var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};function e(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}var i=function(){function t(){this._events={}}return t.prototype.on=function(t,e,i){return this._events[t]||(this._events[t]=[]),this._events[t].push({callback:e,once:!!i}),this},t.prototype.once=function(t,e){return this.on(t,e,!0)},t.prototype.emit=function(t){for(var e=this,i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];var r=this._events[t]||[],s=this._events["*"]||[],o=function(n){for(var r=n.length,s=0;s<r;s++)if(n[s]){var o=n[s],a=o.callback;o.once&&(n.splice(s,1),0===n.length&&delete e._events[t],r--,s--),a.apply(e,i)}};o(r),o(s)},t.prototype.off=function(t,e){if(t)if(e){for(var i=this._events[t]||[],n=i.length,r=0;r<n;r++)i[r].callback===e&&(i.splice(r,1),n--,r--);0===i.length&&delete this._events[t]}else delete this._events[t];else this._events={};return this},t.prototype.getEvents=function(){return this._events},t.prototype.clearEvents=function(){this._events={}},t}(),n=function(t){this.graph=t,this.cfg=this.graph.cfg},r=function(){function t(){}return t.prototype.layout=function(t){this.init(t),this.execute()},t}(),s=function(t){this.cfg=t},o=function(){function t(t){this.graph=t,this.eventHandlers={}}return t.prototype.getDefaultCfg=function(){return{}},t.prototype.getEvents=function(){return{}},t.prototype.shouldBegin=function(){return!0},t.prototype.shouldUpdate=function(){return!0},t.prototype.shouldEnd=function(){return!0},t.prototype.bind=function(){var t=this.getEvents();for(var e in t){var i=this[t[e]].bind(this);this.eventHandlers[e]=i,this.graph.on(e,i)}},t.prototype.unbind=function(){var t=this.getEvents();for(var e in t)this.graph.off(e,this.eventHandlers[e])},t}(),a=(t=>(t[t.WEBGL_LEGACY=0]="WEBGL_LEGACY",t[t.WEBGL=1]="WEBGL",t[t.WEBGL2=2]="WEBGL2",t))(a||{}),h=(t=>(t[t.UNKNOWN=0]="UNKNOWN",t[t.WEBGL=1]="WEBGL",t[t.CANVAS=2]="CANVAS",t))(h||{}),l=(t=>(t[t.COLOR=16384]="COLOR",t[t.DEPTH=256]="DEPTH",t[t.STENCIL=1024]="STENCIL",t))(l||{}),u=(t=>(t[t.NORMAL=0]="NORMAL",t[t.ADD=1]="ADD",t[t.MULTIPLY=2]="MULTIPLY",t[t.SCREEN=3]="SCREEN",t[t.OVERLAY=4]="OVERLAY",t[t.DARKEN=5]="DARKEN",t[t.LIGHTEN=6]="LIGHTEN",t[t.COLOR_DODGE=7]="COLOR_DODGE",t[t.COLOR_BURN=8]="COLOR_BURN",t[t.HARD_LIGHT=9]="HARD_LIGHT",t[t.SOFT_LIGHT=10]="SOFT_LIGHT",t[t.DIFFERENCE=11]="DIFFERENCE",t[t.EXCLUSION=12]="EXCLUSION",t[t.HUE=13]="HUE",t[t.SATURATION=14]="SATURATION",t[t.COLOR=15]="COLOR",t[t.LUMINOSITY=16]="LUMINOSITY",t[t.NORMAL_NPM=17]="NORMAL_NPM",t[t.ADD_NPM=18]="ADD_NPM",t[t.SCREEN_NPM=19]="SCREEN_NPM",t[t.NONE=20]="NONE",t[t.SRC_OVER=0]="SRC_OVER",t[t.SRC_IN=21]="SRC_IN",t[t.SRC_OUT=22]="SRC_OUT",t[t.SRC_ATOP=23]="SRC_ATOP",t[t.DST_OVER=24]="DST_OVER",t[t.DST_IN=25]="DST_IN",t[t.DST_OUT=26]="DST_OUT",t[t.DST_ATOP=27]="DST_ATOP",t[t.ERASE=26]="ERASE",t[t.SUBTRACT=28]="SUBTRACT",t[t.XOR=29]="XOR",t))(u||{}),c=(t=>(t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN",t))(c||{}),d=(t=>(t[t.RGBA=6408]="RGBA",t[t.RGB=6407]="RGB",t[t.RG=33319]="RG",t[t.RED=6403]="RED",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.ALPHA=6406]="ALPHA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t))(d||{}),p=(t=>(t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t))(p||{}),f=(t=>(t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.BYTE=5120]="BYTE",t[t.SHORT=5122]="SHORT",t[t.INT=5124]="INT",t[t.FLOAT=5126]="FLOAT",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.HALF_FLOAT=36193]="HALF_FLOAT",t))(f||{}),g=(t=>(t[t.FLOAT=0]="FLOAT",t[t.INT=1]="INT",t[t.UINT=2]="UINT",t))(g||{}),m=(t=>(t[t.NEAREST=0]="NEAREST",t[t.LINEAR=1]="LINEAR",t))(m||{}),v=(t=>(t[t.CLAMP=33071]="CLAMP",t[t.REPEAT=10497]="REPEAT",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",t))(v||{}),y=(t=>(t[t.OFF=0]="OFF",t[t.POW2=1]="POW2",t[t.ON=2]="ON",t[t.ON_MANUAL=3]="ON_MANUAL",t))(y||{}),_=(t=>(t[t.NPM=0]="NPM",t[t.UNPACK=1]="UNPACK",t[t.PMA=2]="PMA",t[t.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",t[t.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",t[t.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",t))(_||{}),x=(t=>(t[t.NO=0]="NO",t[t.YES=1]="YES",t[t.AUTO=2]="AUTO",t[t.BLEND=0]="BLEND",t[t.CLEAR=1]="CLEAR",t[t.BLIT=2]="BLIT",t))(x||{}),b=(t=>(t[t.AUTO=0]="AUTO",t[t.MANUAL=1]="MANUAL",t))(b||{}),w=(t=>(t.LOW="lowp",t.MEDIUM="mediump",t.HIGH="highp",t))(w||{}),T=(t=>(t[t.NONE=0]="NONE",t[t.SCISSOR=1]="SCISSOR",t[t.STENCIL=2]="STENCIL",t[t.SPRITE=3]="SPRITE",t[t.COLOR=4]="COLOR",t))(T||{}),E=(t=>(t[t.NONE=0]="NONE",t[t.LOW=2]="LOW",t[t.MEDIUM=4]="MEDIUM",t[t.HIGH=8]="HIGH",t))(E||{}),A=(t=>(t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t))(A||{});const S={createCanvas:(t,e)=>{const i=document.createElement("canvas");return i.width=t,i.height=e,i},getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(t,e)=>fetch(t,e),parseXML:t=>(new DOMParser).parseFromString(t,"text/xml")},C={ADAPTER:S,RESOLUTION:1,CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1};var I=/iPhone/i,M=/iPod/i,R=/iPad/i,P=/\biOS-universal(?:.+)Mac\b/i,D=/\bAndroid(?:.+)Mobile\b/i,O=/Android/i,L=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,N=/Silk/i,B=/Windows Phone/i,k=/\bWindows(?:.+)ARM\b/i,F=/BlackBerry/i,U=/BB10/i,G=/Opera Mini/i,z=/\b(CriOS|Chrome)(?:.+)Mobile/i,j=/Mobile(?:.+)Firefox\b/i,H=function(t){return void 0!==t&&"MacIntel"===t.platform&&"number"==typeof t.maxTouchPoints&&t.maxTouchPoints>1&&"undefined"==typeof MSStream};function W(t){var e={userAgent:"",platform:"",maxTouchPoints:0};t||"undefined"==typeof navigator?"string"==typeof t?e.userAgent=t:t&&t.userAgent&&(e={userAgent:t.userAgent,platform:t.platform,maxTouchPoints:t.maxTouchPoints||0}):e={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0};var i=e.userAgent,n=i.split("[FBAN");void 0!==n[1]&&(i=n[0]),void 0!==(n=i.split("Twitter"))[1]&&(i=n[0]);var r=function(t){return function(e){return e.test(t)}}(i),s={apple:{phone:r(I)&&!r(B),ipod:r(M),tablet:!r(I)&&(r(R)||H(e))&&!r(B),universal:r(P),device:(r(I)||r(M)||r(R)||r(P)||H(e))&&!r(B)},amazon:{phone:r(L),tablet:!r(L)&&r(N),device:r(L)||r(N)},android:{phone:!r(B)&&r(L)||!r(B)&&r(D),tablet:!r(B)&&!r(L)&&!r(D)&&(r(N)||r(O)),device:!r(B)&&(r(L)||r(N)||r(D)||r(O))||r(/\bokhttp\b/i)},windows:{phone:r(B),tablet:r(k),device:r(B)||r(k)},other:{blackberry:r(F),blackberry10:r(U),opera:r(G),firefox:r(j),chrome:r(z),device:r(F)||r(U)||r(G)||r(j)||r(z)},any:!1,phone:!1,tablet:!1};return s.any=s.apple.device||s.android.device||s.windows.device||s.other.device,s.phone=s.apple.phone||s.android.phone||s.windows.phone,s.tablet=s.apple.tablet||s.android.tablet||s.windows.tablet,s}const X=(W.default??W)(globalThis.navigator);C.RETINA_PREFIX=/@([0-9\.]+)x/,C.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var V={exports:{}};!function(t){var e=Object.prototype.hasOwnProperty,i="~";function n(){}function r(t,e,i){this.fn=t,this.context=e,this.once=i||!1}function s(t,e,n,s,o){if("function"!=typeof n)throw new TypeError("The listener must be a function");var a=new r(n,s||t,o),h=i?i+e:e;return t._events[h]?t._events[h].fn?t._events[h]=[t._events[h],a]:t._events[h].push(a):(t._events[h]=a,t._eventsCount++),t}function o(t,e){0==--t._eventsCount?t._events=new n:delete t._events[e]}function a(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(i=!1)),a.prototype.eventNames=function(){var t,n,r=[];if(0===this._eventsCount)return r;for(n in t=this._events)e.call(t,n)&&r.push(i?n.slice(1):n);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(t)):r},a.prototype.listeners=function(t){var e=i?i+t:t,n=this._events[e];if(!n)return[];if(n.fn)return[n.fn];for(var r=0,s=n.length,o=new Array(s);r<s;r++)o[r]=n[r].fn;return o},a.prototype.listenerCount=function(t){var e=i?i+t:t,n=this._events[e];return n?n.fn?1:n.length:0},a.prototype.emit=function(t,e,n,r,s,o){var a=i?i+t:t;if(!this._events[a])return!1;var h,l,u=this._events[a],c=arguments.length;if(u.fn){switch(u.once&&this.removeListener(t,u.fn,void 0,!0),c){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,e),!0;case 3:return u.fn.call(u.context,e,n),!0;case 4:return u.fn.call(u.context,e,n,r),!0;case 5:return u.fn.call(u.context,e,n,r,s),!0;case 6:return u.fn.call(u.context,e,n,r,s,o),!0}for(l=1,h=new Array(c-1);l<c;l++)h[l-1]=arguments[l];u.fn.apply(u.context,h)}else{var d,p=u.length;for(l=0;l<p;l++)switch(u[l].once&&this.removeListener(t,u[l].fn,void 0,!0),c){case 1:u[l].fn.call(u[l].context);break;case 2:u[l].fn.call(u[l].context,e);break;case 3:u[l].fn.call(u[l].context,e,n);break;case 4:u[l].fn.call(u[l].context,e,n,r);break;default:if(!h)for(d=1,h=new Array(c-1);d<c;d++)h[d-1]=arguments[d];u[l].fn.apply(u[l].context,h)}}return!0},a.prototype.on=function(t,e,i){return s(this,t,e,i,!1)},a.prototype.once=function(t,e,i){return s(this,t,e,i,!0)},a.prototype.removeListener=function(t,e,n,r){var s=i?i+t:t;if(!this._events[s])return this;if(!e)return o(this,s),this;var a=this._events[s];if(a.fn)a.fn!==e||r&&!a.once||n&&a.context!==n||o(this,s);else{for(var h=0,l=[],u=a.length;h<u;h++)(a[h].fn!==e||r&&!a[h].once||n&&a[h].context!==n)&&l.push(a[h]);l.length?this._events[s]=1===l.length?l[0]:l:o(this,s)}return this},a.prototype.removeAllListeners=function(t){var e;return t?(e=i?i+t:t,this._events[e]&&o(this,e)):(this._events=new n,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=i,a.EventEmitter=a,t.exports=a}(V);var Y=V.exports,$={exports:{}};function q(t,e,i){i=i||2;var n,r,s,o,a,h,l,u=e&&e.length,c=u?e[0]*i:t.length,d=K(t,0,c,i,!0),p=[];if(!d||d.next===d.prev)return p;if(u&&(d=function(t,e,i,n){var r,s,o,a=[];for(r=0,s=e.length;r<s;r++)(o=K(t,e[r]*n,r<s-1?e[r+1]*n:t.length,n,!1))===o.next&&(o.steiner=!0),a.push(at(o));for(a.sort(nt),r=0;r<a.length;r++)i=rt(a[r],i);return i}(t,e,d,i)),t.length>80*i){n=s=t[0],r=o=t[1];for(var f=i;f<c;f+=i)(a=t[f])<n&&(n=a),(h=t[f+1])<r&&(r=h),a>s&&(s=a),h>o&&(o=h);l=0!==(l=Math.max(s-n,o-r))?32767/l:0}return J(d,p,i,n,r,l,0),p}function K(t,e,i,n,r){var s,o;if(r===xt(t,e,i,n)>0)for(s=e;s<i;s+=n)o=vt(s,t[s],t[s+1],o);else for(s=i-n;s>=e;s-=n)o=vt(s,t[s],t[s+1],o);return o&&ct(o,o.next)&&(yt(o),o=o.next),o}function Z(t,e){if(!t)return t;e||(e=t);var i,n=t;do{if(i=!1,n.steiner||!ct(n,n.next)&&0!==ut(n.prev,n,n.next))n=n.next;else{if(yt(n),(n=e=n.prev)===n.next)break;i=!0}}while(i||n!==e);return e}function J(t,e,i,n,r,s,o){if(t){!o&&s&&function(t,e,i,n){var r=t;do{0===r.z&&(r.z=ot(r.x,r.y,e,i,n)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,function(t){var e,i,n,r,s,o,a,h,l=1;do{for(i=t,t=null,s=null,o=0;i;){for(o++,n=i,a=0,e=0;e<l&&(a++,n=n.nextZ);e++);for(h=l;a>0||h>0&&n;)0!==a&&(0===h||!n||i.z<=n.z)?(r=i,i=i.nextZ,a--):(r=n,n=n.nextZ,h--),s?s.nextZ=r:t=r,r.prevZ=s,s=r;i=n}s.nextZ=null,l*=2}while(o>1)}(r)}(t,n,r,s);for(var a,h,l=t;t.prev!==t.next;)if(a=t.prev,h=t.next,s?tt(t,n,r,s):Q(t))e.push(a.i/i|0),e.push(t.i/i|0),e.push(h.i/i|0),yt(t),t=h.next,l=h.next;else if((t=h)===l){o?1===o?J(t=et(Z(t),e,i),e,i,n,r,s,2):2===o&&it(t,e,i,n,r,s):J(Z(t),e,i,n,r,s,1);break}}}function Q(t){var e=t.prev,i=t,n=t.next;if(ut(e,i,n)>=0)return!1;for(var r=e.x,s=i.x,o=n.x,a=e.y,h=i.y,l=n.y,u=r<s?r<o?r:o:s<o?s:o,c=a<h?a<l?a:l:h<l?h:l,d=r>s?r>o?r:o:s>o?s:o,p=a>h?a>l?a:l:h>l?h:l,f=n.next;f!==e;){if(f.x>=u&&f.x<=d&&f.y>=c&&f.y<=p&&ht(r,a,s,h,o,l,f.x,f.y)&&ut(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function tt(t,e,i,n){var r=t.prev,s=t,o=t.next;if(ut(r,s,o)>=0)return!1;for(var a=r.x,h=s.x,l=o.x,u=r.y,c=s.y,d=o.y,p=a<h?a<l?a:l:h<l?h:l,f=u<c?u<d?u:d:c<d?c:d,g=a>h?a>l?a:l:h>l?h:l,m=u>c?u>d?u:d:c>d?c:d,v=ot(p,f,e,i,n),y=ot(g,m,e,i,n),_=t.prevZ,x=t.nextZ;_&&_.z>=v&&x&&x.z<=y;){if(_.x>=p&&_.x<=g&&_.y>=f&&_.y<=m&&_!==r&&_!==o&&ht(a,u,h,c,l,d,_.x,_.y)&&ut(_.prev,_,_.next)>=0)return!1;if(_=_.prevZ,x.x>=p&&x.x<=g&&x.y>=f&&x.y<=m&&x!==r&&x!==o&&ht(a,u,h,c,l,d,x.x,x.y)&&ut(x.prev,x,x.next)>=0)return!1;x=x.nextZ}for(;_&&_.z>=v;){if(_.x>=p&&_.x<=g&&_.y>=f&&_.y<=m&&_!==r&&_!==o&&ht(a,u,h,c,l,d,_.x,_.y)&&ut(_.prev,_,_.next)>=0)return!1;_=_.prevZ}for(;x&&x.z<=y;){if(x.x>=p&&x.x<=g&&x.y>=f&&x.y<=m&&x!==r&&x!==o&&ht(a,u,h,c,l,d,x.x,x.y)&&ut(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}function et(t,e,i){var n=t;do{var r=n.prev,s=n.next.next;!ct(r,s)&&dt(r,n,n.next,s)&&gt(r,s)&&gt(s,r)&&(e.push(r.i/i|0),e.push(n.i/i|0),e.push(s.i/i|0),yt(n),yt(n.next),n=t=s),n=n.next}while(n!==t);return Z(n)}function it(t,e,i,n,r,s){var o=t;do{for(var a=o.next.next;a!==o.prev;){if(o.i!==a.i&&lt(o,a)){var h=mt(o,a);return o=Z(o,o.next),h=Z(h,h.next),J(o,e,i,n,r,s,0),void J(h,e,i,n,r,s,0)}a=a.next}o=o.next}while(o!==t)}function nt(t,e){return t.x-e.x}function rt(t,e){var i=function(t,e){var i,n=e,r=t.x,s=t.y,o=-1/0;do{if(s<=n.y&&s>=n.next.y&&n.next.y!==n.y){var a=n.x+(s-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(a<=r&&a>o&&(o=a,i=n.x<n.next.x?n:n.next,a===r))return i}n=n.next}while(n!==e);if(!i)return null;var h,l=i,u=i.x,c=i.y,d=1/0;n=i;do{r>=n.x&&n.x>=u&&r!==n.x&&ht(s<c?r:o,s,u,c,s<c?o:r,s,n.x,n.y)&&(h=Math.abs(s-n.y)/(r-n.x),gt(n,t)&&(h<d||h===d&&(n.x>i.x||n.x===i.x&&st(i,n)))&&(i=n,d=h)),n=n.next}while(n!==l);return i}(t,e);if(!i)return e;var n=mt(i,t);return Z(n,n.next),Z(i,i.next)}function st(t,e){return ut(t.prev,t,e.prev)<0&&ut(e.next,t,t.next)<0}function ot(t,e,i,n,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*r|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*r|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function at(t){var e=t,i=t;do{(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next}while(e!==t);return i}function ht(t,e,i,n,r,s,o,a){return(r-o)*(e-a)>=(t-o)*(s-a)&&(t-o)*(n-a)>=(i-o)*(e-a)&&(i-o)*(s-a)>=(r-o)*(n-a)}function lt(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&dt(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}(t,e)&&(gt(t,e)&&gt(e,t)&&function(t,e){var i=t,n=!1,r=(t.x+e.x)/2,s=(t.y+e.y)/2;do{i.y>s!=i.next.y>s&&i.next.y!==i.y&&r<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next}while(i!==t);return n}(t,e)&&(ut(t.prev,t,e.prev)||ut(t,e.prev,e))||ct(t,e)&&ut(t.prev,t,t.next)>0&&ut(e.prev,e,e.next)>0)}function ut(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function ct(t,e){return t.x===e.x&&t.y===e.y}function dt(t,e,i,n){var r=ft(ut(t,e,i)),s=ft(ut(t,e,n)),o=ft(ut(i,n,t)),a=ft(ut(i,n,e));return r!==s&&o!==a||(!(0!==r||!pt(t,i,e))||(!(0!==s||!pt(t,n,e))||(!(0!==o||!pt(i,t,n))||!(0!==a||!pt(i,e,n)))))}function pt(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function ft(t){return t>0?1:t<0?-1:0}function gt(t,e){return ut(t.prev,t,t.next)<0?ut(t,e,t.next)>=0&&ut(t,t.prev,e)>=0:ut(t,e,t.prev)<0||ut(t,t.next,e)<0}function mt(t,e){var i=new _t(t.i,t.x,t.y),n=new _t(e.i,e.x,e.y),r=t.next,s=e.prev;return t.next=e,e.prev=t,i.next=r,r.prev=i,n.next=i,i.prev=n,s.next=n,n.prev=s,n}function vt(t,e,i,n){var r=new _t(t,e,i);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function yt(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function _t(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function xt(t,e,i,n){for(var r=0,s=e,o=i-n;s<i;s+=n)r+=(t[o]-t[s])*(t[s+1]+t[o+1]),o=s;return r}$.exports=q,$.exports.default=q,q.deviation=function(t,e,i,n){var r=e&&e.length,s=r?e[0]*i:t.length,o=Math.abs(xt(t,0,s,i));if(r)for(var a=0,h=e.length;a<h;a++){var l=e[a]*i,u=a<h-1?e[a+1]*i:t.length;o-=Math.abs(xt(t,l,u,i))}var c=0;for(a=0;a<n.length;a+=3){var d=n[a]*i,p=n[a+1]*i,f=n[a+2]*i;c+=Math.abs((t[d]-t[f])*(t[p+1]-t[d+1])-(t[d]-t[p])*(t[f+1]-t[d+1]))}return 0===o&&0===c?0:Math.abs((c-o)/o)},q.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},n=0,r=0;r<t.length;r++){for(var s=0;s<t[r].length;s++)for(var o=0;o<e;o++)i.vertices.push(t[r][s][o]);r>0&&(n+=t[r-1].length,i.holes.push(n))}return i};
/*! https://mths.be/punycode v1.4.1 by @mathias */
var bt=2147483647,wt=36,Tt=1,Et=26,At=38,St=700,Ct=72,It=128,Mt="-",Rt=/[^\x20-\x7E]/,Pt=/[\x2E\u3002\uFF0E\uFF61]/g,Dt={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},Ot=wt-Tt,Lt=Math.floor,Nt=String.fromCharCode;function Bt(t){throw new RangeError(Dt[t])}function kt(t,e){return t+22+75*(t<26)-((0!=e)<<5)}function Ft(t,e,i){var n=0;for(t=i?Lt(t/St):t>>1,t+=Lt(t/e);t>Ot*Et>>1;n+=wt)t=Lt(t/Ot);return Lt(n+(Ot+1)*t/(t+At))}function Ut(t){return function(t,e){var i=t.split("@"),n="";i.length>1&&(n=i[0]+"@",t=i[1]);var r=function(t,e){for(var i=t.length,n=[];i--;)n[i]=e(t[i]);return n}((t=t.replace(Pt,".")).split("."),e).join(".");return n+r}(t,(function(t){return Rt.test(t)?"xn--"+function(t){var e,i,n,r,s,o,a,h,l,u,c,d,p,f,g,m=[];for(t=function(t){for(var e,i,n=[],r=0,s=t.length;r<s;)(e=t.charCodeAt(r++))>=55296&&e<=56319&&r<s?56320==(64512&(i=t.charCodeAt(r++)))?n.push(((1023&e)<<10)+(1023&i)+65536):(n.push(e),r--):n.push(e);return n}(t),d=t.length,e=It,i=0,s=Ct,o=0;o<d;++o)(c=t[o])<128&&m.push(Nt(c));for(n=r=m.length,r&&m.push(Mt);n<d;){for(a=bt,o=0;o<d;++o)(c=t[o])>=e&&c<a&&(a=c);for(a-e>Lt((bt-i)/(p=n+1))&&Bt("overflow"),i+=(a-e)*p,e=a,o=0;o<d;++o)if((c=t[o])<e&&++i>bt&&Bt("overflow"),c==e){for(h=i,l=wt;!(h<(u=l<=s?Tt:l>=s+Et?Et:l-s));l+=wt)g=h-u,f=wt-u,m.push(Nt(kt(u+g%f,0))),h=Lt(g/f);m.push(Nt(kt(h,0))),s=Ft(i,p,n==r),i=0,++n}++i,++e}return m.join("")}(t):t}))}var Gt="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{};function zt(t){return null===t}function jt(t){return"string"==typeof t}function Ht(t){return"object"==typeof t&&null!==t}function Wt(t,e){return Object.prototype.hasOwnProperty.call(t,e)}var Xt=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)};function Vt(t){switch(typeof t){case"string":return t;case"boolean":return t?"true":"false";case"number":return isFinite(t)?t:"";default:return""}}function Yt(t,e){if(t.map)return t.map(e);for(var i=[],n=0;n<t.length;n++)i.push(e(t[n],n));return i}var $t=Object.keys||function(t){var e=[];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.push(i);return e};function qt(t,e,i,n){e=e||"&",i=i||"=";var r={};if("string"!=typeof t||0===t.length)return r;var s=/\+/g;t=t.split(e);var o=1e3;n&&"number"==typeof n.maxKeys&&(o=n.maxKeys);var a=t.length;o>0&&a>o&&(a=o);for(var h=0;h<a;++h){var l,u,c,d,p=t[h].replace(s,"%20"),f=p.indexOf(i);f>=0?(l=p.substr(0,f),u=p.substr(f+1)):(l=p,u=""),c=decodeURIComponent(l),d=decodeURIComponent(u),Wt(r,c)?Xt(r[c])?r[c].push(d):r[c]=[r[c],d]:r[c]=d}return r}function Kt(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var Zt=/^([a-z0-9.+-]+:)/i,Jt=/:[0-9]*$/,Qt=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,te=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),ee=["'"].concat(te),ie=["%","/","?",";","#"].concat(ee),ne=["/","?","#"],re=255,se=/^[+a-z0-9A-Z_-]{0,63}$/,oe=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,ae={javascript:!0,"javascript:":!0},he={javascript:!0,"javascript:":!0},le={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0};function ue(t,e,i){if(t&&Ht(t)&&t instanceof Kt)return t;var n=new Kt;return n.parse(t,e,i),n}function ce(t,e,i,n){if(!jt(e))throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var r=e.indexOf("?"),s=-1!==r&&r<e.indexOf("#")?"?":"#",o=e.split(s);o[0]=o[0].replace(/\\/g,"/");var a=e=o.join(s);if(a=a.trim(),!n&&1===e.split("#").length){var h=Qt.exec(a);if(h)return t.path=a,t.href=a,t.pathname=h[1],h[2]?(t.search=h[2],t.query=i?qt(t.search.substr(1)):t.search.substr(1)):i&&(t.search="",t.query={}),t}var l,u,c,d,p=Zt.exec(a);if(p){var f=(p=p[0]).toLowerCase();t.protocol=f,a=a.substr(p.length)}if(n||p||a.match(/^\/\/[^@\/]+@[^@\/]+/)){var g="//"===a.substr(0,2);!g||p&&he[p]||(a=a.substr(2),t.slashes=!0)}if(!he[p]&&(g||p&&!le[p])){var m,v,y=-1;for(l=0;l<ne.length;l++)-1!==(u=a.indexOf(ne[l]))&&(-1===y||u<y)&&(y=u);for(-1!==(v=-1===y?a.lastIndexOf("@"):a.lastIndexOf("@",y))&&(m=a.slice(0,v),a=a.slice(v+1),t.auth=decodeURIComponent(m)),y=-1,l=0;l<ie.length;l++)-1!==(u=a.indexOf(ie[l]))&&(-1===y||u<y)&&(y=u);-1===y&&(y=a.length),t.host=a.slice(0,y),a=a.slice(y),pe(t),t.hostname=t.hostname||"";var _="["===t.hostname[0]&&"]"===t.hostname[t.hostname.length-1];if(!_){var x=t.hostname.split(/\./);for(l=0,c=x.length;l<c;l++){var b=x[l];if(b&&!b.match(se)){for(var w="",T=0,E=b.length;T<E;T++)b.charCodeAt(T)>127?w+="x":w+=b[T];if(!w.match(se)){var A=x.slice(0,l),S=x.slice(l+1),C=b.match(oe);C&&(A.push(C[1]),S.unshift(C[2])),S.length&&(a="/"+S.join(".")+a),t.hostname=A.join(".");break}}}}t.hostname.length>re?t.hostname="":t.hostname=t.hostname.toLowerCase(),_||(t.hostname=Ut(t.hostname)),d=t.port?":"+t.port:"";var I=t.hostname||"";t.host=I+d,t.href+=t.host,_&&(t.hostname=t.hostname.substr(1,t.hostname.length-2),"/"!==a[0]&&(a="/"+a))}if(!ae[f])for(l=0,c=ee.length;l<c;l++){var M=ee[l];if(-1!==a.indexOf(M)){var R=encodeURIComponent(M);R===M&&(R=escape(M)),a=a.split(M).join(R)}}var P=a.indexOf("#");-1!==P&&(t.hash=a.substr(P),a=a.slice(0,P));var D=a.indexOf("?");if(-1!==D?(t.search=a.substr(D),t.query=a.substr(D+1),i&&(t.query=qt(t.query)),a=a.slice(0,D)):i&&(t.search="",t.query={}),a&&(t.pathname=a),le[f]&&t.hostname&&!t.pathname&&(t.pathname="/"),t.pathname||t.search){d=t.pathname||"";var O=t.search||"";t.path=d+O}return t.href=de(t),t}function de(t){var e=t.auth||"";e&&(e=(e=encodeURIComponent(e)).replace(/%3A/i,":"),e+="@");var i=t.protocol||"",n=t.pathname||"",r=t.hash||"",s=!1,o="";t.host?s=e+t.host:t.hostname&&(s=e+(-1===t.hostname.indexOf(":")?t.hostname:"["+this.hostname+"]"),t.port&&(s+=":"+t.port)),t.query&&Ht(t.query)&&Object.keys(t.query).length&&(o=function(t,e,i,n){return e=e||"&",i=i||"=",null===t&&(t=void 0),"object"==typeof t?Yt($t(t),(function(n){var r=encodeURIComponent(Vt(n))+i;return Xt(t[n])?Yt(t[n],(function(t){return r+encodeURIComponent(Vt(t))})).join(e):r+encodeURIComponent(Vt(t[n]))})).join(e):n?encodeURIComponent(Vt(n))+i+encodeURIComponent(Vt(t)):""}(t.query));var a=t.search||o&&"?"+o||"";return i&&":"!==i.substr(-1)&&(i+=":"),t.slashes||(!i||le[i])&&!1!==s?(s="//"+(s||""),n&&"/"!==n.charAt(0)&&(n="/"+n)):s||(s=""),r&&"#"!==r.charAt(0)&&(r="#"+r),a&&"?"!==a.charAt(0)&&(a="?"+a),i+s+(n=n.replace(/[?#]/g,(function(t){return encodeURIComponent(t)})))+(a=a.replace("#","%23"))+r}function pe(t){var e=t.host,i=Jt.exec(e);i&&(":"!==(i=i[0])&&(t.port=i.substr(1)),e=e.substr(0,e.length-i.length)),e&&(t.hostname=e)}Kt.prototype.parse=function(t,e,i){return ce(this,t,e,i)},Kt.prototype.format=function(){return de(this)},Kt.prototype.resolve=function(t){return this.resolveObject(ue(t,!1,!0)).format()},Kt.prototype.resolveObject=function(t){if(jt(t)){var e=new Kt;e.parse(t,!1,!0),t=e}for(var i,n=new Kt,r=Object.keys(this),s=0;s<r.length;s++){var o=r[s];n[o]=this[o]}if(n.hash=t.hash,""===t.href)return n.href=n.format(),n;if(t.slashes&&!t.protocol){for(var a=Object.keys(t),h=0;h<a.length;h++){var l=a[h];"protocol"!==l&&(n[l]=t[l])}return le[n.protocol]&&n.hostname&&!n.pathname&&(n.path=n.pathname="/"),n.href=n.format(),n}if(t.protocol&&t.protocol!==n.protocol){if(!le[t.protocol]){for(var u=Object.keys(t),c=0;c<u.length;c++){var d=u[c];n[d]=t[d]}return n.href=n.format(),n}if(n.protocol=t.protocol,t.host||he[t.protocol])n.pathname=t.pathname;else{for(i=(t.pathname||"").split("/");i.length&&!(t.host=i.shift()););t.host||(t.host=""),t.hostname||(t.hostname=""),""!==i[0]&&i.unshift(""),i.length<2&&i.unshift(""),n.pathname=i.join("/")}if(n.search=t.search,n.query=t.query,n.host=t.host||"",n.auth=t.auth,n.hostname=t.hostname||t.host,n.port=t.port,n.pathname||n.search){var p=n.pathname||"",f=n.search||"";n.path=p+f}return n.slashes=n.slashes||t.slashes,n.href=n.format(),n}var g,m=n.pathname&&"/"===n.pathname.charAt(0),v=t.host||t.pathname&&"/"===t.pathname.charAt(0),y=v||m||n.host&&t.pathname,_=y,x=n.pathname&&n.pathname.split("/")||[],b=n.protocol&&!le[n.protocol];if(i=t.pathname&&t.pathname.split("/")||[],b&&(n.hostname="",n.port=null,n.host&&(""===x[0]?x[0]=n.host:x.unshift(n.host)),n.host="",t.protocol&&(t.hostname=null,t.port=null,t.host&&(""===i[0]?i[0]=t.host:i.unshift(t.host)),t.host=null),y=y&&(""===i[0]||""===x[0])),v)n.host=t.host||""===t.host?t.host:n.host,n.hostname=t.hostname||""===t.hostname?t.hostname:n.hostname,n.search=t.search,n.query=t.query,x=i;else if(i.length)x||(x=[]),x.pop(),x=x.concat(i),n.search=t.search,n.query=t.query;else if(null!=t.search)return b&&(n.hostname=n.host=x.shift(),(g=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=g.shift(),n.host=n.hostname=g.shift())),n.search=t.search,n.query=t.query,zt(n.pathname)&&zt(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.href=n.format(),n;if(!x.length)return n.pathname=null,n.search?n.path="/"+n.search:n.path=null,n.href=n.format(),n;for(var w=x.slice(-1)[0],T=(n.host||t.host||x.length>1)&&("."===w||".."===w)||""===w,E=0,A=x.length;A>=0;A--)"."===(w=x[A])?x.splice(A,1):".."===w?(x.splice(A,1),E++):E&&(x.splice(A,1),E--);if(!y&&!_)for(;E--;E)x.unshift("..");!y||""===x[0]||x[0]&&"/"===x[0].charAt(0)||x.unshift(""),T&&"/"!==x.join("/").substr(-1)&&x.push("");var S=""===x[0]||x[0]&&"/"===x[0].charAt(0);return b&&(n.hostname=n.host=S?"":x.length?x.shift():"",(g=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=g.shift(),n.host=n.hostname=g.shift())),(y=y||n.host&&x.length)&&!S&&x.unshift(""),x.length?n.pathname=x.join("/"):(n.pathname=null,n.path=null),zt(n.pathname)&&zt(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.auth=t.auth||n.auth,n.slashes=n.slashes||t.slashes,n.href=n.format(),n},Kt.prototype.parseHost=function(){return pe(this)};const fe={parse:ue,format:function(t){return jt(t)&&(t=ce({},t)),de(t)},resolve:function(t,e){return ue(t,!1,!0).resolve(e)}};function ge(t){if("string"!=typeof t)throw new TypeError(`Path must be a string. Received ${JSON.stringify(t)}`)}function me(t){return t.split("?")[0].split("#")[0]}const ve={toPosix:t=>function(t,e,i){return t.replace(new RegExp(function(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}(e),"g"),i)}(t,"\\","/"),isUrl(t){return/^https?:/.test(this.toPosix(t))},isDataUrl:t=>/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(t),hasProtocol(t){return/^[^/:]+:\//.test(this.toPosix(t))},getProtocol(t){ge(t),t=this.toPosix(t);let e="";const i=/^file:\/\/\//.exec(t),n=/^[^/:]+:\/\//.exec(t),r=/^[^/:]+:\//.exec(t);if(i||n||r){const s=i?.[0]||n?.[0]||r?.[0];e=s,t=t.slice(s.length)}return e},toAbsolute(t,e,i){if(this.isDataUrl(t))return t;const n=me(this.toPosix(e??C.ADAPTER.getBaseUrl())),r=me(this.toPosix(i??this.rootname(n)));if(ge(t),(t=this.toPosix(t)).startsWith("/"))return ve.join(r,t.slice(1));return this.isAbsolute(t)?t:this.join(n,t)},normalize(t){if(ge(t=this.toPosix(t)),0===t.length)return".";let e="";const i=t.startsWith("/");this.hasProtocol(t)&&(e=this.rootname(t),t=t.slice(e.length));const n=t.endsWith("/");return t=function(t,e){let i="",n=0,r=-1,s=0,o=-1;for(let a=0;a<=t.length;++a){if(a<t.length)o=t.charCodeAt(a);else{if(47===o)break;o=47}if(47===o){if(r===a-1||1===s);else if(r!==a-1&&2===s){if(i.length<2||2!==n||46!==i.charCodeAt(i.length-1)||46!==i.charCodeAt(i.length-2))if(i.length>2){const t=i.lastIndexOf("/");if(t!==i.length-1){-1===t?(i="",n=0):(i=i.slice(0,t),n=i.length-1-i.lastIndexOf("/")),r=a,s=0;continue}}else if(2===i.length||1===i.length){i="",n=0,r=a,s=0;continue}e&&(i.length>0?i+="/..":i="..",n=2)}else i.length>0?i+=`/${t.slice(r+1,a)}`:i=t.slice(r+1,a),n=a-r-1;r=a,s=0}else 46===o&&-1!==s?++s:s=-1}return i}(t,!1),t.length>0&&n&&(t+="/"),i?`/${t}`:e+t},isAbsolute(t){return ge(t),t=this.toPosix(t),!!this.hasProtocol(t)||t.startsWith("/")},join(...t){if(0===t.length)return".";let e;for(let i=0;i<t.length;++i){const n=t[i];if(ge(n),n.length>0)if(void 0===e)e=n;else{const r=t[i-1]??"";this.extname(r)?e+=`/../${n}`:e+=`/${n}`}}return void 0===e?".":this.normalize(e)},dirname(t){if(ge(t),0===t.length)return".";let e=(t=this.toPosix(t)).charCodeAt(0);const i=47===e;let n=-1,r=!0;const s=this.getProtocol(t),o=t;for(let i=(t=t.slice(s.length)).length-1;i>=1;--i)if(e=t.charCodeAt(i),47===e){if(!r){n=i;break}}else r=!1;return-1===n?i?"/":this.isUrl(o)?s+t:s:i&&1===n?"//":s+t.slice(0,n)},rootname(t){ge(t);let e="";if(e=(t=this.toPosix(t)).startsWith("/")?"/":this.getProtocol(t),this.isUrl(t)){const i=t.indexOf("/",e.length);e=-1!==i?t.slice(0,i):t,e.endsWith("/")||(e+="/")}return e},basename(t,e){ge(t),e&&ge(e),t=me(this.toPosix(t));let i,n=0,r=-1,s=!0;if(void 0!==e&&e.length>0&&e.length<=t.length){if(e.length===t.length&&e===t)return"";let o=e.length-1,a=-1;for(i=t.length-1;i>=0;--i){const h=t.charCodeAt(i);if(47===h){if(!s){n=i+1;break}}else-1===a&&(s=!1,a=i+1),o>=0&&(h===e.charCodeAt(o)?-1==--o&&(r=i):(o=-1,r=a))}return n===r?r=a:-1===r&&(r=t.length),t.slice(n,r)}for(i=t.length-1;i>=0;--i)if(47===t.charCodeAt(i)){if(!s){n=i+1;break}}else-1===r&&(s=!1,r=i+1);return-1===r?"":t.slice(n,r)},extname(t){ge(t);let e=-1,i=0,n=-1,r=!0,s=0;for(let o=(t=me(this.toPosix(t))).length-1;o>=0;--o){const a=t.charCodeAt(o);if(47!==a)-1===n&&(r=!1,n=o+1),46===a?-1===e?e=o:1!==s&&(s=1):-1!==e&&(s=-1);else if(!r){i=o+1;break}}return-1===e||-1===n||0===s||1===s&&e===n-1&&e===i+1?"":t.slice(e,n)},parse(t){ge(t);const e={root:"",dir:"",base:"",ext:"",name:""};if(0===t.length)return e;let i=(t=me(this.toPosix(t))).charCodeAt(0);const n=this.isAbsolute(t);let r;e.root=this.rootname(t),r=n||this.hasProtocol(t)?1:0;let s=-1,o=0,a=-1,h=!0,l=t.length-1,u=0;for(;l>=r;--l)if(i=t.charCodeAt(l),47!==i)-1===a&&(h=!1,a=l+1),46===i?-1===s?s=l:1!==u&&(u=1):-1!==s&&(u=-1);else if(!h){o=l+1;break}return-1===s||-1===a||0===u||1===u&&s===a-1&&s===o+1?-1!==a&&(e.base=e.name=0===o&&n?t.slice(1,a):t.slice(o,a)):(0===o&&n?(e.name=t.slice(1,s),e.base=t.slice(1,a)):(e.name=t.slice(o,s),e.base=t.slice(o,a)),e.ext=t.slice(s,a)),e.dir=this.dirname(t),e},sep:"/",delimiter:":"},ye={};function _e(t,e,i=3){if(ye[e])return;let n=(new Error).stack;void 0===n?console.warn("PixiJS Deprecation Warning: ",`${e}\nDeprecated since v${t}`):(n=n.split("\n").splice(i).join("\n"),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",`${e}\nDeprecated since v${t}`),console.warn(n),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",`${e}\nDeprecated since v${t}`),console.warn(n))),ye[e]=!0}let xe;var be={grad:.9,turn:360,rad:360/(2*Math.PI)},we=function(t){return"string"==typeof t?t.length>0:"number"==typeof t},Te=function(t,e,i){return void 0===e&&(e=0),void 0===i&&(i=Math.pow(10,e)),Math.round(i*t)/i+0},Ee=function(t,e,i){return void 0===e&&(e=0),void 0===i&&(i=1),t>i?i:t>e?t:e},Ae=function(t){return(t=isFinite(t)?t%360:0)>0?t:t+360},Se=function(t){return{r:Ee(t.r,0,255),g:Ee(t.g,0,255),b:Ee(t.b,0,255),a:Ee(t.a)}},Ce=function(t){return{r:Te(t.r),g:Te(t.g),b:Te(t.b),a:Te(t.a,3)}},Ie=/^#([0-9a-f]{3,8})$/i,Me=function(t){var e=t.toString(16);return e.length<2?"0"+e:e},Re=function(t){var e=t.r,i=t.g,n=t.b,r=t.a,s=Math.max(e,i,n),o=s-Math.min(e,i,n),a=o?s===e?(i-n)/o:s===i?2+(n-e)/o:4+(e-i)/o:0;return{h:60*(a<0?a+6:a),s:s?o/s*100:0,v:s/255*100,a:r}},Pe=function(t){var e=t.h,i=t.s,n=t.v,r=t.a;e=e/360*6,i/=100,n/=100;var s=Math.floor(e),o=n*(1-i),a=n*(1-(e-s)*i),h=n*(1-(1-e+s)*i),l=s%6;return{r:255*[n,a,o,o,h,n][l],g:255*[h,n,n,a,o,o][l],b:255*[o,o,h,n,n,a][l],a:r}},De=function(t){return{h:Ae(t.h),s:Ee(t.s,0,100),l:Ee(t.l,0,100),a:Ee(t.a)}},Oe=function(t){return{h:Te(t.h),s:Te(t.s),l:Te(t.l),a:Te(t.a,3)}},Le=function(t){return Pe((i=(e=t).s,{h:e.h,s:(i*=((n=e.l)<50?n:100-n)/100)>0?2*i/(n+i)*100:0,v:n+i,a:e.a}));var e,i,n},Ne=function(t){return{h:(e=Re(t)).h,s:(r=(200-(i=e.s))*(n=e.v)/100)>0&&r<200?i*n/100/(r<=100?r:200-r)*100:0,l:r/2,a:e.a};var e,i,n,r},Be=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,ke=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Fe=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Ue=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Ge={string:[[function(t){var e=Ie.exec(t);return e?(t=e[1]).length<=4?{r:parseInt(t[0]+t[0],16),g:parseInt(t[1]+t[1],16),b:parseInt(t[2]+t[2],16),a:4===t.length?Te(parseInt(t[3]+t[3],16)/255,2):1}:6===t.length||8===t.length?{r:parseInt(t.substr(0,2),16),g:parseInt(t.substr(2,2),16),b:parseInt(t.substr(4,2),16),a:8===t.length?Te(parseInt(t.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(t){var e=Fe.exec(t)||Ue.exec(t);return e?e[2]!==e[4]||e[4]!==e[6]?null:Se({r:Number(e[1])/(e[2]?100/255:1),g:Number(e[3])/(e[4]?100/255:1),b:Number(e[5])/(e[6]?100/255:1),a:void 0===e[7]?1:Number(e[7])/(e[8]?100:1)}):null},"rgb"],[function(t){var e=Be.exec(t)||ke.exec(t);if(!e)return null;var i,n,r=De({h:(i=e[1],n=e[2],void 0===n&&(n="deg"),Number(i)*(be[n]||1)),s:Number(e[3]),l:Number(e[4]),a:void 0===e[5]?1:Number(e[5])/(e[6]?100:1)});return Le(r)},"hsl"]],object:[[function(t){var e=t.r,i=t.g,n=t.b,r=t.a,s=void 0===r?1:r;return we(e)&&we(i)&&we(n)?Se({r:Number(e),g:Number(i),b:Number(n),a:Number(s)}):null},"rgb"],[function(t){var e=t.h,i=t.s,n=t.l,r=t.a,s=void 0===r?1:r;if(!we(e)||!we(i)||!we(n))return null;var o=De({h:Number(e),s:Number(i),l:Number(n),a:Number(s)});return Le(o)},"hsl"],[function(t){var e=t.h,i=t.s,n=t.v,r=t.a,s=void 0===r?1:r;if(!we(e)||!we(i)||!we(n))return null;var o=function(t){return{h:Ae(t.h),s:Ee(t.s,0,100),v:Ee(t.v,0,100),a:Ee(t.a)}}({h:Number(e),s:Number(i),v:Number(n),a:Number(s)});return Pe(o)},"hsv"]]},ze=function(t,e){for(var i=0;i<e.length;i++){var n=e[i][0](t);if(n)return[n,e[i][1]]}return[null,void 0]},je=function(t,e){var i=Ne(t);return{h:i.h,s:Ee(i.s+100*e,0,100),l:i.l,a:i.a}},He=function(t){return(299*t.r+587*t.g+114*t.b)/1e3/255},We=function(t,e){var i=Ne(t);return{h:i.h,s:i.s,l:Ee(i.l+100*e,0,100),a:i.a}},Xe=function(){function t(t){this.parsed=function(t){return"string"==typeof t?ze(t.trim(),Ge.string):"object"==typeof t&&null!==t?ze(t,Ge.object):[null,void 0]}(t)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return t.prototype.isValid=function(){return null!==this.parsed},t.prototype.brightness=function(){return Te(He(this.rgba),2)},t.prototype.isDark=function(){return He(this.rgba)<.5},t.prototype.isLight=function(){return He(this.rgba)>=.5},t.prototype.toHex=function(){return e=(t=Ce(this.rgba)).r,i=t.g,n=t.b,s=(r=t.a)<1?Me(Te(255*r)):"","#"+Me(e)+Me(i)+Me(n)+s;var t,e,i,n,r,s},t.prototype.toRgb=function(){return Ce(this.rgba)},t.prototype.toRgbString=function(){return e=(t=Ce(this.rgba)).r,i=t.g,n=t.b,(r=t.a)<1?"rgba("+e+", "+i+", "+n+", "+r+")":"rgb("+e+", "+i+", "+n+")";var t,e,i,n,r},t.prototype.toHsl=function(){return Oe(Ne(this.rgba))},t.prototype.toHslString=function(){return e=(t=Oe(Ne(this.rgba))).h,i=t.s,n=t.l,(r=t.a)<1?"hsla("+e+", "+i+"%, "+n+"%, "+r+")":"hsl("+e+", "+i+"%, "+n+"%)";var t,e,i,n,r},t.prototype.toHsv=function(){return t=Re(this.rgba),{h:Te(t.h),s:Te(t.s),v:Te(t.v),a:Te(t.a,3)};var t},t.prototype.invert=function(){return Ve({r:255-(t=this.rgba).r,g:255-t.g,b:255-t.b,a:t.a});var t},t.prototype.saturate=function(t){return void 0===t&&(t=.1),Ve(je(this.rgba,t))},t.prototype.desaturate=function(t){return void 0===t&&(t=.1),Ve(je(this.rgba,-t))},t.prototype.grayscale=function(){return Ve(je(this.rgba,-1))},t.prototype.lighten=function(t){return void 0===t&&(t=.1),Ve(We(this.rgba,t))},t.prototype.darken=function(t){return void 0===t&&(t=.1),Ve(We(this.rgba,-t))},t.prototype.rotate=function(t){return void 0===t&&(t=15),this.hue(this.hue()+t)},t.prototype.alpha=function(t){return"number"==typeof t?Ve({r:(e=this.rgba).r,g:e.g,b:e.b,a:t}):Te(this.rgba.a,3);var e},t.prototype.hue=function(t){var e=Ne(this.rgba);return"number"==typeof t?Ve({h:t,s:e.s,l:e.l,a:e.a}):Te(e.h)},t.prototype.isEqual=function(t){return this.toHex()===Ve(t).toHex()},t}(),Ve=function(t){return t instanceof Xe?t:new Xe(t)},Ye=[];!function(t){t.forEach((function(t){Ye.indexOf(t)<0&&(t(Xe,Ge),Ye.push(t))}))}([function(t,e){var i={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},n={};for(var r in i)n[i[r]]=r;var s={};t.prototype.toName=function(e){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var r,o,a=n[this.toHex()];if(a)return a;if(null==e?void 0:e.closest){var h=this.toRgb(),l=1/0,u="black";if(!s.length)for(var c in i)s[c]=new t(i[c]).toRgb();for(var d in i){var p=(r=h,o=s[d],Math.pow(r.r-o.r,2)+Math.pow(r.g-o.g,2)+Math.pow(r.b-o.b,2));p<l&&(l=p,u=d)}return u}},e.string.push([function(e){var n=e.toLowerCase(),r="transparent"===n?"#0000":i[n];return r?new t(r).toRgb():null},"name"])}]);const $e=class{constructor(t=16777215){this._value=null,this._components=new Float32Array(4),this._components.fill(1),this._int=16777215,this.value=t}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue(t){return this.value=t,this}set value(t){if(t instanceof $e)this._value=this.cloneSource(t._value),this._int=t._int,this._components.set(t._components);else{if(null===t)throw new Error("Cannot set PIXI.Color#value to null");null!==this._value&&this.isSourceEqual(this._value,t)||(this.normalize(t),this._value=this.cloneSource(t))}}get value(){return this._value}cloneSource(t){return"string"==typeof t||"number"==typeof t||t instanceof Number||null===t?t:Array.isArray(t)||ArrayBuffer.isView(t)?t.slice(0):"object"==typeof t&&null!==t?{...t}:t}isSourceEqual(t,e){const i=typeof t;if(i!==typeof e)return!1;if("number"===i||"string"===i||t instanceof Number)return t===e;if(Array.isArray(t)&&Array.isArray(e)||ArrayBuffer.isView(t)&&ArrayBuffer.isView(e))return t.length===e.length&&t.every(((t,i)=>t===e[i]));if(null!==t&&null!==e){const i=Object.keys(t),n=Object.keys(e);return i.length===n.length&&i.every((i=>t[i]===e[i]))}return t===e}toRgba(){const[t,e,i,n]=this._components;return{r:t,g:e,b:i,a:n}}toRgb(){const[t,e,i]=this._components;return{r:t,g:e,b:i}}toRgbaString(){const[t,e,i]=this.toUint8RgbArray();return`rgba(${t},${e},${i},${this.alpha})`}toUint8RgbArray(t){const[e,i,n]=this._components;return(t=t??[])[0]=Math.round(255*e),t[1]=Math.round(255*i),t[2]=Math.round(255*n),t}toRgbArray(t){t=t??[];const[e,i,n]=this._components;return t[0]=e,t[1]=i,t[2]=n,t}toNumber(){return this._int}toLittleEndianNumber(){const t=this._int;return(t>>16)+(65280&t)+((255&t)<<16)}multiply(t){const[e,i,n,r]=$e.temp.setValue(t)._components;return this._components[0]*=e,this._components[1]*=i,this._components[2]*=n,this._components[3]*=r,this.refreshInt(),this._value=null,this}premultiply(t,e=!0){return e&&(this._components[0]*=t,this._components[1]*=t,this._components[2]*=t),this._components[3]=t,this.refreshInt(),this._value=null,this}toPremultiplied(t,e=!0){if(1===t)return(255<<24)+this._int;if(0===t)return e?0:this._int;let i=this._int>>16&255,n=this._int>>8&255,r=255&this._int;return e&&(i=i*t+.5|0,n=n*t+.5|0,r=r*t+.5|0),(255*t<<24)+(i<<16)+(n<<8)+r}toHex(){const t=this._int.toString(16);return`#${"000000".substring(0,6-t.length)+t}`}toHexa(){const t=Math.round(255*this._components[3]).toString(16);return this.toHex()+"00".substring(0,2-t.length)+t}setAlpha(t){return this._components[3]=this._clamp(t),this}round(t){const[e,i,n]=this._components;return this._components[0]=Math.round(e*t)/t,this._components[1]=Math.round(i*t)/t,this._components[2]=Math.round(n*t)/t,this.refreshInt(),this._value=null,this}toArray(t){t=t??[];const[e,i,n,r]=this._components;return t[0]=e,t[1]=i,t[2]=n,t[3]=r,t}normalize(t){let e,i,n,r;if(("number"==typeof t||t instanceof Number)&&t>=0&&t<=16777215){e=(t>>16&255)/255,i=(t>>8&255)/255,n=(255&t)/255,r=1}else if((Array.isArray(t)||t instanceof Float32Array)&&t.length>=3&&t.length<=4)t=this._clamp(t),[e,i,n,r=1]=t;else if((t instanceof Uint8Array||t instanceof Uint8ClampedArray)&&t.length>=3&&t.length<=4)t=this._clamp(t,0,255),[e,i,n,r=255]=t,e/=255,i/=255,n/=255,r/=255;else if("string"==typeof t||"object"==typeof t){if("string"==typeof t){const e=$e.HEX_PATTERN.exec(t);e&&(t=`#${e[2]}`)}const s=Ve(t);s.isValid()&&(({r:e,g:i,b:n,a:r}=s.rgba),e/=255,i/=255,n/=255)}if(void 0===e)throw new Error(`Unable to convert color ${t}`);this._components[0]=e,this._components[1]=i,this._components[2]=n,this._components[3]=r,this.refreshInt()}refreshInt(){this._clamp(this._components);const[t,e,i]=this._components;this._int=(255*t<<16)+(255*e<<8)+(255*i|0)}_clamp(t,e=0,i=1){return"number"==typeof t?Math.min(Math.max(t,e),i):(t.forEach(((n,r)=>{t[r]=Math.min(Math.max(n,e),i)})),t)}};let qe=$e;function Ke(t,e=[]){return _e("7.2.0","utils.hex2rgb is deprecated, use Color#toRgbArray instead"),qe.shared.setValue(t).toRgbArray(e)}qe.shared=new $e,qe.temp=new $e,qe.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;const Ze=function(){const t=[],e=[];for(let i=0;i<32;i++)t[i]=i,e[i]=i;t[u.NORMAL_NPM]=u.NORMAL,t[u.ADD_NPM]=u.ADD,t[u.SCREEN_NPM]=u.SCREEN,e[u.NORMAL]=u.NORMAL_NPM,e[u.ADD]=u.ADD_NPM,e[u.SCREEN]=u.SCREEN_NPM;const i=[];return i.push(e),i.push(t),i}();function Je(t,e){return Ze[e?1:0][t]}function Qe(t){if(4===t.BYTES_PER_ELEMENT)return t instanceof Float32Array?"Float32Array":t instanceof Uint32Array?"Uint32Array":"Int32Array";if(2===t.BYTES_PER_ELEMENT){if(t instanceof Uint16Array)return"Uint16Array"}else if(1===t.BYTES_PER_ELEMENT&&t instanceof Uint8Array)return"Uint8Array";return null}function ti(t){return t+=0===t?1:0,--t,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,(t|=t>>>16)+1}function ei(t){return!(t&t-1||!t)}function ii(t){let e=(t>65535?1:0)<<4,i=((t>>>=e)>255?1:0)<<3;return e|=i,i=((t>>>=i)>15?1:0)<<2,e|=i,i=((t>>>=i)>3?1:0)<<1,e|=i,e|(t>>>=i)>>1}function ni(t,e,i){const n=t.length;let r;if(e>=n||0===i)return;const s=n-(i=e+i>n?n-e:i);for(r=e;r<s;++r)t[r]=t[r+i];t.length=s}function ri(t){return 0===t?0:t<0?-1:1}let si=0;function oi(){return++si}const ai=class{constructor(t,e,i,n){this.left=t,this.top=e,this.right=i,this.bottom=n}get width(){return this.right-this.left}get height(){return this.bottom-this.top}isEmpty(){return this.left===this.right||this.top===this.bottom}};let hi=ai;hi.EMPTY=new ai(0,0,0,0);const li={},ui=Object.create(null),ci=Object.create(null);class di{constructor(t,e,i){this._canvas=C.ADAPTER.createCanvas(),this._context=this._canvas.getContext("2d"),this.resolution=i||C.RESOLUTION,this.resize(t,e)}clear(){this._checkDestroyed(),this._context.setTransform(1,0,0,1,0,0),this._context.clearRect(0,0,this._canvas.width,this._canvas.height)}resize(t,e){this._checkDestroyed(),this._canvas.width=Math.round(t*this.resolution),this._canvas.height=Math.round(e*this.resolution)}destroy(){this._context=null,this._canvas=null}get width(){return this._checkDestroyed(),this._canvas.width}set width(t){this._checkDestroyed(),this._canvas.width=Math.round(t)}get height(){return this._checkDestroyed(),this._canvas.height}set height(t){this._checkDestroyed(),this._canvas.height=Math.round(t)}get canvas(){return this._checkDestroyed(),this._canvas}get context(){return this._checkDestroyed(),this._context}_checkDestroyed(){if(null===this._canvas)throw new TypeError("The CanvasRenderTarget has already been destroyed")}}function pi(t,e,i){for(let n=0,r=4*i*e;n<e;++n,r+=4)if(0!==t[r+3])return!1;return!0}function fi(t,e,i,n,r){const s=4*e;for(let e=n,o=n*s+4*i;e<=r;++e,o+=s)if(0!==t[o+3])return!1;return!0}function gi(t){const e=function(t){const{width:e,height:i}=t,n=t.getContext("2d",{willReadFrequently:!0});if(null===n)throw new TypeError("Failed to get canvas 2D context");const r=n.getImageData(0,0,e,i).data;let s=0,o=0,a=e-1,h=i-1;for(;o<i&&pi(r,e,o);)++o;if(o===i)return hi.EMPTY;for(;pi(r,e,h);)--h;for(;fi(r,e,s,o,h);)++s;for(;fi(r,e,a,o,h);)--a;return++a,++h,new hi(s,o,a,h)}(t),{width:i,height:n}=e;let r=null;if(!e.isEmpty()){const s=t.getContext("2d");if(null===s)throw new TypeError("Failed to get canvas 2D context");r=s.getImageData(e.left,e.top,i,n)}return{width:i,height:n,data:r}}let mi;function vi(t,e=globalThis.location){if(t.startsWith("data:"))return"";e=e||globalThis.location,mi||(mi=document.createElement("a")),mi.href=t;const i=fe.parse(mi.href),n=!i.port&&""===e.port||i.port===e.port;return i.hostname===e.hostname&&n&&i.protocol===e.protocol?"":"anonymous"}function yi(t,e=1){const i=C.RETINA_PREFIX?.exec(t);return i?parseFloat(i[1]):e}var _i=(t=>(t.Renderer="renderer",t.Application="application",t.RendererSystem="renderer-webgl-system",t.RendererPlugin="renderer-webgl-plugin",t.CanvasRendererSystem="renderer-canvas-system",t.CanvasRendererPlugin="renderer-canvas-plugin",t.Asset="asset",t.LoadParser="load-parser",t.ResolveParser="resolve-parser",t.CacheParser="cache-parser",t.DetectionParser="detection-parser",t))(_i||{});const xi=t=>{if("function"==typeof t||"object"==typeof t&&t.extension){if(!t.extension)throw new Error("Extension class must have an extension object");t={..."object"!=typeof t.extension?{type:t.extension}:t.extension,ref:t}}if("object"!=typeof t)throw new Error("Invalid extension type");return"string"==typeof(t={...t}).type&&(t.type=[t.type]),t},bi=(t,e)=>xi(t).priority??e,wi={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...t){return t.map(xi).forEach((t=>{t.type.forEach((e=>this._removeHandlers[e]?.(t)))})),this},add(...t){return t.map(xi).forEach((t=>{t.type.forEach((e=>{const i=this._addHandlers,n=this._queue;i[e]?i[e](t):(n[e]=n[e]||[],n[e].push(t))}))})),this},handle(t,e,i){const n=this._addHandlers,r=this._removeHandlers;if(n[t]||r[t])throw new Error(`Extension type ${t} already has a handler`);n[t]=e,r[t]=i;const s=this._queue;return s[t]&&(s[t].forEach((t=>e(t))),delete s[t]),this},handleByMap(t,e){return this.handle(t,(t=>{e[t.name]=t.ref}),(t=>{delete e[t.name]}))},handleByList(t,e,i=-1){return this.handle(t,(t=>{e.includes(t.ref)||(e.push(t.ref),e.sort(((t,e)=>bi(e,i)-bi(t,i))))}),(t=>{const i=e.indexOf(t.ref);-1!==i&&e.splice(i,1)}))}};class Ti{constructor(t){"number"==typeof t?this.rawBinaryData=new ArrayBuffer(t):t instanceof Uint8Array?this.rawBinaryData=t.buffer:this.rawBinaryData=t,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get uint16View(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}view(t){return this[`${t}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${t} isn't a valid view type`)}}}const Ei=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join("\n");function Ai(t){let e="";for(let i=0;i<t;++i)i>0&&(e+="\nelse "),i<t-1&&(e+=`if(test == ${i}.0){}`);return e}class Si{constructor(){this.data=0,this.blendMode=u.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(1&this.data)}set blend(t){!!(1&this.data)!==t&&(this.data^=1)}get offsets(){return!!(2&this.data)}set offsets(t){!!(2&this.data)!==t&&(this.data^=2)}get culling(){return!!(4&this.data)}set culling(t){!!(4&this.data)!==t&&(this.data^=4)}get depthTest(){return!!(8&this.data)}set depthTest(t){!!(8&this.data)!==t&&(this.data^=8)}get depthMask(){return!!(32&this.data)}set depthMask(t){!!(32&this.data)!==t&&(this.data^=32)}get clockwiseFrontFace(){return!!(16&this.data)}set clockwiseFrontFace(t){!!(16&this.data)!==t&&(this.data^=16)}get blendMode(){return this._blendMode}set blendMode(t){this.blend=t!==u.NONE,this._blendMode=t}get polygonOffset(){return this._polygonOffset}set polygonOffset(t){this.offsets=!!t,this._polygonOffset=t}toString(){return`[@pixi/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`}static for2d(){const t=new Si;return t.depthTest=!1,t.blend=!0,t}}const Ci=[];function Ii(t,e){if(!t)return null;let i="";if("string"==typeof t){const e=/\.(\w{3,4})(?:$|\?|#)/i.exec(t);e&&(i=e[1].toLowerCase())}for(let n=Ci.length-1;n>=0;--n){const r=Ci[n];if(r.test&&r.test(t,i))return new r(t,e)}throw new Error("Unrecognized source type to auto-detect Resource")}class Mi{constructor(t){this.items=[],this._name=t,this._aliasCount=0}emit(t,e,i,n,r,s,o,a){if(arguments.length>8)throw new Error("max arguments reached");const{name:h,items:l}=this;this._aliasCount++;for(let u=0,c=l.length;u<c;u++)l[u][h](t,e,i,n,r,s,o,a);return l===this.items&&this._aliasCount--,this}ensureNonAliasedItems(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))}add(t){return t[this._name]&&(this.ensureNonAliasedItems(),this.remove(t),this.items.push(t)),this}remove(t){const e=this.items.indexOf(t);return-1!==e&&(this.ensureNonAliasedItems(),this.items.splice(e,1)),this}contains(t){return this.items.includes(t)}removeAll(){return this.ensureNonAliasedItems(),this.items.length=0,this}destroy(){this.removeAll(),this.items=null,this._name=null}get empty(){return 0===this.items.length}get name(){return this._name}}Object.defineProperties(Mi.prototype,{dispatch:{value:Mi.prototype.emit},run:{value:Mi.prototype.emit}});class Ri{constructor(t=0,e=0){this._width=t,this._height=e,this.destroyed=!1,this.internal=!1,this.onResize=new Mi("setRealSize"),this.onUpdate=new Mi("update"),this.onError=new Mi("onError")}bind(t){this.onResize.add(t),this.onUpdate.add(t),this.onError.add(t),(this._width||this._height)&&this.onResize.emit(this._width,this._height)}unbind(t){this.onResize.remove(t),this.onUpdate.remove(t),this.onError.remove(t)}resize(t,e){t===this._width&&e===this._height||(this._width=t,this._height=e,this.onResize.emit(t,e))}get valid(){return!!this._width&&!!this._height}update(){this.destroyed||this.onUpdate.emit()}load(){return Promise.resolve(this)}get width(){return this._width}get height(){return this._height}style(t,e,i){return!1}dispose(){}destroy(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)}static test(t,e){return!1}}class Pi extends Ri{constructor(t,e){const{width:i,height:n}=e||{};if(!i||!n)throw new Error("BufferResource width or height invalid");super(i,n),this.data=t}upload(t,e,i){const n=t.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===_.UNPACK);const r=e.realWidth,s=e.realHeight;return i.width===r&&i.height===s?n.texSubImage2D(e.target,0,0,0,r,s,e.format,i.type,this.data):(i.width=r,i.height=s,n.texImage2D(e.target,0,i.internalFormat,r,s,0,e.format,i.type,this.data)),!0}dispose(){this.data=null}static test(t){return t instanceof Float32Array||t instanceof Uint8Array||t instanceof Uint32Array}}const Di={scaleMode:m.NEAREST,format:d.RGBA,alphaMode:_.NPM},Oi=class extends Y{constructor(t=null,e=null){super(),e=Object.assign({},Oi.defaultOptions,e);const{alphaMode:i,mipmap:n,anisotropicLevel:r,scaleMode:s,width:o,height:a,wrapMode:h,format:l,type:u,target:c,resolution:d,resourceOptions:p}=e;!t||t instanceof Ri||((t=Ii(t,p)).internal=!0),this.resolution=d||C.RESOLUTION,this.width=Math.round((o||0)*this.resolution)/this.resolution,this.height=Math.round((a||0)*this.resolution)/this.resolution,this._mipmap=n,this.anisotropicLevel=r,this._wrapMode=h,this._scaleMode=s,this.format=l,this.type=u,this.target=c,this.alphaMode=i,this.uid=oi(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=o>0&&a>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this._batchLocation=0,this.parentTextureArray=null,this.setResource(t)}get realWidth(){return Math.round(this.width*this.resolution)}get realHeight(){return Math.round(this.height*this.resolution)}get mipmap(){return this._mipmap}set mipmap(t){this._mipmap!==t&&(this._mipmap=t,this.dirtyStyleId++)}get scaleMode(){return this._scaleMode}set scaleMode(t){this._scaleMode!==t&&(this._scaleMode=t,this.dirtyStyleId++)}get wrapMode(){return this._wrapMode}set wrapMode(t){this._wrapMode!==t&&(this._wrapMode=t,this.dirtyStyleId++)}setStyle(t,e){let i;return void 0!==t&&t!==this.scaleMode&&(this.scaleMode=t,i=!0),void 0!==e&&e!==this.mipmap&&(this.mipmap=e,i=!0),i&&this.dirtyStyleId++,this}setSize(t,e,i){return i=i||this.resolution,this.setRealSize(t*i,e*i,i)}setRealSize(t,e,i){return this.resolution=i||this.resolution,this.width=Math.round(t)/this.resolution,this.height=Math.round(e)/this.resolution,this._refreshPOT(),this.update(),this}_refreshPOT(){this.isPowerOfTwo=ei(this.realWidth)&&ei(this.realHeight)}setResolution(t){const e=this.resolution;return e===t||(this.resolution=t,this.valid&&(this.width=Math.round(this.width*e)/t,this.height=Math.round(this.height*e)/t,this.emit("update",this)),this._refreshPOT()),this}setResource(t){if(this.resource===t)return this;if(this.resource)throw new Error("Resource can be set only once");return t.bind(this),this.resource=t,this}update(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))}onError(t){this.emit("error",this,t)}destroy(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete ci[this.cacheId],delete ui[this.cacheId],this.cacheId=null),this.dispose(),Oi.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0}dispose(){this.emit("dispose",this)}castToBaseTexture(){return this}static from(t,e,i=C.STRICT_TEXTURE_CACHE){const n="string"==typeof t;let r=null;if(n)r=t;else{if(!t._pixiId){const i=e?.pixiIdPrefix||"pixiid";t._pixiId=`${i}_${oi()}`}r=t._pixiId}let s=ci[r];if(n&&i&&!s)throw new Error(`The cacheId "${r}" does not exist in BaseTextureCache.`);return s||(s=new Oi(t,e),s.cacheId=r,Oi.addToCache(s,r)),s}static fromBuffer(t,e,i,n){t=t||new Float32Array(e*i*4);const r=new Pi(t,{width:e,height:i}),s=t instanceof Float32Array?f.FLOAT:f.UNSIGNED_BYTE;return new Oi(r,Object.assign({},Di,{type:s},n))}static addToCache(t,e){e&&(t.textureCacheIds.includes(e)||t.textureCacheIds.push(e),ci[e]&&ci[e]!==t&&console.warn(`BaseTexture added to the cache with an id [${e}] that already had an entry`),ci[e]=t)}static removeFromCache(t){if("string"==typeof t){const e=ci[t];if(e){const i=e.textureCacheIds.indexOf(t);return i>-1&&e.textureCacheIds.splice(i,1),delete ci[t],e}}else if(t?.textureCacheIds){for(let e=0;e<t.textureCacheIds.length;++e)delete ci[t.textureCacheIds[e]];return t.textureCacheIds.length=0,t}return null}};let Li=Oi;Li.defaultOptions={mipmap:y.POW2,anisotropicLevel:0,scaleMode:m.LINEAR,wrapMode:v.CLAMP,alphaMode:_.UNPACK,target:p.TEXTURE_2D,format:d.RGBA,type:f.UNSIGNED_BYTE},Li._globalBatch=0;class Ni{constructor(){this.texArray=null,this.blend=0,this.type=c.TRIANGLES,this.start=0,this.size=0,this.data=null}}let Bi=0;class ki{constructor(t,e=!0,i=!1){this.data=t||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=i,this.static=e,this.id=Bi++,this.disposeRunner=new Mi("disposeBuffer")}update(t){t instanceof Array&&(t=new Float32Array(t)),this.data=t||this.data,this._updateID++}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.data=null}set index(t){this.type=t?A.ELEMENT_ARRAY_BUFFER:A.ARRAY_BUFFER}get index(){return this.type===A.ELEMENT_ARRAY_BUFFER}static from(t){return t instanceof Array&&(t=new Float32Array(t)),new ki(t)}}class Fi{constructor(t,e=0,i=!1,n=f.FLOAT,r,s,o,a=1){this.buffer=t,this.size=e,this.normalized=i,this.type=n,this.stride=r,this.start=s,this.instance=o,this.divisor=a}destroy(){this.buffer=null}static from(t,e,i,n,r){return new Fi(t,e,i,n,r)}}const Ui={Float32Array:Float32Array,Uint32Array:Uint32Array,Int32Array:Int32Array,Uint8Array:Uint8Array};const Gi={5126:4,5123:2,5121:1};let zi=0;const ji={Float32Array:Float32Array,Uint32Array:Uint32Array,Int32Array:Int32Array,Uint8Array:Uint8Array,Uint16Array:Uint16Array};class Hi{constructor(t=[],e={}){this.buffers=t,this.indexBuffer=null,this.attributes=e,this.glVertexArrayObjects={},this.id=zi++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new Mi("disposeGeometry"),this.refCount=0}addAttribute(t,e,i=0,n=!1,r,s,o,a=!1){if(!e)throw new Error("You must pass a buffer when creating an attribute");e instanceof ki||(e instanceof Array&&(e=new Float32Array(e)),e=new ki(e));const h=t.split("|");if(h.length>1){for(let t=0;t<h.length;t++)this.addAttribute(h[t],e,i,n,r);return this}let l=this.buffers.indexOf(e);return-1===l&&(this.buffers.push(e),l=this.buffers.length-1),this.attributes[t]=new Fi(l,i,n,r,s,o,a),this.instanced=this.instanced||a,this}getAttribute(t){return this.attributes[t]}getBuffer(t){return this.buffers[this.getAttribute(t).buffer]}addIndex(t){return t instanceof ki||(t instanceof Array&&(t=new Uint16Array(t)),t=new ki(t)),t.type=A.ELEMENT_ARRAY_BUFFER,this.indexBuffer=t,this.buffers.includes(t)||this.buffers.push(t),this}getIndex(){return this.indexBuffer}interleave(){if(1===this.buffers.length||2===this.buffers.length&&this.indexBuffer)return this;const t=[],e=[],i=new ki;let n;for(n in this.attributes){const i=this.attributes[n],r=this.buffers[i.buffer];t.push(r.data),e.push(i.size*Gi[i.type]/4),i.buffer=0}for(i.data=function(t,e){let i=0,n=0;const r={};for(let r=0;r<t.length;r++)n+=e[r],i+=t[r].length;const s=new ArrayBuffer(4*i);let o=null,a=0;for(let i=0;i<t.length;i++){const h=e[i],l=t[i],u=Qe(l);r[u]||(r[u]=new Ui[u](s)),o=r[u];for(let t=0;t<l.length;t++)o[(t/h|0)*n+a+t%h]=l[t];a+=h}return new Float32Array(s)}(t,e),n=0;n<this.buffers.length;n++)this.buffers[n]!==this.indexBuffer&&this.buffers[n].destroy();return this.buffers=[i],this.indexBuffer&&this.buffers.push(this.indexBuffer),this}getSize(){for(const t in this.attributes){const e=this.attributes[t];return this.buffers[e.buffer].data.length/(e.stride/4||e.size)}return 0}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null}clone(){const t=new Hi;for(let e=0;e<this.buffers.length;e++)t.buffers[e]=new ki(this.buffers[e].data.slice(0));for(const e in this.attributes){const i=this.attributes[e];t.attributes[e]=new Fi(i.buffer,i.size,i.normalized,i.type,i.stride,i.start,i.instance)}return this.indexBuffer&&(t.indexBuffer=t.buffers[this.buffers.indexOf(this.indexBuffer)],t.indexBuffer.type=A.ELEMENT_ARRAY_BUFFER),t}static merge(t){const e=new Hi,i=[],n=[],r=[];let s;for(let e=0;e<t.length;e++){s=t[e];for(let t=0;t<s.buffers.length;t++)n[t]=n[t]||0,n[t]+=s.buffers[t].data.length,r[t]=0}for(let t=0;t<s.buffers.length;t++)i[t]=new(ji[Qe(s.buffers[t].data)])(n[t]),e.buffers[t]=new ki(i[t]);for(let e=0;e<t.length;e++){s=t[e];for(let t=0;t<s.buffers.length;t++)i[t].set(s.buffers[t].data,r[t]),r[t]+=s.buffers[t].data.length}if(e.attributes=s.attributes,s.indexBuffer){e.indexBuffer=e.buffers[s.buffers.indexOf(s.indexBuffer)],e.indexBuffer.type=A.ELEMENT_ARRAY_BUFFER;let i=0,n=0,r=0,o=0;for(let t=0;t<s.buffers.length;t++)if(s.buffers[t]!==s.indexBuffer){o=t;break}for(const t in s.attributes){const e=s.attributes[t];(0|e.buffer)===o&&(n+=e.size*Gi[e.type]/4)}for(let s=0;s<t.length;s++){const a=t[s].indexBuffer.data;for(let t=0;t<a.length;t++)e.indexBuffer.data[t+r]+=i;i+=t[s].buffers[o].data.length/n,r+=a.length}}return e}}class Wi extends Hi{constructor(t=!1){super(),this._buffer=new ki(null,t,!1),this._indexBuffer=new ki(null,t,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,f.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,f.FLOAT).addAttribute("aColor",this._buffer,4,!0,f.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,f.FLOAT).addIndex(this._indexBuffer)}}const Xi=2*Math.PI,Vi=180/Math.PI,Yi=Math.PI/180;var $i=(t=>(t[t.POLY=0]="POLY",t[t.RECT=1]="RECT",t[t.CIRC=2]="CIRC",t[t.ELIP=3]="ELIP",t[t.RREC=4]="RREC",t))($i||{});class qi{constructor(t=0,e=0){this.x=0,this.y=0,this.x=t,this.y=e}clone(){return new qi(this.x,this.y)}copyFrom(t){return this.set(t.x,t.y),this}copyTo(t){return t.set(this.x,this.y),t}equals(t){return t.x===this.x&&t.y===this.y}set(t=0,e=t){return this.x=t,this.y=e,this}toString(){return`[@pixi/math:Point x=${this.x} y=${this.y}]`}}const Ki=[new qi,new qi,new qi,new qi];class Zi{constructor(t=0,e=0,i=0,n=0){this.x=Number(t),this.y=Number(e),this.width=Number(i),this.height=Number(n),this.type=$i.RECT}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}static get EMPTY(){return new Zi(0,0,0,0)}clone(){return new Zi(this.x,this.y,this.width,this.height)}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t}contains(t,e){return!(this.width<=0||this.height<=0)&&(t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height)}intersects(t,e){if(!e){const e=this.x<t.x?t.x:this.x;if((this.right>t.right?t.right:this.right)<=e)return!1;const i=this.y<t.y?t.y:this.y;return(this.bottom>t.bottom?t.bottom:this.bottom)>i}const i=this.left,n=this.right,r=this.top,s=this.bottom;if(n<=i||s<=r)return!1;const o=Ki[0].set(t.left,t.top),a=Ki[1].set(t.left,t.bottom),h=Ki[2].set(t.right,t.top),l=Ki[3].set(t.right,t.bottom);if(h.x<=o.x||a.y<=o.y)return!1;const u=Math.sign(e.a*e.d-e.b*e.c);if(0===u)return!1;if(e.apply(o,o),e.apply(a,a),e.apply(h,h),e.apply(l,l),Math.max(o.x,a.x,h.x,l.x)<=i||Math.min(o.x,a.x,h.x,l.x)>=n||Math.max(o.y,a.y,h.y,l.y)<=r||Math.min(o.y,a.y,h.y,l.y)>=s)return!1;const c=u*(a.y-o.y),d=u*(o.x-a.x),p=c*i+d*r,f=c*n+d*r,g=c*i+d*s,m=c*n+d*s;if(Math.max(p,f,g,m)<=c*o.x+d*o.y||Math.min(p,f,g,m)>=c*l.x+d*l.y)return!1;const v=u*(o.y-h.y),y=u*(h.x-o.x),_=v*i+y*r,x=v*n+y*r,b=v*i+y*s,w=v*n+y*s;return!(Math.max(_,x,b,w)<=v*o.x+y*o.y||Math.min(_,x,b,w)>=v*l.x+y*l.y)}pad(t=0,e=t){return this.x-=t,this.y-=e,this.width+=2*t,this.height+=2*e,this}fit(t){const e=Math.max(this.x,t.x),i=Math.min(this.x+this.width,t.x+t.width),n=Math.max(this.y,t.y),r=Math.min(this.y+this.height,t.y+t.height);return this.x=e,this.width=Math.max(i-e,0),this.y=n,this.height=Math.max(r-n,0),this}ceil(t=1,e=.001){const i=Math.ceil((this.x+this.width-e)*t)/t,n=Math.ceil((this.y+this.height-e)*t)/t;return this.x=Math.floor((this.x+e)*t)/t,this.y=Math.floor((this.y+e)*t)/t,this.width=i-this.x,this.height=n-this.y,this}enlarge(t){const e=Math.min(this.x,t.x),i=Math.max(this.x+this.width,t.x+t.width),n=Math.min(this.y,t.y),r=Math.max(this.y+this.height,t.y+t.height);return this.x=e,this.width=i-e,this.y=n,this.height=r-n,this}toString(){return`[@pixi/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`}}class Ji{constructor(t=0,e=0,i=0){this.x=t,this.y=e,this.radius=i,this.type=$i.CIRC}clone(){return new Ji(this.x,this.y,this.radius)}contains(t,e){if(this.radius<=0)return!1;const i=this.radius*this.radius;let n=this.x-t,r=this.y-e;return n*=n,r*=r,n+r<=i}getBounds(){return new Zi(this.x-this.radius,this.y-this.radius,2*this.radius,2*this.radius)}toString(){return`[@pixi/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`}}class Qi{constructor(t=0,e=0,i=0,n=0){this.x=t,this.y=e,this.width=i,this.height=n,this.type=$i.ELIP}clone(){return new Qi(this.x,this.y,this.width,this.height)}contains(t,e){if(this.width<=0||this.height<=0)return!1;let i=(t-this.x)/this.width,n=(e-this.y)/this.height;return i*=i,n*=n,i+n<=1}getBounds(){return new Zi(this.x-this.width,this.y-this.height,this.width,this.height)}toString(){return`[@pixi/math:Ellipse x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`}}class tn{constructor(...t){let e=Array.isArray(t[0])?t[0]:t;if("number"!=typeof e[0]){const t=[];for(let i=0,n=e.length;i<n;i++)t.push(e[i].x,e[i].y);e=t}this.points=e,this.type=$i.POLY,this.closeStroke=!0}clone(){const t=this.points.slice(),e=new tn(t);return e.closeStroke=this.closeStroke,e}contains(t,e){let i=!1;const n=this.points.length/2;for(let r=0,s=n-1;r<n;s=r++){const n=this.points[2*r],o=this.points[2*r+1],a=this.points[2*s],h=this.points[2*s+1];o>e!=h>e&&t<(e-o)/(h-o)*(a-n)+n&&(i=!i)}return i}toString(){return`[@pixi/math:PolygoncloseStroke=${this.closeStroke}points=${this.points.reduce(((t,e)=>`${t}, ${e}`),"")}]`}}class en{constructor(t=0,e=0,i=0,n=0,r=20){this.x=t,this.y=e,this.width=i,this.height=n,this.radius=r,this.type=$i.RREC}clone(){return new en(this.x,this.y,this.width,this.height,this.radius)}contains(t,e){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height){const i=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(e>=this.y+i&&e<=this.y+this.height-i||t>=this.x+i&&t<=this.x+this.width-i)return!0;let n=t-(this.x+i),r=e-(this.y+i);const s=i*i;if(n*n+r*r<=s)return!0;if(n=t-(this.x+this.width-i),n*n+r*r<=s)return!0;if(r=e-(this.y+this.height-i),n*n+r*r<=s)return!0;if(n=t-(this.x+i),n*n+r*r<=s)return!0}return!1}toString(){return`[@pixi/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`}}class nn{constructor(t=1,e=0,i=0,n=1,r=0,s=0){this.array=null,this.a=t,this.b=e,this.c=i,this.d=n,this.tx=r,this.ty=s}fromArray(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]}set(t,e,i,n,r,s){return this.a=t,this.b=e,this.c=i,this.d=n,this.tx=r,this.ty=s,this}toArray(t,e){this.array||(this.array=new Float32Array(9));const i=e||this.array;return t?(i[0]=this.a,i[1]=this.b,i[2]=0,i[3]=this.c,i[4]=this.d,i[5]=0,i[6]=this.tx,i[7]=this.ty,i[8]=1):(i[0]=this.a,i[1]=this.c,i[2]=this.tx,i[3]=this.b,i[4]=this.d,i[5]=this.ty,i[6]=0,i[7]=0,i[8]=1),i}apply(t,e){e=e||new qi;const i=t.x,n=t.y;return e.x=this.a*i+this.c*n+this.tx,e.y=this.b*i+this.d*n+this.ty,e}applyInverse(t,e){e=e||new qi;const i=1/(this.a*this.d+this.c*-this.b),n=t.x,r=t.y;return e.x=this.d*i*n+-this.c*i*r+(this.ty*this.c-this.tx*this.d)*i,e.y=this.a*i*r+-this.b*i*n+(-this.ty*this.a+this.tx*this.b)*i,e}translate(t,e){return this.tx+=t,this.ty+=e,this}scale(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this}rotate(t){const e=Math.cos(t),i=Math.sin(t),n=this.a,r=this.c,s=this.tx;return this.a=n*e-this.b*i,this.b=n*i+this.b*e,this.c=r*e-this.d*i,this.d=r*i+this.d*e,this.tx=s*e-this.ty*i,this.ty=s*i+this.ty*e,this}append(t){const e=this.a,i=this.b,n=this.c,r=this.d;return this.a=t.a*e+t.b*n,this.b=t.a*i+t.b*r,this.c=t.c*e+t.d*n,this.d=t.c*i+t.d*r,this.tx=t.tx*e+t.ty*n+this.tx,this.ty=t.tx*i+t.ty*r+this.ty,this}setTransform(t,e,i,n,r,s,o,a,h){return this.a=Math.cos(o+h)*r,this.b=Math.sin(o+h)*r,this.c=-Math.sin(o-a)*s,this.d=Math.cos(o-a)*s,this.tx=t-(i*this.a+n*this.c),this.ty=e-(i*this.b+n*this.d),this}prepend(t){const e=this.tx;if(1!==t.a||0!==t.b||0!==t.c||1!==t.d){const e=this.a,i=this.c;this.a=e*t.a+this.b*t.c,this.b=e*t.b+this.b*t.d,this.c=i*t.a+this.d*t.c,this.d=i*t.b+this.d*t.d}return this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this}decompose(t){const e=this.a,i=this.b,n=this.c,r=this.d,s=t.pivot,o=-Math.atan2(-n,r),a=Math.atan2(i,e),h=Math.abs(o+a);return h<1e-5||Math.abs(Xi-h)<1e-5?(t.rotation=a,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=o,t.skew.y=a),t.scale.x=Math.sqrt(e*e+i*i),t.scale.y=Math.sqrt(n*n+r*r),t.position.x=this.tx+(s.x*e+s.y*n),t.position.y=this.ty+(s.x*i+s.y*r),t}invert(){const t=this.a,e=this.b,i=this.c,n=this.d,r=this.tx,s=t*n-e*i;return this.a=n/s,this.b=-e/s,this.c=-i/s,this.d=t/s,this.tx=(i*this.ty-n*r)/s,this.ty=-(t*this.ty-e*r)/s,this}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const t=new nn;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyTo(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyFrom(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this}toString(){return`[@pixi/math:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`}static get IDENTITY(){return new nn}static get TEMP_MATRIX(){return new nn}}const rn=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],sn=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],on=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],an=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],hn=[],ln=[],un=Math.sign;!function(){for(let t=0;t<16;t++){const e=[];hn.push(e);for(let i=0;i<16;i++){const n=un(rn[t]*rn[i]+on[t]*sn[i]),r=un(sn[t]*rn[i]+an[t]*sn[i]),s=un(rn[t]*on[i]+on[t]*an[i]),o=un(sn[t]*on[i]+an[t]*an[i]);for(let t=0;t<16;t++)if(rn[t]===n&&sn[t]===r&&on[t]===s&&an[t]===o){e.push(t);break}}}for(let t=0;t<16;t++){const e=new nn;e.set(rn[t],sn[t],on[t],an[t],0,0),ln.push(e)}}();const cn={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:t=>rn[t],uY:t=>sn[t],vX:t=>on[t],vY:t=>an[t],inv:t=>8&t?15&t:7&-t,add:(t,e)=>hn[t][e],sub:(t,e)=>hn[t][cn.inv(e)],rotate180:t=>4^t,isVertical:t=>2==(3&t),byDirection:(t,e)=>2*Math.abs(t)<=Math.abs(e)?e>=0?cn.S:cn.N:2*Math.abs(e)<=Math.abs(t)?t>0?cn.E:cn.W:e>0?t>0?cn.SE:cn.SW:t>0?cn.NE:cn.NW,matrixAppendRotationInv:(t,e,i=0,n=0)=>{const r=ln[cn.inv(e)];r.tx=i,r.ty=n,t.append(r)}};class dn{constructor(t,e,i=0,n=0){this._x=i,this._y=n,this.cb=t,this.scope=e}clone(t=this.cb,e=this.scope){return new dn(t,e,this._x,this._y)}set(t=0,e=t){return this._x===t&&this._y===e||(this._x=t,this._y=e,this.cb.call(this.scope)),this}copyFrom(t){return this._x===t.x&&this._y===t.y||(this._x=t.x,this._y=t.y,this.cb.call(this.scope)),this}copyTo(t){return t.set(this._x,this._y),t}equals(t){return t.x===this._x&&t.y===this._y}toString(){return`[@pixi/math:ObservablePoint x=0 y=0 scope=${this.scope}]`}get x(){return this._x}set x(t){this._x!==t&&(this._x=t,this.cb.call(this.scope))}get y(){return this._y}set y(t){this._y!==t&&(this._y=t,this.cb.call(this.scope))}}const pn=class{constructor(){this.worldTransform=new nn,this.localTransform=new nn,this.position=new dn(this.onChange,this,0,0),this.scale=new dn(this.onChange,this,1,1),this.pivot=new dn(this.onChange,this,0,0),this.skew=new dn(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}onChange(){this._localID++}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++}toString(){return`[@pixi/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`}updateLocalTransform(){const t=this.localTransform;this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1)}updateTransform(t){const e=this.localTransform;if(this._localID!==this._currentLocalID&&(e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==t._worldID){const i=t.worldTransform,n=this.worldTransform;n.a=e.a*i.a+e.b*i.c,n.b=e.a*i.b+e.b*i.d,n.c=e.c*i.a+e.d*i.c,n.d=e.c*i.b+e.d*i.d,n.tx=e.tx*i.a+e.ty*i.c+i.tx,n.ty=e.tx*i.b+e.ty*i.d+i.ty,this._parentID=t._worldID,this._worldID++}}setFromMatrix(t){t.decompose(this),this._localID++}get rotation(){return this._rotation}set rotation(t){this._rotation!==t&&(this._rotation=t,this.updateSkew())}};let fn=pn;fn.IDENTITY=new pn;function gn(t,e,i){const n=t.createShader(e);return t.shaderSource(n,i),t.compileShader(n),n}function mn(t){const e=new Array(t);for(let t=0;t<e.length;t++)e[t]=!1;return e}function vn(t,e){switch(t){case"float":case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"vec2":return new Float32Array(2*e);case"vec3":return new Float32Array(3*e);case"vec4":return new Float32Array(4*e);case"ivec2":return new Int32Array(2*e);case"ivec3":return new Int32Array(3*e);case"ivec4":return new Int32Array(4*e);case"uvec2":return new Uint32Array(2*e);case"uvec3":return new Uint32Array(3*e);case"uvec4":return new Uint32Array(4*e);case"bool":return!1;case"bvec2":return mn(2*e);case"bvec3":return mn(3*e);case"bvec4":return mn(4*e);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}const yn=[{test:t=>"float"===t.type&&1===t.size&&!t.isArray,code:t=>`\n            if(uv["${t}"] !== ud["${t}"].value)\n            {\n                ud["${t}"].value = uv["${t}"]\n                gl.uniform1f(ud["${t}"].location, uv["${t}"])\n            }\n            `},{test:(t,e)=>!("sampler2D"!==t.type&&"samplerCube"!==t.type&&"sampler2DArray"!==t.type||1!==t.size||t.isArray||null!=e&&void 0===e.castToBaseTexture),code:t=>`t = syncData.textureCount++;\n\n            renderer.texture.bind(uv["${t}"], t);\n\n            if(ud["${t}"].value !== t)\n            {\n                ud["${t}"].value = t;\n                gl.uniform1i(ud["${t}"].location, t);\n; // eslint-disable-line max-len\n            }`},{test:(t,e)=>"mat3"===t.type&&1===t.size&&!t.isArray&&void 0!==e.a,code:t=>`\n            gl.uniformMatrix3fv(ud["${t}"].location, false, uv["${t}"].toArray(true));\n            `,codeUbo:t=>`\n                var ${t}_matrix = uv.${t}.toArray(true);\n\n                data[offset] = ${t}_matrix[0];\n                data[offset+1] = ${t}_matrix[1];\n                data[offset+2] = ${t}_matrix[2];\n        \n                data[offset + 4] = ${t}_matrix[3];\n                data[offset + 5] = ${t}_matrix[4];\n                data[offset + 6] = ${t}_matrix[5];\n        \n                data[offset + 8] = ${t}_matrix[6];\n                data[offset + 9] = ${t}_matrix[7];\n                data[offset + 10] = ${t}_matrix[8];\n            `},{test:(t,e)=>"vec2"===t.type&&1===t.size&&!t.isArray&&void 0!==e.x,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v.x || cv[1] !== v.y)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    gl.uniform2f(ud["${t}"].location, v.x, v.y);\n                }`,codeUbo:t=>`\n                v = uv.${t};\n\n                data[offset] = v.x;\n                data[offset+1] = v.y;\n            `},{test:t=>"vec2"===t.type&&1===t.size&&!t.isArray,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v[0] || cv[1] !== v[1])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    gl.uniform2f(ud["${t}"].location, v[0], v[1]);\n                }\n            `},{test:(t,e)=>"vec4"===t.type&&1===t.size&&!t.isArray&&void 0!==e.width,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    cv[2] = v.width;\n                    cv[3] = v.height;\n                    gl.uniform4f(ud["${t}"].location, v.x, v.y, v.width, v.height)\n                }`,codeUbo:t=>`\n                    v = uv.${t};\n\n                    data[offset] = v.x;\n                    data[offset+1] = v.y;\n                    data[offset+2] = v.width;\n                    data[offset+3] = v.height;\n                `},{test:(t,e)=>"vec4"===t.type&&1===t.size&&!t.isArray&&void 0!==e.red,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.alpha)\n                {\n                    cv[0] = v.red;\n                    cv[1] = v.green;\n                    cv[2] = v.blue;\n                    cv[3] = v.alpha;\n                    gl.uniform4f(ud["${t}"].location, v.red, v.green, v.blue, v.alpha)\n                }`,codeUbo:t=>`\n                    v = uv.${t};\n\n                    data[offset] = v.red;\n                    data[offset+1] = v.green;\n                    data[offset+2] = v.blue;\n                    data[offset+3] = v.alpha;\n                `},{test:(t,e)=>"vec3"===t.type&&1===t.size&&!t.isArray&&void 0!==e.red,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.a)\n                {\n                    cv[0] = v.red;\n                    cv[1] = v.green;\n                    cv[2] = v.blue;\n    \n                    gl.uniform3f(ud["${t}"].location, v.red, v.green, v.blue)\n                }`,codeUbo:t=>`\n                    v = uv.${t};\n\n                    data[offset] = v.red;\n                    data[offset+1] = v.green;\n                    data[offset+2] = v.blue;\n                `},{test:t=>"vec4"===t.type&&1===t.size&&!t.isArray,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    cv[2] = v[2];\n                    cv[3] = v[3];\n\n                    gl.uniform4f(ud["${t}"].location, v[0], v[1], v[2], v[3])\n                }`}],_n={float:"\n    if (cv !== v)\n    {\n        cu.value = v;\n        gl.uniform1f(location, v);\n    }",vec2:"\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2f(location, v[0], v[1])\n    }",vec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3f(location, v[0], v[1], v[2])\n    }",vec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4f(location, v[0], v[1], v[2], v[3]);\n    }",int:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }",ivec2:"\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2i(location, v[0], v[1]);\n    }",ivec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3i(location, v[0], v[1], v[2]);\n    }",ivec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4i(location, v[0], v[1], v[2], v[3]);\n    }",uint:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1ui(location, v);\n    }",uvec2:"\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2ui(location, v[0], v[1]);\n    }",uvec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3ui(location, v[0], v[1], v[2]);\n    }",uvec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);\n    }",bool:"\n    if (cv !== v)\n    {\n        cu.value = v;\n        gl.uniform1i(location, v);\n    }",bvec2:"\n    if (cv[0] != v[0] || cv[1] != v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2i(location, v[0], v[1]);\n    }",bvec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3i(location, v[0], v[1], v[2]);\n    }",bvec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4i(location, v[0], v[1], v[2], v[3]);\n    }",mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }",samplerCube:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }",sampler2DArray:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }"},xn={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};const bn={};let wn,Tn=bn;function En(){if(!wn){wn=w.MEDIUM;const t=function(){if(Tn===bn||Tn?.isContextLost()){const t=C.ADAPTER.createCanvas();let e;C.PREFER_ENV>=a.WEBGL2&&(e=t.getContext("webgl2",{})),e||(e=t.getContext("webgl",{})||t.getContext("experimental-webgl",{}),e?e.getExtension("WEBGL_draw_buffers"):e=null),Tn=e}return Tn}();if(t&&t.getShaderPrecisionFormat){const e=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT);wn=e.precision?w.HIGH:w.MEDIUM}}return wn}function An(t,e){const i=t.getShaderSource(e).split("\n").map(((t,e)=>`${e}: ${t}`)),n=t.getShaderInfoLog(e),r=n.split("\n"),s={},o=r.map((t=>parseFloat(t.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1")))).filter((t=>!(!t||s[t])&&(s[t]=!0,!0))),a=[""];o.forEach((t=>{i[t-1]=`%c${i[t-1]}%c`,a.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")}));const h=i.join("\n");a[0]=h,console.error(n),console.groupCollapsed("click to view full shader code"),console.warn(...a),console.groupEnd()}const Sn={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function Cn(t){return Sn[t]}let In=null;const Mn={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function Rn(t,e){if(!In){const e=Object.keys(Mn);In={};for(let i=0;i<e.length;++i){const n=e[i];In[t[n]]=Mn[n]}}return In[e]}function Pn(t,e,i){if("precision"!==t.substring(0,9)){let n=e;return e===w.HIGH&&i!==w.HIGH&&(n=w.MEDIUM),`precision ${n} float;\n${t}`}return i!==w.HIGH&&"precision highp"===t.substring(0,15)?t.replace("precision highp","precision mediump"):t}let Dn;let On=0;const Ln={},Nn=class{constructor(t,e,i="pixi-shader",n={}){this.extra={},this.id=On++,this.vertexSrc=t||Nn.defaultVertexSrc,this.fragmentSrc=e||Nn.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.extra=n,"#version"!==this.vertexSrc.substring(0,8)&&(i=i.replace(/\s+/g,"-"),Ln[i]?(Ln[i]++,i+=`-${Ln[i]}`):Ln[i]=1,this.vertexSrc=`#define SHADER_NAME ${i}\n${this.vertexSrc}`,this.fragmentSrc=`#define SHADER_NAME ${i}\n${this.fragmentSrc}`,this.vertexSrc=Pn(this.vertexSrc,Nn.defaultVertexPrecision,w.HIGH),this.fragmentSrc=Pn(this.fragmentSrc,Nn.defaultFragmentPrecision,En())),this.glPrograms={},this.syncUniforms=null}static get defaultVertexSrc(){return"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void){\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vTextureCoord = aTextureCoord;\n}\n"}static get defaultFragmentSrc(){return"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor *= texture2D(uSampler, vTextureCoord);\n}"}static from(t,e,i){const n=t+e;let r=li[n];return r||(li[n]=r=new Nn(t,e,i)),r}};let Bn=Nn;Bn.defaultVertexPrecision=w.HIGH,Bn.defaultFragmentPrecision=X.apple.device?w.HIGH:w.MEDIUM;let kn=0;class Fn{constructor(t,e,i){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=kn++,this.static=!!e,this.ubo=!!i,t instanceof ki?(this.buffer=t,this.buffer.type=A.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=t,this.ubo&&(this.buffer=new ki(new Float32Array(1)),this.buffer.type=A.UNIFORM_BUFFER,this.autoManage=!0))}update(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()}add(t,e,i){if(this.ubo)throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them");this.uniforms[t]=new Fn(e,i)}static from(t,e,i){return new Fn(t,e,i)}static uboFrom(t,e){return new Fn(t,e??!0,!0)}}class Un{constructor(t,e){this.uniformBindCount=0,this.program=t,this.uniformGroup=e?e instanceof Fn?e:new Fn(e):new Fn({}),this.disposeRunner=new Mi("disposeShader")}checkUniformExists(t,e){if(e.uniforms[t])return!0;for(const i in e.uniforms){const n=e.uniforms[i];if(n.group&&this.checkUniformExists(t,n))return!0}return!1}destroy(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()}get uniforms(){return this.uniformGroup.uniforms}static from(t,e,i){const n=Bn.from(t,e);return new Un(n,i)}}class Gn{constructor(t,e){if(this.vertexSrc=t,this.fragTemplate=e,this.programCache={},this.defaultGroupCache={},!e.includes("%count%"))throw new Error('Fragment template must contain "%count%".');if(!e.includes("%forloop%"))throw new Error('Fragment template must contain "%forloop%".')}generateShader(t){if(!this.programCache[t]){const e=new Int32Array(t);for(let i=0;i<t;i++)e[i]=i;this.defaultGroupCache[t]=Fn.from({uSamplers:e},!0);let i=this.fragTemplate;i=i.replace(/%count%/gi,`${t}`),i=i.replace(/%forloop%/gi,this.generateSampleSrc(t)),this.programCache[t]=new Bn(this.vertexSrc,i)}const e={tint:new Float32Array([1,1,1,1]),translationMatrix:new nn,default:this.defaultGroupCache[t]};return new Un(this.programCache[t],e)}generateSampleSrc(t){let e="";e+="\n",e+="\n";for(let i=0;i<t;i++)i>0&&(e+="\nelse "),i<t-1&&(e+=`if(vTextureId < ${i}.5)`),e+="\n{",e+=`\n\tcolor = texture2D(uSamplers[${i}], vTextureCoord);`,e+="\n}";return e+="\n",e+="\n",e}}class zn{constructor(){this.elements=[],this.ids=[],this.count=0}clear(){for(let t=0;t<this.count;t++)this.elements[t]=null;this.count=0}}class jn{constructor(t){this.renderer=t}flush(){}destroy(){this.renderer=null}start(){}stop(){this.flush()}render(t){}}const Hn=class extends jn{constructor(t){super(t),this.setShaderGenerator(),this.geometryClass=Wi,this.vertexSize=6,this.state=Si.for2d(),this.size=4*Hn.defaultBatchSize,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferedTextures=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._aBuffers={},this._iBuffers={},this.maxTextures=1,this.renderer.on("prerender",this.onPrerender,this),t.runners.contextChange.add(this),this._dcIndex=0,this._aIndex=0,this._iIndex=0,this._attributeBuffer=null,this._indexBuffer=null,this._tempBoundTextures=[]}static get defaultMaxTextures(){return this._defaultMaxTextures=this._defaultMaxTextures??function(t){let e=!0;const i=C.ADAPTER.getNavigator();if(X.tablet||X.phone){if(X.apple.device){const t=i.userAgent.match(/OS (\d+)_(\d+)?/);t&&parseInt(t[1],10)<11&&(e=!1)}if(X.android.device){const t=i.userAgent.match(/Android\s([0-9.]*)/);t&&parseInt(t[1],10)<7&&(e=!1)}}return e?t:4}(32),this._defaultMaxTextures}static set defaultMaxTextures(t){this._defaultMaxTextures=t}static get canUploadSameBuffer(){return this._canUploadSameBuffer=this._canUploadSameBuffer??!X.apple.device,this._canUploadSameBuffer}static set canUploadSameBuffer(t){this._canUploadSameBuffer=t}get MAX_TEXTURES(){return _e("7.1.0","BatchRenderer#MAX_TEXTURES renamed to BatchRenderer#maxTextures"),this.maxTextures}static get defaultVertexSrc(){return"precision highp float;\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\nattribute float aTextureId;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform vec4 tint;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vTextureId = aTextureId;\n    vColor = aColor * tint;\n}\n"}static get defaultFragmentTemplate(){return"varying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\nuniform sampler2D uSamplers[%count%];\n\nvoid main(void){\n    vec4 color;\n    %forloop%\n    gl_FragColor = color * vColor;\n}\n"}setShaderGenerator({vertex:t=Hn.defaultVertexSrc,fragment:e=Hn.defaultFragmentTemplate}={}){this.shaderGenerator=new Gn(t,e)}contextChange(){const t=this.renderer.gl;C.PREFER_ENV===a.WEBGL_LEGACY?this.maxTextures=1:(this.maxTextures=Math.min(t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),Hn.defaultMaxTextures),this.maxTextures=function(t,e){if(0===t)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const i=e.createShader(e.FRAGMENT_SHADER);for(;;){const n=Ei.replace(/%forloop%/gi,Ai(t));if(e.shaderSource(i,n),e.compileShader(i),e.getShaderParameter(i,e.COMPILE_STATUS))break;t=t/2|0}return t}(this.maxTextures,t)),this._shader=this.shaderGenerator.generateShader(this.maxTextures);for(let t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]=new this.geometryClass;this.initFlushBuffers()}initFlushBuffers(){const{_drawCallPool:t,_textureArrayPool:e}=Hn,i=this.size/4,n=Math.floor(i/this.maxTextures)+1;for(;t.length<i;)t.push(new Ni);for(;e.length<n;)e.push(new zn);for(let t=0;t<this.maxTextures;t++)this._tempBoundTextures[t]=null}onPrerender(){this._flushId=0}render(t){t._texture.valid&&(this._vertexCount+t.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=t.vertexData.length/2,this._indexCount+=t.indices.length,this._bufferedTextures[this._bufferSize]=t._texture.baseTexture,this._bufferedElements[this._bufferSize++]=t)}buildTexturesAndDrawCalls(){const{_bufferedTextures:t,maxTextures:e}=this,i=Hn._textureArrayPool,n=this.renderer.batch,r=this._tempBoundTextures,s=this.renderer.textureGC.count;let o=++Li._globalBatch,a=0,h=i[0],l=0;n.copyBoundTextures(r,e);for(let u=0;u<this._bufferSize;++u){const c=t[u];t[u]=null,c._batchEnabled!==o&&(h.count>=e&&(n.boundArray(h,r,o,e),this.buildDrawCalls(h,l,u),l=u,h=i[++a],++o),c._batchEnabled=o,c.touched=s,h.elements[h.count++]=c)}h.count>0&&(n.boundArray(h,r,o,e),this.buildDrawCalls(h,l,this._bufferSize),++a,++o);for(let t=0;t<r.length;t++)r[t]=null;Li._globalBatch=o}buildDrawCalls(t,e,i){const{_bufferedElements:n,_attributeBuffer:r,_indexBuffer:s,vertexSize:o}=this,a=Hn._drawCallPool;let h=this._dcIndex,l=this._aIndex,u=this._iIndex,c=a[h];c.start=this._iIndex,c.texArray=t;for(let d=e;d<i;++d){const i=n[d],p=i._texture.baseTexture,f=Ze[p.alphaMode?1:0][i.blendMode];n[d]=null,e<d&&c.blend!==f&&(c.size=u-c.start,e=d,c=a[++h],c.texArray=t,c.start=u),this.packInterleavedGeometry(i,r,s,l,u),l+=i.vertexData.length/2*o,u+=i.indices.length,c.blend=f}e<i&&(c.size=u-c.start,++h),this._dcIndex=h,this._aIndex=l,this._iIndex=u}bindAndClearTexArray(t){const e=this.renderer.texture;for(let i=0;i<t.count;i++)e.bind(t.elements[i],t.ids[i]),t.elements[i]=null;t.count=0}updateGeometry(){const{_packedGeometries:t,_attributeBuffer:e,_indexBuffer:i}=this;Hn.canUploadSameBuffer?(t[this._flushId]._buffer.update(e.rawBinaryData),t[this._flushId]._indexBuffer.update(i),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,t[this._flushId]=new this.geometryClass),t[this._flushId]._buffer.update(e.rawBinaryData),t[this._flushId]._indexBuffer.update(i),this.renderer.geometry.bind(t[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)}drawBatches(){const t=this._dcIndex,{gl:e,state:i}=this.renderer,n=Hn._drawCallPool;let r=null;for(let s=0;s<t;s++){const{texArray:t,type:o,size:a,start:h,blend:l}=n[s];r!==t&&(r=t,this.bindAndClearTexArray(t)),this.state.blendMode=l,i.set(this.state),e.drawElements(o,a,e.UNSIGNED_SHORT,2*h)}}flush(){0!==this._vertexCount&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)}start(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.maxTextures),this.renderer.shader.bind(this._shader),Hn.canUploadSameBuffer&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])}stop(){this.flush()}destroy(){for(let t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]&&this._packedGeometries[t].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),super.destroy()}getAttributeBuffer(t){const e=ti(Math.ceil(t/8)),i=ii(e),n=8*e;this._aBuffers.length<=i&&(this._iBuffers.length=i+1);let r=this._aBuffers[n];return r||(this._aBuffers[n]=r=new Ti(n*this.vertexSize*4)),r}getIndexBuffer(t){const e=ti(Math.ceil(t/12)),i=ii(e),n=12*e;this._iBuffers.length<=i&&(this._iBuffers.length=i+1);let r=this._iBuffers[i];return r||(this._iBuffers[i]=r=new Uint16Array(n)),r}packInterleavedGeometry(t,e,i,n,r){const{uint32View:s,float32View:o}=e,a=n/this.vertexSize,h=t.uvs,l=t.indices,u=t.vertexData,c=t._texture.baseTexture._batchLocation,d=Math.min(t.worldAlpha,1),p=qe.shared.setValue(t._tintRGB).toPremultiplied(d,t._texture.baseTexture.alphaMode>0);for(let t=0;t<u.length;t+=2)o[n++]=u[t],o[n++]=u[t+1],o[n++]=h[t],o[n++]=h[t+1],s[n++]=p,o[n++]=c;for(let t=0;t<l.length;t++)i[r++]=a+l[t]}};let Wn=Hn;Wn.defaultBatchSize=4096,Wn.extension={name:"batch",type:_i.RendererPlugin},Wn._drawCallPool=[],Wn._textureArrayPool=[],wi.add(Wn);const Xn=class extends Un{constructor(t,e,i){super(Bn.from(t||Xn.defaultVertexSrc,e||Xn.defaultFragmentSrc),i),this.padding=0,this.resolution=Xn.defaultResolution,this.multisample=Xn.defaultMultisample,this.enabled=!0,this.autoFit=!0,this.state=new Si}apply(t,e,i,n,r){t.applyFilter(this,e,i,n)}get blendMode(){return this.state.blendMode}set blendMode(t){this.state.blendMode=t}get resolution(){return this._resolution}set resolution(t){this._resolution=t}static get defaultVertexSrc(){return"attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n"}static get defaultFragmentSrc(){return"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor = texture2D(uSampler, vTextureCoord);\n}\n"}};let Vn=Xn;Vn.defaultResolution=1,Vn.defaultMultisample=E.NONE;class Yn{constructor(){this.clearBeforeRender=!0,this._backgroundColor=new qe(0),this.alpha=1}init(t){this.clearBeforeRender=t.clearBeforeRender;const{backgroundColor:e,background:i,backgroundAlpha:n}=t,r=i??e;void 0!==r&&(this.color=r),this.alpha=n}get color(){return this._backgroundColor.value}set color(t){this._backgroundColor.setValue(t)}get alpha(){return this._backgroundColor.alpha}set alpha(t){this._backgroundColor.setAlpha(t)}get backgroundColor(){return this._backgroundColor}destroy(){}}Yn.defaultOptions={backgroundAlpha:1,backgroundColor:0,clearBeforeRender:!0},Yn.extension={type:[_i.RendererSystem,_i.CanvasRendererSystem],name:"background"},wi.add(Yn);class $n{constructor(t){this.renderer=t,this.emptyRenderer=new jn(t),this.currentRenderer=this.emptyRenderer}setObjectRenderer(t){this.currentRenderer!==t&&(this.currentRenderer.stop(),this.currentRenderer=t,this.currentRenderer.start())}flush(){this.setObjectRenderer(this.emptyRenderer)}reset(){this.setObjectRenderer(this.emptyRenderer)}copyBoundTextures(t,e){const{boundTextures:i}=this.renderer.texture;for(let n=e-1;n>=0;--n)t[n]=i[n]||null,t[n]&&(t[n]._batchLocation=n)}boundArray(t,e,i,n){const{elements:r,ids:s,count:o}=t;let a=0;for(let t=0;t<o;t++){const o=r[t],h=o._batchLocation;if(h>=0&&h<n&&e[h]===o)s[t]=h;else for(;a<n;){const n=e[a];if(!n||n._batchEnabled!==i||n._batchLocation!==a){s[t]=a,o._batchLocation=a,e[a]=o;break}a++}}}destroy(){this.renderer=null}}$n.extension={type:_i.RendererSystem,name:"batch"},wi.add($n);let qn=0;class Kn{constructor(t){this.renderer=t,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(t){this.gl=t,this.renderer.gl=t,this.renderer.CONTEXT_UID=qn++}init(t){if(t.context)this.initFromContext(t.context);else{const e=this.renderer.background.alpha<1,i=t.premultipliedAlpha;this.preserveDrawingBuffer=t.preserveDrawingBuffer,this.useContextAlpha=t.useContextAlpha,this.powerPreference=t.powerPreference,this.initFromOptions({alpha:e,premultipliedAlpha:i,antialias:t.antialias,stencil:!0,preserveDrawingBuffer:t.preserveDrawingBuffer,powerPreference:t.powerPreference})}}initFromContext(t){this.gl=t,this.validateContext(t),this.renderer.gl=t,this.renderer.CONTEXT_UID=qn++,this.renderer.runners.contextChange.emit(t);const e=this.renderer.view;void 0!==e.addEventListener&&(e.addEventListener("webglcontextlost",this.handleContextLost,!1),e.addEventListener("webglcontextrestored",this.handleContextRestored,!1))}initFromOptions(t){const e=this.createContext(this.renderer.view,t);this.initFromContext(e)}createContext(t,e){let i;if(C.PREFER_ENV>=a.WEBGL2&&(i=t.getContext("webgl2",e)),i)this.webGLVersion=2;else if(this.webGLVersion=1,i=t.getContext("webgl",e)||t.getContext("experimental-webgl",e),!i)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=i,this.getExtensions(),this.gl}getExtensions(){const{gl:t}=this,e={loseContext:t.getExtension("WEBGL_lose_context"),anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),s3tc:t.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:t.getExtension("WEBGL_compressed_texture_etc"),etc1:t.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:t.getExtension("WEBGL_compressed_texture_atc"),astc:t.getExtension("WEBGL_compressed_texture_astc")};1===this.webGLVersion?Object.assign(this.extensions,e,{drawBuffers:t.getExtension("WEBGL_draw_buffers"),depthTexture:t.getExtension("WEBGL_depth_texture"),vertexArrayObject:t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:t.getExtension("OES_element_index_uint"),floatTexture:t.getExtension("OES_texture_float"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),textureHalfFloat:t.getExtension("OES_texture_half_float"),textureHalfFloatLinear:t.getExtension("OES_texture_half_float_linear")}):2===this.webGLVersion&&Object.assign(this.extensions,e,{colorBufferFloat:t.getExtension("EXT_color_buffer_float")})}handleContextLost(t){t.preventDefault(),setTimeout((()=>{this.gl.isContextLost()&&this.extensions.loseContext&&this.extensions.loseContext.restoreContext()}),0)}handleContextRestored(){this.renderer.runners.contextChange.emit(this.gl)}destroy(){const t=this.renderer.view;this.renderer=null,void 0!==t.removeEventListener&&(t.removeEventListener("webglcontextlost",this.handleContextLost),t.removeEventListener("webglcontextrestored",this.handleContextRestored)),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()}postrender(){this.renderer.objectRenderer.renderingToScreen&&this.gl.flush()}validateContext(t){const e=t.getContextAttributes(),i="WebGL2RenderingContext"in globalThis&&t instanceof globalThis.WebGL2RenderingContext;i&&(this.webGLVersion=2),e&&!e.stencil&&console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");const n=i||!!t.getExtension("OES_element_index_uint");this.supports.uint32Indices=n,n||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")}}Kn.defaultOptions={context:null,antialias:!1,premultipliedAlpha:!0,preserveDrawingBuffer:!1,powerPreference:"default"},Kn.extension={type:_i.RendererSystem,name:"context"},wi.add(Kn);class Zn extends Pi{upload(t,e,i){const n=t.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===_.UNPACK);const r=e.realWidth,s=e.realHeight;return i.width===r&&i.height===s?n.texSubImage2D(e.target,0,0,0,r,s,e.format,i.type,this.data):(i.width=r,i.height=s,n.texImage2D(e.target,0,i.internalFormat,r,s,0,e.format,i.type,this.data)),!0}}class Jn{constructor(t,e){this.width=Math.round(t||100),this.height=Math.round(e||100),this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new Mi("disposeFramebuffer"),this.multisample=E.NONE}get colorTexture(){return this.colorTextures[0]}addColorTexture(t=0,e){return this.colorTextures[t]=e||new Li(null,{scaleMode:m.NEAREST,resolution:1,mipmap:y.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this}addDepthTexture(t){return this.depthTexture=t||new Li(new Zn(null,{width:this.width,height:this.height}),{scaleMode:m.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:y.OFF,format:d.DEPTH_COMPONENT,type:f.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this}enableDepth(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this}enableStencil(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this}resize(t,e){if(t=Math.round(t),e=Math.round(e),t!==this.width||e!==this.height){this.width=t,this.height=e,this.dirtyId++,this.dirtySize++;for(let i=0;i<this.colorTextures.length;i++){const n=this.colorTextures[i],r=n.resolution;n.setSize(t/r,e/r)}if(this.depthTexture){const i=this.depthTexture.resolution;this.depthTexture.setSize(t/i,e/i)}}}dispose(){this.disposeRunner.emit(this,!1)}destroyDepthTexture(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)}}class Qn extends Li{constructor(t={}){if("number"==typeof t){t={width:arguments[0],height:arguments[1],scaleMode:arguments[2],resolution:arguments[3]}}t.width=t.width||100,t.height=t.height||100,t.multisample??(t.multisample=E.NONE),super(null,t),this.mipmap=y.OFF,this.valid=!0,this._clear=new qe([0,0,0,0]),this.framebuffer=new Jn(this.realWidth,this.realHeight).addColorTexture(0,this),this.framebuffer.multisample=t.multisample,this.maskStack=[],this.filterStack=[{}]}set clearColor(t){this._clear.setValue(t)}get clearColor(){return this._clear.value}get clear(){return this._clear}resize(t,e){this.framebuffer.resize(t*this.resolution,e*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)}dispose(){this.framebuffer.dispose(),super.dispose()}destroy(){super.destroy(),this.framebuffer.destroyDepthTexture(),this.framebuffer=null}}class tr extends Ri{constructor(t){const e=t;super(e.naturalWidth||e.videoWidth||e.width,e.naturalHeight||e.videoHeight||e.height),this.source=t,this.noSubImage=!1}static crossOrigin(t,e,i){void 0!==i||e.startsWith("data:")?!1!==i&&(t.crossOrigin="string"==typeof i?i:"anonymous"):t.crossOrigin=vi(e)}upload(t,e,i,n){const r=t.gl,s=e.realWidth,o=e.realHeight;if(n=n||this.source,"undefined"!=typeof HTMLImageElement&&n instanceof HTMLImageElement){if(!n.complete||0===n.naturalWidth)return!1}else if("undefined"!=typeof HTMLVideoElement&&n instanceof HTMLVideoElement&&n.readyState<=1&&0===n.buffered.length)return!1;return r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===_.UNPACK),this.noSubImage||e.target!==r.TEXTURE_2D||i.width!==s||i.height!==o?(i.width=s,i.height=o,r.texImage2D(e.target,0,i.internalFormat,e.format,i.type,n)):r.texSubImage2D(r.TEXTURE_2D,0,0,0,e.format,i.type,n),!0}update(){if(this.destroyed)return;const t=this.source,e=t.naturalWidth||t.videoWidth||t.width,i=t.naturalHeight||t.videoHeight||t.height;this.resize(e,i),super.update()}dispose(){this.source=null}}class er extends tr{constructor(t,e){if(e=e||{},"string"==typeof t){const i=new Image;tr.crossOrigin(i,t,e.crossorigin),i.src=t,t=i}super(t),!t.complete&&this._width&&this._height&&(this._width=0,this._height=0),this.url=t.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=(e.createBitmap??C.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,this.alphaMode="number"==typeof e.alphaMode?e.alphaMode:null,this.bitmap=null,this._load=null,!1!==e.autoLoad&&this.load()}load(t){return this._load||(void 0!==t&&(this.createBitmap=t),this._load=new Promise(((t,e)=>{const i=this.source;this.url=i.src;const n=()=>{this.destroyed||(i.onload=null,i.onerror=null,this.resize(i.width,i.height),this._load=null,this.createBitmap?t(this.process()):t(this))};i.complete&&i.src?n():(i.onload=n,i.onerror=t=>{e(t),this.onError.emit(t)})}))),this._load}process(){const t=this.source;if(null!==this._process)return this._process;if(null!==this.bitmap||!globalThis.createImageBitmap)return Promise.resolve(this);const e=globalThis.createImageBitmap,i=!t.crossOrigin||"anonymous"===t.crossOrigin;return this._process=fetch(t.src,{mode:i?"cors":"no-cors"}).then((t=>t.blob())).then((i=>e(i,0,0,t.width,t.height,{premultiplyAlpha:null===this.alphaMode||this.alphaMode===_.UNPACK?"premultiply":"none"}))).then((t=>this.destroyed?Promise.reject():(this.bitmap=t,this.update(),this._process=null,Promise.resolve(this)))),this._process}upload(t,e,i){if("number"==typeof this.alphaMode&&(e.alphaMode=this.alphaMode),!this.createBitmap)return super.upload(t,e,i);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(super.upload(t,e,i,this.bitmap),!this.preserveBitmap){let t=!0;const n=e._glTextures;for(const r in n){const s=n[r];if(s!==i&&s.dirtyId!==e.dirtyId){t=!1;break}}t&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0}dispose(){this.source.onload=null,this.source.onerror=null,super.dispose(),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null}static test(t){return"undefined"!=typeof HTMLImageElement&&("string"==typeof t||t instanceof HTMLImageElement)}}class ir{constructor(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}set(t,e,i){const n=e.width,r=e.height;if(i){const e=t.width/2/n,s=t.height/2/r,o=t.x/n+e,a=t.y/r+s;i=cn.add(i,cn.NW),this.x0=o+e*cn.uX(i),this.y0=a+s*cn.uY(i),i=cn.add(i,2),this.x1=o+e*cn.uX(i),this.y1=a+s*cn.uY(i),i=cn.add(i,2),this.x2=o+e*cn.uX(i),this.y2=a+s*cn.uY(i),i=cn.add(i,2),this.x3=o+e*cn.uX(i),this.y3=a+s*cn.uY(i)}else this.x0=t.x/n,this.y0=t.y/r,this.x1=(t.x+t.width)/n,this.y1=t.y/r,this.x2=(t.x+t.width)/n,this.y2=(t.y+t.height)/r,this.x3=t.x/n,this.y3=(t.y+t.height)/r;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3}toString(){return`[@pixi/core:TextureUvs x0=${this.x0} y0=${this.y0} x1=${this.x1} y1=${this.y1} x2=${this.x2} y2=${this.y2} x3=${this.x3} y3=${this.y3}]`}}const nr=new ir;function rr(t){t.destroy=function(){},t.on=function(){},t.once=function(){},t.emit=function(){}}class sr extends Y{constructor(t,e,i,n,r,s,o){if(super(),this.noFrame=!1,e||(this.noFrame=!0,e=new Zi(0,0,1,1)),t instanceof sr&&(t=t.baseTexture),this.baseTexture=t,this._frame=e,this.trim=n,this.valid=!1,this._uvs=nr,this.uvMatrix=null,this.orig=i||e,this._rotate=Number(r||0),!0===r)this._rotate=2;else if(this._rotate%2!=0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");this.defaultAnchor=s?new qi(s.x,s.y):new qi(0,0),this.defaultBorders=o,this._updateID=0,this.textureCacheIds=[],t.valid?this.noFrame?t.valid&&this.onBaseTextureUpdated(t):this.frame=e:t.once("loaded",this.onBaseTextureUpdated,this),this.noFrame&&t.on("update",this.onBaseTextureUpdated,this)}update(){this.baseTexture.resource&&this.baseTexture.resource.update()}onBaseTextureUpdated(t){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=t.width,this._frame.height=t.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)}destroy(t){if(this.baseTexture){if(t){const{resource:t}=this.baseTexture;t?.url&&ui[t.url]&&sr.removeFromCache(t.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,sr.removeFromCache(this),this.textureCacheIds=null}clone(){const t=this._frame.clone(),e=this._frame===this.orig?t:this.orig.clone(),i=new sr(this.baseTexture,!this.noFrame&&t,e,this.trim?.clone(),this.rotate,this.defaultAnchor,this.defaultBorders);return this.noFrame&&(i._frame=t),i}updateUvs(){this._uvs===nr&&(this._uvs=new ir),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++}static from(t,e={},i=C.STRICT_TEXTURE_CACHE){const n="string"==typeof t;let r=null;if(n)r=t;else if(t instanceof Li){if(!t.cacheId){const i=e?.pixiIdPrefix||"pixiid";t.cacheId=`${i}-${oi()}`,Li.addToCache(t,t.cacheId)}r=t.cacheId}else{if(!t._pixiId){const i=e?.pixiIdPrefix||"pixiid";t._pixiId=`${i}_${oi()}`}r=t._pixiId}let s=ui[r];if(n&&i&&!s)throw new Error(`The cacheId "${r}" does not exist in TextureCache.`);return s||t instanceof Li?!s&&t instanceof Li&&(s=new sr(t),sr.addToCache(s,r)):(e.resolution||(e.resolution=yi(t)),s=new sr(new Li(t,e)),s.baseTexture.cacheId=r,Li.addToCache(s.baseTexture,r),sr.addToCache(s,r)),s}static fromURL(t,e){const i=Object.assign({autoLoad:!1},e?.resourceOptions),n=sr.from(t,Object.assign({resourceOptions:i},e),!1),r=n.baseTexture.resource;return n.baseTexture.valid?Promise.resolve(n):r.load().then((()=>Promise.resolve(n)))}static fromBuffer(t,e,i,n){return new sr(Li.fromBuffer(t,e,i,n))}static fromLoader(t,e,i,n){const r=new Li(t,Object.assign({scaleMode:Li.defaultOptions.scaleMode,resolution:yi(e)},n)),{resource:s}=r;s instanceof er&&(s.url=e);const o=new sr(r);return i||(i=e),Li.addToCache(o.baseTexture,i),sr.addToCache(o,i),i!==e&&(Li.addToCache(o.baseTexture,e),sr.addToCache(o,e)),o.baseTexture.valid?Promise.resolve(o):new Promise((t=>{o.baseTexture.once("loaded",(()=>t(o)))}))}static addToCache(t,e){e&&(t.textureCacheIds.includes(e)||t.textureCacheIds.push(e),ui[e]&&ui[e]!==t&&console.warn(`Texture added to the cache with an id [${e}] that already had an entry`),ui[e]=t)}static removeFromCache(t){if("string"==typeof t){const e=ui[t];if(e){const i=e.textureCacheIds.indexOf(t);return i>-1&&e.textureCacheIds.splice(i,1),delete ui[t],e}}else if(t?.textureCacheIds){for(let e=0;e<t.textureCacheIds.length;++e)ui[t.textureCacheIds[e]]===t&&delete ui[t.textureCacheIds[e]];return t.textureCacheIds.length=0,t}return null}get resolution(){return this.baseTexture.resolution}get frame(){return this._frame}set frame(t){this._frame=t,this.noFrame=!1;const{x:e,y:i,width:n,height:r}=t,s=e+n>this.baseTexture.width,o=i+r>this.baseTexture.height;if(s||o){const t=s&&o?"and":"or",a=`X: ${e} + ${n} = ${e+n} > ${this.baseTexture.width}`,h=`Y: ${i} + ${r} = ${i+r} > ${this.baseTexture.height}`;throw new Error(`Texture Error: frame does not fit inside the base Texture dimensions: ${a} ${t} ${h}`)}this.valid=n&&r&&this.baseTexture.valid,this.trim||this.rotate||(this.orig=t),this.valid&&this.updateUvs()}get rotate(){return this._rotate}set rotate(t){this._rotate=t,this.valid&&this.updateUvs()}get width(){return this.orig.width}get height(){return this.orig.height}castToBaseTexture(){return this.baseTexture}static get EMPTY(){return sr._EMPTY||(sr._EMPTY=new sr(new Li),rr(sr._EMPTY),rr(sr._EMPTY.baseTexture)),sr._EMPTY}static get WHITE(){if(!sr._WHITE){const t=C.ADAPTER.createCanvas(16,16),e=t.getContext("2d");t.width=16,t.height=16,e.fillStyle="white",e.fillRect(0,0,16,16),sr._WHITE=new sr(Li.from(t)),rr(sr._WHITE),rr(sr._WHITE.baseTexture)}return sr._WHITE}}class or extends sr{constructor(t,e){super(t,e),this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}get framebuffer(){return this.baseTexture.framebuffer}get multisample(){return this.framebuffer.multisample}set multisample(t){this.framebuffer.multisample=t}resize(t,e,i=!0){const n=this.baseTexture.resolution,r=Math.round(t*n)/n,s=Math.round(e*n)/n;this.valid=r>0&&s>0,this._frame.width=this.orig.width=r,this._frame.height=this.orig.height=s,i&&this.baseTexture.resize(r,s),this.updateUvs()}setResolution(t){const{baseTexture:e}=this;e.resolution!==t&&(e.setResolution(t),this.resize(e.width,e.height,!1))}static create(t){return new or(new Qn(t))}}class ar{constructor(t){this.texturePool={},this.textureOptions=t||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}createTexture(t,e,i=E.NONE){const n=new Qn(Object.assign({width:t,height:e,resolution:1,multisample:i},this.textureOptions));return new or(n)}getOptimalTexture(t,e,i=1,n=E.NONE){let r;t=Math.ceil(t*i-1e-6),e=Math.ceil(e*i-1e-6),this.enableFullScreen&&t===this._pixelsWidth&&e===this._pixelsHeight?r=n>1?-n:-1:(r=((65535&(t=ti(t)))<<16|65535&(e=ti(e)))>>>0,n>1&&(r+=4294967296*n)),this.texturePool[r]||(this.texturePool[r]=[]);let s=this.texturePool[r].pop();return s||(s=this.createTexture(t,e,n)),s.filterPoolKey=r,s.setResolution(i),s}getFilterTexture(t,e,i){const n=this.getOptimalTexture(t.width,t.height,e||t.resolution,i||E.NONE);return n.filterFrame=t.filterFrame,n}returnTexture(t){const e=t.filterPoolKey;t.filterFrame=null,this.texturePool[e].push(t)}returnFilterTexture(t){this.returnTexture(t)}clear(t){if(t=!1!==t)for(const t in this.texturePool){const e=this.texturePool[t];if(e)for(let t=0;t<e.length;t++)e[t].destroy(!0)}this.texturePool={}}setScreenSize(t){if(t.width!==this._pixelsWidth||t.height!==this._pixelsHeight){this.enableFullScreen=t.width>0&&t.height>0;for(const t in this.texturePool){if(!(Number(t)<0))continue;const e=this.texturePool[t];if(e)for(let t=0;t<e.length;t++)e[t].destroy(!0);this.texturePool[t]=[]}this._pixelsWidth=t.width,this._pixelsHeight=t.height}}}ar.SCREEN_KEY=-1;class hr extends Hi{constructor(){super(),this.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2])}}class lr extends Hi{constructor(){super(),this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new ki(this.vertices),this.uvBuffer=new ki(this.uvs),this.addAttribute("aVertexPosition",this.vertexBuffer).addAttribute("aTextureCoord",this.uvBuffer).addIndex([0,1,2,0,2,3])}map(t,e){let i=0,n=0;return this.uvs[0]=i,this.uvs[1]=n,this.uvs[2]=i+e.width/t.width,this.uvs[3]=n,this.uvs[4]=i+e.width/t.width,this.uvs[5]=n+e.height/t.height,this.uvs[6]=i,this.uvs[7]=n+e.height/t.height,i=e.x,n=e.y,this.vertices[0]=i,this.vertices[1]=n,this.vertices[2]=i+e.width,this.vertices[3]=n,this.vertices[4]=i+e.width,this.vertices[5]=n+e.height,this.vertices[6]=i,this.vertices[7]=n+e.height,this.invalidate(),this}invalidate(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this}}class ur{constructor(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=E.NONE,this.sourceFrame=new Zi,this.destinationFrame=new Zi,this.bindingSourceFrame=new Zi,this.bindingDestinationFrame=new Zi,this.filters=[],this.transform=null}clear(){this.target=null,this.filters=null,this.renderTexture=null}}const cr=[new qi,new qi,new qi,new qi],dr=new nn;class pr{constructor(t){this.renderer=t,this.defaultFilterStack=[{}],this.texturePool=new ar,this.statePool=[],this.quad=new hr,this.quadUv=new lr,this.tempRect=new Zi,this.activeState={},this.globalUniforms=new Fn({outputFrame:new Zi,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}init(){this.texturePool.setScreenSize(this.renderer.view)}push(t,e){const i=this.renderer,n=this.defaultFilterStack,r=this.statePool.pop()||new ur,s=this.renderer.renderTexture;let o=e[0].resolution,a=e[0].multisample,h=e[0].padding,l=e[0].autoFit,u=e[0].legacy??!0;for(let t=1;t<e.length;t++){const i=e[t];o=Math.min(o,i.resolution),a=Math.min(a,i.multisample),h=this.useMaxPadding?Math.max(h,i.padding):h+i.padding,l=l&&i.autoFit,u=u||(i.legacy??!0)}1===n.length&&(this.defaultFilterStack[0].renderTexture=s.current),n.push(r),r.resolution=o,r.multisample=a,r.legacy=u,r.target=t,r.sourceFrame.copyFrom(t.filterArea||t.getBounds(!0)),r.sourceFrame.pad(h);const c=this.tempRect.copyFrom(s.sourceFrame);i.projection.transform&&this.transformAABB(dr.copyFrom(i.projection.transform).invert(),c),l?(r.sourceFrame.fit(c),(r.sourceFrame.width<=0||r.sourceFrame.height<=0)&&(r.sourceFrame.width=0,r.sourceFrame.height=0)):r.sourceFrame.intersects(c)||(r.sourceFrame.width=0,r.sourceFrame.height=0),this.roundFrame(r.sourceFrame,s.current?s.current.resolution:i.resolution,s.sourceFrame,s.destinationFrame,i.projection.transform),r.renderTexture=this.getOptimalFilterTexture(r.sourceFrame.width,r.sourceFrame.height,o,a),r.filters=e,r.destinationFrame.width=r.renderTexture.width,r.destinationFrame.height=r.renderTexture.height;const d=this.tempRect;d.x=0,d.y=0,d.width=r.sourceFrame.width,d.height=r.sourceFrame.height,r.renderTexture.filterFrame=r.sourceFrame,r.bindingSourceFrame.copyFrom(s.sourceFrame),r.bindingDestinationFrame.copyFrom(s.destinationFrame),r.transform=i.projection.transform,i.projection.transform=null,s.bind(r.renderTexture,r.sourceFrame,d),i.framebuffer.clear(0,0,0,0)}pop(){const t=this.defaultFilterStack,e=t.pop(),i=e.filters;this.activeState=e;const n=this.globalUniforms.uniforms;n.outputFrame=e.sourceFrame,n.resolution=e.resolution;const r=n.inputSize,s=n.inputPixel,o=n.inputClamp;if(r[0]=e.destinationFrame.width,r[1]=e.destinationFrame.height,r[2]=1/r[0],r[3]=1/r[1],s[0]=Math.round(r[0]*e.resolution),s[1]=Math.round(r[1]*e.resolution),s[2]=1/s[0],s[3]=1/s[1],o[0]=.5*s[2],o[1]=.5*s[3],o[2]=e.sourceFrame.width*r[2]-.5*s[2],o[3]=e.sourceFrame.height*r[3]-.5*s[3],e.legacy){const t=n.filterArea;t[0]=e.destinationFrame.width,t[1]=e.destinationFrame.height,t[2]=e.sourceFrame.x,t[3]=e.sourceFrame.y,n.filterClamp=n.inputClamp}this.globalUniforms.update();const a=t[t.length-1];if(this.renderer.framebuffer.blit(),1===i.length)i[0].apply(this,e.renderTexture,a.renderTexture,x.BLEND,e),this.returnFilterTexture(e.renderTexture);else{let t=e.renderTexture,n=this.getOptimalFilterTexture(t.width,t.height,e.resolution);n.filterFrame=t.filterFrame;let r=0;for(r=0;r<i.length-1;++r){1===r&&e.multisample>1&&(n=this.getOptimalFilterTexture(t.width,t.height,e.resolution),n.filterFrame=t.filterFrame),i[r].apply(this,t,n,x.CLEAR,e);const s=t;t=n,n=s}i[r].apply(this,t,a.renderTexture,x.BLEND,e),r>1&&e.multisample>1&&this.returnFilterTexture(e.renderTexture),this.returnFilterTexture(t),this.returnFilterTexture(n)}e.clear(),this.statePool.push(e)}bindAndClear(t,e=x.CLEAR){const{renderTexture:i,state:n}=this.renderer;if(t===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,t?.filterFrame){const e=this.tempRect;e.x=0,e.y=0,e.width=t.filterFrame.width,e.height=t.filterFrame.height,i.bind(t,t.filterFrame,e)}else t!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?i.bind(t):this.renderer.renderTexture.bind(t,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);const r=1&n.stateId||this.forceClear;(e===x.CLEAR||e===x.BLIT&&r)&&this.renderer.framebuffer.clear(0,0,0,0)}applyFilter(t,e,i,n){const r=this.renderer;r.state.set(t.state),this.bindAndClear(i,n),t.uniforms.uSampler=e,t.uniforms.filterGlobals=this.globalUniforms,r.shader.bind(t),t.legacy=!!t.program.attributeData.aTextureCoord,t.legacy?(this.quadUv.map(e._frame,e.filterFrame),r.geometry.bind(this.quadUv),r.geometry.draw(c.TRIANGLES)):(r.geometry.bind(this.quad),r.geometry.draw(c.TRIANGLE_STRIP))}calculateSpriteMatrix(t,e){const{sourceFrame:i,destinationFrame:n}=this.activeState,{orig:r}=e._texture,s=t.set(n.width,0,0,n.height,i.x,i.y),o=e.worldTransform.copyTo(nn.TEMP_MATRIX);return o.invert(),s.prepend(o),s.scale(1/r.width,1/r.height),s.translate(e.anchor.x,e.anchor.y),s}destroy(){this.renderer=null,this.texturePool.clear(!1)}getOptimalFilterTexture(t,e,i=1,n=E.NONE){return this.texturePool.getOptimalTexture(t,e,i,n)}getFilterTexture(t,e,i){if("number"==typeof t){const i=t;t=e,e=i}t=t||this.activeState.renderTexture;const n=this.texturePool.getOptimalTexture(t.width,t.height,e||t.resolution,i||E.NONE);return n.filterFrame=t.filterFrame,n}returnFilterTexture(t){this.texturePool.returnTexture(t)}emptyPool(){this.texturePool.clear(!0)}resize(){this.texturePool.setScreenSize(this.renderer.view)}transformAABB(t,e){const i=cr[0],n=cr[1],r=cr[2],s=cr[3];i.set(e.left,e.top),n.set(e.left,e.bottom),r.set(e.right,e.top),s.set(e.right,e.bottom),t.apply(i,i),t.apply(n,n),t.apply(r,r),t.apply(s,s);const o=Math.min(i.x,n.x,r.x,s.x),a=Math.min(i.y,n.y,r.y,s.y),h=Math.max(i.x,n.x,r.x,s.x),l=Math.max(i.y,n.y,r.y,s.y);e.x=o,e.y=a,e.width=h-o,e.height=l-a}roundFrame(t,e,i,n,r){if(!(t.width<=0||t.height<=0||i.width<=0||i.height<=0)){if(r){const{a:t,b:e,c:i,d:n}=r;if((Math.abs(e)>1e-4||Math.abs(i)>1e-4)&&(Math.abs(t)>1e-4||Math.abs(n)>1e-4))return}(r=r?dr.copyFrom(r):dr.identity()).translate(-i.x,-i.y).scale(n.width/i.width,n.height/i.height).translate(n.x,n.y),this.transformAABB(r,t),t.ceil(e),this.transformAABB(r.invert(),t)}}}pr.extension={type:_i.RendererSystem,name:"filter"},wi.add(pr);class fr{constructor(t){this.framebuffer=t,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=E.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}}const gr=new Zi;class mr{constructor(t){this.renderer=t,this.managedFramebuffers=[],this.unknownFramebuffer=new Jn(10,10),this.msaaSamples=null}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new Zi,this.hasMRT=!0,this.writeDepthTexture=!0,1===this.renderer.context.webGLVersion){let e=this.renderer.context.extensions.drawBuffers,i=this.renderer.context.extensions.depthTexture;C.PREFER_ENV===a.WEBGL_LEGACY&&(e=null,i=null),e?t.drawBuffers=t=>e.drawBuffersWEBGL(t):(this.hasMRT=!1,t.drawBuffers=()=>{}),i||(this.writeDepthTexture=!1)}else this.msaaSamples=t.getInternalformatParameter(t.RENDERBUFFER,t.RGBA8,t.SAMPLES)}bind(t,e,i=0){const{gl:n}=this;if(t){const r=t.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(t);this.current!==t&&(this.current=t,n.bindFramebuffer(n.FRAMEBUFFER,r.framebuffer)),r.mipLevel!==i&&(t.dirtyId++,t.dirtyFormat++,r.mipLevel=i),r.dirtyId!==t.dirtyId&&(r.dirtyId=t.dirtyId,r.dirtyFormat!==t.dirtyFormat?(r.dirtyFormat=t.dirtyFormat,r.dirtySize=t.dirtySize,this.updateFramebuffer(t,i)):r.dirtySize!==t.dirtySize&&(r.dirtySize=t.dirtySize,this.resizeFramebuffer(t)));for(let e=0;e<t.colorTextures.length;e++){const i=t.colorTextures[e];this.renderer.texture.unbind(i.parentTextureArray||i)}if(t.depthTexture&&this.renderer.texture.unbind(t.depthTexture),e){const t=e.width>>i,n=e.height>>i,r=t/e.width;this.setViewport(e.x*r,e.y*r,t,n)}else{const e=t.width>>i,n=t.height>>i;this.setViewport(0,0,e,n)}}else this.current&&(this.current=null,n.bindFramebuffer(n.FRAMEBUFFER,null)),e?this.setViewport(e.x,e.y,e.width,e.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)}setViewport(t,e,i,n){const r=this.viewport;t=Math.round(t),e=Math.round(e),i=Math.round(i),n=Math.round(n),r.width===i&&r.height===n&&r.x===t&&r.y===e||(r.x=t,r.y=e,r.width=i,r.height=n,this.gl.viewport(t,e,i,n))}get size(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}}clear(t,e,i,n,r=l.COLOR|l.DEPTH){const{gl:s}=this;s.clearColor(t,e,i,n),s.clear(r)}initFramebuffer(t){const{gl:e}=this,i=new fr(e.createFramebuffer());return i.multisample=this.detectSamples(t.multisample),t.glFramebuffers[this.CONTEXT_UID]=i,this.managedFramebuffers.push(t),t.disposeRunner.add(this),i}resizeFramebuffer(t){const{gl:e}=this,i=t.glFramebuffers[this.CONTEXT_UID];i.stencil&&(e.bindRenderbuffer(e.RENDERBUFFER,i.stencil),i.msaaBuffer?e.renderbufferStorageMultisample(e.RENDERBUFFER,i.multisample,e.DEPTH24_STENCIL8,t.width,t.height):e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,t.width,t.height));const n=t.colorTextures;let r=n.length;e.drawBuffers||(r=Math.min(r,1));for(let s=0;s<r;s++){const r=n[s],o=r.parentTextureArray||r;this.renderer.texture.bind(o,0),0===s&&i.msaaBuffer&&(e.bindRenderbuffer(e.RENDERBUFFER,i.msaaBuffer),e.renderbufferStorageMultisample(e.RENDERBUFFER,i.multisample,o._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height))}t.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(t.depthTexture,0)}updateFramebuffer(t,e){const{gl:i}=this,n=t.glFramebuffers[this.CONTEXT_UID],r=t.colorTextures;let s=r.length;i.drawBuffers||(s=Math.min(s,1)),n.multisample>1&&this.canMultisampleFramebuffer(t)?n.msaaBuffer=n.msaaBuffer||i.createRenderbuffer():n.msaaBuffer&&(i.deleteRenderbuffer(n.msaaBuffer),n.msaaBuffer=null,n.blitFramebuffer&&(n.blitFramebuffer.dispose(),n.blitFramebuffer=null));const o=[];for(let a=0;a<s;a++){const s=r[a],h=s.parentTextureArray||s;this.renderer.texture.bind(h,0),0===a&&n.msaaBuffer?(i.bindRenderbuffer(i.RENDERBUFFER,n.msaaBuffer),i.renderbufferStorageMultisample(i.RENDERBUFFER,n.multisample,h._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.RENDERBUFFER,n.msaaBuffer)):(i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+a,s.target,h._glTextures[this.CONTEXT_UID].texture,e),o.push(i.COLOR_ATTACHMENT0+a))}if(o.length>1&&i.drawBuffers(o),t.depthTexture){if(this.writeDepthTexture){const n=t.depthTexture;this.renderer.texture.bind(n,0),i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.TEXTURE_2D,n._glTextures[this.CONTEXT_UID].texture,e)}}!t.stencil&&!t.depth||t.depthTexture&&this.writeDepthTexture?n.stencil&&(i.deleteRenderbuffer(n.stencil),n.stencil=null):(n.stencil=n.stencil||i.createRenderbuffer(),i.bindRenderbuffer(i.RENDERBUFFER,n.stencil),n.msaaBuffer?i.renderbufferStorageMultisample(i.RENDERBUFFER,n.multisample,i.DEPTH24_STENCIL8,t.width,t.height):i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,t.width,t.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,n.stencil))}canMultisampleFramebuffer(t){return 1!==this.renderer.context.webGLVersion&&t.colorTextures.length<=1&&!t.depthTexture}detectSamples(t){const{msaaSamples:e}=this;let i=E.NONE;if(t<=1||null===e)return i;for(let n=0;n<e.length;n++)if(e[n]<=t){i=e[n];break}return 1===i&&(i=E.NONE),i}blit(t,e,i){const{current:n,renderer:r,gl:s,CONTEXT_UID:o}=this;if(2!==r.context.webGLVersion)return;if(!n)return;const a=n.glFramebuffers[o];if(!a)return;if(!t){if(!a.msaaBuffer)return;const e=n.colorTextures[0];if(!e)return;a.blitFramebuffer||(a.blitFramebuffer=new Jn(n.width,n.height),a.blitFramebuffer.addColorTexture(0,e)),(t=a.blitFramebuffer).colorTextures[0]!==e&&(t.colorTextures[0]=e,t.dirtyId++,t.dirtyFormat++),t.width===n.width&&t.height===n.height||(t.width=n.width,t.height=n.height,t.dirtyId++,t.dirtySize++)}e||((e=gr).width=n.width,e.height=n.height),i||(i=e);const h=e.width===i.width&&e.height===i.height;this.bind(t),s.bindFramebuffer(s.READ_FRAMEBUFFER,a.framebuffer),s.blitFramebuffer(e.left,e.top,e.right,e.bottom,i.left,i.top,i.right,i.bottom,s.COLOR_BUFFER_BIT,h?s.NEAREST:s.LINEAR),s.bindFramebuffer(s.READ_FRAMEBUFFER,t.glFramebuffers[this.CONTEXT_UID].framebuffer)}disposeFramebuffer(t,e){const i=t.glFramebuffers[this.CONTEXT_UID],n=this.gl;if(!i)return;delete t.glFramebuffers[this.CONTEXT_UID];const r=this.managedFramebuffers.indexOf(t);r>=0&&this.managedFramebuffers.splice(r,1),t.disposeRunner.remove(this),e||(n.deleteFramebuffer(i.framebuffer),i.msaaBuffer&&n.deleteRenderbuffer(i.msaaBuffer),i.stencil&&n.deleteRenderbuffer(i.stencil)),i.blitFramebuffer&&this.disposeFramebuffer(i.blitFramebuffer,e)}disposeAll(t){const e=this.managedFramebuffers;this.managedFramebuffers=[];for(let i=0;i<e.length;i++)this.disposeFramebuffer(e[i],t)}forceStencil(){const t=this.current;if(!t)return;const e=t.glFramebuffers[this.CONTEXT_UID];if(!e||e.stencil)return;t.stencil=!0;const i=t.width,n=t.height,r=this.gl,s=r.createRenderbuffer();r.bindRenderbuffer(r.RENDERBUFFER,s),e.msaaBuffer?r.renderbufferStorageMultisample(r.RENDERBUFFER,e.multisample,r.DEPTH24_STENCIL8,i,n):r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_STENCIL,i,n),e.stencil=s,r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.RENDERBUFFER,s)}reset(){this.current=this.unknownFramebuffer,this.viewport=new Zi}destroy(){this.renderer=null}}mr.extension={type:_i.RendererSystem,name:"framebuffer"},wi.add(mr);const vr={5126:4,5123:2,5121:1};class yr{constructor(t){this.renderer=t,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl,e=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,2!==e.webGLVersion){let e=this.renderer.context.extensions.vertexArrayObject;C.PREFER_ENV===a.WEBGL_LEGACY&&(e=null),e?(t.createVertexArray=()=>e.createVertexArrayOES(),t.bindVertexArray=t=>e.bindVertexArrayOES(t),t.deleteVertexArray=t=>e.deleteVertexArrayOES(t)):(this.hasVao=!1,t.createVertexArray=()=>null,t.bindVertexArray=()=>null,t.deleteVertexArray=()=>null)}if(2!==e.webGLVersion){const e=t.getExtension("ANGLE_instanced_arrays");e?(t.vertexAttribDivisor=(t,i)=>e.vertexAttribDivisorANGLE(t,i),t.drawElementsInstanced=(t,i,n,r,s)=>e.drawElementsInstancedANGLE(t,i,n,r,s),t.drawArraysInstanced=(t,i,n,r)=>e.drawArraysInstancedANGLE(t,i,n,r)):this.hasInstance=!1}this.canUseUInt32ElementIndex=2===e.webGLVersion||!!e.extensions.uint32ElementIndex}bind(t,e){e=e||this.renderer.shader.shader;const{gl:i}=this;let n=t.glVertexArrayObjects[this.CONTEXT_UID],r=!1;n||(this.managedGeometries[t.id]=t,t.disposeRunner.add(this),t.glVertexArrayObjects[this.CONTEXT_UID]=n={},r=!0);const s=n[e.program.id]||this.initGeometryVao(t,e,r);this._activeGeometry=t,this._activeVao!==s&&(this._activeVao=s,this.hasVao?i.bindVertexArray(s):this.activateVao(t,e.program)),this.updateBuffers()}reset(){this.unbind()}updateBuffers(){const t=this._activeGeometry,e=this.renderer.buffer;for(let i=0;i<t.buffers.length;i++){const n=t.buffers[i];e.update(n)}}checkCompatibility(t,e){const i=t.attributes,n=e.attributeData;for(const t in n)if(!i[t])throw new Error(`shader and geometry incompatible, geometry missing the "${t}" attribute`)}getSignature(t,e){const i=t.attributes,n=e.attributeData,r=["g",t.id];for(const t in i)n[t]&&r.push(t,n[t].location);return r.join("-")}initGeometryVao(t,e,i=!0){const n=this.gl,r=this.CONTEXT_UID,s=this.renderer.buffer,o=e.program;o.glPrograms[r]||this.renderer.shader.generateProgram(e),this.checkCompatibility(t,o);const a=this.getSignature(t,o),h=t.glVertexArrayObjects[this.CONTEXT_UID];let l=h[a];if(l)return h[o.id]=l,l;const u=t.buffers,c=t.attributes,d={},p={};for(const t in u)d[t]=0,p[t]=0;for(const t in c)!c[t].size&&o.attributeData[t]?c[t].size=o.attributeData[t].size:c[t].size||console.warn(`PIXI Geometry attribute '${t}' size cannot be determined (likely the bound shader does not have the attribute)`),d[c[t].buffer]+=c[t].size*vr[c[t].type];for(const t in c){const e=c[t],i=e.size;void 0===e.stride&&(d[e.buffer]===i*vr[e.type]?e.stride=0:e.stride=d[e.buffer]),void 0===e.start&&(e.start=p[e.buffer],p[e.buffer]+=i*vr[e.type])}l=n.createVertexArray(),n.bindVertexArray(l);for(let t=0;t<u.length;t++){const e=u[t];s.bind(e),i&&e._glBuffers[r].refCount++}return this.activateVao(t,o),h[o.id]=l,h[a]=l,n.bindVertexArray(null),s.unbind(A.ARRAY_BUFFER),l}disposeGeometry(t,e){if(!this.managedGeometries[t.id])return;delete this.managedGeometries[t.id];const i=t.glVertexArrayObjects[this.CONTEXT_UID],n=this.gl,r=t.buffers,s=this.renderer?.buffer;if(t.disposeRunner.remove(this),i){if(s)for(let t=0;t<r.length;t++){const i=r[t]._glBuffers[this.CONTEXT_UID];i&&(i.refCount--,0!==i.refCount||e||s.dispose(r[t],e))}if(!e)for(const t in i)if("g"===t[0]){const e=i[t];this._activeVao===e&&this.unbind(),n.deleteVertexArray(e)}delete t.glVertexArrayObjects[this.CONTEXT_UID]}}disposeAll(t){const e=Object.keys(this.managedGeometries);for(let i=0;i<e.length;i++)this.disposeGeometry(this.managedGeometries[e[i]],t)}activateVao(t,e){const i=this.gl,n=this.CONTEXT_UID,r=this.renderer.buffer,s=t.buffers,o=t.attributes;t.indexBuffer&&r.bind(t.indexBuffer);let a=null;for(const t in o){const h=o[t],l=s[h.buffer],u=l._glBuffers[n];if(e.attributeData[t]){a!==u&&(r.bind(l),a=u);const n=e.attributeData[t].location;if(i.enableVertexAttribArray(n),i.vertexAttribPointer(n,h.size,h.type||i.FLOAT,h.normalized,h.stride,h.start),h.instance){if(!this.hasInstance)throw new Error("geometry error, GPU Instancing is not supported on this device");i.vertexAttribDivisor(n,h.divisor)}}}}draw(t,e,i,n){const{gl:r}=this,s=this._activeGeometry;if(s.indexBuffer){const o=s.indexBuffer.data.BYTES_PER_ELEMENT,a=2===o?r.UNSIGNED_SHORT:r.UNSIGNED_INT;2===o||4===o&&this.canUseUInt32ElementIndex?s.instanced?r.drawElementsInstanced(t,e||s.indexBuffer.data.length,a,(i||0)*o,n||1):r.drawElements(t,e||s.indexBuffer.data.length,a,(i||0)*o):console.warn("unsupported index buffer type: uint32")}else s.instanced?r.drawArraysInstanced(t,i,e||s.getSize(),n||1):r.drawArrays(t,i,e||s.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this.renderer=null}}yr.extension={type:_i.RendererSystem,name:"geometry"},wi.add(yr);const _r=new nn;class xr{constructor(t,e){this._texture=t,this.mapCoord=new nn,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=void 0===e?.5:e,this.isSimple=!1}get texture(){return this._texture}set texture(t){this._texture=t,this._textureID=-1}multiplyUvs(t,e){void 0===e&&(e=t);const i=this.mapCoord;for(let n=0;n<t.length;n+=2){const r=t[n],s=t[n+1];e[n]=r*i.a+s*i.c+i.tx,e[n+1]=r*i.b+s*i.d+i.ty}return e}update(t){const e=this._texture;if(!e||!e.valid)return!1;if(!t&&this._textureID===e._updateID)return!1;this._textureID=e._updateID,this._updateID++;const i=e._uvs;this.mapCoord.set(i.x1-i.x0,i.y1-i.y0,i.x3-i.x0,i.y3-i.y0,i.x0,i.y0);const n=e.orig,r=e.trim;r&&(_r.set(n.width/r.width,0,0,n.height/r.height,-r.x/r.width,-r.y/r.height),this.mapCoord.append(_r));const s=e.baseTexture,o=this.uClampFrame,a=this.clampMargin/s.resolution,h=this.clampOffset;return o[0]=(e._frame.x+a+h)/s.width,o[1]=(e._frame.y+a+h)/s.height,o[2]=(e._frame.x+e._frame.width-a+h)/s.width,o[3]=(e._frame.y+e._frame.height-a+h)/s.height,this.uClampOffset[0]=h/s.realWidth,this.uClampOffset[1]=h/s.realHeight,this.isSimple=e._frame.width===s.width&&e._frame.height===s.height&&0===e.rotate,!0}}class br extends Vn{constructor(t,e,i){let n=null;"string"!=typeof t&&void 0===e&&void 0===i&&(n=t,t=void 0,e=void 0,i=void 0),super(t||"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 otherMatrix;\n\nvarying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n}\n",e||"varying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D mask;\nuniform float alpha;\nuniform float npmAlpha;\nuniform vec4 maskClamp;\n\nvoid main(void)\n{\n    float clip = step(3.5,\n        step(maskClamp.x, vMaskCoord.x) +\n        step(maskClamp.y, vMaskCoord.y) +\n        step(vMaskCoord.x, maskClamp.z) +\n        step(vMaskCoord.y, maskClamp.w));\n\n    vec4 original = texture2D(uSampler, vTextureCoord);\n    vec4 masky = texture2D(mask, vMaskCoord);\n    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);\n\n    original *= (alphaMul * masky.r * alpha * clip);\n\n    gl_FragColor = original;\n}\n",i),this.maskSprite=n,this.maskMatrix=new nn}get maskSprite(){return this._maskSprite}set maskSprite(t){this._maskSprite=t,this._maskSprite&&(this._maskSprite.renderable=!1)}apply(t,e,i,n){const r=this._maskSprite,s=r._texture;s.valid&&(s.uvMatrix||(s.uvMatrix=new xr(s,0)),s.uvMatrix.update(),this.uniforms.npmAlpha=s.baseTexture.alphaMode?0:1,this.uniforms.mask=s,this.uniforms.otherMatrix=t.calculateSpriteMatrix(this.maskMatrix,r).prepend(s.uvMatrix.mapCoord),this.uniforms.alpha=r.worldAlpha,this.uniforms.maskClamp=s.uvMatrix.uClampFrame,t.applyFilter(this,e,i,n))}}class wr{constructor(t=null){this.type=T.NONE,this.autoDetect=!0,this.maskObject=t||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=Vn.defaultMultisample,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}get filter(){return this._filters?this._filters[0]:null}set filter(t){t?this._filters?this._filters[0]=t:this._filters=[t]:this._filters=null}reset(){this.pooled&&(this.maskObject=null,this.type=T.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null}copyCountersOrReset(t){t?(this._stencilCounter=t._stencilCounter,this._scissorCounter=t._scissorCounter,this._scissorRect=t._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)}}class Tr{constructor(t){this.renderer=t,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}setMaskStack(t){this.maskStack=t,this.renderer.scissor.setMaskStack(t),this.renderer.stencil.setMaskStack(t)}push(t,e){let i=e;if(!i.isMaskData){const t=this.maskDataPool.pop()||new wr;t.pooled=!0,t.maskObject=e,i=t}const n=0!==this.maskStack.length?this.maskStack[this.maskStack.length-1]:null;if(i.copyCountersOrReset(n),i._colorMask=n?n._colorMask:15,i.autoDetect&&this.detect(i),i._target=t,i.type!==T.SPRITE&&this.maskStack.push(i),i.enabled)switch(i.type){case T.SCISSOR:this.renderer.scissor.push(i);break;case T.STENCIL:this.renderer.stencil.push(i);break;case T.SPRITE:i.copyCountersOrReset(null),this.pushSpriteMask(i);break;case T.COLOR:this.pushColorMask(i)}i.type===T.SPRITE&&this.maskStack.push(i)}pop(t){const e=this.maskStack.pop();if(e&&e._target===t){if(e.enabled)switch(e.type){case T.SCISSOR:this.renderer.scissor.pop(e);break;case T.STENCIL:this.renderer.stencil.pop(e.maskObject);break;case T.SPRITE:this.popSpriteMask(e);break;case T.COLOR:this.popColorMask(e)}if(e.reset(),e.pooled&&this.maskDataPool.push(e),0!==this.maskStack.length){const t=this.maskStack[this.maskStack.length-1];t.type===T.SPRITE&&t._filters&&(t._filters[0].maskSprite=t.maskObject)}}}detect(t){const e=t.maskObject;e?e.isSprite?t.type=T.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(t)?t.type=T.SCISSOR:t.type=T.STENCIL:t.type=T.COLOR}pushSpriteMask(t){const{maskObject:e}=t,i=t._target;let n=t._filters;n||(n=this.alphaMaskPool[this.alphaMaskIndex],n||(n=this.alphaMaskPool[this.alphaMaskIndex]=[new br]));const r=this.renderer,s=r.renderTexture;let o,a;if(s.current){const e=s.current;o=t.resolution||e.resolution,a=t.multisample??e.multisample}else o=t.resolution||r.resolution,a=t.multisample??r.multisample;n[0].resolution=o,n[0].multisample=a,n[0].maskSprite=e;const h=i.filterArea;i.filterArea=e.getBounds(!0),r.filter.push(i,n),i.filterArea=h,t._filters||this.alphaMaskIndex++}popSpriteMask(t){this.renderer.filter.pop(),t._filters?t._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)}pushColorMask(t){const e=t._colorMask,i=t._colorMask=e&t.colorMask;i!==e&&this.renderer.gl.colorMask(0!=(1&i),0!=(2&i),0!=(4&i),0!=(8&i))}popColorMask(t){const e=t._colorMask,i=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;i!==e&&this.renderer.gl.colorMask(0!=(1&i),0!=(2&i),0!=(4&i),0!=(8&i))}destroy(){this.renderer=null}}Tr.extension={type:_i.RendererSystem,name:"mask"},wi.add(Tr);class Er{constructor(t){this.renderer=t,this.maskStack=[],this.glConst=0}getStackLength(){return this.maskStack.length}setMaskStack(t){const{gl:e}=this.renderer,i=this.getStackLength();this.maskStack=t;const n=this.getStackLength();n!==i&&(0===n?e.disable(this.glConst):(e.enable(this.glConst),this._useCurrent()))}_useCurrent(){}destroy(){this.renderer=null,this.maskStack=null}}const Ar=new nn,Sr=[],Cr=class extends Er{constructor(t){super(t),this.glConst=C.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST}getStackLength(){const t=this.maskStack[this.maskStack.length-1];return t?t._scissorCounter:0}calcScissorRect(t){if(t._scissorRectLocal)return;const e=t._scissorRect,{maskObject:i}=t,{renderer:n}=this,r=n.renderTexture,s=i.getBounds(!0,Sr.pop()??new Zi);this.roundFrameToPixels(s,r.current?r.current.resolution:n.resolution,r.sourceFrame,r.destinationFrame,n.projection.transform),e&&s.fit(e),t._scissorRectLocal=s}static isMatrixRotated(t){if(!t)return!1;const{a:e,b:i,c:n,d:r}=t;return(Math.abs(i)>1e-4||Math.abs(n)>1e-4)&&(Math.abs(e)>1e-4||Math.abs(r)>1e-4)}testScissor(t){const{maskObject:e}=t;if(!e.isFastRect||!e.isFastRect())return!1;if(Cr.isMatrixRotated(e.worldTransform))return!1;if(Cr.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(t);const i=t._scissorRectLocal;return i.width>0&&i.height>0}roundFrameToPixels(t,e,i,n,r){Cr.isMatrixRotated(r)||((r=r?Ar.copyFrom(r):Ar.identity()).translate(-i.x,-i.y).scale(n.width/i.width,n.height/i.height).translate(n.x,n.y),this.renderer.filter.transformAABB(r,t),t.fit(n),t.x=Math.round(t.x*e),t.y=Math.round(t.y*e),t.width=Math.round(t.width*e),t.height=Math.round(t.height*e))}push(t){t._scissorRectLocal||this.calcScissorRect(t);const{gl:e}=this.renderer;t._scissorRect||e.enable(e.SCISSOR_TEST),t._scissorCounter++,t._scissorRect=t._scissorRectLocal,this._useCurrent()}pop(t){const{gl:e}=this.renderer;t&&Sr.push(t._scissorRectLocal),this.getStackLength()>0?this._useCurrent():e.disable(e.SCISSOR_TEST)}_useCurrent(){const t=this.maskStack[this.maskStack.length-1]._scissorRect;let e;e=this.renderer.renderTexture.current?t.y:this.renderer.height-t.height-t.y,this.renderer.gl.scissor(t.x,e,t.width,t.height)}};let Ir=Cr;Ir.extension={type:_i.RendererSystem,name:"scissor"},wi.add(Ir);class Mr extends Er{constructor(t){super(t),this.glConst=C.ADAPTER.getWebGLRenderingContext().STENCIL_TEST}getStackLength(){const t=this.maskStack[this.maskStack.length-1];return t?t._stencilCounter:0}push(t){const e=t.maskObject,{gl:i}=this.renderer,n=t._stencilCounter;0===n&&(this.renderer.framebuffer.forceStencil(),i.clearStencil(0),i.clear(i.STENCIL_BUFFER_BIT),i.enable(i.STENCIL_TEST)),t._stencilCounter++;const r=t._colorMask;0!==r&&(t._colorMask=0,i.colorMask(!1,!1,!1,!1)),i.stencilFunc(i.EQUAL,n,4294967295),i.stencilOp(i.KEEP,i.KEEP,i.INCR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,0!==r&&(t._colorMask=r,i.colorMask(0!=(1&r),0!=(2&r),0!=(4&r),0!=(8&r))),this._useCurrent()}pop(t){const e=this.renderer.gl;if(0===this.getStackLength())e.disable(e.STENCIL_TEST);else{const i=0!==this.maskStack.length?this.maskStack[this.maskStack.length-1]:null,n=i?i._colorMask:15;0!==n&&(i._colorMask=0,e.colorMask(!1,!1,!1,!1)),e.stencilOp(e.KEEP,e.KEEP,e.DECR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,0!==n&&(i._colorMask=n,e.colorMask(0!=(1&n),0!=(2&n),0!=(4&n),0!=(8&n))),this._useCurrent()}}_useCurrent(){const t=this.renderer.gl;t.stencilFunc(t.EQUAL,this.getStackLength(),4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)}}Mr.extension={type:_i.RendererSystem,name:"stencil"},wi.add(Mr);class Rr{constructor(t){this.renderer=t,this.plugins={},Object.defineProperties(this.plugins,{extract:{enumerable:!1,get:()=>(_e("7.0.0","renderer.plugins.extract has moved to renderer.extract"),t.extract)},prepare:{enumerable:!1,get:()=>(_e("7.0.0","renderer.plugins.prepare has moved to renderer.prepare"),t.prepare)},interaction:{enumerable:!1,get:()=>(_e("7.0.0","renderer.plugins.interaction has been deprecated, use renderer.events"),t.events)}})}init(){const t=this.rendererPlugins;for(const e in t)this.plugins[e]=new t[e](this.renderer)}destroy(){for(const t in this.plugins)this.plugins[t].destroy(),this.plugins[t]=null}}Rr.extension={type:[_i.RendererSystem,_i.CanvasRendererSystem],name:"_plugin"},wi.add(Rr);class Pr{constructor(t){this.renderer=t,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new nn,this.transform=null}update(t,e,i,n){this.destinationFrame=t||this.destinationFrame||this.defaultFrame,this.sourceFrame=e||this.sourceFrame||t,this.calculateProjection(this.destinationFrame,this.sourceFrame,i,n),this.transform&&this.projectionMatrix.append(this.transform);const r=this.renderer;r.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,r.globalUniforms.update(),r.shader.shader&&r.shader.syncUniformGroup(r.shader.shader.uniforms.globals)}calculateProjection(t,e,i,n){const r=this.projectionMatrix,s=n?-1:1;r.identity(),r.a=1/e.width*2,r.d=s*(1/e.height*2),r.tx=-1-e.x*r.a,r.ty=-s-e.y*r.d}setTransform(t){}destroy(){this.renderer=null}}Pr.extension={type:_i.RendererSystem,name:"projection"},wi.add(Pr);const Dr=new fn;class Or{constructor(t){this.renderer=t,this._tempMatrix=new nn}generateTexture(t,e){const{region:i,...n}=e||{},r=i||t.getLocalBounds(null,!0);0===r.width&&(r.width=1),0===r.height&&(r.height=1);const s=or.create({width:r.width,height:r.height,...n});this._tempMatrix.tx=-r.x,this._tempMatrix.ty=-r.y;const o=t.transform;return t.transform=Dr,this.renderer.render(t,{renderTexture:s,transform:this._tempMatrix,skipUpdateTransform:!!t.parent,blit:!0}),t.transform=o,s}destroy(){}}Or.extension={type:[_i.RendererSystem,_i.CanvasRendererSystem],name:"textureGenerator"},wi.add(Or);const Lr=new Zi,Nr=new Zi;class Br{constructor(t){this.renderer=t,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new Zi,this.destinationFrame=new Zi,this.viewportFrame=new Zi}contextChange(){const t=this.renderer?.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(t&&t.alpha&&t.premultipliedAlpha)}bind(t=null,e,i){const n=this.renderer;let r,s,o;this.current=t,t?(r=t.baseTexture,o=r.resolution,e||(Lr.width=t.frame.width,Lr.height=t.frame.height,e=Lr),i||(Nr.x=t.frame.x,Nr.y=t.frame.y,Nr.width=e.width,Nr.height=e.height,i=Nr),s=r.framebuffer):(o=n.resolution,e||(Lr.width=n._view.screen.width,Lr.height=n._view.screen.height,e=Lr),i||((i=Lr).width=e.width,i.height=e.height));const a=this.viewportFrame;a.x=i.x*o,a.y=i.y*o,a.width=i.width*o,a.height=i.height*o,t||(a.y=n.view.height-(a.y+a.height)),a.ceil(),this.renderer.framebuffer.bind(s,a),this.renderer.projection.update(i,e,o,!s),t?this.renderer.mask.setMaskStack(r.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(e),this.destinationFrame.copyFrom(i)}clear(t,e){const i=this.current?this.current.baseTexture.clear:this.renderer.background.backgroundColor,n=qe.shared.setValue(t||i);(this.current&&this.current.baseTexture.alphaMode>0||!this.current&&this._rendererPremultipliedAlpha)&&n.premultiply(n.alpha);const r=this.destinationFrame,s=this.current?this.current.baseTexture:this.renderer._view.screen,o=r.width!==s.width||r.height!==s.height;if(o){let{x:t,y:e,width:i,height:n}=this.viewportFrame;t=Math.round(t),e=Math.round(e),i=Math.round(i),n=Math.round(n),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(t,e,i,n)}this.renderer.framebuffer.clear(n.red,n.green,n.blue,n.alpha,e),o&&this.renderer.scissor.pop()}resize(){this.bind(null)}reset(){this.bind(null)}destroy(){this.renderer=null}}Br.extension={type:_i.RendererSystem,name:"renderTexture"},wi.add(Br);class kr{constructor(t,e){this.program=t,this.uniformData=e,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null}}function Fr(t,e){const i=gn(t,t.VERTEX_SHADER,e.vertexSrc),n=gn(t,t.FRAGMENT_SHADER,e.fragmentSrc),r=t.createProgram();t.attachShader(r,i),t.attachShader(r,n);const s=e.extra?.transformFeedbackVaryings;if(s&&("function"!=typeof t.transformFeedbackVaryings?console.warn("TransformFeedback is not supported but TransformFeedbackVaryings are given."):t.transformFeedbackVaryings(r,s.names,"separate"===s.bufferMode?t.SEPARATE_ATTRIBS:t.INTERLEAVED_ATTRIBS)),t.linkProgram(r),t.getProgramParameter(r,t.LINK_STATUS)||function(t,e,i,n){t.getProgramParameter(e,t.LINK_STATUS)||(t.getShaderParameter(i,t.COMPILE_STATUS)||An(t,i),t.getShaderParameter(n,t.COMPILE_STATUS)||An(t,n),console.error("PixiJS Error: Could not initialize shader."),""!==t.getProgramInfoLog(e)&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",t.getProgramInfoLog(e)))}(t,r,i,n),e.attributeData=function(t,e){const i={},n=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let r=0;r<n;r++){const n=e.getActiveAttrib(t,r);if(n.name.startsWith("gl_"))continue;const s=Rn(e,n.type),o={type:s,name:n.name,size:Cn(s),location:e.getAttribLocation(t,n.name)};i[n.name]=o}return i}(r,t),e.uniformData=function(t,e){const i={},n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let r=0;r<n;r++){const n=e.getActiveUniform(t,r),s=n.name.replace(/\[.*?\]$/,""),o=!!n.name.match(/\[.*?\]$/),a=Rn(e,n.type);i[s]={name:s,index:r,type:a,size:n.size,isArray:o,value:vn(a,n.size)}}return i}(r,t),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(e.vertexSrc)){const i=Object.keys(e.attributeData);i.sort(((t,e)=>t>e?1:-1));for(let n=0;n<i.length;n++)e.attributeData[i[n]].location=n,t.bindAttribLocation(r,n,i[n]);t.linkProgram(r)}t.deleteShader(i),t.deleteShader(n);const o={};for(const i in e.uniformData){const n=e.uniformData[i];o[i]={location:t.getUniformLocation(r,i),value:vn(n.type,n.size)}}return new kr(r,o)}function Ur(t,e,i,n,r){i.buffer.update(r)}const Gr={float:"\n        data[offset] = v;\n    ",vec2:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n    ",vec3:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n\n    ",vec4:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n        data[offset+3] = v[3];\n    ",mat2:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n\n        data[offset+4] = v[2];\n        data[offset+5] = v[3];\n    ",mat3:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n\n        data[offset + 4] = v[3];\n        data[offset + 5] = v[4];\n        data[offset + 6] = v[5];\n\n        data[offset + 8] = v[6];\n        data[offset + 9] = v[7];\n        data[offset + 10] = v[8];\n    ",mat4:"\n        for(var i = 0; i < 16; i++)\n        {\n            data[offset + i] = v[i];\n        }\n    "},zr={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:32,mat3:48,mat4:64};function jr(t,e){if(!t.autoManage)return{size:0,syncFunc:Ur};const i=function(t,e){const i=[];for(const n in t)e[n]&&i.push(e[n]);return i.sort(((t,e)=>t.index-e.index)),i}(t.uniforms,e),{uboElements:n,size:r}=function(t){const e=t.map((t=>({data:t,offset:0,dataLen:0,dirty:0})));let i=0,n=0,r=0;for(let t=0;t<e.length;t++){const s=e[t];if(i=zr[s.data.type],s.data.size>1&&(i=Math.max(i,16)*s.data.size),s.dataLen=i,n%i!=0&&n<16){const t=n%i%16;n+=t,r+=t}n+i>16?(r=16*Math.ceil(r/16),s.offset=r,r+=i,n=i):(s.offset=r,n+=i,r+=i)}return r=16*Math.ceil(r/16),{uboElements:e,size:r}}(i),s=["\n    var v = null;\n    var v2 = null;\n    var cv = null;\n    var t = 0;\n    var gl = renderer.gl\n    var index = 0;\n    var data = buffer.data;\n    "];for(let e=0;e<n.length;e++){const i=n[e],r=t.uniforms[i.data.name],o=i.data.name;let a=!1;for(let t=0;t<yn.length;t++){const e=yn[t];if(e.codeUbo&&e.test(i.data,r)){s.push(`offset = ${i.offset/4};`,yn[t].codeUbo(i.data.name,r)),a=!0;break}}if(!a)if(i.data.size>1){const t=Cn(i.data.type),e=Math.max(zr[i.data.type]/16,1),n=t/e,r=(4-n%4)%4;s.push(`\n                cv = ud.${o}.value;\n                v = uv.${o};\n                offset = ${i.offset/4};\n\n                t = 0;\n\n                for(var i=0; i < ${i.data.size*e}; i++)\n                {\n                    for(var j = 0; j < ${n}; j++)\n                    {\n                        data[offset++] = v[t++];\n                    }\n                    offset += ${r};\n                }\n\n                `)}else{const t=Gr[i.data.type];s.push(`\n                cv = ud.${o}.value;\n                v = uv.${o};\n                offset = ${i.offset/4};\n                ${t};\n                `)}}return s.push("\n       renderer.buffer.update(buffer);\n    "),{size:r,syncFunc:new Function("ud","uv","renderer","syncData","buffer",s.join("\n"))}}let Hr=0;const Wr={textureCount:0,uboCount:0};class Xr{constructor(t){this.destroyed=!1,this.renderer=t,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=Hr++}systemCheck(){if(!function(){if("boolean"==typeof Dn)return Dn;try{const t=new Function("param1","param2","param3","return param1[param2] === param3;");Dn=!0===t({a:"b"},"a","b")}catch(t){Dn=!1}return Dn}())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")}contextChange(t){this.gl=t,this.reset()}bind(t,e){t.disposeRunner.add(this),t.uniforms.globals=this.renderer.globalUniforms;const i=t.program,n=i.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(t);return this.shader=t,this.program!==i&&(this.program=i,this.gl.useProgram(n.program)),e||(Wr.textureCount=0,Wr.uboCount=0,this.syncUniformGroup(t.uniformGroup,Wr)),n}setUniforms(t){const e=this.shader.program,i=e.glPrograms[this.renderer.CONTEXT_UID];e.syncUniforms(i.uniformData,t,this.renderer)}syncUniformGroup(t,e){const i=this.getGlProgram();t.static&&t.dirtyId===i.uniformDirtyGroups[t.id]||(i.uniformDirtyGroups[t.id]=t.dirtyId,this.syncUniforms(t,i,e))}syncUniforms(t,e,i){(t.syncUniforms[this.shader.program.id]||this.createSyncGroups(t))(e.uniformData,t.uniforms,this.renderer,i)}createSyncGroups(t){const e=this.getSignature(t,this.shader.program.uniformData,"u");return this.cache[e]||(this.cache[e]=function(t,e){const i=["\n        var v = null;\n        var cv = null;\n        var cu = null;\n        var t = 0;\n        var gl = renderer.gl;\n    "];for(const n in t.uniforms){const r=e[n];if(!r){t.uniforms[n]?.group&&(t.uniforms[n].ubo?i.push(`\n                        renderer.shader.syncUniformBufferGroup(uv.${n}, '${n}');\n                    `):i.push(`\n                        renderer.shader.syncUniformGroup(uv.${n}, syncData);\n                    `));continue}const s=t.uniforms[n];let o=!1;for(let t=0;t<yn.length;t++)if(yn[t].test(r,s)){i.push(yn[t].code(n,s)),o=!0;break}if(!o){const t=(1!==r.size||r.isArray?xn:_n)[r.type].replace("location",`ud["${n}"].location`);i.push(`\n            cu = ud["${n}"];\n            cv = cu.value;\n            v = uv["${n}"];\n            ${t};`)}}return new Function("ud","uv","renderer","syncData",i.join("\n"))}(t,this.shader.program.uniformData)),t.syncUniforms[this.shader.program.id]=this.cache[e],t.syncUniforms[this.shader.program.id]}syncUniformBufferGroup(t,e){const i=this.getGlProgram();if(!t.static||0!==t.dirtyId||!i.uniformGroups[t.id]){t.dirtyId=0;const n=i.uniformGroups[t.id]||this.createSyncBufferGroup(t,i,e);t.buffer.update(),n(i.uniformData,t.uniforms,this.renderer,Wr,t.buffer)}this.renderer.buffer.bindBufferBase(t.buffer,i.uniformBufferBindings[e])}createSyncBufferGroup(t,e,i){const{gl:n}=this.renderer;this.renderer.buffer.bind(t.buffer);const r=this.gl.getUniformBlockIndex(e.program,i);e.uniformBufferBindings[i]=this.shader.uniformBindCount,n.uniformBlockBinding(e.program,r,this.shader.uniformBindCount),this.shader.uniformBindCount++;const s=this.getSignature(t,this.shader.program.uniformData,"ubo");let o=this._uboCache[s];if(o||(o=this._uboCache[s]=jr(t,this.shader.program.uniformData)),t.autoManage){const e=new Float32Array(o.size/4);t.buffer.update(e)}return e.uniformGroups[t.id]=o.syncFunc,e.uniformGroups[t.id]}getSignature(t,e,i){const n=t.uniforms,r=[`${i}-`];for(const t in n)r.push(t),e[t]&&r.push(e[t].type);return r.join("-")}getGlProgram(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null}generateProgram(t){const e=this.gl,i=t.program,n=Fr(e,i);return i.glPrograms[this.renderer.CONTEXT_UID]=n,n}reset(){this.program=null,this.shader=null}disposeShader(t){this.shader===t&&(this.shader=null)}destroy(){this.renderer=null,this.destroyed=!0}}Xr.extension={type:_i.RendererSystem,name:"shader"},wi.add(Xr);class Vr{constructor(t){this.renderer=t}run(t){const{renderer:e}=this;e.runners.init.emit(e.options),t.hello&&console.log(`PixiJS 7.2.4 - ${e.rendererLogId} - https://pixijs.com`),e.resize(e.screen.width,e.screen.height)}destroy(){}}Vr.defaultOptions={hello:!1},Vr.extension={type:[_i.RendererSystem,_i.CanvasRendererSystem],name:"startup"},wi.add(Vr);const Yr=class{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=u.NONE,this._blendEq=!1,this.map=[],this.map[0]=this.setBlend,this.map[1]=this.setOffset,this.map[2]=this.setCullFace,this.map[3]=this.setDepthTest,this.map[4]=this.setFrontFace,this.map[5]=this.setDepthMask,this.checks=[],this.defaultState=new Si,this.defaultState.blend=!0}contextChange(t){this.gl=t,this.blendModes=function(t,e=[]){return e[u.NORMAL]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[u.ADD]=[t.ONE,t.ONE],e[u.MULTIPLY]=[t.DST_COLOR,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[u.SCREEN]=[t.ONE,t.ONE_MINUS_SRC_COLOR,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[u.OVERLAY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[u.DARKEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[u.LIGHTEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[u.COLOR_DODGE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[u.COLOR_BURN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[u.HARD_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[u.SOFT_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[u.DIFFERENCE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[u.EXCLUSION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[u.HUE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[u.SATURATION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[u.COLOR]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[u.LUMINOSITY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[u.NONE]=[0,0],e[u.NORMAL_NPM]=[t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[u.ADD_NPM]=[t.SRC_ALPHA,t.ONE,t.ONE,t.ONE],e[u.SCREEN_NPM]=[t.SRC_ALPHA,t.ONE_MINUS_SRC_COLOR,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[u.SRC_IN]=[t.DST_ALPHA,t.ZERO],e[u.SRC_OUT]=[t.ONE_MINUS_DST_ALPHA,t.ZERO],e[u.SRC_ATOP]=[t.DST_ALPHA,t.ONE_MINUS_SRC_ALPHA],e[u.DST_OVER]=[t.ONE_MINUS_DST_ALPHA,t.ONE],e[u.DST_IN]=[t.ZERO,t.SRC_ALPHA],e[u.DST_OUT]=[t.ZERO,t.ONE_MINUS_SRC_ALPHA],e[u.DST_ATOP]=[t.ONE_MINUS_DST_ALPHA,t.SRC_ALPHA],e[u.XOR]=[t.ONE_MINUS_DST_ALPHA,t.ONE_MINUS_SRC_ALPHA],e[u.SUBTRACT]=[t.ONE,t.ONE,t.ONE,t.ONE,t.FUNC_REVERSE_SUBTRACT,t.FUNC_ADD],e}(t),this.set(this.defaultState),this.reset()}set(t){if(t=t||this.defaultState,this.stateId!==t.data){let e=this.stateId^t.data,i=0;for(;e;)1&e&&this.map[i].call(this,!!(t.data&1<<i)),e>>=1,i++;this.stateId=t.data}for(let e=0;e<this.checks.length;e++)this.checks[e](this,t)}forceState(t){t=t||this.defaultState;for(let e=0;e<this.map.length;e++)this.map[e].call(this,!!(t.data&1<<e));for(let e=0;e<this.checks.length;e++)this.checks[e](this,t);this.stateId=t.data}setBlend(t){this.updateCheck(Yr.checkBlendMode,t),this.gl[t?"enable":"disable"](this.gl.BLEND)}setOffset(t){this.updateCheck(Yr.checkPolygonOffset,t),this.gl[t?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(t){this.gl[t?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(t){this.gl.depthMask(t)}setCullFace(t){this.gl[t?"enable":"disable"](this.gl.CULL_FACE)}setFrontFace(t){this.gl.frontFace(this.gl[t?"CW":"CCW"])}setBlendMode(t){if(t===this.blendMode)return;this.blendMode=t;const e=this.blendModes[t],i=this.gl;2===e.length?i.blendFunc(e[0],e[1]):i.blendFuncSeparate(e[0],e[1],e[2],e[3]),6===e.length?(this._blendEq=!0,i.blendEquationSeparate(e[4],e[5])):this._blendEq&&(this._blendEq=!1,i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD))}setPolygonOffset(t,e){this.gl.polygonOffset(t,e)}reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)}updateCheck(t,e){const i=this.checks.indexOf(t);e&&-1===i?this.checks.push(t):e||-1===i||this.checks.splice(i,1)}static checkBlendMode(t,e){t.setBlendMode(e.blendMode)}static checkPolygonOffset(t,e){t.setPolygonOffset(1,e.polygonOffset)}destroy(){this.gl=null}};let $r=Yr;$r.extension={type:_i.RendererSystem,name:"state"},wi.add($r);class qr extends Y{constructor(){super(...arguments),this.runners={},this._systemsHash={}}setup(t){this.addRunners(...t.runners);const e=(t.priority??[]).filter((e=>t.systems[e])),i=[...e,...Object.keys(t.systems).filter((t=>!e.includes(t)))];for(const e of i)this.addSystem(t.systems[e],e)}addRunners(...t){t.forEach((t=>{this.runners[t]=new Mi(t)}))}addSystem(t,e){const i=new t(this);if(this[e])throw new Error(`Whoops! The name "${e}" is already in use`);this[e]=i,this._systemsHash[e]=i;for(const t in this.runners)this.runners[t].add(i);return this}emitWithCustomOptions(t,e){const i=Object.keys(this._systemsHash);t.items.forEach((n=>{const r=i.find((t=>this._systemsHash[t]===n));n[t.name](e[r])}))}destroy(){Object.values(this.runners).forEach((t=>{t.destroy()})),this._systemsHash={}}}const Kr=class{constructor(t){this.renderer=t,this.count=0,this.checkCount=0,this.maxIdle=Kr.defaultMaxIdle,this.checkCountMax=Kr.defaultCheckCountMax,this.mode=Kr.defaultMode}postrender(){this.renderer.objectRenderer.renderingToScreen&&(this.count++,this.mode!==b.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){const t=this.renderer.texture,e=t.managedTextures;let i=!1;for(let n=0;n<e.length;n++){const r=e[n];!r.framebuffer&&this.count-r.touched>this.maxIdle&&(t.destroyTexture(r,!0),e[n]=null,i=!0)}if(i){let t=0;for(let i=0;i<e.length;i++)null!==e[i]&&(e[t++]=e[i]);e.length=t}}unload(t){const e=this.renderer.texture,i=t._texture;i&&!i.framebuffer&&e.destroyTexture(i);for(let e=t.children.length-1;e>=0;e--)this.unload(t.children[e])}destroy(){this.renderer=null}};let Zr=Kr;Zr.defaultMode=b.AUTO,Zr.defaultMaxIdle=3600,Zr.defaultCheckCountMax=600,Zr.extension={type:_i.RendererSystem,name:"textureGC"},wi.add(Zr);class Jr{constructor(t){this.texture=t,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=f.UNSIGNED_BYTE,this.internalFormat=d.RGBA,this.samplerType=0}}class Qr{constructor(t){this.renderer=t,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new Li,this.hasIntegerTextures=!1}contextChange(){const t=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=function(t){let e;return e="WebGL2RenderingContext"in globalThis&&t instanceof globalThis.WebGL2RenderingContext?{[f.UNSIGNED_BYTE]:{[d.RGBA]:t.RGBA8,[d.RGB]:t.RGB8,[d.RG]:t.RG8,[d.RED]:t.R8,[d.RGBA_INTEGER]:t.RGBA8UI,[d.RGB_INTEGER]:t.RGB8UI,[d.RG_INTEGER]:t.RG8UI,[d.RED_INTEGER]:t.R8UI,[d.ALPHA]:t.ALPHA,[d.LUMINANCE]:t.LUMINANCE,[d.LUMINANCE_ALPHA]:t.LUMINANCE_ALPHA},[f.BYTE]:{[d.RGBA]:t.RGBA8_SNORM,[d.RGB]:t.RGB8_SNORM,[d.RG]:t.RG8_SNORM,[d.RED]:t.R8_SNORM,[d.RGBA_INTEGER]:t.RGBA8I,[d.RGB_INTEGER]:t.RGB8I,[d.RG_INTEGER]:t.RG8I,[d.RED_INTEGER]:t.R8I},[f.UNSIGNED_SHORT]:{[d.RGBA_INTEGER]:t.RGBA16UI,[d.RGB_INTEGER]:t.RGB16UI,[d.RG_INTEGER]:t.RG16UI,[d.RED_INTEGER]:t.R16UI,[d.DEPTH_COMPONENT]:t.DEPTH_COMPONENT16},[f.SHORT]:{[d.RGBA_INTEGER]:t.RGBA16I,[d.RGB_INTEGER]:t.RGB16I,[d.RG_INTEGER]:t.RG16I,[d.RED_INTEGER]:t.R16I},[f.UNSIGNED_INT]:{[d.RGBA_INTEGER]:t.RGBA32UI,[d.RGB_INTEGER]:t.RGB32UI,[d.RG_INTEGER]:t.RG32UI,[d.RED_INTEGER]:t.R32UI,[d.DEPTH_COMPONENT]:t.DEPTH_COMPONENT24},[f.INT]:{[d.RGBA_INTEGER]:t.RGBA32I,[d.RGB_INTEGER]:t.RGB32I,[d.RG_INTEGER]:t.RG32I,[d.RED_INTEGER]:t.R32I},[f.FLOAT]:{[d.RGBA]:t.RGBA32F,[d.RGB]:t.RGB32F,[d.RG]:t.RG32F,[d.RED]:t.R32F,[d.DEPTH_COMPONENT]:t.DEPTH_COMPONENT32F},[f.HALF_FLOAT]:{[d.RGBA]:t.RGBA16F,[d.RGB]:t.RGB16F,[d.RG]:t.RG16F,[d.RED]:t.R16F},[f.UNSIGNED_SHORT_5_6_5]:{[d.RGB]:t.RGB565},[f.UNSIGNED_SHORT_4_4_4_4]:{[d.RGBA]:t.RGBA4},[f.UNSIGNED_SHORT_5_5_5_1]:{[d.RGBA]:t.RGB5_A1},[f.UNSIGNED_INT_2_10_10_10_REV]:{[d.RGBA]:t.RGB10_A2,[d.RGBA_INTEGER]:t.RGB10_A2UI},[f.UNSIGNED_INT_10F_11F_11F_REV]:{[d.RGB]:t.R11F_G11F_B10F},[f.UNSIGNED_INT_5_9_9_9_REV]:{[d.RGB]:t.RGB9_E5},[f.UNSIGNED_INT_24_8]:{[d.DEPTH_STENCIL]:t.DEPTH24_STENCIL8},[f.FLOAT_32_UNSIGNED_INT_24_8_REV]:{[d.DEPTH_STENCIL]:t.DEPTH32F_STENCIL8}}:{[f.UNSIGNED_BYTE]:{[d.RGBA]:t.RGBA,[d.RGB]:t.RGB,[d.ALPHA]:t.ALPHA,[d.LUMINANCE]:t.LUMINANCE,[d.LUMINANCE_ALPHA]:t.LUMINANCE_ALPHA},[f.UNSIGNED_SHORT_5_6_5]:{[d.RGB]:t.RGB},[f.UNSIGNED_SHORT_4_4_4_4]:{[d.RGBA]:t.RGBA},[f.UNSIGNED_SHORT_5_5_5_1]:{[d.RGBA]:t.RGBA}},e}(t);const e=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=e;for(let t=0;t<e;t++)this.boundTextures[t]=null;this.emptyTextures={};const i=new Jr(t.createTexture());t.bindTexture(t.TEXTURE_2D,i.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[t.TEXTURE_2D]=i,this.emptyTextures[t.TEXTURE_CUBE_MAP]=new Jr(t.createTexture()),t.bindTexture(t.TEXTURE_CUBE_MAP,this.emptyTextures[t.TEXTURE_CUBE_MAP].texture);for(let e=0;e<6;e++)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,null);t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.LINEAR);for(let t=0;t<this.boundTextures.length;t++)this.bind(null,t)}bind(t,e=0){const{gl:i}=this;if(t=t?.castToBaseTexture(),t?.valid&&!t.parentTextureArray){t.touched=this.renderer.textureGC.count;const n=t._glTextures[this.CONTEXT_UID]||this.initTexture(t);this.boundTextures[e]!==t&&(this.currentLocation!==e&&(this.currentLocation=e,i.activeTexture(i.TEXTURE0+e)),i.bindTexture(t.target,n.texture)),n.dirtyId!==t.dirtyId?(this.currentLocation!==e&&(this.currentLocation=e,i.activeTexture(i.TEXTURE0+e)),this.updateTexture(t)):n.dirtyStyleId!==t.dirtyStyleId&&this.updateTextureStyle(t),this.boundTextures[e]=t}else this.currentLocation!==e&&(this.currentLocation=e,i.activeTexture(i.TEXTURE0+e)),i.bindTexture(i.TEXTURE_2D,this.emptyTextures[i.TEXTURE_2D].texture),this.boundTextures[e]=null}reset(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(let t=0;t<this.boundTextures.length;t++)this.boundTextures[t]=this.unknownTexture}unbind(t){const{gl:e,boundTextures:i}=this;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(let t=0;t<i.length;t++)i[t]===this.unknownTexture&&this.bind(null,t)}for(let n=0;n<i.length;n++)i[n]===t&&(this.currentLocation!==n&&(e.activeTexture(e.TEXTURE0+n),this.currentLocation=n),e.bindTexture(t.target,this.emptyTextures[t.target].texture),i[n]=null)}ensureSamplerType(t){const{boundTextures:e,hasIntegerTextures:i,CONTEXT_UID:n}=this;if(i)for(let i=t-1;i>=0;--i){const t=e[i];if(t){t._glTextures[n].samplerType!==g.FLOAT&&this.renderer.texture.unbind(t)}}}initTexture(t){const e=new Jr(this.gl.createTexture());return e.dirtyId=-1,t._glTextures[this.CONTEXT_UID]=e,this.managedTextures.push(t),t.on("dispose",this.destroyTexture,this),e}initTextureType(t,e){e.internalFormat=this.internalFormats[t.type]?.[t.format]??t.format,2===this.webGLVersion&&t.type===f.HALF_FLOAT?e.type=this.gl.HALF_FLOAT:e.type=t.type}updateTexture(t){const e=t._glTextures[this.CONTEXT_UID];if(!e)return;const i=this.renderer;if(this.initTextureType(t,e),t.resource?.upload(i,t,e))e.samplerType!==g.FLOAT&&(this.hasIntegerTextures=!0);else{const n=t.realWidth,r=t.realHeight,s=i.gl;(e.width!==n||e.height!==r||e.dirtyId<0)&&(e.width=n,e.height=r,s.texImage2D(t.target,0,e.internalFormat,n,r,0,t.format,e.type,null))}t.dirtyStyleId!==e.dirtyStyleId&&this.updateTextureStyle(t),e.dirtyId=t.dirtyId}destroyTexture(t,e){const{gl:i}=this;if((t=t.castToBaseTexture())._glTextures[this.CONTEXT_UID]&&(this.unbind(t),i.deleteTexture(t._glTextures[this.CONTEXT_UID].texture),t.off("dispose",this.destroyTexture,this),delete t._glTextures[this.CONTEXT_UID],!e)){const e=this.managedTextures.indexOf(t);-1!==e&&ni(this.managedTextures,e,1)}}updateTextureStyle(t){const e=t._glTextures[this.CONTEXT_UID];e&&(t.mipmap!==y.POW2&&2===this.webGLVersion||t.isPowerOfTwo?e.mipmap=t.mipmap>=1:e.mipmap=!1,2===this.webGLVersion||t.isPowerOfTwo?e.wrapMode=t.wrapMode:e.wrapMode=v.CLAMP,t.resource?.style(this.renderer,t,e)||this.setStyle(t,e),e.dirtyStyleId=t.dirtyStyleId)}setStyle(t,e){const i=this.gl;if(e.mipmap&&t.mipmap!==y.ON_MANUAL&&i.generateMipmap(t.target),i.texParameteri(t.target,i.TEXTURE_WRAP_S,e.wrapMode),i.texParameteri(t.target,i.TEXTURE_WRAP_T,e.wrapMode),e.mipmap){i.texParameteri(t.target,i.TEXTURE_MIN_FILTER,t.scaleMode===m.LINEAR?i.LINEAR_MIPMAP_LINEAR:i.NEAREST_MIPMAP_NEAREST);const e=this.renderer.context.extensions.anisotropicFiltering;if(e&&t.anisotropicLevel>0&&t.scaleMode===m.LINEAR){const n=Math.min(t.anisotropicLevel,i.getParameter(e.MAX_TEXTURE_MAX_ANISOTROPY_EXT));i.texParameterf(t.target,e.TEXTURE_MAX_ANISOTROPY_EXT,n)}}else i.texParameteri(t.target,i.TEXTURE_MIN_FILTER,t.scaleMode===m.LINEAR?i.LINEAR:i.NEAREST);i.texParameteri(t.target,i.TEXTURE_MAG_FILTER,t.scaleMode===m.LINEAR?i.LINEAR:i.NEAREST)}destroy(){this.renderer=null}}Qr.extension={type:_i.RendererSystem,name:"texture"},wi.add(Qr);class ts{constructor(t){this.renderer=t}contextChange(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:e,CONTEXT_UID:i}=this,n=t._glTransformFeedbacks[i]||this.createGLTransformFeedback(t);e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,n)}unbind(){const{gl:t}=this;t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,null)}beginTransformFeedback(t,e){const{gl:i,renderer:n}=this;e&&n.shader.bind(e),i.beginTransformFeedback(t)}endTransformFeedback(){const{gl:t}=this;t.endTransformFeedback()}createGLTransformFeedback(t){const{gl:e,renderer:i,CONTEXT_UID:n}=this,r=e.createTransformFeedback();t._glTransformFeedbacks[n]=r,e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,r);for(let r=0;r<t.buffers.length;r++){const s=t.buffers[r];s&&(i.buffer.update(s),s._glBuffers[n].refCount++,e.bindBufferBase(e.TRANSFORM_FEEDBACK_BUFFER,r,s._glBuffers[n].buffer||null))}return e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null),t.disposeRunner.add(this),r}disposeTransformFeedback(t,e){const i=t._glTransformFeedbacks[this.CONTEXT_UID],n=this.gl;t.disposeRunner.remove(this);const r=this.renderer.buffer;if(r)for(let i=0;i<t.buffers.length;i++){const n=t.buffers[i];if(!n)continue;const s=n._glBuffers[this.CONTEXT_UID];s&&(s.refCount--,0!==s.refCount||e||r.dispose(n,e))}i&&(e||n.deleteTransformFeedback(i),delete t._glTransformFeedbacks[this.CONTEXT_UID])}destroy(){this.renderer=null}}ts.extension={type:_i.RendererSystem,name:"transformFeedback"},wi.add(ts);class es{constructor(t){this.renderer=t}init(t){this.screen=new Zi(0,0,t.width,t.height),this.element=t.view||C.ADAPTER.createCanvas(),this.resolution=t.resolution||C.RESOLUTION,this.autoDensity=!!t.autoDensity}resizeView(t,e){this.element.width=Math.round(t*this.resolution),this.element.height=Math.round(e*this.resolution);const i=this.element.width/this.resolution,n=this.element.height/this.resolution;this.screen.width=i,this.screen.height=n,this.autoDensity&&(this.element.style.width=`${i}px`,this.element.style.height=`${n}px`),this.renderer.emit("resize",i,n),this.renderer.runners.resize.emit(this.screen.width,this.screen.height)}destroy(t){t&&this.element.parentNode?.removeChild(this.element),this.renderer=null,this.element=null,this.screen=null}}es.defaultOptions={width:800,height:600,resolution:C.RESOLUTION,autoDensity:!1},es.extension={type:[_i.RendererSystem,_i.CanvasRendererSystem],name:"_view"},wi.add(es),C.PREFER_ENV=a.WEBGL2,C.STRICT_TEXTURE_CACHE=!1,C.RENDER_OPTIONS={...Kn.defaultOptions,...Yn.defaultOptions,...es.defaultOptions,...Vr.defaultOptions},Object.defineProperties(C,{WRAP_MODE:{get:()=>Li.defaultOptions.wrapMode,set(t){_e("7.1.0","settings.WRAP_MODE is deprecated, use BaseTexture.defaultOptions.wrapMode"),Li.defaultOptions.wrapMode=t}},SCALE_MODE:{get:()=>Li.defaultOptions.scaleMode,set(t){_e("7.1.0","settings.SCALE_MODE is deprecated, use BaseTexture.defaultOptions.scaleMode"),Li.defaultOptions.scaleMode=t}},MIPMAP_TEXTURES:{get:()=>Li.defaultOptions.mipmap,set(t){_e("7.1.0","settings.MIPMAP_TEXTURES is deprecated, use BaseTexture.defaultOptions.mipmap"),Li.defaultOptions.mipmap=t}},ANISOTROPIC_LEVEL:{get:()=>Li.defaultOptions.anisotropicLevel,set(t){_e("7.1.0","settings.ANISOTROPIC_LEVEL is deprecated, use BaseTexture.defaultOptions.anisotropicLevel"),Li.defaultOptions.anisotropicLevel=t}},FILTER_RESOLUTION:{get:()=>(_e("7.1.0","settings.FILTER_RESOLUTION is deprecated, use Filter.defaultResolution"),Vn.defaultResolution),set(t){Vn.defaultResolution=t}},FILTER_MULTISAMPLE:{get:()=>(_e("7.1.0","settings.FILTER_MULTISAMPLE is deprecated, use Filter.defaultMultisample"),Vn.defaultMultisample),set(t){Vn.defaultMultisample=t}},SPRITE_MAX_TEXTURES:{get:()=>Wn.defaultMaxTextures,set(t){_e("7.1.0","settings.SPRITE_MAX_TEXTURES is deprecated, use BatchRenderer.defaultMaxTextures"),Wn.defaultMaxTextures=t}},SPRITE_BATCH_SIZE:{get:()=>Wn.defaultBatchSize,set(t){_e("7.1.0","settings.SPRITE_BATCH_SIZE is deprecated, use BatchRenderer.defaultBatchSize"),Wn.defaultBatchSize=t}},CAN_UPLOAD_SAME_BUFFER:{get:()=>Wn.canUploadSameBuffer,set(t){_e("7.1.0","settings.CAN_UPLOAD_SAME_BUFFER is deprecated, use BatchRenderer.canUploadSameBuffer"),Wn.canUploadSameBuffer=t}},GC_MODE:{get:()=>Zr.defaultMode,set(t){_e("7.1.0","settings.GC_MODE is deprecated, use TextureGCSystem.defaultMode"),Zr.defaultMode=t}},GC_MAX_IDLE:{get:()=>Zr.defaultMaxIdle,set(t){_e("7.1.0","settings.GC_MAX_IDLE is deprecated, use TextureGCSystem.defaultMaxIdle"),Zr.defaultMaxIdle=t}},GC_MAX_CHECK_COUNT:{get:()=>Zr.defaultCheckCountMax,set(t){_e("7.1.0","settings.GC_MAX_CHECK_COUNT is deprecated, use TextureGCSystem.defaultCheckCountMax"),Zr.defaultCheckCountMax=t}},PRECISION_VERTEX:{get:()=>Bn.defaultVertexPrecision,set(t){_e("7.1.0","settings.PRECISION_VERTEX is deprecated, use Program.defaultVertexPrecision"),Bn.defaultVertexPrecision=t}},PRECISION_FRAGMENT:{get:()=>Bn.defaultFragmentPrecision,set(t){_e("7.1.0","settings.PRECISION_FRAGMENT is deprecated, use Program.defaultFragmentPrecision"),Bn.defaultFragmentPrecision=t}}});var is=(t=>(t[t.INTERACTION=50]="INTERACTION",t[t.HIGH=25]="HIGH",t[t.NORMAL=0]="NORMAL",t[t.LOW=-25]="LOW",t[t.UTILITY=-50]="UTILITY",t))(is||{});class ns{constructor(t,e=null,i=0,n=!1){this.next=null,this.previous=null,this._destroyed=!1,this.fn=t,this.context=e,this.priority=i,this.once=n}match(t,e=null){return this.fn===t&&this.context===e}emit(t){this.fn&&(this.context?this.fn.call(this.context,t):this.fn(t));const e=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),e}connect(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this}destroy(t=!1){this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const e=this.next;return this.next=t?null:e,this.previous=null,e}}const rs=class{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new ns(null,null,1/0),this.deltaMS=1/rs.targetFPMS,this.elapsedMS=1/rs.targetFPMS,this._tick=t=>{this._requestId=null,this.started&&(this.update(t),this.started&&null===this._requestId&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){null===this._requestId&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){null!==this._requestId&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(t,e,i=is.NORMAL){return this._addListener(new ns(t,e,i))}addOnce(t,e,i=is.NORMAL){return this._addListener(new ns(t,e,i,!0))}_addListener(t){let e=this._head.next,i=this._head;if(e){for(;e;){if(t.priority>e.priority){t.connect(i);break}i=e,e=e.next}t.previous||t.connect(i)}else t.connect(i);return this._startIfPossible(),this}remove(t,e){let i=this._head.next;for(;i;)i=i.match(t,e)?i.destroy():i.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let t=0,e=this._head;for(;e=e.next;)t++;return t}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let t=this._head.next;for(;t;)t=t.destroy(!0);this._head.destroy(),this._head=null}}update(t=performance.now()){let e;if(t>this.lastTime){if(e=this.elapsedMS=t-this.lastTime,e>this._maxElapsedMS&&(e=this._maxElapsedMS),e*=this.speed,this._minElapsedMS){const e=t-this._lastFrame|0;if(e<this._minElapsedMS)return;this._lastFrame=t-e%this._minElapsedMS}this.deltaMS=e,this.deltaTime=this.deltaMS*rs.targetFPMS;const i=this._head;let n=i.next;for(;n;)n=n.emit(this.deltaTime);i.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=t}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(t){const e=Math.min(this.maxFPS,t),i=Math.min(Math.max(0,e)/1e3,rs.targetFPMS);this._maxElapsedMS=1/i}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(t){if(0===t)this._minElapsedMS=0;else{const e=Math.max(this.minFPS,t);this._minElapsedMS=1/(e/1e3)}}static get shared(){if(!rs._shared){const t=rs._shared=new rs;t.autoStart=!0,t._protected=!0}return rs._shared}static get system(){if(!rs._system){const t=rs._system=new rs;t.autoStart=!0,t._protected=!0}return rs._system}};let ss=rs;ss.targetFPMS=.06,Object.defineProperties(C,{TARGET_FPMS:{get:()=>ss.targetFPMS,set(t){_e("7.1.0","settings.TARGET_FPMS is deprecated, use Ticker.targetFPMS"),ss.targetFPMS=t}}});class os{static init(t){t=Object.assign({autoStart:!0,sharedTicker:!1},t),Object.defineProperty(this,"ticker",{set(t){this._ticker&&this._ticker.remove(this.render,this),this._ticker=t,t&&t.add(this.render,this,is.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=t.sharedTicker?ss.shared:new ss,t.autoStart&&this.start()}static destroy(){if(this._ticker){const t=this._ticker;this.ticker=null,t.destroy()}}}os.extension=_i.Application,wi.add(os);const as=[];wi.handleByList(_i.Renderer,as);const hs="attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n";class ls{constructor(t){this.renderer=t}contextChange(t){let e;if(1===this.renderer.context.webGLVersion){const i=t.getParameter(t.FRAMEBUFFER_BINDING);t.bindFramebuffer(t.FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.FRAMEBUFFER,i)}else{const i=t.getParameter(t.DRAW_FRAMEBUFFER_BINDING);t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,i)}e>=E.HIGH?this.multisample=E.HIGH:e>=E.MEDIUM?this.multisample=E.MEDIUM:e>=E.LOW?this.multisample=E.LOW:this.multisample=E.NONE}destroy(){}}ls.extension={type:_i.RendererSystem,name:"_multisample"},wi.add(ls);class us{constructor(t){this.buffer=t||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}}class cs{constructor(t){this.renderer=t,this.managedBuffers={},this.boundBufferBases={}}destroy(){this.renderer=null}contextChange(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:e,CONTEXT_UID:i}=this,n=t._glBuffers[i]||this.createGLBuffer(t);e.bindBuffer(t.type,n.buffer)}unbind(t){const{gl:e}=this;e.bindBuffer(t,null)}bindBufferBase(t,e){const{gl:i,CONTEXT_UID:n}=this;if(this.boundBufferBases[e]!==t){const r=t._glBuffers[n]||this.createGLBuffer(t);this.boundBufferBases[e]=t,i.bindBufferBase(i.UNIFORM_BUFFER,e,r.buffer)}}bindBufferRange(t,e,i){const{gl:n,CONTEXT_UID:r}=this;i=i||0;const s=t._glBuffers[r]||this.createGLBuffer(t);n.bindBufferRange(n.UNIFORM_BUFFER,e||0,s.buffer,256*i,256)}update(t){const{gl:e,CONTEXT_UID:i}=this,n=t._glBuffers[i]||this.createGLBuffer(t);if(t._updateID!==n.updateID)if(n.updateID=t._updateID,e.bindBuffer(t.type,n.buffer),n.byteLength>=t.data.byteLength)e.bufferSubData(t.type,0,t.data);else{const i=t.static?e.STATIC_DRAW:e.DYNAMIC_DRAW;n.byteLength=t.data.byteLength,e.bufferData(t.type,t.data,i)}}dispose(t,e){if(!this.managedBuffers[t.id])return;delete this.managedBuffers[t.id];const i=t._glBuffers[this.CONTEXT_UID],n=this.gl;t.disposeRunner.remove(this),i&&(e||n.deleteBuffer(i.buffer),delete t._glBuffers[this.CONTEXT_UID])}disposeAll(t){const e=Object.keys(this.managedBuffers);for(let i=0;i<e.length;i++)this.dispose(this.managedBuffers[e[i]],t)}createGLBuffer(t){const{CONTEXT_UID:e,gl:i}=this;return t._glBuffers[e]=new us(i.createBuffer()),this.managedBuffers[t.id]=t,t.disposeRunner.add(this),t._glBuffers[e]}}cs.extension={type:_i.RendererSystem,name:"buffer"},wi.add(cs);class ds{constructor(t){this.renderer=t}render(t,e){const i=this.renderer;let n,r,s,o;if(e&&(n=e.renderTexture,r=e.clear,s=e.transform,o=e.skipUpdateTransform),this.renderingToScreen=!n,i.runners.prerender.emit(),i.emit("prerender"),i.projection.transform=s,!i.context.isLost){if(n||(this.lastObjectRendered=t),!o){const e=t.enableTempParent();t.updateTransform(),t.disableTempParent(e)}i.renderTexture.bind(n),i.batch.currentRenderer.start(),(r??i.background.clearBeforeRender)&&i.renderTexture.clear(),t.render(i),i.batch.currentRenderer.flush(),n&&(e.blit&&i.framebuffer.blit(),n.baseTexture.update()),i.runners.postrender.emit(),i.projection.transform=null,i.emit("postrender")}}destroy(){this.renderer=null,this.lastObjectRendered=null}}ds.extension={type:_i.RendererSystem,name:"objectRenderer"},wi.add(ds);const ps=class extends qr{constructor(t){super(),this.type=h.WEBGL,t=Object.assign({},C.RENDER_OPTIONS,t),this.gl=null,this.CONTEXT_UID=0,this.globalUniforms=new Fn({projectionMatrix:new nn},!0);const e={runners:["init","destroy","contextChange","resolutionChange","reset","update","postrender","prerender","resize"],systems:ps.__systems,priority:["_view","textureGenerator","background","_plugin","startup","context","state","texture","buffer","geometry","framebuffer","transformFeedback","mask","scissor","stencil","projection","textureGC","filter","renderTexture","batch","objectRenderer","_multisample"]};this.setup(e),"useContextAlpha"in t&&(_e("7.0.0","options.useContextAlpha is deprecated, use options.premultipliedAlpha and options.backgroundAlpha instead"),t.premultipliedAlpha=t.useContextAlpha&&"notMultiplied"!==t.useContextAlpha,t.backgroundAlpha=!1===t.useContextAlpha?1:t.backgroundAlpha),this._plugin.rendererPlugins=ps.__plugins,this.options=t,this.startup.run(this.options)}static test(t){return!t?.forceCanvas&&(void 0===xe&&(xe=function(){const t={stencil:!0,failIfMajorPerformanceCaveat:C.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!C.ADAPTER.getWebGLRenderingContext())return!1;const e=C.ADAPTER.createCanvas();let i=e.getContext("webgl",t)||e.getContext("experimental-webgl",t);const n=!!i?.getContextAttributes()?.stencil;if(i){const t=i.getExtension("WEBGL_lose_context");t&&t.loseContext()}return i=null,n}catch(t){return!1}}()),xe)}render(t,e){this.objectRenderer.render(t,e)}resize(t,e){this._view.resizeView(t,e)}reset(){return this.runners.reset.emit(),this}clear(){this.renderTexture.bind(),this.renderTexture.clear()}destroy(t=!1){this.runners.destroy.items.reverse(),this.emitWithCustomOptions(this.runners.destroy,{_view:t}),super.destroy()}get plugins(){return this._plugin.plugins}get multisample(){return this._multisample.multisample}get width(){return this._view.element.width}get height(){return this._view.element.height}get resolution(){return this._view.resolution}set resolution(t){this._view.resolution=t,this.runners.resolutionChange.emit(t)}get autoDensity(){return this._view.autoDensity}get view(){return this._view.element}get screen(){return this._view.screen}get lastObjectRendered(){return this.objectRenderer.lastObjectRendered}get renderingToScreen(){return this.objectRenderer.renderingToScreen}get rendererLogId(){return`WebGL ${this.context.webGLVersion}`}get clearBeforeRender(){return _e("7.0.0","renderer.clearBeforeRender has been deprecated, please use renderer.background.clearBeforeRender instead."),this.background.clearBeforeRender}get useContextAlpha(){return _e("7.0.0","renderer.useContextAlpha has been deprecated, please use renderer.context.premultipliedAlpha instead."),this.context.useContextAlpha}get preserveDrawingBuffer(){return _e("7.0.0","renderer.preserveDrawingBuffer has been deprecated, we cannot truly know this unless pixi created the context"),this.context.preserveDrawingBuffer}get backgroundColor(){return _e("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color}set backgroundColor(t){_e("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color=t}get backgroundAlpha(){return _e("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha}set backgroundAlpha(t){_e("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha=t}get powerPreference(){return _e("7.0.0","renderer.powerPreference has been deprecated, we can only know this if pixi creates the context"),this.context.powerPreference}generateTexture(t,e){return this.textureGenerator.generateTexture(t,e)}};let fs=ps;fs.extension={type:_i.Renderer,priority:1},fs.__plugins={},fs.__systems={},wi.handleByMap(_i.RendererPlugin,fs.__plugins),wi.handleByMap(_i.RendererSystem,fs.__systems),wi.add(fs);class gs extends Ri{constructor(t,e){const{width:i,height:n}=e||{};super(i,n),this.items=[],this.itemDirtyIds=[];for(let e=0;e<t;e++){const t=new Li;this.items.push(t),this.itemDirtyIds.push(-2)}this.length=t,this._load=null,this.baseTexture=null}initFromArray(t,e){for(let i=0;i<this.length;i++)t[i]&&(t[i].castToBaseTexture?this.addBaseTextureAt(t[i].castToBaseTexture(),i):t[i]instanceof Ri?this.addResourceAt(t[i],i):this.addResourceAt(Ii(t[i],e),i))}dispose(){for(let t=0,e=this.length;t<e;t++)this.items[t].destroy();this.items=null,this.itemDirtyIds=null,this._load=null}addResourceAt(t,e){if(!this.items[e])throw new Error(`Index ${e} is out of bounds`);return t.valid&&!this.valid&&this.resize(t.width,t.height),this.items[e].setResource(t),this}bind(t){if(null!==this.baseTexture)throw new Error("Only one base texture per TextureArray is allowed");super.bind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=t,this.items[e].on("update",t.update,t)}unbind(t){super.unbind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=null,this.items[e].off("update",t.update,t)}load(){if(this._load)return this._load;const t=this.items.map((t=>t.resource)).filter((t=>t)).map((t=>t.load()));return this._load=Promise.all(t).then((()=>{const{realWidth:t,realHeight:e}=this.items[0];return this.resize(t,e),Promise.resolve(this)})),this._load}}const ms=class extends gs{constructor(t,e){const{width:i,height:n,autoLoad:r,linkBaseTexture:s}=e||{};if(t&&t.length!==ms.SIDES)throw new Error(`Invalid length. Got ${t.length}, expected 6`);super(6,{width:i,height:n});for(let t=0;t<ms.SIDES;t++)this.items[t].target=p.TEXTURE_CUBE_MAP_POSITIVE_X+t;this.linkBaseTexture=!1!==s,t&&this.initFromArray(t,e),!1!==r&&this.load()}bind(t){super.bind(t),t.target=p.TEXTURE_CUBE_MAP}addBaseTextureAt(t,e,i){if(void 0===i&&(i=this.linkBaseTexture),!this.items[e])throw new Error(`Index ${e} is out of bounds`);if(!this.linkBaseTexture||t.parentTextureArray||Object.keys(t._glTextures).length>0){if(!t.resource)throw new Error("CubeResource does not support copying of renderTexture.");this.addResourceAt(t.resource,e)}else t.target=p.TEXTURE_CUBE_MAP_POSITIVE_X+e,t.parentTextureArray=this.baseTexture,this.items[e]=t;return t.valid&&!this.valid&&this.resize(t.realWidth,t.realHeight),this.items[e]=t,this}upload(t,e,i){const n=this.itemDirtyIds;for(let r=0;r<ms.SIDES;r++){const s=this.items[r];(n[r]<s.dirtyId||i.dirtyId<e.dirtyId)&&(s.valid&&s.resource?(s.resource.upload(t,s,i),n[r]=s.dirtyId):n[r]<-1&&(t.gl.texImage2D(s.target,0,i.internalFormat,e.realWidth,e.realHeight,0,e.format,i.type,null),n[r]=-1))}return!0}static test(t){return Array.isArray(t)&&t.length===ms.SIDES}};let vs=ms;vs.SIDES=6;class ys extends tr{constructor(t,e){let i,n;e=e||{},"string"==typeof t?(i=ys.EMPTY,n=t):(i=t,n=null),super(i),this.url=n,this.crossOrigin=e.crossOrigin??!0,this.alphaMode="number"==typeof e.alphaMode?e.alphaMode:null,this._load=null,!1!==e.autoLoad&&this.load()}load(){return this._load||(this._load=new Promise((async(t,e)=>{if(null!==this.url)try{const e=await C.ADAPTER.fetch(this.url,{mode:this.crossOrigin?"cors":"no-cors"});if(this.destroyed)return;const i=await e.blob();if(this.destroyed)return;const n=await createImageBitmap(i,{premultiplyAlpha:null===this.alphaMode||this.alphaMode===_.UNPACK?"premultiply":"none"});if(this.destroyed)return;this.source=n,this.update(),t(this)}catch(t){if(this.destroyed)return;e(t),this.onError.emit(t)}else t(this)}))),this._load}upload(t,e,i){return this.source instanceof ImageBitmap?("number"==typeof this.alphaMode&&(e.alphaMode=this.alphaMode),super.upload(t,e,i)):(this.load(),!1)}dispose(){this.source instanceof ImageBitmap&&this.source.close(),super.dispose(),this._load=null}static test(t){return!!globalThis.createImageBitmap&&"undefined"!=typeof ImageBitmap&&("string"==typeof t||t instanceof ImageBitmap)}static get EMPTY(){return ys._EMPTY=ys._EMPTY??C.ADAPTER.createCanvas(0,0),ys._EMPTY}}const _s=class extends tr{constructor(t,e){e=e||{},super(C.ADAPTER.createCanvas()),this._width=0,this._height=0,this.svg=t,this.scale=e.scale||1,this._overrideWidth=e.width,this._overrideHeight=e.height,this._resolve=null,this._crossorigin=e.crossorigin,this._load=null,!1!==e.autoLoad&&this.load()}load(){return this._load||(this._load=new Promise((t=>{if(this._resolve=()=>{this.resize(this.source.width,this.source.height),t(this)},_s.SVG_XML.test(this.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");this.svg=`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(this.svg)))}`}this._loadSvg()}))),this._load}_loadSvg(){const t=new Image;tr.crossOrigin(t,this.svg,this._crossorigin),t.src=this.svg,t.onerror=e=>{this._resolve&&(t.onerror=null,this.onError.emit(e))},t.onload=()=>{if(!this._resolve)return;const e=t.width,i=t.height;if(!e||!i)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");let n=e*this.scale,r=i*this.scale;(this._overrideWidth||this._overrideHeight)&&(n=this._overrideWidth||this._overrideHeight/i*e,r=this._overrideHeight||this._overrideWidth/e*i),n=Math.round(n),r=Math.round(r);const s=this.source;s.width=n,s.height=r,s._pixiId=`canvas_${oi()}`,s.getContext("2d").drawImage(t,0,0,e,i,0,0,n,r),this._resolve(),this._resolve=null}}static getSize(t){const e=_s.SVG_SIZE.exec(t),i={};return e&&(i[e[1]]=Math.round(parseFloat(e[3])),i[e[5]]=Math.round(parseFloat(e[7]))),i}dispose(){super.dispose(),this._resolve=null,this._crossorigin=null}static test(t,e){return"svg"===e||"string"==typeof t&&t.startsWith("data:image/svg+xml")||"string"==typeof t&&_s.SVG_XML.test(t)}};let xs=_s;xs.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m,xs.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;const bs=class extends tr{constructor(t,e){if(e=e||{},!(t instanceof HTMLVideoElement)){const i=document.createElement("video");i.setAttribute("preload","auto"),i.setAttribute("webkit-playsinline",""),i.setAttribute("playsinline",""),"string"==typeof t&&(t=[t]);const n=t[0].src||t[0];tr.crossOrigin(i,n,e.crossorigin);for(let e=0;e<t.length;++e){const n=document.createElement("source");let{src:r,mime:s}=t[e];r=r||t[e];const o=r.split("?").shift().toLowerCase(),a=o.slice(o.lastIndexOf(".")+1);s=s||bs.MIME_TYPES[a]||`video/${a}`,n.src=r,n.type=s,i.appendChild(n)}t=i}super(t),this.noSubImage=!0,this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=e.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=!1!==e.autoPlay,this._load=null,this._resolve=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),!1!==e.autoLoad&&this.load()}update(t=0){if(!this.destroyed){const t=ss.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-t),(!this._updateFPS||this._msToNextUpdate<=0)&&(super.update(),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}}load(){if(this._load)return this._load;const t=this.source;return(t.readyState===t.HAVE_ENOUGH_DATA||t.readyState===t.HAVE_FUTURE_DATA)&&t.width&&t.height&&(t.complete=!0),t.addEventListener("play",this._onPlayStart.bind(this)),t.addEventListener("pause",this._onPlayStop.bind(this)),this._isSourceReady()?this._onCanPlay():(t.addEventListener("canplay",this._onCanPlay),t.addEventListener("canplaythrough",this._onCanPlay),t.addEventListener("error",this._onError,!0)),this._load=new Promise((e=>{this.valid?e(this):(this._resolve=e,t.load())})),this._load}_onError(t){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(t)}_isSourcePlaying(){const t=this.source;return!t.paused&&!t.ended&&this._isSourceReady()}_isSourceReady(){return this.source.readyState>2}_onPlayStart(){this.valid||this._onCanPlay(),this.autoUpdate&&!this._isConnectedToTicker&&(ss.shared.add(this.update,this),this._isConnectedToTicker=!0)}_onPlayStop(){this._isConnectedToTicker&&(ss.shared.remove(this.update,this),this._isConnectedToTicker=!1)}_onCanPlay(){const t=this.source;t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlay);const e=this.valid;this.resize(t.videoWidth,t.videoHeight),!e&&this._resolve&&(this._resolve(this),this._resolve=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&t.play()}dispose(){this._isConnectedToTicker&&(ss.shared.remove(this.update,this),this._isConnectedToTicker=!1);const t=this.source;t&&(t.removeEventListener("error",this._onError,!0),t.pause(),t.src="",t.load()),super.dispose()}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,!this._autoUpdate&&this._isConnectedToTicker?(ss.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._isSourcePlaying()&&(ss.shared.add(this.update,this),this._isConnectedToTicker=!0))}get updateFPS(){return this._updateFPS}set updateFPS(t){t!==this._updateFPS&&(this._updateFPS=t)}static test(t,e){return globalThis.HTMLVideoElement&&t instanceof HTMLVideoElement||bs.TYPES.includes(e)}};let ws=bs;ws.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"],ws.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"},Ci.push(ys,er,class extends tr{constructor(t){super(t)}static test(t){const{OffscreenCanvas:e}=globalThis;return!!(e&&t instanceof e)||globalThis.HTMLCanvasElement&&t instanceof HTMLCanvasElement}},ws,xs,Pi,vs,class extends gs{constructor(t,e){const{width:i,height:n}=e||{};let r,s;Array.isArray(t)?(r=t,s=t.length):s=t,super(s,{width:i,height:n}),r&&this.initFromArray(r,e)}addBaseTextureAt(t,e){if(!t.resource)throw new Error("ArrayResource does not support RenderTexture");return this.addResourceAt(t.resource,e),this}bind(t){super.bind(t),t.target=p.TEXTURE_2D_ARRAY}upload(t,e,i){const{length:n,itemDirtyIds:r,items:s}=this,{gl:o}=t;i.dirtyId<0&&o.texImage3D(o.TEXTURE_2D_ARRAY,0,i.internalFormat,this._width,this._height,n,0,e.format,i.type,null);for(let t=0;t<n;t++){const n=s[t];r[t]<n.dirtyId&&(r[t]=n.dirtyId,n.valid&&o.texSubImage3D(o.TEXTURE_2D_ARRAY,0,0,0,t,n.resource.width,n.resource.height,1,e.format,i.type,n.resource.source))}return!0}});class Ts{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}clear(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}getRectangle(t){return this.minX>this.maxX||this.minY>this.maxY?Zi.EMPTY:((t=t||new Zi(0,0,1,1)).x=this.minX,t.y=this.minY,t.width=this.maxX-this.minX,t.height=this.maxY-this.minY,t)}addPoint(t){this.minX=Math.min(this.minX,t.x),this.maxX=Math.max(this.maxX,t.x),this.minY=Math.min(this.minY,t.y),this.maxY=Math.max(this.maxY,t.y)}addPointMatrix(t,e){const{a:i,b:n,c:r,d:s,tx:o,ty:a}=t,h=i*e.x+r*e.y+o,l=n*e.x+s*e.y+a;this.minX=Math.min(this.minX,h),this.maxX=Math.max(this.maxX,h),this.minY=Math.min(this.minY,l),this.maxY=Math.max(this.maxY,l)}addQuad(t){let e=this.minX,i=this.minY,n=this.maxX,r=this.maxY,s=t[0],o=t[1];e=s<e?s:e,i=o<i?o:i,n=s>n?s:n,r=o>r?o:r,s=t[2],o=t[3],e=s<e?s:e,i=o<i?o:i,n=s>n?s:n,r=o>r?o:r,s=t[4],o=t[5],e=s<e?s:e,i=o<i?o:i,n=s>n?s:n,r=o>r?o:r,s=t[6],o=t[7],e=s<e?s:e,i=o<i?o:i,n=s>n?s:n,r=o>r?o:r,this.minX=e,this.minY=i,this.maxX=n,this.maxY=r}addFrame(t,e,i,n,r){this.addFrameMatrix(t.worldTransform,e,i,n,r)}addFrameMatrix(t,e,i,n,r){const s=t.a,o=t.b,a=t.c,h=t.d,l=t.tx,u=t.ty;let c=this.minX,d=this.minY,p=this.maxX,f=this.maxY,g=s*e+a*i+l,m=o*e+h*i+u;c=g<c?g:c,d=m<d?m:d,p=g>p?g:p,f=m>f?m:f,g=s*n+a*i+l,m=o*n+h*i+u,c=g<c?g:c,d=m<d?m:d,p=g>p?g:p,f=m>f?m:f,g=s*e+a*r+l,m=o*e+h*r+u,c=g<c?g:c,d=m<d?m:d,p=g>p?g:p,f=m>f?m:f,g=s*n+a*r+l,m=o*n+h*r+u,c=g<c?g:c,d=m<d?m:d,p=g>p?g:p,f=m>f?m:f,this.minX=c,this.minY=d,this.maxX=p,this.maxY=f}addVertexData(t,e,i){let n=this.minX,r=this.minY,s=this.maxX,o=this.maxY;for(let a=e;a<i;a+=2){const e=t[a],i=t[a+1];n=e<n?e:n,r=i<r?i:r,s=e>s?e:s,o=i>o?i:o}this.minX=n,this.minY=r,this.maxX=s,this.maxY=o}addVertices(t,e,i,n){this.addVerticesMatrix(t.worldTransform,e,i,n)}addVerticesMatrix(t,e,i,n,r=0,s=r){const o=t.a,a=t.b,h=t.c,l=t.d,u=t.tx,c=t.ty;let d=this.minX,p=this.minY,f=this.maxX,g=this.maxY;for(let t=i;t<n;t+=2){const i=e[t],n=e[t+1],m=o*i+h*n+u,v=l*n+a*i+c;d=Math.min(d,m-r),f=Math.max(f,m+r),p=Math.min(p,v-s),g=Math.max(g,v+s)}this.minX=d,this.minY=p,this.maxX=f,this.maxY=g}addBounds(t){const e=this.minX,i=this.minY,n=this.maxX,r=this.maxY;this.minX=t.minX<e?t.minX:e,this.minY=t.minY<i?t.minY:i,this.maxX=t.maxX>n?t.maxX:n,this.maxY=t.maxY>r?t.maxY:r}addBoundsMask(t,e){const i=t.minX>e.minX?t.minX:e.minX,n=t.minY>e.minY?t.minY:e.minY,r=t.maxX<e.maxX?t.maxX:e.maxX,s=t.maxY<e.maxY?t.maxY:e.maxY;if(i<=r&&n<=s){const t=this.minX,e=this.minY,o=this.maxX,a=this.maxY;this.minX=i<t?i:t,this.minY=n<e?n:e,this.maxX=r>o?r:o,this.maxY=s>a?s:a}}addBoundsMatrix(t,e){this.addFrameMatrix(e,t.minX,t.minY,t.maxX,t.maxY)}addBoundsArea(t,e){const i=t.minX>e.x?t.minX:e.x,n=t.minY>e.y?t.minY:e.y,r=t.maxX<e.x+e.width?t.maxX:e.x+e.width,s=t.maxY<e.y+e.height?t.maxY:e.y+e.height;if(i<=r&&n<=s){const t=this.minX,e=this.minY,o=this.maxX,a=this.maxY;this.minX=i<t?i:t,this.minY=n<e?n:e,this.maxX=r>o?r:o,this.maxY=s>a?s:a}}pad(t=0,e=t){this.isEmpty()||(this.minX-=t,this.maxX+=t,this.minY-=e,this.maxY+=e)}addFramePad(t,e,i,n,r,s){t-=r,e-=s,i+=r,n+=s,this.minX=this.minX<t?this.minX:t,this.maxX=this.maxX>i?this.maxX:i,this.minY=this.minY<e?this.minY:e,this.maxY=this.maxY>n?this.maxY:n}}class Es extends Y{constructor(){super(),this.tempDisplayObjectParent=null,this.transform=new fn,this.alpha=1,this.visible=!0,this.renderable=!0,this.cullable=!1,this.cullArea=null,this.parent=null,this.worldAlpha=1,this._lastSortedIndex=0,this._zIndex=0,this.filterArea=null,this.filters=null,this._enabledFilters=null,this._bounds=new Ts,this._localBounds=null,this._boundsID=0,this._boundsRect=null,this._localBoundsRect=null,this._mask=null,this._maskRefCount=0,this._destroyed=!1,this.isSprite=!1,this.isMask=!1}static mixin(t){const e=Object.keys(t);for(let i=0;i<e.length;++i){const n=e[i];Object.defineProperty(Es.prototype,n,Object.getOwnPropertyDescriptor(t,n))}}get destroyed(){return this._destroyed}_recursivePostUpdateTransform(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)}updateTransform(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha}getBounds(t,e){return t||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),e||(this._boundsRect||(this._boundsRect=new Zi),e=this._boundsRect),this._bounds.getRectangle(e)}getLocalBounds(t){t||(this._localBoundsRect||(this._localBoundsRect=new Zi),t=this._localBoundsRect),this._localBounds||(this._localBounds=new Ts);const e=this.transform,i=this.parent;this.parent=null,this.transform=this._tempDisplayObjectParent.transform;const n=this._bounds,r=this._boundsID;this._bounds=this._localBounds;const s=this.getBounds(!1,t);return this.parent=i,this.transform=e,this._bounds=n,this._bounds.updateID+=this._boundsID-r,s}toGlobal(t,e,i=!1){return i||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(t,e)}toLocal(t,e,i,n){return e&&(t=e.toGlobal(t,i,n)),n||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(t,i)}setParent(t){if(!t||!t.addChild)throw new Error("setParent: Argument must be a Container");return t.addChild(this),t}removeFromParent(){this.parent?.removeChild(this)}setTransform(t=0,e=0,i=1,n=1,r=0,s=0,o=0,a=0,h=0){return this.position.x=t,this.position.y=e,this.scale.x=i||1,this.scale.y=n||1,this.rotation=r,this.skew.x=s,this.skew.y=o,this.pivot.x=a,this.pivot.y=h,this}destroy(t){this.removeFromParent(),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.eventMode="auto",this.interactiveChildren=!1,this.emit("destroyed"),this.removeAllListeners()}get _tempDisplayObjectParent(){return null===this.tempDisplayObjectParent&&(this.tempDisplayObjectParent=new As),this.tempDisplayObjectParent}enableTempParent(){const t=this.parent;return this.parent=this._tempDisplayObjectParent,t}disableTempParent(t){this.parent=t}get x(){return this.position.x}set x(t){this.transform.position.x=t}get y(){return this.position.y}set y(t){this.transform.position.y=t}get worldTransform(){return this.transform.worldTransform}get localTransform(){return this.transform.localTransform}get position(){return this.transform.position}set position(t){this.transform.position.copyFrom(t)}get scale(){return this.transform.scale}set scale(t){this.transform.scale.copyFrom(t)}get pivot(){return this.transform.pivot}set pivot(t){this.transform.pivot.copyFrom(t)}get skew(){return this.transform.skew}set skew(t){this.transform.skew.copyFrom(t)}get rotation(){return this.transform.rotation}set rotation(t){this.transform.rotation=t}get angle(){return this.transform.rotation*Vi}set angle(t){this.transform.rotation=t*Yi}get zIndex(){return this._zIndex}set zIndex(t){this._zIndex=t,this.parent&&(this.parent.sortDirty=!0)}get worldVisible(){let t=this;do{if(!t.visible)return!1;t=t.parent}while(t);return!0}get mask(){return this._mask}set mask(t){if(this._mask!==t){if(this._mask){const t=this._mask.isMaskData?this._mask.maskObject:this._mask;t&&(t._maskRefCount--,0===t._maskRefCount&&(t.renderable=!0,t.isMask=!1))}if(this._mask=t,this._mask){const t=this._mask.isMaskData?this._mask.maskObject:this._mask;t&&(0===t._maskRefCount&&(t.renderable=!1,t.isMask=!0),t._maskRefCount++)}}}}class As extends Es{constructor(){super(...arguments),this.sortDirty=null}}Es.prototype.displayObjectUpdateTransform=Es.prototype.updateTransform;const Ss=new nn;function Cs(t,e){return t.zIndex===e.zIndex?t._lastSortedIndex-e._lastSortedIndex:t.zIndex-e.zIndex}const Is=class extends Es{constructor(){super(),this.children=[],this.sortableChildren=Is.defaultSortableChildren,this.sortDirty=!1}onChildrenChange(t){}addChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.addChild(t[e]);else{const e=t[0];e.parent&&e.parent.removeChild(e),e.parent=this,this.sortDirty=!0,e.transform._parentID=-1,this.children.push(e),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",e,this,this.children.length-1),e.emit("added",this)}return t[0]}addChildAt(t,e){if(e<0||e>this.children.length)throw new Error(`${t}addChildAt: The index ${e} supplied is out of bounds ${this.children.length}`);return t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.splice(e,0,t),this._boundsID++,this.onChildrenChange(e),t.emit("added",this),this.emit("childAdded",t,this,e),t}swapChildren(t,e){if(t===e)return;const i=this.getChildIndex(t),n=this.getChildIndex(e);this.children[i]=e,this.children[n]=t,this.onChildrenChange(i<n?i:n)}getChildIndex(t){const e=this.children.indexOf(t);if(-1===e)throw new Error("The supplied DisplayObject must be a child of the caller");return e}setChildIndex(t,e){if(e<0||e>=this.children.length)throw new Error(`The index ${e} supplied is out of bounds ${this.children.length}`);const i=this.getChildIndex(t);ni(this.children,i,1),this.children.splice(e,0,t),this.onChildrenChange(e)}getChildAt(t){if(t<0||t>=this.children.length)throw new Error(`getChildAt: Index (${t}) does not exist.`);return this.children[t]}removeChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.removeChild(t[e]);else{const e=t[0],i=this.children.indexOf(e);if(-1===i)return null;e.parent=null,e.transform._parentID=-1,ni(this.children,i,1),this._boundsID++,this.onChildrenChange(i),e.emit("removed",this),this.emit("childRemoved",e,this,i)}return t[0]}removeChildAt(t){const e=this.getChildAt(t);return e.parent=null,e.transform._parentID=-1,ni(this.children,t,1),this._boundsID++,this.onChildrenChange(t),e.emit("removed",this),this.emit("childRemoved",e,this,t),e}removeChildren(t=0,e=this.children.length){const i=t,n=e-i;let r;if(n>0&&n<=e){r=this.children.splice(i,n);for(let t=0;t<r.length;++t)r[t].parent=null,r[t].transform&&(r[t].transform._parentID=-1);this._boundsID++,this.onChildrenChange(t);for(let t=0;t<r.length;++t)r[t].emit("removed",this),this.emit("childRemoved",r[t],this,t);return r}if(0===n&&0===this.children.length)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")}sortChildren(){let t=!1;for(let e=0,i=this.children.length;e<i;++e){const i=this.children[e];i._lastSortedIndex=e,t||0===i.zIndex||(t=!0)}t&&this.children.length>1&&this.children.sort(Cs),this.sortDirty=!1}updateTransform(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(let t=0,e=this.children.length;t<e;++t){const e=this.children[t];e.visible&&e.updateTransform()}}calculateBounds(){this._bounds.clear(),this._calculateBounds();for(let t=0;t<this.children.length;t++){const e=this.children[t];if(e.visible&&e.renderable)if(e.calculateBounds(),e._mask){const t=e._mask.isMaskData?e._mask.maskObject:e._mask;t?(t.calculateBounds(),this._bounds.addBoundsMask(e._bounds,t._bounds)):this._bounds.addBounds(e._bounds)}else e.filterArea?this._bounds.addBoundsArea(e._bounds,e.filterArea):this._bounds.addBounds(e._bounds)}this._bounds.updateID=this._boundsID}getLocalBounds(t,e=!1){const i=super.getLocalBounds(t);if(!e)for(let t=0,e=this.children.length;t<e;++t){const e=this.children[t];e.visible&&e.updateTransform()}return i}_calculateBounds(){}_renderWithCulling(t){const e=t.renderTexture.sourceFrame;if(!(e.width>0&&e.height>0))return;let i,n;this.cullArea?(i=this.cullArea,n=this.worldTransform):this._render!==Is.prototype._render&&(i=this.getBounds(!0));const r=t.projection.transform;if(r&&(n?(n=Ss.copyFrom(n),n.prepend(r)):n=r),i&&e.intersects(i,n))this._render(t);else if(this.cullArea)return;for(let e=0,i=this.children.length;e<i;++e){const i=this.children[e],n=i.cullable;i.cullable=n||!this.cullArea,i.render(t),i.cullable=n}}render(t){if(this.visible&&!(this.worldAlpha<=0)&&this.renderable)if(this._mask||this.filters?.length)this.renderAdvanced(t);else if(this.cullable)this._renderWithCulling(t);else{this._render(t);for(let e=0,i=this.children.length;e<i;++e)this.children[e].render(t)}}renderAdvanced(t){const e=this.filters,i=this._mask;if(e){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(let t=0;t<e.length;t++)e[t].enabled&&this._enabledFilters.push(e[t])}const n=e&&this._enabledFilters?.length||i&&(!i.isMaskData||i.enabled&&(i.autoDetect||i.type!==T.NONE));if(n&&t.batch.flush(),e&&this._enabledFilters?.length&&t.filter.push(this,this._enabledFilters),i&&t.mask.push(this,this._mask),this.cullable)this._renderWithCulling(t);else{this._render(t);for(let e=0,i=this.children.length;e<i;++e)this.children[e].render(t)}n&&t.batch.flush(),i&&t.mask.pop(this),e&&this._enabledFilters?.length&&t.filter.pop()}_render(t){}destroy(t){super.destroy(),this.sortDirty=!1;const e="boolean"==typeof t?t:t?.children,i=this.removeChildren(0,this.children.length);if(e)for(let e=0;e<i.length;++e)i[e].destroy(t)}get width(){return this.scale.x*this.getLocalBounds().width}set width(t){const e=this.getLocalBounds().width;this.scale.x=0!==e?t/e:1,this._width=t}get height(){return this.scale.y*this.getLocalBounds().height}set height(t){const e=this.getLocalBounds().height;this.scale.y=0!==e?t/e:1,this._height=t}};let Ms=Is;Ms.defaultSortableChildren=!1,Ms.prototype.containerUpdateTransform=Ms.prototype.updateTransform,Object.defineProperties(C,{SORTABLE_CHILDREN:{get:()=>Ms.defaultSortableChildren,set(t){_e("7.1.0","settings.SORTABLE_CHILDREN is deprecated, use Container.defaultSortableChildren"),Ms.defaultSortableChildren=t}}});const Rs=new qi,Ps=new Uint16Array([0,1,2,0,2,3]);class Ds extends Ms{constructor(t){super(),this._anchor=new dn(this._onAnchorUpdate,this,t?t.defaultAnchor.x:0,t?t.defaultAnchor.y:0),this._texture=null,this._width=0,this._height=0,this._tintColor=new qe(16777215),this._tintRGB=null,this.tint=16777215,this.blendMode=u.NORMAL,this._cachedTint=16777215,this.uvs=null,this.texture=t||sr.EMPTY,this.vertexData=new Float32Array(8),this.vertexTrimmedData=null,this._transformID=-1,this._textureID=-1,this._transformTrimmedID=-1,this._textureTrimmedID=-1,this.indices=Ps,this.pluginName="batch",this.isSprite=!0,this._roundPixels=C.ROUND_PIXELS}_onTextureUpdate(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=ri(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=ri(this.scale.y)*this._height/this._texture.orig.height)}_onAnchorUpdate(){this._transformID=-1,this._transformTrimmedID=-1}calculateVertices(){const t=this._texture;if(this._transformID===this.transform._worldID&&this._textureID===t._updateID)return;this._textureID!==t._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=t._updateID;const e=this.transform.worldTransform,i=e.a,n=e.b,r=e.c,s=e.d,o=e.tx,a=e.ty,h=this.vertexData,l=t.trim,u=t.orig,c=this._anchor;let d=0,p=0,f=0,g=0;if(l?(p=l.x-c._x*u.width,d=p+l.width,g=l.y-c._y*u.height,f=g+l.height):(p=-c._x*u.width,d=p+u.width,g=-c._y*u.height,f=g+u.height),h[0]=i*p+r*g+o,h[1]=s*g+n*p+a,h[2]=i*d+r*g+o,h[3]=s*g+n*d+a,h[4]=i*d+r*f+o,h[5]=s*f+n*d+a,h[6]=i*p+r*f+o,h[7]=s*f+n*p+a,this._roundPixels){const t=C.RESOLUTION;for(let e=0;e<h.length;++e)h[e]=Math.round(h[e]*t)/t}}calculateTrimmedVertices(){if(this.vertexTrimmedData){if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return}else this.vertexTrimmedData=new Float32Array(8);this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;const t=this._texture,e=this.vertexTrimmedData,i=t.orig,n=this._anchor,r=this.transform.worldTransform,s=r.a,o=r.b,a=r.c,h=r.d,l=r.tx,u=r.ty,c=-n._x*i.width,d=c+i.width,p=-n._y*i.height,f=p+i.height;e[0]=s*c+a*p+l,e[1]=h*p+o*c+u,e[2]=s*d+a*p+l,e[3]=h*p+o*d+u,e[4]=s*d+a*f+l,e[5]=h*f+o*d+u,e[6]=s*c+a*f+l,e[7]=h*f+o*c+u}_render(t){this.calculateVertices(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this)}_calculateBounds(){const t=this._texture.trim,e=this._texture.orig;!t||t.width===e.width&&t.height===e.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))}getLocalBounds(t){return 0===this.children.length?(this._localBounds||(this._localBounds=new Ts),this._localBounds.minX=this._texture.orig.width*-this._anchor._x,this._localBounds.minY=this._texture.orig.height*-this._anchor._y,this._localBounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._localBounds.maxY=this._texture.orig.height*(1-this._anchor._y),t||(this._localBoundsRect||(this._localBoundsRect=new Zi),t=this._localBoundsRect),this._localBounds.getRectangle(t)):super.getLocalBounds.call(this,t)}containsPoint(t){this.worldTransform.applyInverse(t,Rs);const e=this._texture.orig.width,i=this._texture.orig.height,n=-e*this.anchor.x;let r=0;return Rs.x>=n&&Rs.x<n+e&&(r=-i*this.anchor.y,Rs.y>=r&&Rs.y<r+i)}destroy(t){super.destroy(t),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null;if("boolean"==typeof t?t:t?.texture){const e="boolean"==typeof t?t:t?.baseTexture;this._texture.destroy(!!e)}this._texture=null}static from(t,e){const i=t instanceof sr?t:sr.from(t,e);return new Ds(i)}set roundPixels(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t}get roundPixels(){return this._roundPixels}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(t){const e=ri(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(t){const e=ri(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t}get anchor(){return this._anchor}set anchor(t){this._anchor.copyFrom(t)}get tint(){return this._tintColor.value}set tint(t){this._tintColor.setValue(t),this._tintRGB=this._tintColor.toLittleEndianNumber()}get tintValue(){return this._tintColor.toNumber()}get texture(){return this._texture}set texture(t){this._texture!==t&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=t||sr.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,t&&(t.baseTexture.valid?this._onTextureUpdate():t.once("update",this._onTextureUpdate,this)))}}const Os=new nn;Es.prototype._cacheAsBitmap=!1,Es.prototype._cacheData=null,Es.prototype._cacheAsBitmapResolution=null,Es.prototype._cacheAsBitmapMultisample=null;class Ls{constructor(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null}}Object.defineProperties(Es.prototype,{cacheAsBitmapResolution:{get(){return this._cacheAsBitmapResolution},set(t){t!==this._cacheAsBitmapResolution&&(this._cacheAsBitmapResolution=t,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmapMultisample:{get(){return this._cacheAsBitmapMultisample},set(t){t!==this._cacheAsBitmapMultisample&&(this._cacheAsBitmapMultisample=t,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmap:{get(){return this._cacheAsBitmap},set(t){if(this._cacheAsBitmap===t)return;let e;this._cacheAsBitmap=t,t?(this._cacheData||(this._cacheData=new Ls),e=this._cacheData,e.originalRender=this.render,e.originalRenderCanvas=this.renderCanvas,e.originalUpdateTransform=this.updateTransform,e.originalCalculateBounds=this.calculateBounds,e.originalGetLocalBounds=this.getLocalBounds,e.originalDestroy=this.destroy,e.originalContainsPoint=this.containsPoint,e.originalMask=this._mask,e.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):(e=this._cacheData,e.sprite&&this._destroyCachedDisplayObject(),this.render=e.originalRender,this.renderCanvas=e.originalRenderCanvas,this.calculateBounds=e.originalCalculateBounds,this.getLocalBounds=e.originalGetLocalBounds,this.destroy=e.originalDestroy,this.updateTransform=e.originalUpdateTransform,this.containsPoint=e.originalContainsPoint,this._mask=e.originalMask,this.filterArea=e.originalFilterArea)}}}),Es.prototype._renderCached=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(t),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(t))},Es.prototype._initCachedDisplayObject=function(t){if(this._cacheData?.sprite)return;const e=this.alpha;this.alpha=1,t.batch.flush();const i=this.getLocalBounds(null,!0).clone();if(this.filters?.length){const t=this.filters[0].padding;i.pad(t)}i.ceil(C.RESOLUTION);const n=t.renderTexture.current,r=t.renderTexture.sourceFrame.clone(),s=t.renderTexture.destinationFrame.clone(),o=t.projection.transform,a=or.create({width:i.width,height:i.height,resolution:this.cacheAsBitmapResolution||t.resolution,multisample:this.cacheAsBitmapMultisample??t.multisample}),h=`cacheAsBitmap_${oi()}`;this._cacheData.textureCacheId=h,Li.addToCache(a.baseTexture,h),sr.addToCache(a,h);const l=this.transform.localTransform.copyTo(Os).invert().translate(-i.x,-i.y);this.render=this._cacheData.originalRender,t.render(this,{renderTexture:a,clear:!0,transform:l,skipUpdateTransform:!1}),t.framebuffer.blit(),t.projection.transform=o,t.renderTexture.bind(n,r,s),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=e;const u=new Ds(a);u.transform.worldTransform=this.transform.worldTransform,u.anchor.x=-i.x/i.width,u.anchor.y=-i.y/i.height,u.alpha=e,u._bounds=this._bounds,this._cacheData.sprite=u,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=u.containsPoint.bind(u)},Es.prototype._renderCachedCanvas=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(t),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(t))},Es.prototype._initCachedDisplayObjectCanvas=function(t){if(this._cacheData?.sprite)return;const e=this.getLocalBounds(null,!0),i=this.alpha;this.alpha=1;const n=t.canvasContext.activeContext,r=t._projTransform;e.ceil(C.RESOLUTION);const s=or.create({width:e.width,height:e.height}),o=`cacheAsBitmap_${oi()}`;this._cacheData.textureCacheId=o,Li.addToCache(s.baseTexture,o),sr.addToCache(s,o);const a=Os;this.transform.localTransform.copyTo(a),a.invert(),a.tx-=e.x,a.ty-=e.y,this.renderCanvas=this._cacheData.originalRenderCanvas,t.render(this,{renderTexture:s,clear:!0,transform:a,skipUpdateTransform:!1}),t.canvasContext.activeContext=n,t._projTransform=r,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=i;const h=new Ds(s);h.transform.worldTransform=this.transform.worldTransform,h.anchor.x=-e.x/e.width,h.anchor.y=-e.y/e.height,h.alpha=i,h._bounds=this._bounds,this._cacheData.sprite=h,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=t._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=h.containsPoint.bind(h)},Es.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID},Es.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)},Es.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,Li.removeFromCache(this._cacheData.textureCacheId),sr.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null},Es.prototype._cacheAsBitmapDestroy=function(t){this.cacheAsBitmap=!1,this.destroy(t)},Es.prototype.name=null,Ms.prototype.getChildByName=function(t,e){for(let e=0,i=this.children.length;e<i;e++)if(this.children[e].name===t)return this.children[e];if(e)for(let e=0,i=this.children.length;e<i;e++){const i=this.children[e];if(!i.getChildByName)continue;const n=i.getChildByName(t,!0);if(n)return n}return null},Es.prototype.getGlobalPosition=function(t=new qi,e=!1){return this.parent?this.parent.toGlobal(this.position,t,e):(t.x=this.position.x,t.y=this.position.y),t};const Ns={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},Bs=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join("\n");class ks extends Vn{constructor(t,e=8,i=4,n=Vn.defaultResolution,r=5){const s=function(t,e){const i=Math.ceil(t/2);let n,r="\n    attribute vec2 aVertexPosition;\n\n    uniform mat3 projectionMatrix;\n\n    uniform float strength;\n\n    varying vec2 vBlurTexCoords[%size%];\n\n    uniform vec4 inputSize;\n    uniform vec4 outputFrame;\n\n    vec4 filterVertexPosition( void )\n    {\n        vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n        return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n    }\n\n    vec2 filterTextureCoord( void )\n    {\n        return aVertexPosition * (outputFrame.zw * inputSize.zw);\n    }\n\n    void main(void)\n    {\n        gl_Position = filterVertexPosition();\n\n        vec2 textureCoord = filterTextureCoord();\n        %blur%\n    }",s="";n=e?"vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * strength, 0.0);":"vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * strength);";for(let e=0;e<t;e++){let t=n.replace("%index%",e.toString());t=t.replace("%sampleIndex%",e-(i-1)+".0"),s+=t,s+="\n"}return r=r.replace("%blur%",s),r=r.replace("%size%",t.toString()),r}(r,t),o=function(t){const e=Ns[t],i=e.length;let n,r=Bs,s="";for(let r=0;r<t;r++){let o="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;".replace("%index%",r.toString());n=r,r>=i&&(n=t-r-1),o=o.replace("%value%",e[n].toString()),s+=o,s+="\n"}return r=r.replace("%blur%",s),r=r.replace("%size%",t.toString()),r}(r);super(s,o),this.horizontal=t,this.resolution=n,this._quality=0,this.quality=i,this.blur=e}apply(t,e,i,n){if(i?this.horizontal?this.uniforms.strength=1/i.width*(i.width/e.width):this.uniforms.strength=1/i.height*(i.height/e.height):this.horizontal?this.uniforms.strength=1/t.renderer.width*(t.renderer.width/e.width):this.uniforms.strength=1/t.renderer.height*(t.renderer.height/e.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,1===this.passes)t.applyFilter(this,e,i,n);else{const r=t.getFilterTexture(),s=t.renderer;let o=e,a=r;this.state.blend=!1,t.applyFilter(this,o,a,x.CLEAR);for(let e=1;e<this.passes-1;e++){t.bindAndClear(o,x.BLIT),this.uniforms.uSampler=a;const e=a;a=o,o=e,s.shader.bind(this),s.geometry.draw(5)}this.state.blend=!0,t.applyFilter(this,a,i,n),t.returnFilterTexture(r)}}get blur(){return this.strength}set blur(t){this.padding=1+2*Math.abs(t),this.strength=t}get quality(){return this._quality}set quality(t){this._quality=t,this.passes=t}}class Fs extends Vn{constructor(){const t={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};super(hs,"varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float m[20];\nuniform float uAlpha;\n\nvoid main(void)\n{\n    vec4 c = texture2D(uSampler, vTextureCoord);\n\n    if (uAlpha == 0.0) {\n        gl_FragColor = c;\n        return;\n    }\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (c.a > 0.0) {\n      c.rgb /= c.a;\n    }\n\n    vec4 result;\n\n    result.r = (m[0] * c.r);\n        result.r += (m[1] * c.g);\n        result.r += (m[2] * c.b);\n        result.r += (m[3] * c.a);\n        result.r += m[4];\n\n    result.g = (m[5] * c.r);\n        result.g += (m[6] * c.g);\n        result.g += (m[7] * c.b);\n        result.g += (m[8] * c.a);\n        result.g += m[9];\n\n    result.b = (m[10] * c.r);\n       result.b += (m[11] * c.g);\n       result.b += (m[12] * c.b);\n       result.b += (m[13] * c.a);\n       result.b += m[14];\n\n    result.a = (m[15] * c.r);\n       result.a += (m[16] * c.g);\n       result.a += (m[17] * c.b);\n       result.a += (m[18] * c.a);\n       result.a += m[19];\n\n    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);\n\n    // Premultiply alpha again.\n    rgb *= result.a;\n\n    gl_FragColor = vec4(rgb, result.a);\n}\n",t),this.alpha=1}_loadMatrix(t,e=!1){let i=t;e&&(this._multiply(i,this.uniforms.m,t),i=this._colorMatrix(i)),this.uniforms.m=i}_multiply(t,e,i){return t[0]=e[0]*i[0]+e[1]*i[5]+e[2]*i[10]+e[3]*i[15],t[1]=e[0]*i[1]+e[1]*i[6]+e[2]*i[11]+e[3]*i[16],t[2]=e[0]*i[2]+e[1]*i[7]+e[2]*i[12]+e[3]*i[17],t[3]=e[0]*i[3]+e[1]*i[8]+e[2]*i[13]+e[3]*i[18],t[4]=e[0]*i[4]+e[1]*i[9]+e[2]*i[14]+e[3]*i[19]+e[4],t[5]=e[5]*i[0]+e[6]*i[5]+e[7]*i[10]+e[8]*i[15],t[6]=e[5]*i[1]+e[6]*i[6]+e[7]*i[11]+e[8]*i[16],t[7]=e[5]*i[2]+e[6]*i[7]+e[7]*i[12]+e[8]*i[17],t[8]=e[5]*i[3]+e[6]*i[8]+e[7]*i[13]+e[8]*i[18],t[9]=e[5]*i[4]+e[6]*i[9]+e[7]*i[14]+e[8]*i[19]+e[9],t[10]=e[10]*i[0]+e[11]*i[5]+e[12]*i[10]+e[13]*i[15],t[11]=e[10]*i[1]+e[11]*i[6]+e[12]*i[11]+e[13]*i[16],t[12]=e[10]*i[2]+e[11]*i[7]+e[12]*i[12]+e[13]*i[17],t[13]=e[10]*i[3]+e[11]*i[8]+e[12]*i[13]+e[13]*i[18],t[14]=e[10]*i[4]+e[11]*i[9]+e[12]*i[14]+e[13]*i[19]+e[14],t[15]=e[15]*i[0]+e[16]*i[5]+e[17]*i[10]+e[18]*i[15],t[16]=e[15]*i[1]+e[16]*i[6]+e[17]*i[11]+e[18]*i[16],t[17]=e[15]*i[2]+e[16]*i[7]+e[17]*i[12]+e[18]*i[17],t[18]=e[15]*i[3]+e[16]*i[8]+e[17]*i[13]+e[18]*i[18],t[19]=e[15]*i[4]+e[16]*i[9]+e[17]*i[14]+e[18]*i[19]+e[19],t}_colorMatrix(t){const e=new Float32Array(t);return e[4]/=255,e[9]/=255,e[14]/=255,e[19]/=255,e}brightness(t,e){const i=[t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0];this._loadMatrix(i,e)}tint(t,e){const[i,n,r]=qe.shared.setValue(t).toArray(),s=[i,0,0,0,0,0,n,0,0,0,0,0,r,0,0,0,0,0,1,0];this._loadMatrix(s,e)}greyscale(t,e){const i=[t,t,t,0,0,t,t,t,0,0,t,t,t,0,0,0,0,0,1,0];this._loadMatrix(i,e)}blackAndWhite(t){this._loadMatrix([.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0],t)}hue(t,e){t=(t||0)/180*Math.PI;const i=Math.cos(t),n=Math.sin(t),r=1/3,s=(0,Math.sqrt)(r),o=[i+(1-i)*r,r*(1-i)-s*n,r*(1-i)+s*n,0,0,r*(1-i)+s*n,i+r*(1-i),r*(1-i)-s*n,0,0,r*(1-i)-s*n,r*(1-i)+s*n,i+r*(1-i),0,0,0,0,0,1,0];this._loadMatrix(o,e)}contrast(t,e){const i=(t||0)+1,n=-.5*(i-1),r=[i,0,0,0,n,0,i,0,0,n,0,0,i,0,n,0,0,0,1,0];this._loadMatrix(r,e)}saturate(t=0,e){const i=2*t/3+1,n=-.5*(i-1),r=[i,n,n,0,0,n,i,n,0,0,n,n,i,0,0,0,0,0,1,0];this._loadMatrix(r,e)}desaturate(){this.saturate(-1)}negative(t){this._loadMatrix([-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0],t)}sepia(t){this._loadMatrix([.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0],t)}technicolor(t){this._loadMatrix([1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0],t)}polaroid(t){this._loadMatrix([1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],t)}toBGR(t){this._loadMatrix([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0],t)}kodachrome(t){this._loadMatrix([1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0],t)}browni(t){this._loadMatrix([.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0],t)}vintage(t){this._loadMatrix([.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0],t)}colorTone(t,e,i,n,r){t=t||.2,e=e||.15,i=i||16770432,n=n||3375104;const s=qe.shared,[o,a,h]=s.setValue(i).toArray(),[l,u,c]=s.setValue(n).toArray(),d=[.3,.59,.11,0,0,o,a,h,t,0,l,u,c,e,0,o-l,a-u,h-c,0,0];this._loadMatrix(d,r)}night(t,e){const i=[-2*(t=t||.1),-t,0,0,0,-t,0,t,0,0,0,t,2*t,0,0,0,0,0,1,0];this._loadMatrix(i,e)}predator(t,e){const i=[11.224130630493164*t,-4.794486999511719*t,-2.8746118545532227*t,0*t,.40342438220977783*t,-3.6330697536468506*t,9.193157196044922*t,-2.951810836791992*t,0*t,-1.316135048866272*t,-3.2184197902679443*t,-4.2375030517578125*t,7.476448059082031*t,0*t,.8044459223747253*t,0,0,0,1,0];this._loadMatrix(i,e)}lsd(t){this._loadMatrix([2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0],t)}reset(){this._loadMatrix([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],!1)}get matrix(){return this.uniforms.m}set matrix(t){this.uniforms.m=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}}Fs.prototype.grayscale=Fs.prototype.greyscale;const Us={AlphaFilter:class extends Vn{constructor(t=1){super("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}","varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float uAlpha;\n\nvoid main(void)\n{\n   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;\n}\n",{uAlpha:1}),this.alpha=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}},BlurFilter:class extends Vn{constructor(t=8,e=4,i=Vn.defaultResolution,n=5){super(),this._repeatEdgePixels=!1,this.blurXFilter=new ks(!0,t,e,i,n),this.blurYFilter=new ks(!1,t,e,i,n),this.resolution=i,this.quality=e,this.blur=t,this.repeatEdgePixels=!1}apply(t,e,i,n){const r=Math.abs(this.blurXFilter.strength),s=Math.abs(this.blurYFilter.strength);if(r&&s){const r=t.getFilterTexture();this.blurXFilter.apply(t,e,r,x.CLEAR),this.blurYFilter.apply(t,r,i,n),t.returnFilterTexture(r)}else s?this.blurYFilter.apply(t,e,i,n):this.blurXFilter.apply(t,e,i,n)}updatePadding(){this._repeatEdgePixels?this.padding=0:this.padding=2*Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))}get blur(){return this.blurXFilter.blur}set blur(t){this.blurXFilter.blur=this.blurYFilter.blur=t,this.updatePadding()}get quality(){return this.blurXFilter.quality}set quality(t){this.blurXFilter.quality=this.blurYFilter.quality=t}get blurX(){return this.blurXFilter.blur}set blurX(t){this.blurXFilter.blur=t,this.updatePadding()}get blurY(){return this.blurYFilter.blur}set blurY(t){this.blurYFilter.blur=t,this.updatePadding()}get blendMode(){return this.blurYFilter.blendMode}set blendMode(t){this.blurYFilter.blendMode=t}get repeatEdgePixels(){return this._repeatEdgePixels}set repeatEdgePixels(t){this._repeatEdgePixels=t,this.updatePadding()}},BlurFilterPass:ks,ColorMatrixFilter:Fs,DisplacementFilter:class extends Vn{constructor(t,e){const i=new nn;t.renderable=!1,super("attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\nuniform mat3 filterMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vFilterCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n\tgl_Position = filterVertexPosition();\n\tvTextureCoord = filterTextureCoord();\n\tvFilterCoord = ( filterMatrix * vec3( vTextureCoord, 1.0)  ).xy;\n}\n","varying vec2 vFilterCoord;\nvarying vec2 vTextureCoord;\n\nuniform vec2 scale;\nuniform mat2 rotation;\nuniform sampler2D uSampler;\nuniform sampler2D mapSampler;\n\nuniform highp vec4 inputSize;\nuniform vec4 inputClamp;\n\nvoid main(void)\n{\n  vec4 map =  texture2D(mapSampler, vFilterCoord);\n\n  map -= 0.5;\n  map.xy = scale * inputSize.zw * (rotation * map.xy);\n\n  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), inputClamp.xy, inputClamp.zw));\n}\n",{mapSampler:t._texture,filterMatrix:i,scale:{x:1,y:1},rotation:new Float32Array([1,0,0,1])}),this.maskSprite=t,this.maskMatrix=i,null==e&&(e=20),this.scale=new qi(e,e)}apply(t,e,i,n){this.uniforms.filterMatrix=t.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y;const r=this.maskSprite.worldTransform,s=Math.sqrt(r.a*r.a+r.b*r.b),o=Math.sqrt(r.c*r.c+r.d*r.d);0!==s&&0!==o&&(this.uniforms.rotation[0]=r.a/s,this.uniforms.rotation[1]=r.b/s,this.uniforms.rotation[2]=r.c/o,this.uniforms.rotation[3]=r.d/o),t.applyFilter(this,e,i,n)}get map(){return this.uniforms.mapSampler}set map(t){this.uniforms.mapSampler=t}},FXAAFilter:class extends Vn{constructor(){super("\nattribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vFragCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvoid texcoords(vec2 fragCoord, vec2 inverseVP,\n               out vec2 v_rgbNW, out vec2 v_rgbNE,\n               out vec2 v_rgbSW, out vec2 v_rgbSE,\n               out vec2 v_rgbM) {\n    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;\n    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;\n    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;\n    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;\n    v_rgbM = vec2(fragCoord * inverseVP);\n}\n\nvoid main(void) {\n\n   gl_Position = filterVertexPosition();\n\n   vFragCoord = aVertexPosition * outputFrame.zw;\n\n   texcoords(vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n}\n",'varying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vFragCoord;\nuniform sampler2D uSampler;\nuniform highp vec4 inputSize;\n\n\n/**\n Basic FXAA implementation based on the code on geeks3d.com with the\n modification that the texture2DLod stuff was removed since it\'s\n unsupported by WebGL.\n\n --\n\n From:\n https://github.com/mitsuhiko/webgl-meincraft\n\n Copyright (c) 2011 by Armin Ronacher.\n\n Some rights reserved.\n\n Redistribution and use in source and binary forms, with or without\n modification, are permitted provided that the following conditions are\n met:\n\n * Redistributions of source code must retain the above copyright\n notice, this list of conditions and the following disclaimer.\n\n * Redistributions in binary form must reproduce the above\n copyright notice, this list of conditions and the following\n disclaimer in the documentation and/or other materials provided\n with the distribution.\n\n * The names of the contributors may not be used to endorse or\n promote products derived from this software without specific\n prior written permission.\n\n THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n#ifndef FXAA_REDUCE_MIN\n#define FXAA_REDUCE_MIN   (1.0/ 128.0)\n#endif\n#ifndef FXAA_REDUCE_MUL\n#define FXAA_REDUCE_MUL   (1.0 / 8.0)\n#endif\n#ifndef FXAA_SPAN_MAX\n#define FXAA_SPAN_MAX     8.0\n#endif\n\n//optimized version for mobile, where dependent\n//texture reads can be a bottleneck\nvec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 inverseVP,\n          vec2 v_rgbNW, vec2 v_rgbNE,\n          vec2 v_rgbSW, vec2 v_rgbSE,\n          vec2 v_rgbM) {\n    vec4 color;\n    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;\n    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;\n    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;\n    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;\n    vec4 texColor = texture2D(tex, v_rgbM);\n    vec3 rgbM  = texColor.xyz;\n    vec3 luma = vec3(0.299, 0.587, 0.114);\n    float lumaNW = dot(rgbNW, luma);\n    float lumaNE = dot(rgbNE, luma);\n    float lumaSW = dot(rgbSW, luma);\n    float lumaSE = dot(rgbSE, luma);\n    float lumaM  = dot(rgbM,  luma);\n    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n\n    mediump vec2 dir;\n    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n\n    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *\n                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n\n    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\n    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),\n              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\n                  dir * rcpDirMin)) * inverseVP;\n\n    vec3 rgbA = 0.5 * (\n                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +\n                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);\n    vec3 rgbB = rgbA * 0.5 + 0.25 * (\n                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +\n                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);\n\n    float lumaB = dot(rgbB, luma);\n    if ((lumaB < lumaMin) || (lumaB > lumaMax))\n        color = vec4(rgbA, texColor.a);\n    else\n        color = vec4(rgbB, texColor.a);\n    return color;\n}\n\nvoid main() {\n\n      vec4 color;\n\n      color = fxaa(uSampler, vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n\n      gl_FragColor = color;\n}\n')}},NoiseFilter:class extends Vn{constructor(t=.5,e=Math.random()){super(hs,"precision highp float;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform float uNoise;\nuniform float uSeed;\nuniform sampler2D uSampler;\n\nfloat rand(vec2 co)\n{\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nvoid main()\n{\n    vec4 color = texture2D(uSampler, vTextureCoord);\n    float randomValue = rand(gl_FragCoord.xy * uSeed);\n    float diff = (randomValue - 0.5) * uNoise;\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (color.a > 0.0) {\n        color.rgb /= color.a;\n    }\n\n    color.r += diff;\n    color.g += diff;\n    color.b += diff;\n\n    // Premultiply alpha again.\n    color.rgb *= color.a;\n\n    gl_FragColor = color;\n}\n",{uNoise:0,uSeed:0}),this.noise=t,this.seed=e}get noise(){return this.uniforms.uNoise}set noise(t){this.uniforms.uNoise=t}get seed(){return this.uniforms.uSeed}set seed(t){this.uniforms.uSeed=t}}};Object.entries(Us).forEach((([t,e])=>{Object.defineProperty(Us,t,{get:()=>(_e("7.1.0",`filters.${t} has moved to ${t}`),e)})}));const Gs=new class{constructor(){this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}init(t){this.removeTickerListener(),this.events=t,this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}get pauseUpdate(){return this._pauseUpdate}set pauseUpdate(t){this._pauseUpdate=t}addTickerListener(){!this.tickerAdded&&this.domElement&&(ss.system.add(this.tickerUpdate,this,is.INTERACTION),this.tickerAdded=!0)}removeTickerListener(){this.tickerAdded&&(ss.system.remove(this.tickerUpdate,this),this.tickerAdded=!1)}pointerMoved(){this._didMove=!0}update(){if(!this.domElement||this._pauseUpdate)return;if(this._didMove)return void(this._didMove=!1);const t=this.events.rootPointerEvent;this.events.supportsTouchEvents&&"touch"===t.pointerType||globalThis.document.dispatchEvent(new PointerEvent("pointermove",{clientX:t.clientX,clientY:t.clientY}))}tickerUpdate(t){this._deltaTime+=t,this._deltaTime<this.interactionFrequency||(this._deltaTime=0,this.update())}};class zs{constructor(t){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=zs.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new qi,this.page=new qi,this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=t}get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get data(){return this}composedPath(){return!this.manager||this.path&&this.path[this.path.length-1]===this.target||(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}initEvent(t,e,i){throw new Error("initEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}initUIEvent(t,e,i,n,r){throw new Error("initUIEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}preventDefault(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){this.propagationStopped=!0}}class js extends zs{constructor(){super(...arguments),this.client=new qi,this.movement=new qi,this.offset=new qi,this.global=new qi,this.screen=new qi}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.clientX}get y(){return this.clientY}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getLocalPosition(t,e,i){return t.worldTransform.applyInverse(i||this.global,e)}getModifierState(t){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(t)}initMouseEvent(t,e,i,n,r,s,o,a,h,l,u,c,d,p,f){throw new Error("Method not implemented.")}}class Hs extends js{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return"pointermove"===this.type||"mousemove"===this.type||"touchmove"===this.type?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}}class Ws extends js{constructor(){super(...arguments),this.DOM_DELTA_PIXEL=0,this.DOM_DELTA_LINE=1,this.DOM_DELTA_PAGE=2}}Ws.DOM_DELTA_PIXEL=0,Ws.DOM_DELTA_LINE=1,Ws.DOM_DELTA_PAGE=2;const Xs=new qi,Vs=new qi;class Ys{constructor(t){this.dispatch=new Y,this.moveOnAll=!1,this.enableGlobalMoveEvents=!0,this.mappingState={trackingData:{}},this.eventPool=new Map,this._allInteractiveElements=[],this._hitElements=[],this._isPointerMoveEvent=!1,this.rootTarget=t,this.hitPruneFn=this.hitPruneFn.bind(this),this.hitTestFn=this.hitTestFn.bind(this),this.mapPointerDown=this.mapPointerDown.bind(this),this.mapPointerMove=this.mapPointerMove.bind(this),this.mapPointerOut=this.mapPointerOut.bind(this),this.mapPointerOver=this.mapPointerOver.bind(this),this.mapPointerUp=this.mapPointerUp.bind(this),this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this),this.mapWheel=this.mapWheel.bind(this),this.mappingTable={},this.addEventMapping("pointerdown",this.mapPointerDown),this.addEventMapping("pointermove",this.mapPointerMove),this.addEventMapping("pointerout",this.mapPointerOut),this.addEventMapping("pointerleave",this.mapPointerOut),this.addEventMapping("pointerover",this.mapPointerOver),this.addEventMapping("pointerup",this.mapPointerUp),this.addEventMapping("pointerupoutside",this.mapPointerUpOutside),this.addEventMapping("wheel",this.mapWheel)}addEventMapping(t,e){this.mappingTable[t]||(this.mappingTable[t]=[]),this.mappingTable[t].push({fn:e,priority:0}),this.mappingTable[t].sort(((t,e)=>t.priority-e.priority))}dispatchEvent(t,e){t.propagationStopped=!1,t.propagationImmediatelyStopped=!1,this.propagate(t,e),this.dispatch.emit(e||t.type,t)}mapEvent(t){if(!this.rootTarget)return;const e=this.mappingTable[t.type];if(e)for(let i=0,n=e.length;i<n;i++)e[i].fn(t);else console.warn(`[EventBoundary]: Event mapping not defined for ${t.type}`)}hitTest(t,e){Gs.pauseUpdate=!0;const i=this[this._isPointerMoveEvent&&this.enableGlobalMoveEvents?"hitTestMoveRecursive":"hitTestRecursive"](this.rootTarget,this.rootTarget.eventMode,Xs.set(t,e),this.hitTestFn,this.hitPruneFn);return i&&i[0]}propagate(t,e){if(!t.target)return;const i=t.composedPath();t.eventPhase=t.CAPTURING_PHASE;for(let n=0,r=i.length-1;n<r;n++)if(t.currentTarget=i[n],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return;if(t.eventPhase=t.AT_TARGET,t.currentTarget=t.target,this.notifyTarget(t,e),!t.propagationStopped&&!t.propagationImmediatelyStopped){t.eventPhase=t.BUBBLING_PHASE;for(let n=i.length-2;n>=0;n--)if(t.currentTarget=i[n],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return}}all(t,e,i=this._allInteractiveElements){if(0===i.length)return;t.eventPhase=t.BUBBLING_PHASE;const n=Array.isArray(e)?e:[e];for(let e=i.length-1;e>=0;e--)n.forEach((n=>{t.currentTarget=i[e],this.notifyTarget(t,n)}))}propagationPath(t){const e=[t];for(let i=0;i<2048&&t!==this.rootTarget;i++){if(!t.parent)throw new Error("Cannot find propagation path to disconnected target");e.push(t.parent),t=t.parent}return e.reverse(),e}hitTestMoveRecursive(t,e,i,n,r,s=!1){let o=!1;if(this._interactivePrune(t))return null;if("dynamic"!==t.eventMode&&"dynamic"!==e||(Gs.pauseUpdate=!1),t.interactiveChildren&&t.children){const a=t.children;for(let h=a.length-1;h>=0;h--){const l=a[h],u=this.hitTestMoveRecursive(l,this._isInteractive(e)?e:l.eventMode,i,n,r,s||r(t,i));if(u){if(u.length>0&&!u[u.length-1].parent)continue;const e=t.isInteractive();(u.length>0||e)&&(e&&this._allInteractiveElements.push(t),u.push(t)),0===this._hitElements.length&&(this._hitElements=u),o=!0}}}const a=this._isInteractive(e),h=t.isInteractive();return h&&h&&this._allInteractiveElements.push(t),s||this._hitElements.length>0?null:o?this._hitElements:a&&!r(t,i)&&n(t,i)?h?[t]:[]:null}hitTestRecursive(t,e,i,n,r){if(this._interactivePrune(t)||r(t,i))return null;if("dynamic"!==t.eventMode&&"dynamic"!==e||(Gs.pauseUpdate=!1),t.interactiveChildren&&t.children){const s=t.children;for(let o=s.length-1;o>=0;o--){const a=s[o],h=this.hitTestRecursive(a,this._isInteractive(e)?e:a.eventMode,i,n,r);if(h){if(h.length>0&&!h[h.length-1].parent)continue;const e=t.isInteractive();return(h.length>0||e)&&h.push(t),h}}}const s=this._isInteractive(e),o=t.isInteractive();return s&&n(t,i)?o?[t]:[]:null}_isInteractive(t){return"static"===t||"dynamic"===t}_interactivePrune(t){return!(t&&!t.isMask&&t.visible&&t.renderable)||("none"===t.eventMode||("passive"===t.eventMode&&!t.interactiveChildren||!!t.isMask))}hitPruneFn(t,e){if(t.hitArea&&(t.worldTransform.applyInverse(e,Vs),!t.hitArea.contains(Vs.x,Vs.y)))return!0;if(t._mask){const i=t._mask.isMaskData?t._mask.maskObject:t._mask;if(i&&!i.containsPoint?.(e))return!0}return!1}hitTestFn(t,e){return"passive"!==t.eventMode&&(!!t.hitArea||!!t.containsPoint&&t.containsPoint(e))}notifyTarget(t,e){const i=`on${e=e??t.type}`;t.currentTarget[i]?.(t);const n=t.eventPhase===t.CAPTURING_PHASE||t.eventPhase===t.AT_TARGET?`${e}capture`:e;this.notifyListeners(t,n),t.eventPhase===t.AT_TARGET&&this.notifyListeners(t,e)}mapPointerDown(t){if(!(t instanceof Hs))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const e=this.createPointerEvent(t);if(this.dispatchEvent(e,"pointerdown"),"touch"===e.pointerType)this.dispatchEvent(e,"touchstart");else if("mouse"===e.pointerType||"pen"===e.pointerType){const t=2===e.button;this.dispatchEvent(e,t?"rightdown":"mousedown")}this.trackingData(t.pointerId).pressTargetsByButton[t.button]=e.composedPath(),this.freeEvent(e)}mapPointerMove(t){if(!(t instanceof Hs))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");this._allInteractiveElements.length=0,this._hitElements.length=0,this._isPointerMoveEvent=!0;const e=this.createPointerEvent(t);this._isPointerMoveEvent=!1;const i="mouse"===e.pointerType||"pen"===e.pointerType,n=this.trackingData(t.pointerId),r=this.findMountedTarget(n.overTargets);if(n.overTargets?.length>0&&r!==e.target){const n="mousemove"===t.type?"mouseout":"pointerout",s=this.createPointerEvent(t,n,r);if(this.dispatchEvent(s,"pointerout"),i&&this.dispatchEvent(s,"mouseout"),!e.composedPath().includes(r)){const n=this.createPointerEvent(t,"pointerleave",r);for(n.eventPhase=n.AT_TARGET;n.target&&!e.composedPath().includes(n.target);)n.currentTarget=n.target,this.notifyTarget(n),i&&this.notifyTarget(n,"mouseleave"),n.target=n.target.parent;this.freeEvent(n)}this.freeEvent(s)}if(r!==e.target){const n="mousemove"===t.type?"mouseover":"pointerover",s=this.clonePointerEvent(e,n);this.dispatchEvent(s,"pointerover"),i&&this.dispatchEvent(s,"mouseover");let o=r?.parent;for(;o&&o!==this.rootTarget.parent&&o!==e.target;)o=o.parent;if(!o||o===this.rootTarget.parent){const t=this.clonePointerEvent(e,"pointerenter");for(t.eventPhase=t.AT_TARGET;t.target&&t.target!==r&&t.target!==this.rootTarget.parent;)t.currentTarget=t.target,this.notifyTarget(t),i&&this.notifyTarget(t,"mouseenter"),t.target=t.target.parent;this.freeEvent(t)}this.freeEvent(s)}const s=[],o=this.enableGlobalMoveEvents??!0;this.moveOnAll?s.push("pointermove"):this.dispatchEvent(e,"pointermove"),o&&s.push("globalpointermove"),"touch"===e.pointerType&&(this.moveOnAll?s.splice(1,0,"touchmove"):this.dispatchEvent(e,"touchmove"),o&&s.push("globaltouchmove")),i&&(this.moveOnAll?s.splice(1,0,"mousemove"):this.dispatchEvent(e,"mousemove"),o&&s.push("globalmousemove"),this.cursor=e.target?.cursor),s.length>0&&this.all(e,s),this._allInteractiveElements.length=0,this._hitElements.length=0,n.overTargets=e.composedPath(),this.freeEvent(e)}mapPointerOver(t){if(!(t instanceof Hs))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const e=this.trackingData(t.pointerId),i=this.createPointerEvent(t),n="mouse"===i.pointerType||"pen"===i.pointerType;this.dispatchEvent(i,"pointerover"),n&&this.dispatchEvent(i,"mouseover"),"mouse"===i.pointerType&&(this.cursor=i.target?.cursor);const r=this.clonePointerEvent(i,"pointerenter");for(r.eventPhase=r.AT_TARGET;r.target&&r.target!==this.rootTarget.parent;)r.currentTarget=r.target,this.notifyTarget(r),n&&this.notifyTarget(r,"mouseenter"),r.target=r.target.parent;e.overTargets=i.composedPath(),this.freeEvent(i),this.freeEvent(r)}mapPointerOut(t){if(!(t instanceof Hs))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const e=this.trackingData(t.pointerId);if(e.overTargets){const i="mouse"===t.pointerType||"pen"===t.pointerType,n=this.findMountedTarget(e.overTargets),r=this.createPointerEvent(t,"pointerout",n);this.dispatchEvent(r),i&&this.dispatchEvent(r,"mouseout");const s=this.createPointerEvent(t,"pointerleave",n);for(s.eventPhase=s.AT_TARGET;s.target&&s.target!==this.rootTarget.parent;)s.currentTarget=s.target,this.notifyTarget(s),i&&this.notifyTarget(s,"mouseleave"),s.target=s.target.parent;e.overTargets=null,this.freeEvent(r),this.freeEvent(s)}this.cursor=null}mapPointerUp(t){if(!(t instanceof Hs))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const e=performance.now(),i=this.createPointerEvent(t);if(this.dispatchEvent(i,"pointerup"),"touch"===i.pointerType)this.dispatchEvent(i,"touchend");else if("mouse"===i.pointerType||"pen"===i.pointerType){const t=2===i.button;this.dispatchEvent(i,t?"rightup":"mouseup")}const n=this.trackingData(t.pointerId),r=this.findMountedTarget(n.pressTargetsByButton[t.button]);let s=r;if(r&&!i.composedPath().includes(r)){let e=r;for(;e&&!i.composedPath().includes(e);){if(i.currentTarget=e,this.notifyTarget(i,"pointerupoutside"),"touch"===i.pointerType)this.notifyTarget(i,"touchendoutside");else if("mouse"===i.pointerType||"pen"===i.pointerType){const t=2===i.button;this.notifyTarget(i,t?"rightupoutside":"mouseupoutside")}e=e.parent}delete n.pressTargetsByButton[t.button],s=e}if(s){const r=this.clonePointerEvent(i,"click");r.target=s,r.path=null,n.clicksByButton[t.button]||(n.clicksByButton[t.button]={clickCount:0,target:r.target,timeStamp:e});const o=n.clicksByButton[t.button];if(o.target===r.target&&e-o.timeStamp<200?++o.clickCount:o.clickCount=1,o.target=r.target,o.timeStamp=e,r.detail=o.clickCount,"mouse"===r.pointerType){const t=2===r.button;this.dispatchEvent(r,t?"rightclick":"click")}else"touch"===r.pointerType&&this.dispatchEvent(r,"tap");this.dispatchEvent(r,"pointertap"),this.freeEvent(r)}this.freeEvent(i)}mapPointerUpOutside(t){if(!(t instanceof Hs))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const e=this.trackingData(t.pointerId),i=this.findMountedTarget(e.pressTargetsByButton[t.button]),n=this.createPointerEvent(t);if(i){let r=i;for(;r;)n.currentTarget=r,this.notifyTarget(n,"pointerupoutside"),"touch"===n.pointerType?this.notifyTarget(n,"touchendoutside"):"mouse"!==n.pointerType&&"pen"!==n.pointerType||this.notifyTarget(n,2===n.button?"rightupoutside":"mouseupoutside"),r=r.parent;delete e.pressTargetsByButton[t.button]}this.freeEvent(n)}mapWheel(t){if(!(t instanceof Ws))return void console.warn("EventBoundary cannot map a non-wheel event as a wheel event");const e=this.createWheelEvent(t);this.dispatchEvent(e),this.freeEvent(e)}findMountedTarget(t){if(!t)return null;let e=t[0];for(let i=1;i<t.length&&t[i].parent===e;i++)e=t[i];return e}createPointerEvent(t,e,i){const n=this.allocateEvent(Hs);return this.copyPointerData(t,n),this.copyMouseData(t,n),this.copyData(t,n),n.nativeEvent=t.nativeEvent,n.originalEvent=t,n.target=i??this.hitTest(n.global.x,n.global.y)??this._hitElements[0],"string"==typeof e&&(n.type=e),n}createWheelEvent(t){const e=this.allocateEvent(Ws);return this.copyWheelData(t,e),this.copyMouseData(t,e),this.copyData(t,e),e.nativeEvent=t.nativeEvent,e.originalEvent=t,e.target=this.hitTest(e.global.x,e.global.y),e}clonePointerEvent(t,e){const i=this.allocateEvent(Hs);return i.nativeEvent=t.nativeEvent,i.originalEvent=t.originalEvent,this.copyPointerData(t,i),this.copyMouseData(t,i),this.copyData(t,i),i.target=t.target,i.path=t.composedPath().slice(),i.type=e??i.type,i}copyWheelData(t,e){e.deltaMode=t.deltaMode,e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ}copyPointerData(t,e){t instanceof Hs&&e instanceof Hs&&(e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist)}copyMouseData(t,e){t instanceof js&&e instanceof js&&(e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.client.copyFrom(t.client),e.ctrlKey=t.ctrlKey,e.metaKey=t.metaKey,e.movement.copyFrom(t.movement),e.screen.copyFrom(t.screen),e.shiftKey=t.shiftKey,e.global.copyFrom(t.global))}copyData(t,e){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=performance.now(),e.type=t.type,e.detail=t.detail,e.view=t.view,e.which=t.which,e.layer.copyFrom(t.layer),e.page.copyFrom(t.page)}trackingData(t){return this.mappingState.trackingData[t]||(this.mappingState.trackingData[t]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[t]}allocateEvent(t){this.eventPool.has(t)||this.eventPool.set(t,[]);const e=this.eventPool.get(t).pop()||new t(this);return e.eventPhase=e.NONE,e.currentTarget=null,e.path=null,e.target=null,e}freeEvent(t){if(t.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");const e=t.constructor;this.eventPool.has(e)||this.eventPool.set(e,[]),this.eventPool.get(e).push(t)}notifyListeners(t,e){const i=t.currentTarget._events[e];if(i&&t.currentTarget.isInteractive())if("fn"in i)i.once&&t.currentTarget.removeListener(e,i.fn,void 0,!0),i.fn.call(i.context,t);else for(let n=0,r=i.length;n<r&&!t.propagationImmediatelyStopped;n++)i[n].once&&t.currentTarget.removeListener(e,i[n].fn,void 0,!0),i[n].fn.call(i[n].context,t)}}const $s={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"},qs=class{constructor(t){this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.domElement=null,this.resolution=1,this.renderer=t,this.rootBoundary=new Ys(null),Gs.init(this),this.autoPreventDefault=!0,this.eventsAdded=!1,this.rootPointerEvent=new Hs(null),this.rootWheelEvent=new Ws(null),this.cursorStyles={default:"inherit",pointer:"pointer"},this.features=new Proxy({...qs.defaultEventFeatures},{set:(t,e,i)=>("globalMove"===e&&(this.rootBoundary.enableGlobalMoveEvents=i),t[e]=i,!0)}),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onPointerOverOut=this.onPointerOverOut.bind(this),this.onWheel=this.onWheel.bind(this)}static get defaultEventMode(){return this._defaultEventMode}init(t){const{view:e,resolution:i}=this.renderer;this.setTargetElement(e),this.resolution=i,qs._defaultEventMode=t.eventMode??"auto",Object.assign(this.features,t.eventFeatures??{}),this.rootBoundary.enableGlobalMoveEvents=this.features.globalMove}resolutionChange(t){this.resolution=t}destroy(){this.setTargetElement(null),this.renderer=null}setCursor(t){t=t||"default";let e=!0;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas&&(e=!1),this.currentCursor===t)return;this.currentCursor=t;const i=this.cursorStyles[t];if(i)switch(typeof i){case"string":e&&(this.domElement.style.cursor=i);break;case"function":i(t);break;case"object":e&&Object.assign(this.domElement.style,i)}else e&&"string"==typeof t&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,t)&&(this.domElement.style.cursor=t)}get pointer(){return this.rootPointerEvent}onPointerDown(t){if(!this.features.click)return;if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&"touch"===t.pointerType)return;const e=this.normalizeToPointerData(t);if(this.autoPreventDefault&&e[0].isNormalized){(t.cancelable||!("cancelable"in t))&&t.preventDefault()}for(let t=0,i=e.length;t<i;t++){const i=e[t],n=this.bootstrapEvent(this.rootPointerEvent,i);this.rootBoundary.mapEvent(n)}this.setCursor(this.rootBoundary.cursor)}onPointerMove(t){if(!this.features.move)return;if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&"touch"===t.pointerType)return;Gs.pointerMoved();const e=this.normalizeToPointerData(t);for(let t=0,i=e.length;t<i;t++){const i=this.bootstrapEvent(this.rootPointerEvent,e[t]);this.rootBoundary.mapEvent(i)}this.setCursor(this.rootBoundary.cursor)}onPointerUp(t){if(!this.features.click)return;if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&"touch"===t.pointerType)return;let e=t.target;t.composedPath&&t.composedPath().length>0&&(e=t.composedPath()[0]);const i=e!==this.domElement?"outside":"",n=this.normalizeToPointerData(t);for(let t=0,e=n.length;t<e;t++){const e=this.bootstrapEvent(this.rootPointerEvent,n[t]);e.type+=i,this.rootBoundary.mapEvent(e)}this.setCursor(this.rootBoundary.cursor)}onPointerOverOut(t){if(!this.features.click)return;if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&"touch"===t.pointerType)return;const e=this.normalizeToPointerData(t);for(let t=0,i=e.length;t<i;t++){const i=this.bootstrapEvent(this.rootPointerEvent,e[t]);this.rootBoundary.mapEvent(i)}this.setCursor(this.rootBoundary.cursor)}onWheel(t){if(!this.features.wheel)return;const e=this.normalizeWheelEvent(t);this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.rootBoundary.mapEvent(e)}setTargetElement(t){this.removeEvents(),this.domElement=t,Gs.domElement=t,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;Gs.addTickerListener();const t=this.domElement.style;t&&(globalThis.navigator.msPointerEnabled?(t.msContentZooming="none",t.msTouchAction="none"):this.supportsPointerEvents&&(t.touchAction="none")),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this.onPointerMove,!0),this.domElement.addEventListener("pointerdown",this.onPointerDown,!0),this.domElement.addEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.addEventListener("pointerover",this.onPointerOverOut,!0),globalThis.addEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.addEventListener("mousemove",this.onPointerMove,!0),this.domElement.addEventListener("mousedown",this.onPointerDown,!0),this.domElement.addEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.addEventListener("mouseover",this.onPointerOverOut,!0),globalThis.addEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.domElement.addEventListener("touchstart",this.onPointerDown,!0),this.domElement.addEventListener("touchend",this.onPointerUp,!0),this.domElement.addEventListener("touchmove",this.onPointerMove,!0)),this.domElement.addEventListener("wheel",this.onWheel,{passive:!0,capture:!0}),this.eventsAdded=!0}removeEvents(){if(!this.eventsAdded||!this.domElement)return;Gs.removeTickerListener();const t=this.domElement.style;globalThis.navigator.msPointerEnabled?(t.msContentZooming="",t.msTouchAction=""):this.supportsPointerEvents&&(t.touchAction=""),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this.onPointerMove,!0),this.domElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.domElement.removeEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.removeEventListener("pointerover",this.onPointerOverOut,!0),globalThis.removeEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.removeEventListener("mousemove",this.onPointerMove,!0),this.domElement.removeEventListener("mousedown",this.onPointerDown,!0),this.domElement.removeEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.removeEventListener("mouseover",this.onPointerOverOut,!0),globalThis.removeEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.domElement.removeEventListener("touchstart",this.onPointerDown,!0),this.domElement.removeEventListener("touchend",this.onPointerUp,!0),this.domElement.removeEventListener("touchmove",this.onPointerMove,!0)),this.domElement.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapPositionToPoint(t,e,i){let n;n=this.domElement.parentElement?this.domElement.getBoundingClientRect():{x:0,y:0,width:this.domElement.width,height:this.domElement.height,left:0,top:0};const r=1/this.resolution;t.x=(e-n.left)*(this.domElement.width/n.width)*r,t.y=(i-n.top)*(this.domElement.height/n.height)*r}normalizeToPointerData(t){const e=[];if(this.supportsTouchEvents&&t instanceof TouchEvent)for(let i=0,n=t.changedTouches.length;i<n;i++){const n=t.changedTouches[i];void 0===n.button&&(n.button=0),void 0===n.buttons&&(n.buttons=1),void 0===n.isPrimary&&(n.isPrimary=1===t.touches.length&&"touchstart"===t.type),void 0===n.width&&(n.width=n.radiusX||1),void 0===n.height&&(n.height=n.radiusY||1),void 0===n.tiltX&&(n.tiltX=0),void 0===n.tiltY&&(n.tiltY=0),void 0===n.pointerType&&(n.pointerType="touch"),void 0===n.pointerId&&(n.pointerId=n.identifier||0),void 0===n.pressure&&(n.pressure=n.force||.5),void 0===n.twist&&(n.twist=0),void 0===n.tangentialPressure&&(n.tangentialPressure=0),void 0===n.layerX&&(n.layerX=n.offsetX=n.clientX),void 0===n.layerY&&(n.layerY=n.offsetY=n.clientY),n.isNormalized=!0,n.type=t.type,e.push(n)}else if(globalThis.MouseEvent&&(!(t instanceof MouseEvent)||this.supportsPointerEvents&&t instanceof globalThis.PointerEvent))e.push(t);else{const i=t;void 0===i.isPrimary&&(i.isPrimary=!0),void 0===i.width&&(i.width=1),void 0===i.height&&(i.height=1),void 0===i.tiltX&&(i.tiltX=0),void 0===i.tiltY&&(i.tiltY=0),void 0===i.pointerType&&(i.pointerType="mouse"),void 0===i.pointerId&&(i.pointerId=1),void 0===i.pressure&&(i.pressure=.5),void 0===i.twist&&(i.twist=0),void 0===i.tangentialPressure&&(i.tangentialPressure=0),i.isNormalized=!0,e.push(i)}return e}normalizeWheelEvent(t){const e=this.rootWheelEvent;return this.transferMouseData(e,t),e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ,e.deltaMode=t.deltaMode,this.mapPositionToPoint(e.screen,t.clientX,t.clientY),e.global.copyFrom(e.screen),e.offset.copyFrom(e.screen),e.nativeEvent=t,e.type=t.type,e}bootstrapEvent(t,e){return t.originalEvent=null,t.nativeEvent=e,t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist,this.transferMouseData(t,e),this.mapPositionToPoint(t.screen,e.clientX,e.clientY),t.global.copyFrom(t.screen),t.offset.copyFrom(t.screen),t.isTrusted=e.isTrusted,"pointerleave"===t.type&&(t.type="pointerout"),t.type.startsWith("mouse")&&(t.type=t.type.replace("mouse","pointer")),t.type.startsWith("touch")&&(t.type=$s[t.type]||t.type),t}transferMouseData(t,e){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=performance.now(),t.type=e.type,t.altKey=e.altKey,t.button=e.button,t.buttons=e.buttons,t.client.x=e.clientX,t.client.y=e.clientY,t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.movement.x=e.movementX,t.movement.y=e.movementY,t.page.x=e.pageX,t.page.y=e.pageY,t.relatedTarget=null,t.shiftKey=e.shiftKey}};let Ks=qs;function Zs(t){return"dynamic"===t||"static"===t}Ks.extension={name:"events",type:[_i.RendererSystem,_i.CanvasRendererSystem]},Ks.defaultEventFeatures={move:!0,globalMove:!0,click:!0,wheel:!0},wi.add(Ks);const Js={onclick:null,onmousedown:null,onmouseenter:null,onmouseleave:null,onmousemove:null,onglobalmousemove:null,onmouseout:null,onmouseover:null,onmouseup:null,onmouseupoutside:null,onpointercancel:null,onpointerdown:null,onpointerenter:null,onpointerleave:null,onpointermove:null,onglobalpointermove:null,onpointerout:null,onpointerover:null,onpointertap:null,onpointerup:null,onpointerupoutside:null,onrightclick:null,onrightdown:null,onrightup:null,onrightupoutside:null,ontap:null,ontouchcancel:null,ontouchend:null,ontouchendoutside:null,ontouchmove:null,onglobaltouchmove:null,ontouchstart:null,onwheel:null,_internalInteractive:void 0,get interactive(){return this._internalInteractive??Zs(Ks.defaultEventMode)},set interactive(t){_e("7.2.0","Setting interactive is deprecated, use eventMode = 'none'/'passive'/'auto'/'static'/'dynamic' instead."),this._internalInteractive=t,this.eventMode=t?"static":"auto"},_internalEventMode:void 0,get eventMode(){return this._internalEventMode??Ks.defaultEventMode},set eventMode(t){this._internalInteractive=Zs(t),this._internalEventMode=t},isInteractive(){return"static"===this.eventMode||"dynamic"===this.eventMode},interactiveChildren:!0,hitArea:null,addEventListener(t,e,i){const n="function"==typeof e?void 0:e;t="boolean"==typeof i&&i||"object"==typeof i&&i.capture?`${t}capture`:t,e="function"==typeof e?e:e.handleEvent,this.on(t,e,n)},removeEventListener(t,e,i){const n="function"==typeof e?void 0:e;t="boolean"==typeof i&&i||"object"==typeof i&&i.capture?`${t}capture`:t,e="function"==typeof e?e:e.handleEvent,this.off(t,e,n)},dispatchEvent(t){if(!(t instanceof zs))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");return t.defaultPrevented=!1,t.path=null,t.target=this,t.manager.dispatchEvent(t),!t.defaultPrevented}};Es.mixin(Js);Es.mixin({accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,renderId:-1});class Qs{constructor(t){this.debug=!1,this._isActive=!1,this._isMobileAccessibility=!1,this.pool=[],this.renderId=0,this.children=[],this.androidUpdateCount=0,this.androidUpdateFrequency=500,this._hookDiv=null,(X.tablet||X.phone)&&this.createTouchHook();const e=document.createElement("div");e.style.width="100px",e.style.height="100px",e.style.position="absolute",e.style.top="0px",e.style.left="0px",e.style.zIndex=2..toString(),this.div=e,this.renderer=t,this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)}get isActive(){return this._isActive}get isMobileAccessibility(){return this._isMobileAccessibility}createTouchHook(){const t=document.createElement("button");t.style.width="1px",t.style.height="1px",t.style.position="absolute",t.style.top="-1000px",t.style.left="-1000px",t.style.zIndex=2..toString(),t.style.backgroundColor="#FF0000",t.title="select to enable accessibility for this content",t.addEventListener("focus",(()=>{this._isMobileAccessibility=!0,this.activate(),this.destroyTouchHook()})),document.body.appendChild(t),this._hookDiv=t}destroyTouchHook(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)}activate(){this._isActive||(this._isActive=!0,globalThis.document.addEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),this.renderer.view.parentNode?.appendChild(this.div))}deactivate(){this._isActive&&!this._isMobileAccessibility&&(this._isActive=!1,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),this.div.parentNode?.removeChild(this.div))}updateAccessibleObjects(t){if(!t.visible||!t.accessibleChildren)return;t.accessible&&t.isInteractive()&&(t._accessibleActive||this.addChild(t),t.renderId=this.renderId);const e=t.children;if(e)for(let t=0;t<e.length;t++)this.updateAccessibleObjects(e[t])}update(){const t=performance.now();if(X.android.device&&t<this.androidUpdateCount)return;if(this.androidUpdateCount=t+this.androidUpdateFrequency,!this.renderer.renderingToScreen)return;this.renderer.lastObjectRendered&&this.updateAccessibleObjects(this.renderer.lastObjectRendered);const{x:e,y:i,width:n,height:r}=this.renderer.view.getBoundingClientRect(),{width:s,height:o,resolution:a}=this.renderer,h=n/s*a,l=r/o*a;let u=this.div;u.style.left=`${e}px`,u.style.top=`${i}px`,u.style.width=`${s}px`,u.style.height=`${o}px`;for(let t=0;t<this.children.length;t++){const e=this.children[t];if(e.renderId!==this.renderId)e._accessibleActive=!1,ni(this.children,t,1),this.div.removeChild(e._accessibleDiv),this.pool.push(e._accessibleDiv),e._accessibleDiv=null,t--;else{u=e._accessibleDiv;let t=e.hitArea;const i=e.worldTransform;e.hitArea?(u.style.left=(i.tx+t.x*i.a)*h+"px",u.style.top=(i.ty+t.y*i.d)*l+"px",u.style.width=t.width*i.a*h+"px",u.style.height=t.height*i.d*l+"px"):(t=e.getBounds(),this.capHitArea(t),u.style.left=t.x*h+"px",u.style.top=t.y*l+"px",u.style.width=t.width*h+"px",u.style.height=t.height*l+"px",u.title!==e.accessibleTitle&&null!==e.accessibleTitle&&(u.title=e.accessibleTitle),u.getAttribute("aria-label")!==e.accessibleHint&&null!==e.accessibleHint&&u.setAttribute("aria-label",e.accessibleHint)),e.accessibleTitle===u.title&&e.tabIndex===u.tabIndex||(u.title=e.accessibleTitle,u.tabIndex=e.tabIndex,this.debug&&this.updateDebugHTML(u))}}this.renderId++}updateDebugHTML(t){t.innerHTML=`type: ${t.type}</br> title : ${t.title}</br> tabIndex: ${t.tabIndex}`}capHitArea(t){t.x<0&&(t.width+=t.x,t.x=0),t.y<0&&(t.height+=t.y,t.y=0);const{width:e,height:i}=this.renderer;t.x+t.width>e&&(t.width=e-t.x),t.y+t.height>i&&(t.height=i-t.y)}addChild(t){let e=this.pool.pop();e||(e=document.createElement("button"),e.style.width="100px",e.style.height="100px",e.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",e.style.position="absolute",e.style.zIndex=2..toString(),e.style.borderStyle="none",navigator.userAgent.toLowerCase().includes("chrome")?e.setAttribute("aria-live","off"):e.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?e.setAttribute("aria-relevant","additions"):e.setAttribute("aria-relevant","text"),e.addEventListener("click",this._onClick.bind(this)),e.addEventListener("focus",this._onFocus.bind(this)),e.addEventListener("focusout",this._onFocusOut.bind(this))),e.style.pointerEvents=t.accessiblePointerEvents,e.type=t.accessibleType,t.accessibleTitle&&null!==t.accessibleTitle?e.title=t.accessibleTitle:t.accessibleHint&&null!==t.accessibleHint||(e.title=`displayObject ${t.tabIndex}`),t.accessibleHint&&null!==t.accessibleHint&&e.setAttribute("aria-label",t.accessibleHint),this.debug&&this.updateDebugHTML(e),t._accessibleActive=!0,t._accessibleDiv=e,e.displayObject=t,this.children.push(t),this.div.appendChild(t._accessibleDiv),t._accessibleDiv.tabIndex=t.tabIndex}_dispatchEvent(t,e){const{displayObject:i}=t.target,n=this.renderer.events.rootBoundary,r=Object.assign(new zs(n),{target:i});n.rootTarget=this.renderer.lastObjectRendered,e.forEach((t=>n.dispatchEvent(r,t)))}_onClick(t){this._dispatchEvent(t,["click","pointertap","tap"])}_onFocus(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","assertive"),this._dispatchEvent(t,["mouseover"])}_onFocusOut(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","polite"),this._dispatchEvent(t,["mouseout"])}_onKeyDown(t){9===t.keyCode&&this.activate()}_onMouseMove(t){0===t.movementX&&0===t.movementY||this.deactivate()}destroy(){this.destroyTouchHook(),this.div=null,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null}}Qs.extension={name:"accessibility",type:[_i.RendererPlugin,_i.CanvasRendererPlugin]},wi.add(Qs);const to=class{constructor(t){this.stage=new Ms,t=Object.assign({forceCanvas:!1},t),this.renderer=function(t){for(const e of as)if(e.test(t))return new e(t);throw new Error("Unable to auto-detect a suitable renderer.")}(t),to._plugins.forEach((e=>{e.init.call(this,t)}))}render(){this.renderer.render(this.stage)}get view(){return this.renderer.view}get screen(){return this.renderer.screen}destroy(t,e){const i=to._plugins.slice(0);i.reverse(),i.forEach((t=>{t.destroy.call(this)})),this.stage.destroy(e),this.stage=null,this.renderer.destroy(t),this.renderer=null}};let eo=to;eo._plugins=[],wi.handleByList(_i.Application,eo._plugins);class io{static init(t){Object.defineProperty(this,"resizeTo",{set(t){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=t,t&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this.cancelResize(),this._resizeId=requestAnimationFrame((()=>this.resize())))},this.cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;let t,e;if(this.cancelResize(),this._resizeTo===globalThis.window)t=globalThis.innerWidth,e=globalThis.innerHeight;else{const{clientWidth:i,clientHeight:n}=this._resizeTo;t=i,e=n}this.renderer.resize(t,e),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=t.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}io.extension=_i.Application,wi.add(io);const no={loader:_i.LoadParser,resolver:_i.ResolveParser,cache:_i.CacheParser,detection:_i.DetectionParser};wi.handle(_i.Asset,(t=>{const e=t.ref;Object.entries(no).filter((([t])=>!!e[t])).forEach((([t,i])=>wi.add(Object.assign(e[t],{extension:e[t].extension??i}))))}),(t=>{const e=t.ref;Object.keys(no).filter((t=>!!e[t])).forEach((t=>wi.remove(e[t])))}));class ro{constructor(t,e=!1){this._loader=t,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=e}add(t){t.forEach((t=>{this._assetList.push(t)})),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;const t=[],e=Math.min(this._assetList.length,this._maxConcurrent);for(let i=0;i<e;i++)t.push(this._assetList.pop());await this._loader.load(t),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(t){this._isActive!==t&&(this._isActive=t,t&&!this._isLoading&&this._next())}}function so(t,e){if(Array.isArray(e)){for(const i of e)if(t.startsWith(`data:${i}`))return!0;return!1}return t.startsWith(`data:${e}`)}function oo(t,e){const i=t.split("?")[0],n=ve.extname(i).toLowerCase();return Array.isArray(e)?e.includes(n):n===e}const ao=(t,e)=>(Array.isArray(t)||(t=[t]),e?t.map((t=>"string"==typeof t?e(t):t)):t),ho=(t,e)=>{const i=e.split("?")[1];return i&&(t+=`?${i}`),t};function lo(t,e,i,n,r){const s=e[i];for(let o=0;o<s.length;o++){const a=s[o];i<e.length-1?lo(t.replace(n[i],a),e,i+1,n,r):r.push(t.replace(n[i],a))}}function uo(t){const e=t.match(/\{(.*?)\}/g),i=[];if(e){const n=[];e.forEach((t=>{const e=t.substring(1,t.length-1).split(",");n.push(e)})),lo(t,n,0,e,i)}else i.push(t);return i}const co=t=>!Array.isArray(t);const po=new class{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(t){return this._cache.has(t)}get(t){const e=this._cache.get(t);return e||console.warn(`[Assets] Asset id ${t} was not found in the Cache`),e}set(t,e){const i=ao(t);let n;for(let t=0;t<this.parsers.length;t++){const r=this.parsers[t];if(r.test(e)){n=r.getCacheableAssets(i,e);break}}n||(n={},i.forEach((t=>{n[t]=e})));const r=Object.keys(n),s={cacheKeys:r,keys:i};if(i.forEach((t=>{this._cacheMap.set(t,s)})),r.forEach((t=>{this._cache.has(t)&&this._cache.get(t)!==e&&console.warn("[Cache] already has key:",t),this._cache.set(t,n[t])})),e instanceof sr){const t=e;i.forEach((e=>{t.baseTexture!==sr.EMPTY.baseTexture&&Li.addToCache(t.baseTexture,e),sr.addToCache(t,e)}))}}remove(t){if(this._cacheMap.get(t),!this._cacheMap.has(t))return void console.warn(`[Assets] Asset id ${t} was not found in the Cache`);const e=this._cacheMap.get(t);e.cacheKeys.forEach((t=>{this._cache.delete(t)})),e.keys.forEach((t=>{this._cacheMap.delete(t)}))}get parsers(){return this._parsers}};class fo{constructor(){this._parsers=[],this._parsersValidated=!1,this.parsers=new Proxy(this._parsers,{set:(t,e,i)=>(this._parsersValidated=!1,t[e]=i,!0)}),this.promiseCache={}}reset(){this._parsersValidated=!1,this.promiseCache={}}_getLoadPromiseAndParser(t,e){const i={promise:null,parser:null};return i.promise=(async()=>{let n=null,r=null;if(e.loadParser&&(r=this._parserHash[e.loadParser],r||console.warn(`[Assets] specified load parser "${e.loadParser}" not found while loading ${t}`)),!r){for(let i=0;i<this.parsers.length;i++){const n=this.parsers[i];if(n.load&&n.test?.(t,e,this)){r=n;break}}if(!r)return console.warn(`[Assets] ${t} could not be loaded as we don't know how to parse it, ensure the correct parser has been added`),null}n=await r.load(t,e,this),i.parser=r;for(let t=0;t<this.parsers.length;t++){const r=this.parsers[t];r.parse&&r.parse&&await(r.testParse?.(n,e,this))&&(n=await r.parse(n,e,this)||n,i.parser=r)}return n})(),i}async load(t,e){this._parsersValidated||this._validateParsers();let i=0;const n={},r=co(t),s=ao(t,(t=>({src:t}))),o=s.length,a=s.map((async t=>{const r=ve.toAbsolute(t.src);if(!n[t.src])try{this.promiseCache[r]||(this.promiseCache[r]=this._getLoadPromiseAndParser(r,t)),n[t.src]=await this.promiseCache[r].promise,e&&e(++i/o)}catch(e){throw delete this.promiseCache[r],delete n[t.src],new Error(`[Loader.load] Failed to load ${r}.\n${e}`)}}));return await Promise.all(a),r?n[s[0].src]:n}async unload(t){const e=ao(t,(t=>({src:t}))).map((async t=>{const e=ve.toAbsolute(t.src),i=this.promiseCache[e];if(i){const n=await i.promise;i.parser?.unload?.(n,t,this),delete this.promiseCache[e]}}));await Promise.all(e)}_validateParsers(){this._parsersValidated=!0,this._parserHash=this._parsers.filter((t=>t.name)).reduce(((t,e)=>(t[e.name]&&console.warn(`[Assets] loadParser name conflict "${e.name}"`),{...t,[e.name]:e})),{})}}var go=(t=>(t[t.Low=0]="Low",t[t.Normal=1]="Normal",t[t.High=2]="High",t))(go||{});const mo={extension:{type:_i.LoadParser,priority:go.Low},name:"loadJson",test:t=>so(t,"application/json")||oo(t,".json"),async load(t){const e=await C.ADAPTER.fetch(t);return await e.json()}};wi.add(mo);const vo={name:"loadTxt",extension:{type:_i.LoadParser,priority:go.Low},test:t=>so(t,"text/plain")||oo(t,".txt"),async load(t){const e=await C.ADAPTER.fetch(t);return await e.text()}};wi.add(vo);const yo=["normal","bold","100","200","300","400","500","600","700","800","900"],_o=[".ttf",".otf",".woff",".woff2"],xo=["font/ttf","font/otf","font/woff","font/woff2"],bo=/^(--|-?[A-Z_])[0-9A-Z_-]*$/i;const wo={extension:{type:_i.LoadParser,priority:go.Low},name:"loadWebFont",test:t=>so(t,xo)||oo(t,_o),async load(t,e){const i=C.ADAPTER.getFontFaceSet();if(i){const n=[],r=e.data?.family??function(t){const e=ve.extname(t),i=ve.basename(t,e).replace(/(-|_)/g," ").toLowerCase().split(" ").map((t=>t.charAt(0).toUpperCase()+t.slice(1)));let n=i.length>0;for(const t of i)if(!t.match(bo)){n=!1;break}let r=i.join(" ");return n||(r=`"${r.replace(/[\\"]/g,"\\$&")}"`),r}(t),s=e.data?.weights?.filter((t=>yo.includes(t)))??["normal"],o=e.data??{};for(let e=0;e<s.length;e++){const a=s[e],h=new FontFace(r,`url(${encodeURI(t)})`,{...o,weight:a});await h.load(),i.add(h),n.push(h)}return 1===n.length?n[0]:n}return console.warn("[loadWebFont] FontFace API is not supported. Skipping loading font"),null},unload(t){(Array.isArray(t)?t:[t]).forEach((t=>C.ADAPTER.getFontFaceSet().delete(t)))}};wi.add(wo);let To,Eo=0;const Ao={id:"checkImageBitmap",code:"\n    async function checkImageBitmap()\n    {\n        try\n        {\n            if (typeof createImageBitmap !== 'function') return false;\n\n            const response = await fetch('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=');\n            const imageBlob =  await response.blob();\n            const imageBitmap = await createImageBitmap(imageBlob);\n\n            return imageBitmap.width === 1 && imageBitmap.height === 1;\n        }\n        catch (e)\n        {\n            return false;\n        }\n    }\n    checkImageBitmap().then((result) => { self.postMessage(result); });\n    "},So={id:"loadImageBitmap",code:"\n    async function loadImageBitmap(url)\n    {\n        const response = await fetch(url);\n\n        if (!response.ok)\n        {\n            throw new Error(`[WorkerManager.loadImageBitmap] Failed to fetch ${url}: `\n                + `${response.status} ${response.statusText}`);\n        }\n\n        const imageBlob =  await response.blob();\n        const imageBitmap = await createImageBitmap(imageBlob);\n\n        return imageBitmap;\n    }\n    self.onmessage = async (event) =>\n    {\n        try\n        {\n            const imageBitmap = await loadImageBitmap(event.data.data[0]);\n\n            self.postMessage({\n                data: imageBitmap,\n                uuid: event.data.uuid,\n                id: event.data.id,\n            }, [imageBitmap]);\n        }\n        catch(e)\n        {\n            self.postMessage({\n                error: e,\n                uuid: event.data.uuid,\n                id: event.data.id,\n            });\n        }\n    };"};let Co;const Io=new class{constructor(){this._initialized=!1,this._createdWorkers=0,this.workerPool=[],this.queue=[],this.resolveHash={}}isImageBitmapSupported(){return void 0!==this._isImageBitmapSupported||(this._isImageBitmapSupported=new Promise((t=>{const e=URL.createObjectURL(new Blob([Ao.code],{type:"application/javascript"})),i=new Worker(e);i.addEventListener("message",(n=>{i.terminate(),URL.revokeObjectURL(e),t(n.data)}))}))),this._isImageBitmapSupported}loadImageBitmap(t){return this._run("loadImageBitmap",[t])}async _initWorkers(){this._initialized||(this._initialized=!0)}getWorker(){void 0===To&&(To=navigator.hardwareConcurrency||4);let t=this.workerPool.pop();return!t&&this._createdWorkers<To&&(Co||(Co=URL.createObjectURL(new Blob([So.code],{type:"application/javascript"}))),this._createdWorkers++,t=new Worker(Co),t.addEventListener("message",(t=>{this.complete(t.data),this.returnWorker(t.target),this.next()}))),t}returnWorker(t){this.workerPool.push(t)}complete(t){void 0!==t.error?this.resolveHash[t.uuid].reject(t.error):this.resolveHash[t.uuid].resolve(t.data),this.resolveHash[t.uuid]=null}async _run(t,e){await this._initWorkers();const i=new Promise(((i,n)=>{this.queue.push({id:t,arguments:e,resolve:i,reject:n})}));return this.next(),i}next(){if(!this.queue.length)return;const t=this.getWorker();if(!t)return;const e=this.queue.pop(),i=e.id;this.resolveHash[Eo]={resolve:e.resolve,reject:e.reject},t.postMessage({data:e.arguments,uuid:Eo++,id:i})}};function Mo(t,e,i){const n=new sr(t);return n.baseTexture.on("dispose",(()=>{delete e.promiseCache[i]})),n}const Ro=[".jpeg",".jpg",".png",".webp",".avif"],Po=["image/jpeg","image/png","image/webp","image/avif"];const Do={name:"loadTextures",extension:{type:_i.LoadParser,priority:go.High},config:{preferWorkers:!0,preferCreateImageBitmap:!0,crossOrigin:"anonymous"},test:t=>so(t,Po)||oo(t,Ro),async load(t,e,i){let n=null;n=globalThis.createImageBitmap&&this.config.preferCreateImageBitmap?this.config.preferWorkers&&await Io.isImageBitmapSupported()?await Io.loadImageBitmap(t):await async function(t){const e=await C.ADAPTER.fetch(t);if(!e.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${t}: ${e.status} ${e.statusText}`);const i=await e.blob();return await createImageBitmap(i)}(t):await new Promise((e=>{n=new Image,n.crossOrigin=this.config.crossOrigin,n.src=t,n.complete?e(n):n.onload=()=>{e(n)}}));const r=new Li(n,{resolution:yi(t),...e.data});return r.resource.src=t,Mo(r,i,t)},unload(t){t.destroy(!0)}};wi.add(Do);const Oo={extension:{type:_i.LoadParser,priority:go.High},name:"loadSVG",test:t=>so(t,"image/svg+xml")||oo(t,".svg"),testParse:async t=>xs.test(t),async parse(t,e,i){const n=new xs(t,e?.data?.resourceOptions);await n.load();const r=new Li(n,{resolution:yi(t),...e?.data});r.resource.src=t;return Mo(r,i,t)},load:async(t,e)=>(await C.ADAPTER.fetch(t)).text(),unload:Do.unload};wi.add(Oo);class Lo{constructor(){this._defaultBundleIdentifierOptions={connector:"-",createBundleAssetId:(t,e)=>`${t}${this._bundleIdConnector}${e}`,extractAssetIdFromBundle:(t,e)=>e.replace(`${t}${this._bundleIdConnector}`,"")},this._bundleIdConnector=this._defaultBundleIdentifierOptions.connector,this._createBundleAssetId=this._defaultBundleIdentifierOptions.createBundleAssetId,this._extractAssetIdFromBundle=this._defaultBundleIdentifierOptions.extractAssetIdFromBundle,this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(t){if(this._bundleIdConnector=t.connector??this._bundleIdConnector,this._createBundleAssetId=t.createBundleAssetId??this._createBundleAssetId,this._extractAssetIdFromBundle=t.extractAssetIdFromBundle??this._extractAssetIdFromBundle,"bar"!==this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar")))throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...t){t.forEach((t=>{this._preferredOrder.push(t),t.priority||(t.priority=Object.keys(t.params))})),this._resolverHash={}}set basePath(t){this._basePath=t}get basePath(){return this._basePath}set rootPath(t){this._rootPath=t}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this.setBundleIdentifier(this._defaultBundleIdentifierOptions),this._assetMap={},this._preferredOrder=[],this._resolverHash={},this._rootPath=null,this._basePath=null,this._manifest=null,this._bundles={},this._defaultSearchParams=null}setDefaultSearchParams(t){if("string"==typeof t)this._defaultSearchParams=t;else{const e=t;this._defaultSearchParams=Object.keys(e).map((t=>`${encodeURIComponent(t)}=${encodeURIComponent(e[t])}`)).join("&")}}addManifest(t){this._manifest&&console.warn("[Resolver] Manifest already exists, this will be overwritten"),this._manifest=t,t.bundles.forEach((t=>{this.addBundle(t.name,t.assets)}))}addBundle(t,e){const i=[];Array.isArray(e)?e.forEach((e=>{if("string"==typeof e.name){const n=this._createBundleAssetId(t,e.name);i.push(n),this.add([e.name,n],e.srcs,e.data)}else{const n=e.name.map((e=>this._createBundleAssetId(t,e)));n.forEach((t=>{i.push(t)})),this.add([...e.name,...n],e.srcs)}})):Object.keys(e).forEach((n=>{i.push(this._createBundleAssetId(t,n)),this.add([n,this._createBundleAssetId(t,n)],e[n])})),this._bundles[t]=i}add(t,e,i){const n=ao(t);n.forEach((t=>{this.hasKey(t)&&console.warn(`[Resolver] already has key: ${t} overwriting`)})),Array.isArray(e)||(e="string"==typeof e?uo(e):[e]);const r=e.map((t=>{let e=t;if("string"==typeof t){let i=!1;for(let n=0;n<this._parsers.length;n++){const r=this._parsers[n];if(r.test(t)){e=r.parse(t),i=!0;break}}i||(e={src:t})}return e.format||(e.format=e.src.split(".").pop()),e.alias||(e.alias=n),(this._basePath||this._rootPath)&&(e.src=ve.toAbsolute(e.src,this._basePath,this._rootPath)),e.src=this._appendDefaultSearchParams(e.src),e.data=e.data??i,e}));n.forEach((t=>{this._assetMap[t]=r}))}resolveBundle(t){const e=co(t);t=ao(t);const i={};return t.forEach((t=>{const e=this._bundles[t];if(e){const n=this.resolve(e),r={};for(const e in n){const i=n[e];r[this._extractAssetIdFromBundle(t,e)]=i}i[t]=r}})),e?i[t[0]]:i}resolveUrl(t){const e=this.resolve(t);if("string"!=typeof t){const t={};for(const i in e)t[i]=e[i].src;return t}return e.src}resolve(t){const e=co(t);t=ao(t);const i={};return t.forEach((t=>{if(!this._resolverHash[t])if(this._assetMap[t]){let e=this._assetMap[t];const i=this._getPreferredOrder(e),n=e[0];i?.priority.forEach((t=>{i.params[t].forEach((i=>{const n=e.filter((e=>!!e[t]&&e[t]===i));n.length&&(e=n)}))})),this._resolverHash[t]=e[0]??n}else{let e=t;(this._basePath||this._rootPath)&&(e=ve.toAbsolute(e,this._basePath,this._rootPath)),e=this._appendDefaultSearchParams(e),this._resolverHash[t]={src:e}}i[t]=this._resolverHash[t]})),e?i[t[0]]:i}hasKey(t){return!!this._assetMap[t]}hasBundle(t){return!!this._bundles[t]}_getPreferredOrder(t){for(let e=0;e<t.length;e++){const e=t[0],i=this._preferredOrder.find((t=>t.params.format.includes(e.format)));if(i)return i}return this._preferredOrder[0]}_appendDefaultSearchParams(t){if(!this._defaultSearchParams)return t;return`${t}${/\?/.test(t)?"&":"?"}${this._defaultSearchParams}`}}const No=new class{constructor(){this._detections=[],this._initialized=!1,this.resolver=new Lo,this.loader=new fo,this.cache=po,this._backgroundLoader=new ro(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(t={}){if(this._initialized)return void console.warn("[Assets]AssetManager already initialized, did you load before calling this Asset.init()?");if(this._initialized=!0,t.defaultSearchParams&&this.resolver.setDefaultSearchParams(t.defaultSearchParams),t.basePath&&(this.resolver.basePath=t.basePath),t.bundleIdentifier&&this.resolver.setBundleIdentifier(t.bundleIdentifier),t.manifest){let e=t.manifest;"string"==typeof e&&(e=await this.load(e)),this.resolver.addManifest(e)}const e=t.texturePreference?.resolution??1,i="number"==typeof e?[e]:e;let n=[];if(t.texturePreference?.format){const e=t.texturePreference?.format;n="string"==typeof e?[e]:e;for(const t of this._detections)await t.test()||(n=await t.remove(n))}else for(const t of this._detections)await t.test()&&(n=await t.add(n));this.resolver.prefer({params:{format:n,resolution:i}}),t.preferences&&this.setPreferences(t.preferences)}add(t,e,i){this.resolver.add(t,e,i)}async load(t,e){this._initialized||await this.init();const i=co(t),n=ao(t).map((t=>"string"!=typeof t?(this.resolver.add(t.src,t),t.src):(this.resolver.hasKey(t)||this.resolver.add(t,t),t))),r=this.resolver.resolve(n),s=await this._mapLoadToResolve(r,e);return i?s[n[0]]:s}addBundle(t,e){this.resolver.addBundle(t,e)}async loadBundle(t,e){this._initialized||await this.init();let i=!1;"string"==typeof t&&(i=!0,t=[t]);const n=this.resolver.resolveBundle(t),r={},s=Object.keys(n);let o=0,a=0;const h=()=>{e?.(++o/a)},l=s.map((t=>{const e=n[t];return a+=Object.keys(e).length,this._mapLoadToResolve(e,h).then((e=>{r[t]=e}))}));return await Promise.all(l),i?r[t[0]]:r}async backgroundLoad(t){this._initialized||await this.init(),"string"==typeof t&&(t=[t]);const e=this.resolver.resolve(t);this._backgroundLoader.add(Object.values(e))}async backgroundLoadBundle(t){this._initialized||await this.init(),"string"==typeof t&&(t=[t]);const e=this.resolver.resolveBundle(t);Object.values(e).forEach((t=>{this._backgroundLoader.add(Object.values(t))}))}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(t){if("string"==typeof t)return po.get(t);const e={};for(let i=0;i<t.length;i++)e[i]=po.get(t[i]);return e}async _mapLoadToResolve(t,e){const i=Object.values(t),n=Object.keys(t);this._backgroundLoader.active=!1;const r=await this.loader.load(i,e);this._backgroundLoader.active=!0;const s={};return i.forEach(((t,e)=>{const i=r[t.src],o=[t.src];t.alias&&o.push(...t.alias),s[n[e]]=i,po.set(o,i)})),s}async unload(t){this._initialized||await this.init();const e=ao(t).map((t=>"string"!=typeof t?t.src:t)),i=this.resolver.resolve(e);await this._unloadFromResolved(i)}async unloadBundle(t){this._initialized||await this.init(),t=ao(t);const e=this.resolver.resolveBundle(t),i=Object.keys(e).map((t=>this._unloadFromResolved(e[t])));await Promise.all(i)}async _unloadFromResolved(t){const e=Object.values(t);e.forEach((t=>{po.remove(t.src)})),await this.loader.unload(e)}get detections(){return this._detections}get preferWorkers(){return Do.config.preferWorkers}set preferWorkers(t){_e("7.2.0","Assets.prefersWorkers is deprecated, use Assets.setPreferences({ preferWorkers: true }) instead."),this.setPreferences({preferWorkers:t})}setPreferences(t){this.loader.parsers.forEach((e=>{e.config&&Object.keys(e.config).filter((e=>e in t)).forEach((i=>{e.config[i]=t[i]}))}))}};wi.handleByList(_i.LoadParser,No.loader.parsers).handleByList(_i.ResolveParser,No.resolver.parsers).handleByList(_i.CacheParser,No.cache.parsers).handleByList(_i.DetectionParser,No.detections);const Bo={extension:_i.CacheParser,test:t=>Array.isArray(t)&&t.every((t=>t instanceof sr)),getCacheableAssets:(t,e)=>{const i={};return t.forEach((t=>{e.forEach(((e,n)=>{i[t+(0===n?"":n+1)]=e}))})),i}};wi.add(Bo);const ko={extension:{type:_i.DetectionParser,priority:1},test:async()=>{if(!globalThis.createImageBitmap)return!1;const t=await C.ADAPTER.fetch("data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A=").then((t=>t.blob()));return createImageBitmap(t).then((()=>!0),(()=>!1))},add:async t=>[...t,"avif"],remove:async t=>t.filter((t=>"avif"!==t))};wi.add(ko);const Fo={extension:{type:_i.DetectionParser,priority:0},test:async()=>{if(!globalThis.createImageBitmap)return!1;const t=await C.ADAPTER.fetch("data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA=").then((t=>t.blob()));return createImageBitmap(t).then((()=>!0),(()=>!1))},add:async t=>[...t,"webp"],remove:async t=>t.filter((t=>"webp"!==t))};wi.add(Fo);const Uo=["png","jpg","jpeg"],Go={extension:{type:_i.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async t=>[...t,...Uo],remove:async t=>t.filter((t=>!Uo.includes(t)))};wi.add(Go);const zo={extension:_i.ResolveParser,test:Do.test,parse:t=>({resolution:parseFloat(C.RETINA_PREFIX.exec(t)?.[1]??"1"),format:t.split(".").pop(),src:t})};wi.add(zo);var jo=(t=>(t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",t[t.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",t[t.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",t))(jo||{});const Ho={33776:.5,33777:.5,33778:1,33779:1,35916:.5,35917:.5,35918:1,35919:1,37488:.5,37489:.5,37490:1,37491:1,37492:.5,37496:1,37493:.5,37497:1,37494:.5,37495:.5,35840:.5,35842:.5,35841:.25,35843:.25,36196:.5,35986:.5,35986:1,34798:1,37808:1};let Wo,Xo;function Vo(){Xo={s3tc:Wo.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:Wo.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:Wo.getExtension("WEBGL_compressed_texture_etc"),etc1:Wo.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:Wo.getExtension("WEBGL_compressed_texture_pvrtc")||Wo.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:Wo.getExtension("WEBGL_compressed_texture_atc"),astc:Wo.getExtension("WEBGL_compressed_texture_astc")}}const Yo={extension:{type:_i.DetectionParser,priority:2},test:async()=>{const t=C.ADAPTER.createCanvas().getContext("webgl");return t?(Wo=t,!0):(console.warn("WebGL not available for compressed textures."),!1)},add:async t=>{Xo||Vo();const e=[];for(const t in Xo){Xo[t]&&e.push(t)}return[...e,...t]},remove:async t=>(Xo||Vo(),t.filter((t=>!(t in Xo))))};wi.add(Yo);class $o extends Pi{constructor(t,e={width:1,height:1,autoLoad:!0}){let i,n;"string"==typeof t?(i=t,n=new Uint8Array):(i=null,n=t),super(n,e),this.origin=i,this.buffer=n?new Ti(n):null,this._load=null,this.loaded=!1,null!==this.origin&&!1!==e.autoLoad&&this.load(),null===this.origin&&this.buffer&&(this._load=Promise.resolve(this),this.loaded=!0,this.onBlobLoaded(this.buffer.rawBinaryData))}onBlobLoaded(t){}load(){return this._load||(this._load=fetch(this.origin).then((t=>t.blob())).then((t=>t.arrayBuffer())).then((t=>(this.data=new Uint32Array(t),this.buffer=new Ti(t),this.loaded=!0,this.onBlobLoaded(t),this.update(),this)))),this._load}}class qo extends $o{constructor(t,e){super(t,e),this.format=e.format,this.levels=e.levels||1,this._width=e.width,this._height=e.height,this._extension=qo._formatToExtension(this.format),(e.levelBuffers||this.buffer)&&(this._levelBuffers=e.levelBuffers||qo._createLevelBuffers(t instanceof Uint8Array?t:this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height))}upload(t,e,i){const n=t.gl;if(!t.context.extensions[this._extension])throw new Error(`${this._extension} textures are not supported on the current machine`);if(!this._levelBuffers)return!1;for(let t=0,e=this.levels;t<e;t++){const{levelID:e,levelWidth:i,levelHeight:r,levelBuffer:s}=this._levelBuffers[t];n.compressedTexImage2D(n.TEXTURE_2D,e,this.format,i,r,0,s)}return!0}onBlobLoaded(){this._levelBuffers=qo._createLevelBuffers(this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height)}static _formatToExtension(t){if(t>=33776&&t<=33779)return"s3tc";if(t>=37488&&t<=37497)return"etc";if(t>=35840&&t<=35843)return"pvrtc";if(t>=36196)return"etc1";if(t>=35986&&t<=34798)return"atc";throw new Error("Invalid (compressed) texture format given!")}static _createLevelBuffers(t,e,i,n,r,s,o){const a=new Array(i);let h=t.byteOffset,l=s,u=o,c=l+n-1&~(n-1),d=u+r-1&~(r-1),p=c*d*Ho[e];for(let s=0;s<i;s++)a[s]={levelID:s,levelWidth:i>1?l:c,levelHeight:i>1?u:d,levelBuffer:new Uint8Array(t.buffer,h,p)},h+=p,l=l>>1||1,u=u>>1||1,c=l+n-1&~(n-1),d=u+r-1&~(r-1),p=c*d*Ho[e];return a}}const Ko=124,Zo=3,Jo=4,Qo=7,ta=19,ea=2,ia=0,na=1,ra=2,sa=3,oa={827611204:jo.COMPRESSED_RGBA_S3TC_DXT1_EXT,861165636:jo.COMPRESSED_RGBA_S3TC_DXT3_EXT,894720068:jo.COMPRESSED_RGBA_S3TC_DXT5_EXT},aa={70:jo.COMPRESSED_RGBA_S3TC_DXT1_EXT,71:jo.COMPRESSED_RGBA_S3TC_DXT1_EXT,73:jo.COMPRESSED_RGBA_S3TC_DXT3_EXT,74:jo.COMPRESSED_RGBA_S3TC_DXT3_EXT,76:jo.COMPRESSED_RGBA_S3TC_DXT5_EXT,77:jo.COMPRESSED_RGBA_S3TC_DXT5_EXT,72:jo.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,75:jo.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,78:jo.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT};const ha=[171,75,84,88,32,49,49,187,13,10,26,10],la=12,ua=16,ca=24,da=28,pa=36,fa=40,ga=44,ma=48,va=52,ya=56,_a=60,xa=64,ba={[f.UNSIGNED_BYTE]:1,[f.UNSIGNED_SHORT]:2,[f.INT]:4,[f.UNSIGNED_INT]:4,[f.FLOAT]:4,[f.HALF_FLOAT]:8},wa={[d.RGBA]:4,[d.RGB]:3,[d.RG]:2,[d.RED]:1,[d.LUMINANCE]:1,[d.LUMINANCE_ALPHA]:2,[d.ALPHA]:1},Ta={[f.UNSIGNED_SHORT_4_4_4_4]:2,[f.UNSIGNED_SHORT_5_5_5_1]:2,[f.UNSIGNED_SHORT_5_6_5]:2};function Ea(t,e,i=!1){const n=new DataView(e);if(!function(t,e){for(let i=0;i<ha.length;i++)if(e.getUint8(i)!==ha[i])return console.error(`${t} is not a valid *.ktx file!`),!1;return!0}(t,n))return null;const r=67305985===n.getUint32(la,!0),s=n.getUint32(ua,r),o=n.getUint32(ca,r),a=n.getUint32(da,r),h=n.getUint32(pa,r),l=n.getUint32(fa,r)||1,u=n.getUint32(ga,r)||1,c=n.getUint32(ma,r)||1,d=n.getUint32(va,r),p=n.getUint32(ya,r),g=n.getUint32(_a,r);if(0===l||1!==u)throw new Error("Only 2D textures are supported");if(1!==d)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(1!==c)throw new Error("WebGL does not support array textures");const m=h+3&-4,v=l+3&-4,y=new Array(c);let _,x=h*l;if(0===s&&(x=m*v),_=0!==s?ba[s]?ba[s]*wa[o]:Ta[s]:Ho[a],void 0===_)throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");const b=i?function(t,e,i){const n=new Map;let r=0;for(;r<e;){const s=t.getUint32(xa+r,i),o=xa+r+4,a=3-(s+3)%4;if(0===s||s>e-r){console.error("KTXLoader: keyAndValueByteSize out of bounds");break}let h=0;for(;h<s&&0!==t.getUint8(o+h);h++);if(-1===h){console.error("KTXLoader: Failed to find null byte terminating kvData key");break}const l=(new TextDecoder).decode(new Uint8Array(t.buffer,o,h)),u=new DataView(t.buffer,o+h+1,s-h-1);n.set(l,u),r+=4+s+a}return n}(n,g,r):null;let w=x*_,T=h,E=l,A=m,S=v,C=xa+g;for(let t=0;t<p;t++){const i=n.getUint32(C,r);let o=C+4;for(let i=0;i<c;i++){let n=y[i];n||(n=y[i]=new Array(p)),n[t]={levelID:t,levelWidth:p>1||0!==s?T:A,levelHeight:p>1||0!==s?E:S,levelBuffer:new Uint8Array(e,o,w)},o+=w}C+=i+4,C=C%4!=0?C+4-C%4:C,T=T>>1||1,E=E>>1||1,A=T+4-1&-4,S=E+4-1&-4,w=A*S*_}return 0!==s?{uncompressed:y.map((t=>{let e=t[0].levelBuffer,i=!1;return s===f.FLOAT?e=new Float32Array(t[0].levelBuffer.buffer,t[0].levelBuffer.byteOffset,t[0].levelBuffer.byteLength/4):s===f.UNSIGNED_INT?(i=!0,e=new Uint32Array(t[0].levelBuffer.buffer,t[0].levelBuffer.byteOffset,t[0].levelBuffer.byteLength/4)):s===f.INT&&(i=!0,e=new Int32Array(t[0].levelBuffer.buffer,t[0].levelBuffer.byteOffset,t[0].levelBuffer.byteLength/4)),{resource:new Pi(e,{width:t[0].levelWidth,height:t[0].levelHeight}),type:s,format:i?Aa(o):o}})),kvData:b}:{compressed:y.map((t=>new qo(null,{format:a,width:h,height:l,levels:p,levelBuffers:t}))),kvData:b}}function Aa(t){switch(t){case d.RGBA:return d.RGBA_INTEGER;case d.RGB:return d.RGB_INTEGER;case d.RG:return d.RG_INTEGER;case d.RED:return d.RED_INTEGER;default:return t}}const Sa={extension:{type:_i.LoadParser,priority:go.High},name:"loadDDS",test:t=>oo(t,".dds"),async load(t,e,i){const n=await C.ADAPTER.fetch(t),r=function(t){const e=new Uint32Array(t);if(542327876!==e[0])throw new Error("Invalid DDS file magic word");const i=new Uint32Array(t,0,Ko/Uint32Array.BYTES_PER_ELEMENT),n=i[Zo],r=i[Jo],s=i[Qo],o=new Uint32Array(t,ta*Uint32Array.BYTES_PER_ELEMENT,32/Uint32Array.BYTES_PER_ELEMENT),a=o[1];if(4&a){const i=o[ea];if(808540228!==i){const e=oa[i],o=new Uint8Array(t,128);return[new qo(o,{format:e,width:r,height:n,levels:s})]}const a=128,h=new Uint32Array(e.buffer,a,20/Uint32Array.BYTES_PER_ELEMENT),l=h[ia],u=h[na],c=h[ra],d=h[sa],p=aa[l];if(void 0===p)throw new Error(`DDSParser cannot parse texture data with DXGI format ${l}`);if(4===c)throw new Error("DDSParser does not support cubemap textures");if(6===u)throw new Error("DDSParser does not supported 3D texture data");const f=new Array,g=148;if(1===d)f.push(new Uint8Array(t,g));else{const e=Ho[p];let i=0,o=r,a=n;for(let t=0;t<s;t++)i+=Math.max(1,o+3&-4)*Math.max(1,a+3&-4)*e,o>>>=1,a>>>=1;let h=g;for(let e=0;e<d;e++)f.push(new Uint8Array(t,h,i)),h+=i}return f.map((t=>new qo(t,{format:p,width:r,height:n,levels:s})))}if(64&a)throw new Error("DDSParser does not support uncompressed texture data.");if(512&a)throw new Error("DDSParser does not supported YUV uncompressed texture data.");if(131072&a)throw new Error("DDSParser does not support single-channel (lumninance) texture data!");if(2&a)throw new Error("DDSParser does not support single-channel (alpha) texture data!");throw new Error("DDSParser failed to load a texture file due to an unknown reason!")}(await n.arrayBuffer()),s=r.map((n=>Mo(new Li(n,{mipmap:y.OFF,alphaMode:_.NO_PREMULTIPLIED_ALPHA,resolution:yi(t),...e.data}),i,t)));return 1===s.length?s[0]:s},unload(t){Array.isArray(t)?t.forEach((t=>t.destroy(!0))):t.destroy(!0)}};wi.add(Sa);const Ca={extension:{type:_i.LoadParser,priority:go.High},name:"loadKTX",test:t=>oo(t,".ktx"),async load(t,e,i){const n=await C.ADAPTER.fetch(t),r=await n.arrayBuffer(),{compressed:s,uncompressed:o,kvData:a}=Ea(t,r),h=s??o,l={mipmap:y.OFF,alphaMode:_.NO_PREMULTIPLIED_ALPHA,resolution:yi(t),...e.data},u=h.map((e=>{h===o&&Object.assign(l,{type:e.type,format:e.format});const n=new Li(e,l);return n.ktxKeyValueData=a,Mo(n,i,t)}));return 1===u.length?u[0]:u},unload(t){Array.isArray(t)?t.forEach((t=>t.destroy(!0))):t.destroy(!0)}};wi.add(Ca);const Ia={extension:_i.ResolveParser,test:t=>{const e=t.split("?")[0].split(".").pop();return["basis","ktx","dds"].includes(e)},parse:t=>{if("ktx"===t.split("?")[0].split(".").pop()){const e=[".s3tc.ktx",".s3tc_sRGB.ktx",".etc.ktx",".etc1.ktx",".pvrt.ktx",".atc.ktx",".astc.ktx"];if(e.some((e=>t.endsWith(e))))return{resolution:parseFloat(C.RETINA_PREFIX.exec(t)?.[1]??"1"),format:e.find((e=>t.endsWith(e))),src:t}}return{resolution:parseFloat(C.RETINA_PREFIX.exec(t)?.[1]??"1"),format:t.split(".").pop(),src:t}}};wi.add(Ia);const Ma=new Zi,Ra=class{constructor(t){this.renderer=t}async image(t,e,i){const n=new Image;return n.src=await this.base64(t,e,i),n}async base64(t,e,i){const n=this.canvas(t);if(void 0!==n.toBlob)return new Promise(((t,r)=>{n.toBlob((e=>{if(!e)return void r(new Error("ICanvas.toBlob failed!"));const i=new FileReader;i.onload=()=>t(i.result),i.onerror=r,i.readAsDataURL(e)}),e,i)}));if(void 0!==n.toDataURL)return n.toDataURL(e,i);if(void 0!==n.convertToBlob){const t=await n.convertToBlob({type:e,quality:i});return new Promise(((e,i)=>{const n=new FileReader;n.onload=()=>e(n.result),n.onerror=i,n.readAsDataURL(t)}))}throw new Error("Extract.base64() requires ICanvas.toDataURL, ICanvas.toBlob, or ICanvas.convertToBlob to be implemented")}canvas(t,e){const{pixels:i,width:n,height:r,flipY:s}=this._rawPixels(t,e);s&&Ra._flipY(i,n,r),Ra._unpremultiplyAlpha(i);const o=new di(n,r,1),a=new ImageData(new Uint8ClampedArray(i.buffer),n,r);return o.context.putImageData(a,0,0),o.canvas}pixels(t,e){const{pixels:i,width:n,height:r,flipY:s}=this._rawPixels(t,e);return s&&Ra._flipY(i,n,r),Ra._unpremultiplyAlpha(i),i}_rawPixels(t,e){const i=this.renderer;if(!i)throw new Error("The Extract has already been destroyed");let n,r,s=!1,o=!1;if(t&&(t instanceof or?r=t:(r=i.generateTexture(t,{resolution:i.resolution,multisample:i.multisample}),o=!0)),r){if(n=r.baseTexture.resolution,e=e??r.frame,s=!1,!o){i.renderTexture.bind(r);const t=r.framebuffer.glFramebuffers[i.CONTEXT_UID];t.blitFramebuffer&&i.framebuffer.bind(t.blitFramebuffer)}}else n=i.resolution,e||((e=Ma).width=i.width/n,e.height=i.height/n),s=!0,i.renderTexture.bind();const a=Math.round(e.width*n),h=Math.round(e.height*n),l=new Uint8Array(4*a*h),u=i.gl;return u.readPixels(Math.round(e.x*n),Math.round(e.y*n),a,h,u.RGBA,u.UNSIGNED_BYTE,l),o&&r?.destroy(!0),{pixels:l,width:a,height:h,flipY:s}}destroy(){this.renderer=null}static _flipY(t,e,i){const n=e<<2,r=i>>1,s=new Uint8Array(n);for(let e=0;e<r;e++){const r=e*n,o=(i-e-1)*n;s.set(t.subarray(r,r+n)),t.copyWithin(r,o,o+n),t.set(s,o)}}static _unpremultiplyAlpha(t){t instanceof Uint8ClampedArray&&(t=new Uint8Array(t.buffer));const e=t.length;for(let i=0;i<e;i+=4){const e=t[i+3];if(0!==e){const n=255.001/e;t[i]=t[i]*n+.5,t[i+1]=t[i+1]*n+.5,t[i+2]=t[i+2]*n+.5}}}};let Pa=Ra;Pa.extension={name:"extract",type:_i.RendererSystem},wi.add(Pa);const Da={build(t){const e=t.points;let i,n,r,s,o,a;if(t.type===$i.CIRC){const e=t.shape;i=e.x,n=e.y,o=a=e.radius,r=s=0}else if(t.type===$i.ELIP){const e=t.shape;i=e.x,n=e.y,o=e.width,a=e.height,r=s=0}else{const e=t.shape,h=e.width/2,l=e.height/2;i=e.x+h,n=e.y+l,o=a=Math.max(0,Math.min(e.radius,Math.min(h,l))),r=h-o,s=l-a}if(!(o>=0&&a>=0&&r>=0&&s>=0))return void(e.length=0);const h=Math.ceil(2.3*Math.sqrt(o+a)),l=8*h+(r?4:0)+(s?4:0);if(e.length=l,0===l)return;if(0===h)return e.length=8,e[0]=e[6]=i+r,e[1]=e[3]=n+s,e[2]=e[4]=i-r,void(e[5]=e[7]=n-s);let u=0,c=4*h+(r?2:0)+2,d=c,p=l;{const t=r+o,a=s,h=i+t,l=i-t,f=n+a;if(e[u++]=h,e[u++]=f,e[--c]=f,e[--c]=l,s){const t=n-a;e[d++]=l,e[d++]=t,e[--p]=t,e[--p]=h}}for(let t=1;t<h;t++){const l=Math.PI/2*(t/h),f=r+Math.cos(l)*o,g=s+Math.sin(l)*a,m=i+f,v=i-f,y=n+g,_=n-g;e[u++]=m,e[u++]=y,e[--c]=y,e[--c]=v,e[d++]=v,e[d++]=_,e[--p]=_,e[--p]=m}{const t=s+a,o=i+r,h=i-r,l=n+t,c=n-t;e[u++]=o,e[u++]=l,e[--p]=c,e[--p]=o,r&&(e[u++]=h,e[u++]=l,e[--p]=c,e[--p]=h)}},triangulate(t,e){const i=t.points,n=e.points,r=e.indices;if(0===i.length)return;let s=n.length/2;const o=s;let a,h;if(t.type!==$i.RREC){const e=t.shape;a=e.x,h=e.y}else{const e=t.shape;a=e.x+e.width/2,h=e.y+e.height/2}const l=t.matrix;n.push(t.matrix?l.a*a+l.c*h+l.tx:a,t.matrix?l.b*a+l.d*h+l.ty:h),s++,n.push(i[0],i[1]);for(let t=2;t<i.length;t+=2)n.push(i[t],i[t+1]),r.push(s++,o,s);r.push(o+1,o,s)}};function Oa(t,e=!1){const i=t.length;if(i<6)return;let n=0;for(let e=0,r=t[i-2],s=t[i-1];e<i;e+=2){const i=t[e],o=t[e+1];n+=(i-r)*(o+s),r=i,s=o}if(!e&&n>0||e&&n<=0){const e=i/2;for(let n=e+e%2;n<i;n+=2){const e=i-n-2,r=i-n-1,s=n,o=n+1;[t[e],t[s]]=[t[s],t[e]],[t[r],t[o]]=[t[o],t[r]]}}}const La={build(t){t.points=t.shape.points.slice()},triangulate(t,e){let i=t.points;const n=t.holes,r=e.points,s=e.indices;if(i.length>=6){Oa(i,!1);const t=[];for(let e=0;e<n.length;e++){const r=n[e];Oa(r.points,!0),t.push(i.length/2),i=i.concat(r.points)}const e=$.exports(i,t,2);if(!e)return;const o=r.length/2;for(let t=0;t<e.length;t+=3)s.push(e[t]+o),s.push(e[t+1]+o),s.push(e[t+2]+o);for(let t=0;t<i.length;t++)r.push(i[t])}}},Na={build(t){const e=t.shape,i=e.x,n=e.y,r=e.width,s=e.height,o=t.points;o.length=0,r>=0&&s>=0&&o.push(i,n,i+r,n,i+r,n+s,i,n+s)},triangulate(t,e){const i=t.points,n=e.points;if(0===i.length)return;const r=n.length/2;n.push(i[0],i[1],i[2],i[3],i[6],i[7],i[4],i[5]),e.indices.push(r,r+1,r+2,r+1,r+2,r+3)}},Ba={build(t){Da.build(t)},triangulate(t,e){Da.triangulate(t,e)}};var ka=(t=>(t.MITER="miter",t.BEVEL="bevel",t.ROUND="round",t))(ka||{}),Fa=(t=>(t.BUTT="butt",t.ROUND="round",t.SQUARE="square",t))(Fa||{});const Ua={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount(t,e=20){if(!this.adaptive||!t||isNaN(t))return e;let i=Math.ceil(t/this.maxLength);return i<this.minSegments?i=this.minSegments:i>this.maxSegments&&(i=this.maxSegments),i}};class Ga{static curveTo(t,e,i,n,r,s){const o=s[s.length-2],a=s[s.length-1]-e,h=o-t,l=n-e,u=i-t,c=Math.abs(a*u-h*l);if(c<1e-8||0===r)return s[s.length-2]===t&&s[s.length-1]===e||s.push(t,e),null;const d=a*a+h*h,p=l*l+u*u,f=a*l+h*u,g=r*Math.sqrt(d)/c,m=r*Math.sqrt(p)/c,v=g*f/d,y=m*f/p,_=g*u+m*h,x=g*l+m*a,b=h*(m+v),w=a*(m+v),T=u*(g+y),E=l*(g+y);return{cx:_+t,cy:x+e,radius:r,startAngle:Math.atan2(w-x,b-_),endAngle:Math.atan2(E-x,T-_),anticlockwise:h*l>u*a}}static arc(t,e,i,n,r,s,o,a,h){const l=o-s,u=Ua._segmentsCount(Math.abs(l)*r,40*Math.ceil(Math.abs(l)/Xi)),c=l/(2*u),d=2*c,p=Math.cos(c),f=Math.sin(c),g=u-1,m=g%1/g;for(let t=0;t<=g;++t){const e=c+s+d*(t+m*t),o=Math.cos(e),a=-Math.sin(e);h.push((p*o+f*a)*r+i,(p*-a+f*o)*r+n)}}}class za{constructor(){this.reset()}begin(t,e,i){this.reset(),this.style=t,this.start=e,this.attribStart=i}end(t,e){this.attribSize=e-this.attribStart,this.size=t-this.start}reset(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0}}class ja{static curveLength(t,e,i,n,r,s,o,a){let h=0,l=0,u=0,c=0,d=0,p=0,f=0,g=0,m=0,v=0,y=0,_=t,x=e;for(let b=1;b<=10;++b)l=b/10,u=l*l,c=u*l,d=1-l,p=d*d,f=p*d,g=f*t+3*p*l*i+3*d*u*r+c*o,m=f*e+3*p*l*n+3*d*u*s+c*a,v=_-g,y=x-m,_=g,x=m,h+=Math.sqrt(v*v+y*y);return h}static curveTo(t,e,i,n,r,s,o){const a=o[o.length-2],h=o[o.length-1];o.length-=2;const l=Ua._segmentsCount(ja.curveLength(a,h,t,e,i,n,r,s));let u=0,c=0,d=0,p=0,f=0;o.push(a,h);for(let g=1,m=0;g<=l;++g)m=g/l,u=1-m,c=u*u,d=c*u,p=m*m,f=p*m,o.push(d*a+3*c*m*t+3*u*p*i+f*r,d*h+3*c*m*e+3*u*p*n+f*s)}}function Ha(t,e,i,n,r,s,o,a){let h,l;o?(h=n,l=-i):(h=-n,l=i);const u=t-i*r+h,c=e-n*r+l,d=t+i*s+h,p=e+n*s+l;return a.push(u,c,d,p),2}function Wa(t,e,i,n,r,s,o,a){const h=i-t,l=n-e;let u=Math.atan2(h,l),c=Math.atan2(r-t,s-e);a&&u<c?u+=2*Math.PI:!a&&u>c&&(c+=2*Math.PI);let d=u;const p=c-u,f=Math.abs(p),g=Math.sqrt(h*h+l*l),m=1+(15*f*Math.sqrt(g)/Math.PI>>0),v=p/m;if(d+=v,a){o.push(t,e,i,n);for(let i=1,n=d;i<m;i++,n+=v)o.push(t,e,t+Math.sin(n)*g,e+Math.cos(n)*g);o.push(t,e,r,s)}else{o.push(i,n,t,e);for(let i=1,n=d;i<m;i++,n+=v)o.push(t+Math.sin(n)*g,e+Math.cos(n)*g,t,e);o.push(r,s,t,e)}return 2*m}function Xa(t,e){t.lineStyle.native?function(t,e){let i=0;const n=t.shape,r=t.points||n.points,s=n.type!==$i.POLY||n.closeStroke;if(0===r.length)return;const o=e.points,a=e.indices,h=r.length/2,l=o.length/2;let u=l;for(o.push(r[0],r[1]),i=1;i<h;i++)o.push(r[2*i],r[2*i+1]),a.push(u,u+1),u++;s&&a.push(u,l)}(t,e):function(t,e){const i=t.shape;let n=t.points||i.points.slice();const r=e.closePointEps;if(0===n.length)return;const s=t.lineStyle,o=new qi(n[0],n[1]),a=new qi(n[n.length-2],n[n.length-1]),h=i.type!==$i.POLY||i.closeStroke,l=Math.abs(o.x-a.x)<r&&Math.abs(o.y-a.y)<r;if(h){n=n.slice(),l&&(n.pop(),n.pop(),a.set(n[n.length-2],n[n.length-1]));const t=.5*(o.x+a.x),e=.5*(a.y+o.y);n.unshift(t,e),n.push(t,e)}const u=e.points,c=n.length/2;let d=n.length;const p=u.length/2,f=s.width/2,g=f*f,m=s.miterLimit*s.miterLimit;let v=n[0],y=n[1],_=n[2],x=n[3],b=0,w=0,T=-(y-x),E=v-_,A=0,S=0,C=Math.sqrt(T*T+E*E);T/=C,E/=C,T*=f,E*=f;const I=s.alignment,M=2*(1-I),R=2*I;h||(s.cap===Fa.ROUND?d+=Wa(v-T*(M-R)*.5,y-E*(M-R)*.5,v-T*M,y-E*M,v+T*R,y+E*R,u,!0)+2:s.cap===Fa.SQUARE&&(d+=Ha(v,y,T,E,M,R,!0,u))),u.push(v-T*M,y-E*M,v+T*R,y+E*R);for(let t=1;t<c-1;++t){v=n[2*(t-1)],y=n[2*(t-1)+1],_=n[2*t],x=n[2*t+1],b=n[2*(t+1)],w=n[2*(t+1)+1],T=-(y-x),E=v-_,C=Math.sqrt(T*T+E*E),T/=C,E/=C,T*=f,E*=f,A=-(x-w),S=_-b,C=Math.sqrt(A*A+S*S),A/=C,S/=C,A*=f,S*=f;const e=_-v,i=y-x,r=_-b,o=w-x,a=e*r+i*o,h=i*r-o*e,l=h<0;if(Math.abs(h)<.001*Math.abs(a)){u.push(_-T*M,x-E*M,_+T*R,x+E*R),a>=0&&(s.join===ka.ROUND?d+=Wa(_,x,_-T*M,x-E*M,_-A*M,x-S*M,u,!1)+4:d+=2,u.push(_-A*R,x-S*R,_+A*M,x+S*M));continue}const c=(-T+v)*(-E+x)-(-T+_)*(-E+y),p=(-A+b)*(-S+x)-(-A+_)*(-S+w),I=(e*p-r*c)/h,P=(o*c-i*p)/h,D=(I-_)*(I-_)+(P-x)*(P-x),O=_+(I-_)*M,L=x+(P-x)*M,N=_-(I-_)*R,B=x-(P-x)*R,k=l?M:R,F=D<=Math.min(e*e+i*i,r*r+o*o)+k*k*g;let U=s.join;if(U===ka.MITER&&D/g>m&&(U=ka.BEVEL),F)switch(U){case ka.MITER:u.push(O,L,N,B);break;case ka.BEVEL:l?u.push(O,L,_+T*R,x+E*R,O,L,_+A*R,x+S*R):u.push(_-T*M,x-E*M,N,B,_-A*M,x-S*M,N,B),d+=2;break;case ka.ROUND:l?(u.push(O,L,_+T*R,x+E*R),d+=Wa(_,x,_+T*R,x+E*R,_+A*R,x+S*R,u,!0)+4,u.push(O,L,_+A*R,x+S*R)):(u.push(_-T*M,x-E*M,N,B),d+=Wa(_,x,_-T*M,x-E*M,_-A*M,x-S*M,u,!1)+4,u.push(_-A*M,x-S*M,N,B))}else{switch(u.push(_-T*M,x-E*M,_+T*R,x+E*R),U){case ka.MITER:l?u.push(N,B,N,B):u.push(O,L,O,L),d+=2;break;case ka.ROUND:d+=l?Wa(_,x,_+T*R,x+E*R,_+A*R,x+S*R,u,!0)+2:Wa(_,x,_-T*M,x-E*M,_-A*M,x-S*M,u,!1)+2}u.push(_-A*M,x-S*M,_+A*R,x+S*R),d+=2}}v=n[2*(c-2)],y=n[2*(c-2)+1],_=n[2*(c-1)],x=n[2*(c-1)+1],T=-(y-x),E=v-_,C=Math.sqrt(T*T+E*E),T/=C,E/=C,T*=f,E*=f,u.push(_-T*M,x-E*M,_+T*R,x+E*R),h||(s.cap===Fa.ROUND?d+=Wa(_-T*(M-R)*.5,x-E*(M-R)*.5,_-T*M,x-E*M,_+T*R,x+E*R,u,!1)+2:s.cap===Fa.SQUARE&&(d+=Ha(_,x,T,E,M,R,!1,u)));const P=e.indices,D=Ua.epsilon*Ua.epsilon;for(let t=p;t<d+p-2;++t)v=u[2*t],y=u[2*t+1],_=u[2*(t+1)],x=u[2*(t+1)+1],b=u[2*(t+2)],w=u[2*(t+2)+1],Math.abs(v*(x-w)+_*(w-y)+b*(y-x))<D||P.push(t,t+1,t+2)}(t,e)}class Va{static curveLength(t,e,i,n,r,s){const o=t-2*i+r,a=e-2*n+s,h=2*i-2*t,l=2*n-2*e,u=4*(o*o+a*a),c=4*(o*h+a*l),d=h*h+l*l,p=2*Math.sqrt(u+c+d),f=Math.sqrt(u),g=2*u*f,m=2*Math.sqrt(d),v=c/f;return(g*p+f*c*(p-m)+(4*d*u-c*c)*Math.log((2*f+v+p)/(v+m)))/(4*g)}static curveTo(t,e,i,n,r){const s=r[r.length-2],o=r[r.length-1],a=Ua._segmentsCount(Va.curveLength(s,o,t,e,i,n));let h=0,l=0;for(let u=1;u<=a;++u){const c=u/a;h=s+(t-s)*c,l=o+(e-o)*c,r.push(h+(t+(i-t)*c-h)*c,l+(e+(n-e)*c-l)*c)}}}const Ya={[$i.POLY]:La,[$i.CIRC]:Da,[$i.ELIP]:Da,[$i.RECT]:Na,[$i.RREC]:Ba},$a=[],qa=[];class Ka{constructor(t,e=null,i=null,n=null){this.points=[],this.holes=[],this.shape=t,this.lineStyle=i,this.fillStyle=e,this.matrix=n,this.type=t.type}clone(){return new Ka(this.shape,this.fillStyle,this.lineStyle,this.matrix)}destroy(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null}}const Za=new qi,Ja=class extends Wi{constructor(){super(),this.closePointEps=1e-4,this.boundsPadding=0,this.uvsFloat32=null,this.indicesUint16=null,this.batchable=!1,this.points=[],this.colors=[],this.uvs=[],this.indices=[],this.textureIds=[],this.graphicsData=[],this.drawCalls=[],this.batchDirty=-1,this.batches=[],this.dirty=0,this.cacheDirty=-1,this.clearDirty=0,this.shapeIndex=0,this._bounds=new Ts,this.boundsDirty=-1}get bounds(){return this.updateBatches(),this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds}invalidate(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(let t=0;t<this.drawCalls.length;t++)this.drawCalls[t].texArray.clear(),qa.push(this.drawCalls[t]);this.drawCalls.length=0;for(let t=0;t<this.batches.length;t++){const e=this.batches[t];e.reset(),$a.push(e)}this.batches.length=0}clear(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this}drawShape(t,e=null,i=null,n=null){const r=new Ka(t,e,i,n);return this.graphicsData.push(r),this.dirty++,this}drawHole(t,e=null){if(!this.graphicsData.length)return null;const i=new Ka(t,null,null,e),n=this.graphicsData[this.graphicsData.length-1];return i.lineStyle=n.lineStyle,n.holes.push(i),this.dirty++,this}destroy(){super.destroy();for(let t=0;t<this.graphicsData.length;++t)this.graphicsData[t].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null}containsPoint(t){const e=this.graphicsData;for(let i=0;i<e.length;++i){const n=e[i];if(n.fillStyle.visible&&(n.shape&&(n.matrix?n.matrix.applyInverse(t,Za):Za.copyFrom(t),n.shape.contains(Za.x,Za.y)))){let t=!1;if(n.holes)for(let e=0;e<n.holes.length;e++){if(n.holes[e].shape.contains(Za.x,Za.y)){t=!0;break}}if(!t)return!0}}return!1}updateBatches(){if(!this.graphicsData.length)return void(this.batchable=!0);if(!this.validateBatching())return;this.cacheDirty=this.dirty;const t=this.uvs,e=this.graphicsData;let i=null,n=null;this.batches.length>0&&(i=this.batches[this.batches.length-1],n=i.style);for(let r=this.shapeIndex;r<e.length;r++){this.shapeIndex++;const s=e[r],o=s.fillStyle,a=s.lineStyle;Ya[s.type].build(s),s.matrix&&this.transformPoints(s.points,s.matrix),(o.visible||a.visible)&&this.processHoles(s.holes);for(let e=0;e<2;e++){const r=0===e?o:a;if(!r.visible)continue;const h=r.texture.baseTexture,l=this.indices.length,u=this.points.length/2;h.wrapMode=v.REPEAT,0===e?this.processFill(s):this.processLine(s);const c=this.points.length/2-u;0!==c&&(i&&!this._compareStyles(n,r)&&(i.end(l,u),i=null),i||(i=$a.pop()||new za,i.begin(r,l,u),this.batches.push(i),n=r),this.addUvs(this.points,t,r.texture,u,c,r.matrix))}}const r=this.indices.length,s=this.points.length/2;if(i&&i.end(r,s),0===this.batches.length)return void(this.batchable=!0);const o=s>65535;this.indicesUint16&&this.indices.length===this.indicesUint16.length&&o===this.indicesUint16.BYTES_PER_ELEMENT>2?this.indicesUint16.set(this.indices):this.indicesUint16=o?new Uint32Array(this.indices):new Uint16Array(this.indices),this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}_compareStyles(t,e){return!(!t||!e)&&(t.texture.baseTexture===e.texture.baseTexture&&(t.color+t.alpha===e.color+e.alpha&&!!t.native==!!e.native))}validateBatching(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(let t=0,e=this.graphicsData.length;t<e;t++){const e=this.graphicsData[t],i=e.fillStyle,n=e.lineStyle;if(i&&!i.texture.baseTexture.valid)return!1;if(n&&!n.texture.baseTexture.valid)return!1}return!0}packBatches(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);const t=this.batches;for(let e=0,i=t.length;e<i;e++){const i=t[e];for(let t=0;t<i.size;t++){const e=i.start+t;this.indicesUint16[e]=this.indicesUint16[e]-i.attribStart}}}isBatchable(){if(this.points.length>131070)return!1;const t=this.batches;for(let e=0;e<t.length;e++)if(t[e].style.native)return!1;return this.points.length<2*Ja.BATCHABLE_SIZE}buildDrawCalls(){let t=++Li._globalBatch;for(let t=0;t<this.drawCalls.length;t++)this.drawCalls[t].texArray.clear(),qa.push(this.drawCalls[t]);this.drawCalls.length=0;const e=this.colors,i=this.textureIds;let n=qa.pop();n||(n=new Ni,n.texArray=new zn),n.texArray.count=0,n.start=0,n.size=0,n.type=c.TRIANGLES;let r=0,s=null,o=0,a=!1,h=c.TRIANGLES,l=0;this.drawCalls.push(n);for(let u=0;u<this.batches.length;u++){const d=this.batches[u],p=8,f=d.style,g=f.texture.baseTexture;a!==!!f.native&&(a=!!f.native,h=a?c.LINES:c.TRIANGLES,s=null,r=p,t++),s!==g&&(s=g,g._batchEnabled!==t&&(r===p&&(t++,r=0,n.size>0&&(n=qa.pop(),n||(n=new Ni,n.texArray=new zn),this.drawCalls.push(n)),n.start=l,n.size=0,n.texArray.count=0,n.type=h),g.touched=1,g._batchEnabled=t,g._batchLocation=r,g.wrapMode=v.REPEAT,n.texArray.elements[n.texArray.count++]=g,r++)),n.size+=d.size,l+=d.size,o=g._batchLocation,this.addColors(e,f.color,f.alpha,d.attribSize,d.attribStart),this.addTextureIds(i,o,d.attribSize,d.attribStart)}Li._globalBatch=t,this.packAttributes()}packAttributes(){const t=this.points,e=this.uvs,i=this.colors,n=this.textureIds,r=new ArrayBuffer(3*t.length*4),s=new Float32Array(r),o=new Uint32Array(r);let a=0;for(let r=0;r<t.length/2;r++)s[a++]=t[2*r],s[a++]=t[2*r+1],s[a++]=e[2*r],s[a++]=e[2*r+1],o[a++]=i[r],s[a++]=n[r];this._buffer.update(r),this._indexBuffer.update(this.indicesUint16)}processFill(t){if(t.holes.length)La.triangulate(t,this);else{Ya[t.type].triangulate(t,this)}}processLine(t){Xa(t,this);for(let e=0;e<t.holes.length;e++)Xa(t.holes[e],this)}processHoles(t){for(let e=0;e<t.length;e++){const i=t[e];Ya[i.type].build(i),i.matrix&&this.transformPoints(i.points,i.matrix)}}calculateBounds(){const t=this._bounds;t.clear(),t.addVertexData(this.points,0,this.points.length),t.pad(this.boundsPadding,this.boundsPadding)}transformPoints(t,e){for(let i=0;i<t.length/2;i++){const n=t[2*i],r=t[2*i+1];t[2*i]=e.a*n+e.c*r+e.tx,t[2*i+1]=e.b*n+e.d*r+e.ty}}addColors(t,e,i,n,r=0){const s=qe.shared.setValue(e).toLittleEndianNumber(),o=qe.shared.setValue(s).toPremultiplied(i);t.length=Math.max(t.length,r+n);for(let e=0;e<n;e++)t[r+e]=o}addTextureIds(t,e,i,n=0){t.length=Math.max(t.length,n+i);for(let r=0;r<i;r++)t[n+r]=e}addUvs(t,e,i,n,r,s=null){let o=0;const a=e.length,h=i.frame;for(;o<r;){let i=t[2*(n+o)],r=t[2*(n+o)+1];if(s){const t=s.a*i+s.c*r+s.tx;r=s.b*i+s.d*r+s.ty,i=t}o++,e.push(i/h.width,r/h.height)}const l=i.baseTexture;(h.width<l.width||h.height<l.height)&&this.adjustUvs(e,i,a,r)}adjustUvs(t,e,i,n){const r=e.baseTexture,s=1e-6,o=i+2*n,a=e.frame,h=a.width/r.width,l=a.height/r.height;let u=a.x/a.width,c=a.y/a.height,d=Math.floor(t[i]+s),p=Math.floor(t[i+1]+s);for(let e=i+2;e<o;e+=2)d=Math.min(d,Math.floor(t[e]+s)),p=Math.min(p,Math.floor(t[e+1]+s));u-=d,c-=p;for(let e=i;e<o;e+=2)t[e]=(t[e]+u)*h,t[e+1]=(t[e+1]+c)*l}};let Qa=Ja;Qa.BATCHABLE_SIZE=100;class th{constructor(){this.color=16777215,this.alpha=1,this.texture=sr.WHITE,this.matrix=null,this.visible=!1,this.reset()}clone(){const t=new th;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t}reset(){this.color=16777215,this.alpha=1,this.texture=sr.WHITE,this.matrix=null,this.visible=!1}destroy(){this.texture=null,this.matrix=null}}class eh extends th{constructor(){super(...arguments),this.width=0,this.alignment=.5,this.native=!1,this.cap=Fa.BUTT,this.join=ka.MITER,this.miterLimit=10}clone(){const t=new eh;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t.width=this.width,t.alignment=this.alignment,t.native=this.native,t.cap=this.cap,t.join=this.join,t.miterLimit=this.miterLimit,t}reset(){super.reset(),this.color=0,this.alignment=.5,this.width=0,this.native=!1}}const ih={},nh=class extends Ms{constructor(t=null){super(),this.shader=null,this.pluginName="batch",this.currentPath=null,this.batches=[],this.batchTint=-1,this.batchDirty=-1,this.vertexData=null,this._fillStyle=new th,this._lineStyle=new eh,this._matrix=null,this._holeMode=!1,this.state=Si.for2d(),this._geometry=t||new Qa,this._geometry.refCount++,this._transformID=-1,this._tintColor=new qe(16777215),this.blendMode=u.NORMAL}get geometry(){return this._geometry}clone(){return this.finishPoly(),new nh(this._geometry)}set blendMode(t){this.state.blendMode=t}get blendMode(){return this.state.blendMode}get tint(){return this._tintColor.value}set tint(t){this._tintColor.setValue(t)}get fill(){return this._fillStyle}get line(){return this._lineStyle}lineStyle(t=null,e=0,i,n=.5,r=!1){return"number"==typeof t&&(t={width:t,color:e,alpha:i,alignment:n,native:r}),this.lineTextureStyle(t)}lineTextureStyle(t){const e={width:0,texture:sr.WHITE,color:t?.texture?16777215:0,matrix:null,alignment:.5,native:!1,cap:Fa.BUTT,join:ka.MITER,miterLimit:10};t=Object.assign(e,t),this.normalizeColor(t),this.currentPath&&this.startPoly();const i=t.width>0&&t.alpha>0;return i?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._lineStyle,{visible:i},t)):this._lineStyle.reset(),this}startPoly(){if(this.currentPath){const t=this.currentPath.points,e=this.currentPath.points.length;e>2&&(this.drawShape(this.currentPath),this.currentPath=new tn,this.currentPath.closeStroke=!1,this.currentPath.points.push(t[e-2],t[e-1]))}else this.currentPath=new tn,this.currentPath.closeStroke=!1}finishPoly(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)}moveTo(t,e){return this.startPoly(),this.currentPath.points[0]=t,this.currentPath.points[1]=e,this}lineTo(t,e){this.currentPath||this.moveTo(0,0);const i=this.currentPath.points,n=i[i.length-2],r=i[i.length-1];return n===t&&r===e||i.push(t,e),this}_initCurve(t=0,e=0){this.currentPath?0===this.currentPath.points.length&&(this.currentPath.points=[t,e]):this.moveTo(t,e)}quadraticCurveTo(t,e,i,n){this._initCurve();const r=this.currentPath.points;return 0===r.length&&this.moveTo(0,0),Va.curveTo(t,e,i,n,r),this}bezierCurveTo(t,e,i,n,r,s){return this._initCurve(),ja.curveTo(t,e,i,n,r,s,this.currentPath.points),this}arcTo(t,e,i,n,r){this._initCurve(t,e);const s=this.currentPath.points,o=Ga.curveTo(t,e,i,n,r,s);if(o){const{cx:t,cy:e,radius:i,startAngle:n,endAngle:r,anticlockwise:s}=o;this.arc(t,e,i,n,r,s)}return this}arc(t,e,i,n,r,s=!1){if(n===r)return this;!s&&r<=n?r+=Xi:s&&n<=r&&(n+=Xi);if(0===r-n)return this;const o=t+Math.cos(n)*i,a=e+Math.sin(n)*i,h=this._geometry.closePointEps;let l=this.currentPath?this.currentPath.points:null;if(l){const t=Math.abs(l[l.length-2]-o),e=Math.abs(l[l.length-1]-a);t<h&&e<h||l.push(o,a)}else this.moveTo(o,a),l=this.currentPath.points;return Ga.arc(o,a,t,e,i,n,r,s,l),this}beginFill(t=0,e){return this.beginTextureFill({texture:sr.WHITE,color:t,alpha:e})}normalizeColor(t){const e=qe.shared.setValue(t.color??0);t.color=e.toNumber(),t.alpha??(t.alpha=e.alpha)}beginTextureFill(t){const e={texture:sr.WHITE,color:16777215,matrix:null};t=Object.assign(e,t),this.normalizeColor(t),this.currentPath&&this.startPoly();const i=t.alpha>0;return i?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._fillStyle,{visible:i},t)):this._fillStyle.reset(),this}endFill(){return this.finishPoly(),this._fillStyle.reset(),this}drawRect(t,e,i,n){return this.drawShape(new Zi(t,e,i,n))}drawRoundedRect(t,e,i,n,r){return this.drawShape(new en(t,e,i,n,r))}drawCircle(t,e,i){return this.drawShape(new Ji(t,e,i))}drawEllipse(t,e,i,n){return this.drawShape(new Qi(t,e,i,n))}drawPolygon(...t){let e,i=!0;const n=t[0];n.points?(i=n.closeStroke,e=n.points):e=Array.isArray(t[0])?t[0]:t;const r=new tn(e);return r.closeStroke=i,this.drawShape(r),this}drawShape(t){return this._holeMode?this._geometry.drawHole(t,this._matrix):this._geometry.drawShape(t,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this}clear(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this}isFastRect(){const t=this._geometry.graphicsData;return!(1!==t.length||t[0].shape.type!==$i.RECT||t[0].matrix||t[0].holes.length||t[0].lineStyle.visible&&t[0].lineStyle.width)}_render(t){this.finishPoly();const e=this._geometry;e.updateBatches(),e.batchable?(this.batchDirty!==e.batchDirty&&this._populateBatches(),this._renderBatched(t)):(t.batch.flush(),this._renderDirect(t))}_populateBatches(){const t=this._geometry,e=this.blendMode,i=t.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=t.batchDirty,this.batches.length=i,this.vertexData=new Float32Array(t.points);for(let n=0;n<i;n++){const i=t.batches[n],r=i.style.color,s=new Float32Array(this.vertexData.buffer,4*i.attribStart*2,2*i.attribSize),o=new Float32Array(t.uvsFloat32.buffer,4*i.attribStart*2,2*i.attribSize),a={vertexData:s,blendMode:e,indices:new Uint16Array(t.indicesUint16.buffer,2*i.start,i.size),uvs:o,_batchRGB:qe.shared.setValue(r).toRgbArray(),_tintRGB:r,_texture:i.style.texture,alpha:i.style.alpha,worldAlpha:1};this.batches[n]=a}}_renderBatched(t){if(this.batches.length){t.batch.setObjectRenderer(t.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(let e=0,i=this.batches.length;e<i;e++){const i=this.batches[e];i.worldAlpha=this.worldAlpha*i.alpha,t.plugins[this.pluginName].render(i)}}}_renderDirect(t){const e=this._resolveDirectShader(t),i=this._geometry,n=this.worldAlpha,r=e.uniforms,s=i.drawCalls;r.translationMatrix=this.transform.worldTransform,qe.shared.setValue(this._tintColor).premultiply(n).toArray(r.tint),t.shader.bind(e),t.geometry.bind(i,e),t.state.set(this.state);for(let e=0,n=s.length;e<n;e++)this._renderDrawCallDirect(t,i.drawCalls[e])}_renderDrawCallDirect(t,e){const{texArray:i,type:n,size:r,start:s}=e,o=i.count;for(let e=0;e<o;e++)t.texture.bind(i.elements[e],e);t.geometry.draw(n,r,s)}_resolveDirectShader(t){let e=this.shader;const i=this.pluginName;if(!e){if(!ih[i]){const{maxTextures:e}=t.plugins[i],n=new Int32Array(e);for(let t=0;t<e;t++)n[t]=t;const r={tint:new Float32Array([1,1,1,1]),translationMatrix:new nn,default:Fn.from({uSamplers:n},!0)},s=t.plugins[i]._shader.program;ih[i]=new Un(s,r)}e=ih[i]}return e}_calculateBounds(){this.finishPoly();const t=this._geometry;if(!t.graphicsData.length)return;const{minX:e,minY:i,maxX:n,maxY:r}=t.bounds;this._bounds.addFrame(this.transform,e,i,n,r)}containsPoint(t){return this.worldTransform.applyInverse(t,nh._TEMP_POINT),this._geometry.containsPoint(nh._TEMP_POINT)}calculateTints(){if(this.batchTint!==this.tint){this.batchTint=this._tintColor.toNumber();for(let t=0;t<this.batches.length;t++){const e=this.batches[t];e._tintRGB=qe.shared.setValue(this._tintColor).multiply(e._batchRGB).toLittleEndianNumber()}}}calculateVertices(){const t=this.transform._worldID;if(this._transformID===t)return;this._transformID=t;const e=this.transform.worldTransform,i=e.a,n=e.b,r=e.c,s=e.d,o=e.tx,a=e.ty,h=this._geometry.points,l=this.vertexData;let u=0;for(let t=0;t<h.length;t+=2){const e=h[t],c=h[t+1];l[u++]=i*e+r*c+o,l[u++]=s*c+n*e+a}}closePath(){const t=this.currentPath;return t&&(t.closeStroke=!0,this.finishPoly()),this}setMatrix(t){return this._matrix=t,this}beginHole(){return this.finishPoly(),this._holeMode=!0,this}endHole(){return this.finishPoly(),this._holeMode=!1,this}destroy(t){this._geometry.refCount--,0===this._geometry.refCount&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,super.destroy(t)}};let rh=nh;rh.curves=Ua,rh._TEMP_POINT=new qi;const sh={buildPoly:La,buildCircle:Da,buildRectangle:Na,buildRoundedRectangle:Ba,buildLine:Xa,ArcUtils:Ga,BezierUtils:ja,QuadraticUtils:Va,BatchPart:za,FILL_COMMANDS:Ya,BATCH_POOL:$a,DRAW_CALL_POOL:qa};class oh{constructor(t,e){this.uvBuffer=t,this.uvMatrix=e,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}update(t){if(!t&&this._bufferUpdateId===this.uvBuffer._updateID&&this._textureUpdateId===this.uvMatrix._updateID)return;this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;const e=this.uvBuffer.data;this.data&&this.data.length===e.length||(this.data=new Float32Array(e.length)),this.uvMatrix.multiplyUvs(e,this.data),this._updateID++}}const ah=new qi,hh=new tn,lh=class extends Ms{constructor(t,e,i,n=c.TRIANGLES){super(),this.geometry=t,this.shader=e,this.state=i||Si.for2d(),this.drawMode=n,this.start=0,this.size=0,this.uvs=null,this.indices=null,this.vertexData=new Float32Array(1),this.vertexDirty=-1,this._transformID=-1,this._roundPixels=C.ROUND_PIXELS,this.batchUvs=null}get geometry(){return this._geometry}set geometry(t){this._geometry!==t&&(this._geometry&&(this._geometry.refCount--,0===this._geometry.refCount&&this._geometry.dispose()),this._geometry=t,this._geometry&&this._geometry.refCount++,this.vertexDirty=-1)}get uvBuffer(){return this.geometry.buffers[1]}get verticesBuffer(){return this.geometry.buffers[0]}set material(t){this.shader=t}get material(){return this.shader}set blendMode(t){this.state.blendMode=t}get blendMode(){return this.state.blendMode}set roundPixels(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t}get roundPixels(){return this._roundPixels}get tint(){return"tint"in this.shader?this.shader.tint:null}set tint(t){this.shader.tint=t}get tintValue(){return this.shader.tintValue}get texture(){return"texture"in this.shader?this.shader.texture:null}set texture(t){this.shader.texture=t}_render(t){const e=this.geometry.buffers[0].data;this.shader.batchable&&this.drawMode===c.TRIANGLES&&e.length<2*lh.BATCHABLE_SIZE?this._renderToBatch(t):this._renderDefault(t)}_renderDefault(t){const e=this.shader;e.alpha=this.worldAlpha,e.update&&e.update(),t.batch.flush(),e.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0),t.shader.bind(e),t.state.set(this.state),t.geometry.bind(this.geometry,e),t.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)}_renderToBatch(t){const e=this.geometry,i=this.shader;i.uvMatrix&&(i.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=e.indexBuffer.data,this._tintRGB=i._tintRGB,this._texture=i.texture;const n=this.material.pluginName;t.batch.setObjectRenderer(t.plugins[n]),t.plugins[n].render(this)}calculateVertices(){const t=this.geometry.buffers[0],e=t.data,i=t._updateID;if(i===this.vertexDirty&&this._transformID===this.transform._worldID)return;this._transformID=this.transform._worldID,this.vertexData.length!==e.length&&(this.vertexData=new Float32Array(e.length));const n=this.transform.worldTransform,r=n.a,s=n.b,o=n.c,a=n.d,h=n.tx,l=n.ty,u=this.vertexData;for(let t=0;t<u.length/2;t++){const i=e[2*t],n=e[2*t+1];u[2*t]=r*i+o*n+h,u[2*t+1]=s*i+a*n+l}if(this._roundPixels){const t=C.RESOLUTION;for(let e=0;e<u.length;++e)u[e]=Math.round(u[e]*t)/t}this.vertexDirty=i}calculateUvs(){const t=this.geometry.buffers[1],e=this.shader;e.uvMatrix.isSimple?this.uvs=t.data:(this.batchUvs||(this.batchUvs=new oh(t,e.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)}_calculateBounds(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)}containsPoint(t){if(!this.getBounds().contains(t.x,t.y))return!1;this.worldTransform.applyInverse(t,ah);const e=this.geometry.getBuffer("aVertexPosition").data,i=hh.points,n=this.geometry.getIndex().data,r=n.length,s=4===this.drawMode?3:1;for(let t=0;t+2<r;t+=s){const r=2*n[t],s=2*n[t+1],o=2*n[t+2];if(i[0]=e[r],i[1]=e[r+1],i[2]=e[s],i[3]=e[s+1],i[4]=e[o],i[5]=e[o+1],hh.contains(ah.x,ah.y))return!0}return!1}destroy(t){super.destroy(t),this._cachedTexture&&(this._cachedTexture.destroy(),this._cachedTexture=null),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null}};let uh=lh;uh.BATCHABLE_SIZE=100;class ch extends Hi{constructor(t,e,i){super();const n=new ki(t),r=new ki(e,!0),s=new ki(i,!0,!0);this.addAttribute("aVertexPosition",n,2,!1,f.FLOAT).addAttribute("aTextureCoord",r,2,!1,f.FLOAT).addIndex(s),this._updateId=-1}get vertexDirtyId(){return this.buffers[0]._updateID}}class dh extends Un{constructor(t,e){const i={uSampler:t,alpha:1,uTextureMatrix:nn.IDENTITY,uColor:new Float32Array([1,1,1,1])};(e=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},e)).uniforms&&Object.assign(i,e.uniforms),super(e.program||Bn.from("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTextureMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\n}\n","varying vec2 vTextureCoord;\nuniform vec4 uColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;\n}\n"),i),this._colorDirty=!1,this.uvMatrix=new xr(t),this.batchable=void 0===e.program,this.pluginName=e.pluginName,this._tintColor=new qe(e.tint),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0,this.alpha=e.alpha}get texture(){return this.uniforms.uSampler}set texture(t){this.uniforms.uSampler!==t&&(!this.uniforms.uSampler.baseTexture.alphaMode!=!t.baseTexture.alphaMode&&(this._colorDirty=!0),this.uniforms.uSampler=t,this.uvMatrix.texture=t)}set alpha(t){t!==this._alpha&&(this._alpha=t,this._colorDirty=!0)}get alpha(){return this._alpha}set tint(t){t!==this.tint&&(this._tintColor.setValue(t),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0)}get tint(){return this._tintColor.value}get tintValue(){return this._tintColor.toNumber()}update(){if(this._colorDirty){this._colorDirty=!1;const t=this.texture.baseTexture.alphaMode;qe.shared.setValue(this._tintColor).premultiply(this._alpha,t).toArray(this.uniforms.uColor)}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)}}class ph{constructor(t,e,i){this.geometry=new Hi,this.indexBuffer=null,this.size=i,this.dynamicProperties=[],this.staticProperties=[];for(let i=0;i<t.length;++i){let n=t[i];n={attributeName:n.attributeName,size:n.size,uploadFunction:n.uploadFunction,type:n.type||f.FLOAT,offset:n.offset},e[i]?this.dynamicProperties.push(n):this.staticProperties.push(n)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}initBuffers(){const t=this.geometry;let e=0;this.indexBuffer=new ki(function(t,e=null){const i=6*t;if((e=e||new Uint16Array(i)).length!==i)throw new Error(`Out buffer length is incorrect, got ${e.length} and expected ${i}`);for(let t=0,n=0;t<i;t+=6,n+=4)e[t+0]=n+0,e[t+1]=n+1,e[t+2]=n+2,e[t+3]=n+0,e[t+4]=n+2,e[t+5]=n+3;return e}(this.size),!0,!0),t.addIndex(this.indexBuffer),this.dynamicStride=0;for(let t=0;t<this.dynamicProperties.length;++t){const i=this.dynamicProperties[t];i.offset=e,e+=i.size,this.dynamicStride+=i.size}const i=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(i),this.dynamicDataUint32=new Uint32Array(i),this.dynamicBuffer=new ki(this.dynamicData,!1,!1);let n=0;this.staticStride=0;for(let t=0;t<this.staticProperties.length;++t){const e=this.staticProperties[t];e.offset=n,n+=e.size,this.staticStride+=e.size}const r=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(r),this.staticDataUint32=new Uint32Array(r),this.staticBuffer=new ki(this.staticData,!0,!1);for(let e=0;e<this.dynamicProperties.length;++e){const i=this.dynamicProperties[e];t.addAttribute(i.attributeName,this.dynamicBuffer,0,i.type===f.UNSIGNED_BYTE,i.type,4*this.dynamicStride,4*i.offset)}for(let e=0;e<this.staticProperties.length;++e){const i=this.staticProperties[e];t.addAttribute(i.attributeName,this.staticBuffer,0,i.type===f.UNSIGNED_BYTE,i.type,4*this.staticStride,4*i.offset)}}uploadDynamic(t,e,i){for(let n=0;n<this.dynamicProperties.length;n++){const r=this.dynamicProperties[n];r.uploadFunction(t,e,i,r.type===f.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,r.offset)}this.dynamicBuffer._updateID++}uploadStatic(t,e,i){for(let n=0;n<this.staticProperties.length;n++){const r=this.staticProperties[n];r.uploadFunction(t,e,i,r.type===f.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,r.offset)}this.staticBuffer._updateID++}destroy(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()}}class fh extends jn{constructor(t){super(t),this.shader=null,this.properties=null,this.tempMatrix=new nn,this.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:this.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:this.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:this.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:this.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:f.UNSIGNED_BYTE,uploadFunction:this.uploadTint,offset:0}],this.shader=Un.from("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nattribute vec2 aPositionCoord;\nattribute float aRotation;\n\nuniform mat3 translationMatrix;\nuniform vec4 uColor;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nvoid main(void){\n    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);\n    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);\n\n    vec2 v = vec2(x, y);\n    v = v + aPositionCoord;\n\n    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vColor = aColor * uColor;\n}\n","varying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;\n    gl_FragColor = color;\n}",{}),this.state=Si.for2d()}render(t){const e=t.children,i=t._maxSize,n=t._batchSize,r=this.renderer;let s=e.length;if(0===s)return;s>i&&!t.autoResize&&(s=i);let o=t._buffers;o||(o=t._buffers=this.generateBuffers(t));const a=e[0]._texture.baseTexture,h=a.alphaMode>0;this.state.blendMode=Je(t.blendMode,h),r.state.set(this.state);const l=r.gl,u=t.worldTransform.copyTo(this.tempMatrix);u.prepend(r.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=u.toArray(!0),this.shader.uniforms.uColor=qe.shared.setValue(t.tintRgb).premultiply(t.worldAlpha,h).toArray(this.shader.uniforms.uColor),this.shader.uniforms.uSampler=a,this.renderer.shader.bind(this.shader);let c=!1;for(let i=0,a=0;i<s;i+=n,a+=1){let h=s-i;h>n&&(h=n),a>=o.length&&o.push(this._generateOneMoreBuffer(t));const u=o[a];u.uploadDynamic(e,i,h);const d=t._bufferUpdateIDs[a]||0;c=c||u._updateID<d,c&&(u._updateID=t._updateID,u.uploadStatic(e,i,h)),r.geometry.bind(u.geometry),l.drawElements(l.TRIANGLES,6*h,l.UNSIGNED_SHORT,0)}}generateBuffers(t){const e=[],i=t._maxSize,n=t._batchSize,r=t._properties;for(let t=0;t<i;t+=n)e.push(new ph(this.properties,r,n));return e}_generateOneMoreBuffer(t){const e=t._batchSize,i=t._properties;return new ph(this.properties,i,e)}uploadVertices(t,e,i,n,r,s){let o=0,a=0,h=0,l=0;for(let u=0;u<i;++u){const i=t[e+u],c=i._texture,d=i.scale.x,p=i.scale.y,f=c.trim,g=c.orig;f?(a=f.x-i.anchor.x*g.width,o=a+f.width,l=f.y-i.anchor.y*g.height,h=l+f.height):(o=g.width*(1-i.anchor.x),a=g.width*-i.anchor.x,h=g.height*(1-i.anchor.y),l=g.height*-i.anchor.y),n[s]=a*d,n[s+1]=l*p,n[s+r]=o*d,n[s+r+1]=l*p,n[s+2*r]=o*d,n[s+2*r+1]=h*p,n[s+3*r]=a*d,n[s+3*r+1]=h*p,s+=4*r}}uploadPosition(t,e,i,n,r,s){for(let o=0;o<i;o++){const i=t[e+o].position;n[s]=i.x,n[s+1]=i.y,n[s+r]=i.x,n[s+r+1]=i.y,n[s+2*r]=i.x,n[s+2*r+1]=i.y,n[s+3*r]=i.x,n[s+3*r+1]=i.y,s+=4*r}}uploadRotation(t,e,i,n,r,s){for(let o=0;o<i;o++){const i=t[e+o].rotation;n[s]=i,n[s+r]=i,n[s+2*r]=i,n[s+3*r]=i,s+=4*r}}uploadUvs(t,e,i,n,r,s){for(let o=0;o<i;++o){const i=t[e+o]._texture._uvs;i?(n[s]=i.x0,n[s+1]=i.y0,n[s+r]=i.x1,n[s+r+1]=i.y1,n[s+2*r]=i.x2,n[s+2*r+1]=i.y2,n[s+3*r]=i.x3,n[s+3*r+1]=i.y3,s+=4*r):(n[s]=0,n[s+1]=0,n[s+r]=0,n[s+r+1]=0,n[s+2*r]=0,n[s+2*r+1]=0,n[s+3*r]=0,n[s+3*r+1]=0,s+=4*r)}}uploadTint(t,e,i,n,r,s){for(let o=0;o<i;++o){const i=t[e+o],a=qe.shared.setValue(i._tintRGB).toPremultiplied(i.alpha,i.texture.baseTexture.alphaMode>0);n[s]=a,n[s+r]=a,n[s+2*r]=a,n[s+3*r]=a,s+=4*r}}destroy(){super.destroy(),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null}}fh.extension={name:"particle",type:_i.RendererPlugin},wi.add(fh);var gh=(t=>(t[t.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",t[t.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL",t))(gh||{});const mh={willReadFrequently:!0},vh=class{static get experimentalLetterSpacingSupported(){let t=vh._experimentalLetterSpacingSupported;if(void 0!==t){const e=C.ADAPTER.getCanvasRenderingContext2D().prototype;t=vh._experimentalLetterSpacingSupported="letterSpacing"in e||"textLetterSpacing"in e}return t}constructor(t,e,i,n,r,s,o,a,h){this.text=t,this.style=e,this.width=i,this.height=n,this.lines=r,this.lineWidths=s,this.lineHeight=o,this.maxLineWidth=a,this.fontProperties=h}static measureText(t,e,i,n=vh._canvas){i=null==i?e.wordWrap:i;const r=e.toFontString(),s=vh.measureFont(r);0===s.fontSize&&(s.fontSize=e.fontSize,s.ascent=e.fontSize);const o=n.getContext("2d",mh);o.font=r;const a=(i?vh.wordWrap(t,e,n):t).split(/(?:\r\n|\r|\n)/),h=new Array(a.length);let l=0;for(let t=0;t<a.length;t++){const i=vh._measureText(a[t],e.letterSpacing,o);h[t]=i,l=Math.max(l,i)}let u=l+e.strokeThickness;e.dropShadow&&(u+=e.dropShadowDistance);const c=e.lineHeight||s.fontSize+e.strokeThickness;let d=Math.max(c,s.fontSize+2*e.strokeThickness)+(a.length-1)*(c+e.leading);return e.dropShadow&&(d+=e.dropShadowDistance),new vh(t,e,u,d,a,h,c+e.leading,l,s)}static _measureText(t,e,i){let n=!1;vh.experimentalLetterSpacingSupported&&(vh.experimentalLetterSpacing?(i.letterSpacing=`${e}px`,i.textLetterSpacing=`${e}px`,n=!0):(i.letterSpacing="0px",i.textLetterSpacing="0px"));let r=i.measureText(t).width;return r>0&&(n?r-=e:r+=(vh.graphemeSegmenter(t).length-1)*e),r}static wordWrap(t,e,i=vh._canvas){const n=i.getContext("2d",mh);let r=0,s="",o="";const a=Object.create(null),{letterSpacing:h,whiteSpace:l}=e,u=vh.collapseSpaces(l),c=vh.collapseNewlines(l);let d=!u;const p=e.wordWrapWidth+h,f=vh.tokenize(t);for(let t=0;t<f.length;t++){let i=f[t];if(vh.isNewline(i)){if(!c){o+=vh.addLine(s),d=!u,s="",r=0;continue}i=" "}if(u){const t=vh.isBreakingSpace(i),e=vh.isBreakingSpace(s[s.length-1]);if(t&&e)continue}const l=vh.getFromCache(i,h,a,n);if(l>p)if(""!==s&&(o+=vh.addLine(s),s="",r=0),vh.canBreakWords(i,e.breakWords)){const t=vh.wordWrapSplit(i);for(let l=0;l<t.length;l++){let u=t[l],c=u,f=1;for(;t[l+f];){const n=t[l+f];if(vh.canBreakChars(c,n,i,l,e.breakWords))break;u+=n,c=n,f++}l+=f-1;const g=vh.getFromCache(u,h,a,n);g+r>p&&(o+=vh.addLine(s),d=!1,s="",r=0),s+=u,r+=g}}else{s.length>0&&(o+=vh.addLine(s),s="",r=0);const e=t===f.length-1;o+=vh.addLine(i,!e),d=!1,s="",r=0}else l+r>p&&(d=!1,o+=vh.addLine(s),s="",r=0),(s.length>0||!vh.isBreakingSpace(i)||d)&&(s+=i,r+=l)}return o+=vh.addLine(s,!1),o}static addLine(t,e=!0){return t=vh.trimRight(t),t=e?`${t}\n`:t}static getFromCache(t,e,i,n){let r=i[t];return"number"!=typeof r&&(r=vh._measureText(t,e,n)+e,i[t]=r),r}static collapseSpaces(t){return"normal"===t||"pre-line"===t}static collapseNewlines(t){return"normal"===t}static trimRight(t){if("string"!=typeof t)return"";for(let e=t.length-1;e>=0;e--){const i=t[e];if(!vh.isBreakingSpace(i))break;t=t.slice(0,-1)}return t}static isNewline(t){return"string"==typeof t&&vh._newlines.includes(t.charCodeAt(0))}static isBreakingSpace(t,e){return"string"==typeof t&&vh._breakingSpaces.includes(t.charCodeAt(0))}static tokenize(t){const e=[];let i="";if("string"!=typeof t)return e;for(let n=0;n<t.length;n++){const r=t[n],s=t[n+1];vh.isBreakingSpace(r,s)||vh.isNewline(r)?(""!==i&&(e.push(i),i=""),e.push(r)):i+=r}return""!==i&&e.push(i),e}static canBreakWords(t,e){return e}static canBreakChars(t,e,i,n,r){return!0}static wordWrapSplit(t){return vh.graphemeSegmenter(t)}static measureFont(t){if(vh._fonts[t])return vh._fonts[t];const e={ascent:0,descent:0,fontSize:0},i=vh._canvas,n=vh._context;n.font=t;const r=vh.METRICS_STRING+vh.BASELINE_SYMBOL,s=Math.ceil(n.measureText(r).width);let o=Math.ceil(n.measureText(vh.BASELINE_SYMBOL).width);const a=Math.ceil(vh.HEIGHT_MULTIPLIER*o);if(o=o*vh.BASELINE_MULTIPLIER|0,0===s||0===a)return vh._fonts[t]=e,e;i.width=s,i.height=a,n.fillStyle="#f00",n.fillRect(0,0,s,a),n.font=t,n.textBaseline="alphabetic",n.fillStyle="#000",n.fillText(r,0,o);const h=n.getImageData(0,0,s,a).data,l=h.length,u=4*s;let c=0,d=0,p=!1;for(c=0;c<o;++c){for(let t=0;t<u;t+=4)if(255!==h[d+t]){p=!0;break}if(p)break;d+=u}for(e.ascent=o-c,d=l-u,p=!1,c=a;c>o;--c){for(let t=0;t<u;t+=4)if(255!==h[d+t]){p=!0;break}if(p)break;d-=u}return e.descent=c-o,e.fontSize=e.ascent+e.descent,vh._fonts[t]=e,e}static clearMetrics(t=""){t?delete vh._fonts[t]:vh._fonts={}}static get _canvas(){if(!vh.__canvas){let t;try{const e=new OffscreenCanvas(0,0),i=e.getContext("2d",mh);if(i?.measureText)return vh.__canvas=e,e;t=C.ADAPTER.createCanvas()}catch(e){t=C.ADAPTER.createCanvas()}t.width=t.height=10,vh.__canvas=t}return vh.__canvas}static get _context(){return vh.__context||(vh.__context=vh._canvas.getContext("2d",mh)),vh.__context}};let yh=vh;yh.METRICS_STRING="|q",yh.BASELINE_SYMBOL="M",yh.BASELINE_MULTIPLIER=1.4,yh.HEIGHT_MULTIPLIER=2,yh.graphemeSegmenter=(()=>{if("function"==typeof Intl?.Segmenter){const t=new Intl.Segmenter;return e=>[...t.segment(e)].map((t=>t.segment))}return t=>[...t]})(),yh.experimentalLetterSpacing=!1,yh._fonts={},yh._newlines=[10,13],yh._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];const _h=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],xh=class{constructor(t){this.styleID=0,this.reset(),Th(this,t,t)}clone(){const t={};return Th(t,this,xh.defaultStyle),new xh(t)}reset(){Th(this,xh.defaultStyle,xh.defaultStyle)}get align(){return this._align}set align(t){this._align!==t&&(this._align=t,this.styleID++)}get breakWords(){return this._breakWords}set breakWords(t){this._breakWords!==t&&(this._breakWords=t,this.styleID++)}get dropShadow(){return this._dropShadow}set dropShadow(t){this._dropShadow!==t&&(this._dropShadow=t,this.styleID++)}get dropShadowAlpha(){return this._dropShadowAlpha}set dropShadowAlpha(t){this._dropShadowAlpha!==t&&(this._dropShadowAlpha=t,this.styleID++)}get dropShadowAngle(){return this._dropShadowAngle}set dropShadowAngle(t){this._dropShadowAngle!==t&&(this._dropShadowAngle=t,this.styleID++)}get dropShadowBlur(){return this._dropShadowBlur}set dropShadowBlur(t){this._dropShadowBlur!==t&&(this._dropShadowBlur=t,this.styleID++)}get dropShadowColor(){return this._dropShadowColor}set dropShadowColor(t){const e=wh(t);this._dropShadowColor!==e&&(this._dropShadowColor=e,this.styleID++)}get dropShadowDistance(){return this._dropShadowDistance}set dropShadowDistance(t){this._dropShadowDistance!==t&&(this._dropShadowDistance=t,this.styleID++)}get fill(){return this._fill}set fill(t){const e=wh(t);this._fill!==e&&(this._fill=e,this.styleID++)}get fillGradientType(){return this._fillGradientType}set fillGradientType(t){this._fillGradientType!==t&&(this._fillGradientType=t,this.styleID++)}get fillGradientStops(){return this._fillGradientStops}set fillGradientStops(t){(function(t,e){if(!Array.isArray(t)||!Array.isArray(e))return!1;if(t.length!==e.length)return!1;for(let i=0;i<t.length;++i)if(t[i]!==e[i])return!1;return!0})(this._fillGradientStops,t)||(this._fillGradientStops=t,this.styleID++)}get fontFamily(){return this._fontFamily}set fontFamily(t){this.fontFamily!==t&&(this._fontFamily=t,this.styleID++)}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize!==t&&(this._fontSize=t,this.styleID++)}get fontStyle(){return this._fontStyle}set fontStyle(t){this._fontStyle!==t&&(this._fontStyle=t,this.styleID++)}get fontVariant(){return this._fontVariant}set fontVariant(t){this._fontVariant!==t&&(this._fontVariant=t,this.styleID++)}get fontWeight(){return this._fontWeight}set fontWeight(t){this._fontWeight!==t&&(this._fontWeight=t,this.styleID++)}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.styleID++)}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight!==t&&(this._lineHeight=t,this.styleID++)}get leading(){return this._leading}set leading(t){this._leading!==t&&(this._leading=t,this.styleID++)}get lineJoin(){return this._lineJoin}set lineJoin(t){this._lineJoin!==t&&(this._lineJoin=t,this.styleID++)}get miterLimit(){return this._miterLimit}set miterLimit(t){this._miterLimit!==t&&(this._miterLimit=t,this.styleID++)}get padding(){return this._padding}set padding(t){this._padding!==t&&(this._padding=t,this.styleID++)}get stroke(){return this._stroke}set stroke(t){const e=wh(t);this._stroke!==e&&(this._stroke=e,this.styleID++)}get strokeThickness(){return this._strokeThickness}set strokeThickness(t){this._strokeThickness!==t&&(this._strokeThickness=t,this.styleID++)}get textBaseline(){return this._textBaseline}set textBaseline(t){this._textBaseline!==t&&(this._textBaseline=t,this.styleID++)}get trim(){return this._trim}set trim(t){this._trim!==t&&(this._trim=t,this.styleID++)}get whiteSpace(){return this._whiteSpace}set whiteSpace(t){this._whiteSpace!==t&&(this._whiteSpace=t,this.styleID++)}get wordWrap(){return this._wordWrap}set wordWrap(t){this._wordWrap!==t&&(this._wordWrap=t,this.styleID++)}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(t){this._wordWrapWidth!==t&&(this._wordWrapWidth=t,this.styleID++)}toFontString(){const t="number"==typeof this.fontSize?`${this.fontSize}px`:this.fontSize;let e=this.fontFamily;Array.isArray(this.fontFamily)||(e=this.fontFamily.split(","));for(let t=e.length-1;t>=0;t--){let i=e[t].trim();/([\"\'])[^\'\"]+\1/.test(i)||_h.includes(i)||(i=`"${i}"`),e[t]=i}return`${this.fontStyle} ${this.fontVariant} ${this.fontWeight} ${t} ${e.join(",")}`}};let bh=xh;function wh(t){const e=qe.shared;return Array.isArray(t)?t.map((t=>e.setValue(t).toHex())):e.setValue(t).toHex()}function Th(t,e,i){for(const n in i)Array.isArray(e[n])?t[n]=e[n].slice():t[n]=e[n]}bh.defaultStyle={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:gh.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};const Eh={texture:!0,children:!1,baseTexture:!0},Ah=class extends Ds{constructor(t,e,i){let n=!1;i||(i=C.ADAPTER.createCanvas(),n=!0),i.width=3,i.height=3;const r=sr.from(i);r.orig=new Zi,r.trim=new Zi,super(r),this._ownCanvas=n,this.canvas=i,this.context=i.getContext("2d",{willReadFrequently:!0}),this._resolution=Ah.defaultResolution??C.RESOLUTION,this._autoResolution=Ah.defaultAutoResolution,this._text=null,this._style=null,this._styleListener=null,this._font="",this.text=t,this.style=e,this.localStyleID=-1}static get experimentalLetterSpacing(){return yh.experimentalLetterSpacing}static set experimentalLetterSpacing(t){_e("7.1.0","Text.experimentalLetterSpacing is deprecated, use TextMetrics.experimentalLetterSpacing"),yh.experimentalLetterSpacing=t}updateText(t){const e=this._style;if(this.localStyleID!==e.styleID&&(this.dirty=!0,this.localStyleID=e.styleID),!this.dirty&&t)return;this._font=this._style.toFontString();const i=this.context,n=yh.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),r=n.width,s=n.height,o=n.lines,a=n.lineHeight,h=n.lineWidths,l=n.maxLineWidth,u=n.fontProperties;let c,d;this.canvas.width=Math.ceil(Math.ceil(Math.max(1,r)+2*e.padding)*this._resolution),this.canvas.height=Math.ceil(Math.ceil(Math.max(1,s)+2*e.padding)*this._resolution),i.scale(this._resolution,this._resolution),i.clearRect(0,0,this.canvas.width,this.canvas.height),i.font=this._font,i.lineWidth=e.strokeThickness,i.textBaseline=e.textBaseline,i.lineJoin=e.lineJoin,i.miterLimit=e.miterLimit;const p=e.dropShadow?2:1;for(let t=0;t<p;++t){const r=e.dropShadow&&0===t,p=r?Math.ceil(Math.max(1,s)+2*e.padding):0,f=p*this._resolution;if(r){i.fillStyle="black",i.strokeStyle="black";const t=e.dropShadowColor,n=e.dropShadowBlur*this._resolution,r=e.dropShadowDistance*this._resolution;i.shadowColor=qe.shared.setValue(t).setAlpha(e.dropShadowAlpha).toRgbaString(),i.shadowBlur=n,i.shadowOffsetX=Math.cos(e.dropShadowAngle)*r,i.shadowOffsetY=Math.sin(e.dropShadowAngle)*r+f}else i.fillStyle=this._generateFillStyle(e,o,n),i.strokeStyle=e.stroke,i.shadowColor="black",i.shadowBlur=0,i.shadowOffsetX=0,i.shadowOffsetY=0;let g=(a-u.fontSize)/2;a-u.fontSize<0&&(g=0);for(let t=0;t<o.length;t++)c=e.strokeThickness/2,d=e.strokeThickness/2+t*a+u.ascent+g,"right"===e.align?c+=l-h[t]:"center"===e.align&&(c+=(l-h[t])/2),e.stroke&&e.strokeThickness&&this.drawLetterSpacing(o[t],c+e.padding,d+e.padding-p,!0),e.fill&&this.drawLetterSpacing(o[t],c+e.padding,d+e.padding-p)}this.updateTexture()}drawLetterSpacing(t,e,i,n=!1){const r=this._style.letterSpacing;let s=!1;if(yh.experimentalLetterSpacingSupported&&(yh.experimentalLetterSpacing?(this.context.letterSpacing=`${r}px`,this.context.textLetterSpacing=`${r}px`,s=!0):(this.context.letterSpacing="0px",this.context.textLetterSpacing="0px")),0===r||s)return void(n?this.context.strokeText(t,e,i):this.context.fillText(t,e,i));let o=e;const a=yh.graphemeSegmenter(t);let h=this.context.measureText(t).width,l=0;for(let t=0;t<a.length;++t){const e=a[t];n?this.context.strokeText(e,o,i):this.context.fillText(e,o,i);let s="";for(let e=t+1;e<a.length;++e)s+=a[e];l=this.context.measureText(s).width,o+=h-l+r,h=l}}updateTexture(){const t=this.canvas;if(this._style.trim){const e=gi(t);e.data&&(t.width=e.width,t.height=e.height,this.context.putImageData(e.data,0,0))}const e=this._texture,i=this._style,n=i.trim?0:i.padding,r=e.baseTexture;e.trim.width=e._frame.width=t.width/this._resolution,e.trim.height=e._frame.height=t.height/this._resolution,e.trim.x=-n,e.trim.y=-n,e.orig.width=e._frame.width-2*n,e.orig.height=e._frame.height-2*n,this._onTextureUpdate(),r.setRealSize(t.width,t.height,this._resolution),e.updateUvs(),this.dirty=!1}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._render(t)}updateTransform(){this.updateText(!0),super.updateTransform()}getBounds(t,e){return this.updateText(!0),-1===this._textureID&&(t=!1),super.getBounds(t,e)}getLocalBounds(t){return this.updateText(!0),super.getLocalBounds.call(this,t)}_calculateBounds(){this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_generateFillStyle(t,e,i){const n=t.fill;if(!Array.isArray(n))return n;if(1===n.length)return n[0];let r;const s=t.dropShadow?t.dropShadowDistance:0,o=t.padding||0,a=this.canvas.width/this._resolution-s-2*o,h=this.canvas.height/this._resolution-s-2*o,l=n.slice(),u=t.fillGradientStops.slice();if(!u.length){const t=l.length+1;for(let e=1;e<t;++e)u.push(e/t)}if(l.unshift(n[0]),u.unshift(0),l.push(n[n.length-1]),u.push(1),t.fillGradientType===gh.LINEAR_VERTICAL){r=this.context.createLinearGradient(a/2,o,a/2,h+o);const n=i.fontProperties.fontSize+t.strokeThickness;for(let t=0;t<e.length;t++){const s=i.lineHeight*(t-1)+n,o=i.lineHeight*t;let a=o;t>0&&s>o&&(a=(o+s)/2);const c=o+n,d=i.lineHeight*(t+1);let p=c;t+1<e.length&&d<c&&(p=(c+d)/2);const f=(p-a)/h;for(let t=0;t<l.length;t++){let e=0;e="number"==typeof u[t]?u[t]:t/l.length;let i=Math.min(1,Math.max(0,a/h+e*f));i=Number(i.toFixed(5)),r.addColorStop(i,l[t])}}}else{r=this.context.createLinearGradient(o,h/2,a+o,h/2);const t=l.length+1;let e=1;for(let i=0;i<l.length;i++){let n;n="number"==typeof u[i]?u[i]:e/t,r.addColorStop(n,l[i]),e++}}return r}destroy(t){"boolean"==typeof t&&(t={children:t}),t=Object.assign({},Eh,t),super.destroy(t),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width}set width(t){this.updateText(!0);const e=ri(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height}set height(t){this.updateText(!0);const e=ri(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t}get style(){return this._style}set style(t){t=t||{},this._style=t instanceof bh?t:new bh(t),this.localStyleID=-1,this.dirty=!0}get text(){return this._text}set text(t){t=String(null==t?"":t),this._text!==t&&(this._text=t,this.dirty=!0)}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}};let Sh=Ah;Sh.defaultAutoResolution=!0;class Ch{constructor(t){this.maxItemsPerFrame=t,this.itemsLeft=0}beginFrame(){this.itemsLeft=this.maxItemsPerFrame}allowedToUpload(){return this.itemsLeft-- >0}}function Ih(t,e){let i=!1;if(t?._textures?.length)for(let n=0;n<t._textures.length;n++)if(t._textures[n]instanceof sr){const r=t._textures[n].baseTexture;e.includes(r)||(e.push(r),i=!0)}return i}function Mh(t,e){if(t.baseTexture instanceof Li){const i=t.baseTexture;return e.includes(i)||e.push(i),!0}return!1}function Rh(t,e){if(t._texture&&t._texture instanceof sr){const i=t._texture.baseTexture;return e.includes(i)||e.push(i),!0}return!1}function Ph(t,e){return e instanceof Sh&&(e.updateText(!0),!0)}function Dh(t,e){if(e instanceof bh){const t=e.toFontString();return yh.measureFont(t),!0}return!1}function Oh(t,e){if(t instanceof Sh){e.includes(t.style)||e.push(t.style),e.includes(t)||e.push(t);const i=t._texture.baseTexture;return e.includes(i)||e.push(i),!0}return!1}function Lh(t,e){return t instanceof bh&&(e.includes(t)||e.push(t),!0)}const Nh=class{constructor(t){this.limiter=new Ch(Nh.uploadsPerFrame),this.renderer=t,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=()=>{this.queue&&this.prepareItems()},this.registerFindHook(Oh),this.registerFindHook(Lh),this.registerFindHook(Ih),this.registerFindHook(Mh),this.registerFindHook(Rh),this.registerUploadHook(Ph),this.registerUploadHook(Dh)}upload(t){return new Promise((e=>{t&&this.add(t),this.queue.length?(this.completes.push(e),this.ticking||(this.ticking=!0,ss.system.addOnce(this.tick,this,is.UTILITY))):e()}))}tick(){setTimeout(this.delayedTick,0)}prepareItems(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){const t=this.queue[0];let e=!1;if(t&&!t._destroyed)for(let i=0,n=this.uploadHooks.length;i<n;i++)if(this.uploadHooks[i](this.uploadHookHelper,t)){this.queue.shift(),e=!0;break}e||this.queue.shift()}if(this.queue.length)ss.system.addOnce(this.tick,this,is.UTILITY);else{this.ticking=!1;const t=this.completes.slice(0);this.completes.length=0;for(let e=0,i=t.length;e<i;e++)t[e]()}}registerFindHook(t){return t&&this.addHooks.push(t),this}registerUploadHook(t){return t&&this.uploadHooks.push(t),this}add(t){for(let e=0,i=this.addHooks.length;e<i&&!this.addHooks[e](t,this.queue);e++);if(t instanceof Ms)for(let e=t.children.length-1;e>=0;e--)this.add(t.children[e]);return this}destroy(){this.ticking&&ss.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null}};let Bh=Nh;function kh(t,e){return e instanceof Li&&(e._glTextures[t.CONTEXT_UID]||t.texture.bind(e),!0)}function Fh(t,e){if(!(e instanceof rh))return!1;const{geometry:i}=e;e.finishPoly(),i.updateBatches();const{batches:n}=i;for(let e=0;e<n.length;e++){const{texture:i}=n[e].style;i&&kh(t,i.baseTexture)}return i.batchable||t.geometry.bind(i,e._resolveDirectShader(t)),!0}function Uh(t,e){return t instanceof rh&&(e.push(t),!0)}Bh.uploadsPerFrame=4,Object.defineProperties(C,{UPLOADS_PER_FRAME:{get:()=>Bh.uploadsPerFrame,set(t){_e("7.1.0","settings.UPLOADS_PER_FRAME is deprecated, use prepare.BasePrepare.uploadsPerFrame"),Bh.uploadsPerFrame=t}}});class Gh extends Bh{constructor(t){super(t),this.uploadHookHelper=this.renderer,this.registerFindHook(Uh),this.registerUploadHook(kh),this.registerUploadHook(Fh)}}Gh.extension={name:"prepare",type:_i.RendererSystem},wi.add(Gh),new qi;var zh="#version 100\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n";const jh=new nn;class Hh extends jn{constructor(t){super(t),t.runners.contextChange.add(this),this.quad=new lr,this.state=Si.for2d()}contextChange(){const t=this.renderer,e={globals:t.globalUniforms};this.simpleShader=Un.from(zh,"#version 100\n#define SHADER_NAME Tiling-Sprite-Simple-100\n\nprecision lowp float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\n\nvoid main(void)\n{\n    vec4 texSample = texture2D(uSampler, vTextureCoord);\n    gl_FragColor = texSample * uColor;\n}\n",e),this.shader=t.context.webGLVersion>1?Un.from("#version 300 es\n#define SHADER_NAME Tiling-Sprite-300\n\nprecision lowp float;\n\nin vec2 aVertexPosition;\nin vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nout vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n","#version 300 es\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nin vec2 vTextureCoord;\n\nout vec4 fragmentColor;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;\n\nvoid main(void)\n{\n    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);\n    coord = (uMapCoord * vec3(coord, 1.0)).xy;\n    vec2 unclamped = coord;\n    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n    vec4 texSample = texture(uSampler, coord, unclamped == coord ? 0.0f : -32.0f);// lod-bias very negative to force lod 0\n\n    fragmentColor = texSample * uColor;\n}\n",e):Un.from(zh,"#version 100\n#ifdef GL_EXT_shader_texture_lod\n    #extension GL_EXT_shader_texture_lod : enable\n#endif\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;\n\nvoid main(void)\n{\n    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);\n    coord = (uMapCoord * vec3(coord, 1.0)).xy;\n    vec2 unclamped = coord;\n    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n    #ifdef GL_EXT_shader_texture_lod\n        vec4 texSample = unclamped == coord\n            ? texture2D(uSampler, coord) \n            : texture2DLodEXT(uSampler, coord, 0);\n    #else\n        vec4 texSample = texture2D(uSampler, coord);\n    #endif\n\n    gl_FragColor = texSample * uColor;\n}\n",e)}render(t){const e=this.renderer,i=this.quad;let n=i.vertices;n[0]=n[6]=t._width*-t.anchor.x,n[1]=n[3]=t._height*-t.anchor.y,n[2]=n[4]=t._width*(1-t.anchor.x),n[5]=n[7]=t._height*(1-t.anchor.y);const r=t.uvRespectAnchor?t.anchor.x:0,s=t.uvRespectAnchor?t.anchor.y:0;n=i.uvs,n[0]=n[6]=-r,n[1]=n[3]=-s,n[2]=n[4]=1-r,n[5]=n[7]=1-s,i.invalidate();const o=t._texture,a=o.baseTexture,h=a.alphaMode>0,l=t.tileTransform.localTransform,u=t.uvMatrix;let c=a.isPowerOfTwo&&o.frame.width===a.width&&o.frame.height===a.height;c&&(a._glTextures[e.CONTEXT_UID]?c=a.wrapMode!==v.CLAMP:a.wrapMode===v.CLAMP&&(a.wrapMode=v.REPEAT));const d=c?this.simpleShader:this.shader,p=o.width,f=o.height,g=t._width,m=t._height;jh.set(l.a*p/g,l.b*p/m,l.c*f/g,l.d*f/m,l.tx/g,l.ty/m),jh.invert(),c?jh.prepend(u.mapCoord):(d.uniforms.uMapCoord=u.mapCoord.toArray(!0),d.uniforms.uClampFrame=u.uClampFrame,d.uniforms.uClampOffset=u.uClampOffset),d.uniforms.uTransform=jh.toArray(!0),d.uniforms.uColor=qe.shared.setValue(t.tint).premultiply(t.worldAlpha,h).toArray(d.uniforms.uColor),d.uniforms.translationMatrix=t.transform.worldTransform.toArray(!0),d.uniforms.uSampler=o,e.shader.bind(d),e.geometry.bind(i),this.state.blendMode=Je(t.blendMode,h),e.state.set(this.state),e.geometry.draw(this.renderer.gl.TRIANGLES,6,0)}}Hh.extension={name:"tilingSprite",type:_i.RendererPlugin},wi.add(Hh);const Wh=class{constructor(t,e,i=null){this.linkedSheets=[],this._texture=t instanceof sr?t:null,this.baseTexture=t instanceof Li?t:this._texture.baseTexture,this.textures={},this.animations={},this.data=e;const n=this.baseTexture.resource;this.resolution=this._updateResolution(i||(n?n.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}_updateResolution(t=null){const{scale:e}=this.data.meta;let i=yi(t,null);return null===i&&(i=parseFloat(e??"1")),1!==i&&this.baseTexture.setResolution(i),i}parse(){return new Promise((t=>{this._callback=t,this._batchIndex=0,this._frameKeys.length<=Wh.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()}))}_processFrames(t){let e=t;const i=Wh.BATCH_SIZE;for(;e-t<i&&e<this._frameKeys.length;){const t=this._frameKeys[e],i=this._frames[t],n=i.frame;if(n){let e=null,r=null;const s=!1!==i.trimmed&&i.sourceSize?i.sourceSize:i.frame,o=new Zi(0,0,Math.floor(s.w)/this.resolution,Math.floor(s.h)/this.resolution);e=i.rotated?new Zi(Math.floor(n.x)/this.resolution,Math.floor(n.y)/this.resolution,Math.floor(n.h)/this.resolution,Math.floor(n.w)/this.resolution):new Zi(Math.floor(n.x)/this.resolution,Math.floor(n.y)/this.resolution,Math.floor(n.w)/this.resolution,Math.floor(n.h)/this.resolution),!1!==i.trimmed&&i.spriteSourceSize&&(r=new Zi(Math.floor(i.spriteSourceSize.x)/this.resolution,Math.floor(i.spriteSourceSize.y)/this.resolution,Math.floor(n.w)/this.resolution,Math.floor(n.h)/this.resolution)),this.textures[t]=new sr(this.baseTexture,e,o,r,i.rotated?2:0,i.anchor,i.borders),sr.addToCache(this.textures[t],t)}e++}}_processAnimations(){const t=this.data.animations||{};for(const e in t){this.animations[e]=[];for(let i=0;i<t[e].length;i++){const n=t[e][i];this.animations[e].push(this.textures[n])}}}_parseComplete(){const t=this._callback;this._callback=null,this._batchIndex=0,t.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*Wh.BATCH_SIZE),this._batchIndex++,setTimeout((()=>{this._batchIndex*Wh.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())}),0)}destroy(t=!1){for(const t in this.textures)this.textures[t].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,t&&(this._texture?.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null,this.linkedSheets=[]}};let Xh=Wh;Xh.BATCH_SIZE=1e3;const Vh=["jpg","png","jpeg","avif","webp"];function Yh(t,e,i){const n={};if(t.forEach((t=>{n[t]=e})),Object.keys(e.textures).forEach((t=>{n[t]=e.textures[t]})),!i){const i=ve.dirname(t[0]);e.linkedSheets.forEach(((t,r)=>{const s=Yh([`${i}/${e.data.meta.related_multi_packs[r]}`],t,!0);Object.assign(n,s)}))}return n}const $h={extension:_i.Asset,cache:{test:t=>t instanceof Xh,getCacheableAssets:(t,e)=>Yh(t,e,!1)},resolver:{test:t=>{const e=t.split("?")[0].split("."),i=e.pop(),n=e.pop();return"json"===i&&Vh.includes(n)},parse:t=>{const e=t.split(".");return{resolution:parseFloat(C.RETINA_PREFIX.exec(t)?.[1]??"1"),format:e[e.length-2],src:t}}},loader:{name:"spritesheetLoader",extension:{type:_i.LoadParser,priority:go.Normal},testParse:async(t,e)=>".json"===ve.extname(e.src).toLowerCase()&&!!t.frames,async parse(t,e,i){let n=ve.dirname(e.src);n&&n.lastIndexOf("/")!==n.length-1&&(n+="/");let r=n+t.meta.image;r=ho(r,e.src);const s=(await i.load([r]))[r],o=new Xh(s.baseTexture,t,e.src);await o.parse();const a=t?.meta?.related_multi_packs;if(Array.isArray(a)){const t=[];for(const r of a){if("string"!=typeof r)continue;let s=n+r;e.data?.ignoreMultiPack||(s=ho(s,e.src),t.push(i.load({src:s,data:{ignoreMultiPack:!0}})))}const r=await Promise.all(t);o.linkedSheets=r,r.forEach((t=>{t.linkedSheets=[o].concat(o.linkedSheets.filter((e=>e!==t)))}))}return o},unload(t){t.destroy(!0)}}};wi.add($h);class qh{constructor(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[],this.distanceField=[]}}class Kh{static test(t){return"string"==typeof t&&t.startsWith("info face=")}static parse(t){const e=t.match(/^[a-z]+\s+.+$/gm),i={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(const t in e){const n=e[t].match(/^[a-z]+/gm)[0],r=e[t].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),s={};for(const t in r){const e=r[t].split("="),i=e[0],n=e[1].replace(/"/gm,""),o=parseFloat(n),a=isNaN(o)?n:o;s[i]=a}i[n].push(s)}const n=new qh;return i.info.forEach((t=>n.info.push({face:t.face,size:parseInt(t.size,10)}))),i.common.forEach((t=>n.common.push({lineHeight:parseInt(t.lineHeight,10)}))),i.page.forEach((t=>n.page.push({id:parseInt(t.id,10),file:t.file}))),i.char.forEach((t=>n.char.push({id:parseInt(t.id,10),page:parseInt(t.page,10),x:parseInt(t.x,10),y:parseInt(t.y,10),width:parseInt(t.width,10),height:parseInt(t.height,10),xoffset:parseInt(t.xoffset,10),yoffset:parseInt(t.yoffset,10),xadvance:parseInt(t.xadvance,10)}))),i.kerning.forEach((t=>n.kerning.push({first:parseInt(t.first,10),second:parseInt(t.second,10),amount:parseInt(t.amount,10)}))),i.distanceField.forEach((t=>n.distanceField.push({distanceRange:parseInt(t.distanceRange,10),fieldType:t.fieldType}))),n}}class Zh{static test(t){const e=t;return"getElementsByTagName"in e&&e.getElementsByTagName("page").length&&null!==e.getElementsByTagName("info")[0].getAttribute("face")}static parse(t){const e=new qh,i=t.getElementsByTagName("info"),n=t.getElementsByTagName("common"),r=t.getElementsByTagName("page"),s=t.getElementsByTagName("char"),o=t.getElementsByTagName("kerning"),a=t.getElementsByTagName("distanceField");for(let t=0;t<i.length;t++)e.info.push({face:i[t].getAttribute("face"),size:parseInt(i[t].getAttribute("size"),10)});for(let t=0;t<n.length;t++)e.common.push({lineHeight:parseInt(n[t].getAttribute("lineHeight"),10)});for(let t=0;t<r.length;t++)e.page.push({id:parseInt(r[t].getAttribute("id"),10)||0,file:r[t].getAttribute("file")});for(let t=0;t<s.length;t++){const i=s[t];e.char.push({id:parseInt(i.getAttribute("id"),10),page:parseInt(i.getAttribute("page"),10)||0,x:parseInt(i.getAttribute("x"),10),y:parseInt(i.getAttribute("y"),10),width:parseInt(i.getAttribute("width"),10),height:parseInt(i.getAttribute("height"),10),xoffset:parseInt(i.getAttribute("xoffset"),10),yoffset:parseInt(i.getAttribute("yoffset"),10),xadvance:parseInt(i.getAttribute("xadvance"),10)})}for(let t=0;t<o.length;t++)e.kerning.push({first:parseInt(o[t].getAttribute("first"),10),second:parseInt(o[t].getAttribute("second"),10),amount:parseInt(o[t].getAttribute("amount"),10)});for(let t=0;t<a.length;t++)e.distanceField.push({fieldType:a[t].getAttribute("fieldType"),distanceRange:parseInt(a[t].getAttribute("distanceRange"),10)});return e}}class Jh{static test(t){return!("string"!=typeof t||!t.includes("<font>"))&&Zh.test(C.ADAPTER.parseXML(t))}static parse(t){return Zh.parse(C.ADAPTER.parseXML(t))}}const Qh=[Kh,Zh,Jh];function tl(t,e,i,n,r,s,o){const a=i.text,h=i.fontProperties;e.translate(n,r),e.scale(s,s);const l=o.strokeThickness/2,u=-o.strokeThickness/2;if(e.font=o.toFontString(),e.lineWidth=o.strokeThickness,e.textBaseline=o.textBaseline,e.lineJoin=o.lineJoin,e.miterLimit=o.miterLimit,e.fillStyle=function(t,e,i,n,r,s){const o=i.fill;if(!Array.isArray(o))return o;if(1===o.length)return o[0];let a;const h=i.dropShadow?i.dropShadowDistance:0,l=i.padding||0,u=t.width/n-h-2*l,c=t.height/n-h-2*l,d=o.slice(),p=i.fillGradientStops.slice();if(!p.length){const t=d.length+1;for(let e=1;e<t;++e)p.push(e/t)}if(d.unshift(o[0]),p.unshift(0),d.push(o[o.length-1]),p.push(1),i.fillGradientType===gh.LINEAR_VERTICAL){a=e.createLinearGradient(u/2,l,u/2,c+l);let t=0;const n=(s.fontProperties.fontSize+i.strokeThickness)/c;for(let e=0;e<r.length;e++){const i=s.lineHeight*e;for(let e=0;e<d.length;e++){let r=0;r="number"==typeof p[e]?p[e]:e/d.length;const s=i/c+r*n;let o=Math.max(t,s);o=Math.min(o,1),a.addColorStop(o,d[e]),t=o}}}else{a=e.createLinearGradient(l,c/2,u+l,c/2);const t=d.length+1;let i=1;for(let e=0;e<d.length;e++){let n;n="number"==typeof p[e]?p[e]:i/t,a.addColorStop(n,d[e]),i++}}return a}(t,e,o,s,[a],i),e.strokeStyle=o.stroke,o.dropShadow){const t=o.dropShadowColor,i=o.dropShadowBlur*s,n=o.dropShadowDistance*s;e.shadowColor=qe.shared.setValue(t).setAlpha(o.dropShadowAlpha).toRgbaString(),e.shadowBlur=i,e.shadowOffsetX=Math.cos(o.dropShadowAngle)*n,e.shadowOffsetY=Math.sin(o.dropShadowAngle)*n}else e.shadowColor="black",e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0;o.stroke&&o.strokeThickness&&e.strokeText(a,l,u+i.lineHeight-h.descent),o.fill&&e.fillText(a,l,u+i.lineHeight-h.descent),e.setTransform(1,0,0,1,0,0),e.fillStyle="rgba(0, 0, 0, 0)"}function el(t){return t.codePointAt?t.codePointAt(0):t.charCodeAt(0)}function il(t){return Array.from?Array.from(t):t.split("")}const nl=class{constructor(t,e,i){const[n]=t.info,[r]=t.common,[s]=t.page,[o]=t.distanceField,a=yi(s.file),h={};this._ownsTextures=i,this.font=n.face,this.size=n.size,this.lineHeight=r.lineHeight/a,this.chars={},this.pageTextures=h;for(let i=0;i<t.page.length;i++){const{id:n,file:r}=t.page[i];h[n]=e instanceof Array?e[i]:e[r],o?.fieldType&&"none"!==o.fieldType&&(h[n].baseTexture.alphaMode=_.NO_PREMULTIPLIED_ALPHA,h[n].baseTexture.mipmap=y.OFF)}for(let e=0;e<t.char.length;e++){const{id:i,page:n}=t.char[e];let{x:r,y:s,width:o,height:l,xoffset:u,yoffset:c,xadvance:d}=t.char[e];r/=a,s/=a,o/=a,l/=a,u/=a,c/=a,d/=a;const p=new Zi(r+h[n].frame.x/a,s+h[n].frame.y/a,o,l);this.chars[i]={xOffset:u,yOffset:c,xAdvance:d,kerning:{},texture:new sr(h[n].baseTexture,p),page:n}}for(let e=0;e<t.kerning.length;e++){let{first:i,second:n,amount:r}=t.kerning[e];i/=a,n/=a,r/=a,this.chars[n]&&(this.chars[n].kerning[i]=r)}this.distanceFieldRange=o?.distanceRange,this.distanceFieldType=o?.fieldType?.toLowerCase()??"none"}destroy(){for(const t in this.chars)this.chars[t].texture.destroy(),this.chars[t].texture=null;for(const t in this.pageTextures)this._ownsTextures&&this.pageTextures[t].destroy(!0),this.pageTextures[t]=null;this.chars=null,this.pageTextures=null}static install(t,e,i){let n;if(t instanceof qh)n=t;else{const e=function(t){for(let e=0;e<Qh.length;e++)if(Qh[e].test(t))return Qh[e];return null}(t);if(!e)throw new Error("Unrecognized data format for font.");n=e.parse(t)}e instanceof sr&&(e=[e]);const r=new nl(n,e,i);return nl.available[r.font]=r,r}static uninstall(t){const e=nl.available[t];if(!e)throw new Error(`No font found named '${t}'`);e.destroy(),delete nl.available[t]}static from(t,e,i){if(!t)throw new Error("[BitmapFont] Property `name` is required.");const{chars:n,padding:r,resolution:s,textureWidth:o,textureHeight:a,...h}=Object.assign({},nl.defaultOptions,i),l=function(t){"string"==typeof t&&(t=[t]);const e=[];for(let i=0,n=t.length;i<n;i++){const n=t[i];if(Array.isArray(n)){if(2!==n.length)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${n.length}.`);const t=n[0].charCodeAt(0),i=n[1].charCodeAt(0);if(i<t)throw new Error("[BitmapFont]: Invalid character range.");for(let n=t,r=i;n<=r;n++)e.push(String.fromCharCode(n))}else e.push(...il(n))}if(0===e.length)throw new Error("[BitmapFont]: Empty set when resolving characters.");return e}(n),u=e instanceof bh?e:new bh(e),c=o,d=new qh;d.info[0]={face:u.fontFamily,size:u.fontSize},d.common[0]={lineHeight:u.fontSize};let p,f,g,m=0,v=0,y=0;const _=[];for(let t=0;t<l.length;t++){p||(p=C.ADAPTER.createCanvas(),p.width=o,p.height=a,f=p.getContext("2d"),g=new Li(p,{resolution:s,...h}),_.push(new sr(g)),d.page.push({id:_.length-1,file:""}));const e=l[t],i=yh.measureText(e,u,!1,p),n=i.width,x=Math.ceil(i.height),b=Math.ceil(("italic"===u.fontStyle?2:1)*n);if(v>=a-x*s){if(0===v)throw new Error(`[BitmapFont] textureHeight ${a}px is too small (fontFamily: '${u.fontFamily}', fontSize: ${u.fontSize}px, char: '${e}')`);--t,p=null,f=null,g=null,v=0,m=0,y=0;continue}if(y=Math.max(x+i.fontProperties.descent,y),b*s+m>=c){if(0===m)throw new Error(`[BitmapFont] textureWidth ${o}px is too small (fontFamily: '${u.fontFamily}', fontSize: ${u.fontSize}px, char: '${e}')`);--t,v+=y*s,v=Math.ceil(v),m=0,y=0;continue}tl(p,f,i,m,v,s,u);const w=el(i.text);d.char.push({id:w,page:_.length-1,x:m/s,y:v/s,width:b,height:x,xoffset:0,yoffset:0,xadvance:n-(u.dropShadow?u.dropShadowDistance:0)-(u.stroke?u.strokeThickness:0)}),m+=(b+2*r)*s,m=Math.ceil(m)}for(let t=0,e=l.length;t<e;t++){const i=l[t];for(let t=0;t<e;t++){const e=l[t],n=f.measureText(i).width,r=f.measureText(e).width,s=f.measureText(i+e).width-(n+r);s&&d.kerning.push({first:el(i),second:el(e),amount:s})}}const x=new nl(d,_,!0);return void 0!==nl.available[t]&&nl.uninstall(t),nl.available[t]=x,x}};let rl=nl;rl.ALPHA=[["a","z"],["A","Z"]," "],rl.NUMERIC=[["0","9"]],rl.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],rl.ASCII=[[" ","~"]],rl.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:nl.ALPHANUMERIC},rl.available={};const sl=[],ol=[],al=[],hl=class extends Ms{constructor(t,e={}){super();const{align:i,tint:n,maxWidth:r,letterSpacing:s,fontName:o,fontSize:a}=Object.assign({},hl.styleDefaults,e);if(!rl.available[o])throw new Error(`Missing BitmapFont "${o}"`);this._activePagesMeshData=[],this._textWidth=0,this._textHeight=0,this._align=i,this._tintColor=new qe(n),this._font=void 0,this._fontName=o,this._fontSize=a,this.text=t,this._maxWidth=r,this._maxLineHeight=0,this._letterSpacing=s,this._anchor=new dn((()=>{this.dirty=!0}),this,0,0),this._roundPixels=C.ROUND_PIXELS,this.dirty=!0,this._resolution=C.RESOLUTION,this._autoResolution=!0,this._textureCache={}}updateText(){const t=rl.available[this._fontName],e=this.fontSize,i=e/t.size,n=new qi,r=[],s=[],o=[],a=il(this._text.replace(/(?:\r\n|\r)/g,"\n")||" "),h=this._maxWidth*t.size/e,l="none"===t.distanceFieldType?sl:ol;let c=null,d=0,p=0,f=0,g=-1,m=0,v=0,y=0,_=0;for(let e=0;e<a.length;e++){const i=a[e],l=el(i);if(/(?:\s)/.test(i)&&(g=e,m=d,_++),"\r"===i||"\n"===i){s.push(d),o.push(-1),p=Math.max(p,d),++f,++v,n.x=0,n.y+=t.lineHeight,c=null,_=0;continue}const u=t.chars[l];if(!u)continue;c&&u.kerning[c]&&(n.x+=u.kerning[c]);const x=al.pop()||{texture:sr.EMPTY,line:0,charCode:0,prevSpaces:0,position:new qi};x.texture=u.texture,x.line=f,x.charCode=l,x.position.x=Math.round(n.x+u.xOffset+this._letterSpacing/2),x.position.y=Math.round(n.y+u.yOffset),x.prevSpaces=_,r.push(x),d=x.position.x+Math.max(u.xAdvance-u.xOffset,u.texture.orig.width),n.x+=u.xAdvance+this._letterSpacing,y=Math.max(y,u.yOffset+u.texture.height),c=l,-1!==g&&h>0&&n.x>h&&(++v,ni(r,1+g-v,1+e-g),e=g,g=-1,s.push(m),o.push(r.length>0?r[r.length-1].prevSpaces:0),p=Math.max(p,m),f++,n.x=0,n.y+=t.lineHeight,c=null,_=0)}const x=a[a.length-1];"\r"!==x&&"\n"!==x&&(/(?:\s)/.test(x)&&(d=m),s.push(d),p=Math.max(p,d),o.push(-1));const b=[];for(let t=0;t<=f;t++){let e=0;"right"===this._align?e=p-s[t]:"center"===this._align?e=(p-s[t])/2:"justify"===this._align&&(e=o[t]<0?0:(p-s[t])/o[t]),b.push(e)}const w=r.length,T={},E=[],A=this._activePagesMeshData;l.push(...A);for(let e=0;e<w;e++){const i=r[e].texture,n=i.baseTexture.uid;if(!T[n]){let e=l.pop();if(!e){const i=new ch;let n,r;"none"===t.distanceFieldType?(n=new dh(sr.EMPTY),r=u.NORMAL):(n=new dh(sr.EMPTY,{program:Bn.from("// Mesh material default fragment\r\nattribute vec2 aVertexPosition;\r\nattribute vec2 aTextureCoord;\r\n\r\nuniform mat3 projectionMatrix;\r\nuniform mat3 translationMatrix;\r\nuniform mat3 uTextureMatrix;\r\n\r\nvarying vec2 vTextureCoord;\r\n\r\nvoid main(void)\r\n{\r\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r\n\r\n    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\r\n}\r\n","// Pixi texture info\r\nvarying vec2 vTextureCoord;\r\nuniform sampler2D uSampler;\r\n\r\n// Tint\r\nuniform vec4 uColor;\r\n\r\n// on 2D applications fwidth is screenScale / glyphAtlasScale * distanceFieldRange\r\nuniform float uFWidth;\r\n\r\nvoid main(void) {\r\n\r\n  // To stack MSDF and SDF we need a non-pre-multiplied-alpha texture.\r\n  vec4 texColor = texture2D(uSampler, vTextureCoord);\r\n\r\n  // MSDF\r\n  float median = texColor.r + texColor.g + texColor.b -\r\n                  min(texColor.r, min(texColor.g, texColor.b)) -\r\n                  max(texColor.r, max(texColor.g, texColor.b));\r\n  // SDF\r\n  median = min(median, texColor.a);\r\n\r\n  float screenPxDistance = uFWidth * (median - 0.5);\r\n  float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\r\n  if (median < 0.01) {\r\n    alpha = 0.0;\r\n  } else if (median > 0.99) {\r\n    alpha = 1.0;\r\n  }\r\n\r\n  // Gamma correction for coverage-like alpha\r\n  float luma = dot(uColor.rgb, vec3(0.299, 0.587, 0.114));\r\n  float gamma = mix(1.0, 1.0 / 2.2, luma);\r\n  float coverage = pow(uColor.a * alpha, gamma);  \r\n\r\n  // NPM Textures, NPM outputs\r\n  gl_FragColor = vec4(uColor.rgb, coverage);\r\n}\r\n"),uniforms:{uFWidth:0}}),r=u.NORMAL_NPM);const s=new uh(i,n);s.blendMode=r,e={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:s,vertices:null,uvs:null,indices:null}}e.index=0,e.indexCount=0,e.vertexCount=0,e.uvsCount=0,e.total=0;const{_textureCache:r}=this;r[n]=r[n]||new sr(i.baseTexture),e.mesh.texture=r[n],e.mesh.tint=this._tintColor.value,E.push(e),T[n]=e}T[n].total++}for(let t=0;t<A.length;t++)E.includes(A[t])||this.removeChild(A[t].mesh);for(let t=0;t<E.length;t++)E[t].mesh.parent!==this&&this.addChild(E[t].mesh);this._activePagesMeshData=E;for(const t in T){const e=T[t],i=e.total;if(!(e.indices?.length>6*i)||e.vertices.length<2*uh.BATCHABLE_SIZE)e.vertices=new Float32Array(8*i),e.uvs=new Float32Array(8*i),e.indices=new Uint16Array(6*i);else{const t=e.total,i=e.vertices;for(let e=4*t*2;e<i.length;e++)i[e]=0}e.mesh.size=6*i}for(let t=0;t<w;t++){const e=r[t];let n=e.position.x+b[e.line]*("justify"===this._align?e.prevSpaces:1);this._roundPixels&&(n=Math.round(n));const s=n*i,o=e.position.y*i,a=e.texture,h=T[a.baseTexture.uid],l=a.frame,u=a._uvs,c=h.index++;h.indices[6*c+0]=0+4*c,h.indices[6*c+1]=1+4*c,h.indices[6*c+2]=2+4*c,h.indices[6*c+3]=0+4*c,h.indices[6*c+4]=2+4*c,h.indices[6*c+5]=3+4*c,h.vertices[8*c+0]=s,h.vertices[8*c+1]=o,h.vertices[8*c+2]=s+l.width*i,h.vertices[8*c+3]=o,h.vertices[8*c+4]=s+l.width*i,h.vertices[8*c+5]=o+l.height*i,h.vertices[8*c+6]=s,h.vertices[8*c+7]=o+l.height*i,h.uvs[8*c+0]=u.x0,h.uvs[8*c+1]=u.y0,h.uvs[8*c+2]=u.x1,h.uvs[8*c+3]=u.y1,h.uvs[8*c+4]=u.x2,h.uvs[8*c+5]=u.y2,h.uvs[8*c+6]=u.x3,h.uvs[8*c+7]=u.y3}this._textWidth=p*i,this._textHeight=(n.y+t.lineHeight)*i;for(const t in T){const e=T[t];if(0!==this.anchor.x||0!==this.anchor.y){let t=0;const i=this._textWidth*this.anchor.x,n=this._textHeight*this.anchor.y;for(let r=0;r<e.total;r++)e.vertices[t++]-=i,e.vertices[t++]-=n,e.vertices[t++]-=i,e.vertices[t++]-=n,e.vertices[t++]-=i,e.vertices[t++]-=n,e.vertices[t++]-=i,e.vertices[t++]-=n}this._maxLineHeight=y*i;const n=e.mesh.geometry.getBuffer("aVertexPosition"),r=e.mesh.geometry.getBuffer("aTextureCoord"),s=e.mesh.geometry.getIndex();n.data=e.vertices,r.data=e.uvs,s.data=e.indices,n.update(),r.update(),s.update()}for(let t=0;t<r.length;t++)al.push(r[t]);this._font=t,this.dirty=!1}updateTransform(){this.validate(),this.containerUpdateTransform()}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0);const{distanceFieldRange:e,distanceFieldType:i,size:n}=rl.available[this._fontName];if("none"!==i){const{a:i,b:r,c:s,d:o}=this.worldTransform,a=Math.sqrt(i*i+r*r),h=Math.sqrt(s*s+o*o),l=(Math.abs(a)+Math.abs(h))/2,u=this.fontSize/n,c=t._view.resolution;for(const t of this._activePagesMeshData)t.mesh.shader.uniforms.uFWidth=l*e*u*c}super._render(t)}getLocalBounds(){return this.validate(),super.getLocalBounds()}validate(){const t=rl.available[this._fontName];if(!t)throw new Error(`Missing BitmapFont "${this._fontName}"`);this._font!==t&&(this.dirty=!0),this.dirty&&this.updateText()}get tint(){return this._tintColor.value}set tint(t){if(this.tint!==t){this._tintColor.setValue(t);for(let e=0;e<this._activePagesMeshData.length;e++)this._activePagesMeshData[e].mesh.tint=t}}get align(){return this._align}set align(t){this._align!==t&&(this._align=t,this.dirty=!0)}get fontName(){return this._fontName}set fontName(t){if(!rl.available[t])throw new Error(`Missing BitmapFont "${t}"`);this._fontName!==t&&(this._fontName=t,this.dirty=!0)}get fontSize(){return this._fontSize??rl.available[this._fontName].size}set fontSize(t){this._fontSize!==t&&(this._fontSize=t,this.dirty=!0)}get anchor(){return this._anchor}set anchor(t){"number"==typeof t?this._anchor.set(t):this._anchor.copyFrom(t)}get text(){return this._text}set text(t){t=String(null==t?"":t),this._text!==t&&(this._text=t,this.dirty=!0)}get maxWidth(){return this._maxWidth}set maxWidth(t){this._maxWidth!==t&&(this._maxWidth=t,this.dirty=!0)}get maxLineHeight(){return this.validate(),this._maxLineHeight}get textWidth(){return this.validate(),this._textWidth}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.dirty=!0)}get roundPixels(){return this._roundPixels}set roundPixels(t){t!==this._roundPixels&&(this._roundPixels=t,this.dirty=!0)}get textHeight(){return this.validate(),this._textHeight}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}destroy(t){const{_textureCache:e}=this,i="none"===rl.available[this._fontName].distanceFieldType?sl:ol;i.push(...this._activePagesMeshData);for(const t of this._activePagesMeshData)this.removeChild(t.mesh);this._activePagesMeshData=[],i.filter((t=>e[t.mesh.texture.baseTexture.uid])).forEach((t=>{t.mesh.texture=sr.EMPTY}));for(const t in e){e[t].destroy(),delete e[t]}this._font=null,this._tintColor=null,this._textureCache=null,super.destroy(t)}};hl.styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0};const ll=[".xml",".fnt"],ul={extension:{type:_i.LoadParser,priority:go.Normal},name:"loadBitmapFont",test:t=>ll.includes(ve.extname(t).toLowerCase()),testParse:async t=>Kh.test(t)||Jh.test(t),async parse(t,e,i){const n=Kh.test(t)?Kh.parse(t):Jh.parse(t),{src:r}=e,{page:s}=n,o=[];for(let t=0;t<s.length;++t){const e=s[t].file;let i=ve.join(ve.dirname(r),e);i=ho(i,r),o.push(i)}const a=await i.load(o),h=o.map((t=>a[t]));return rl.install(n,h,!0)},load:async(t,e)=>(await C.ADAPTER.fetch(t)).text(),unload(t){t.destroy()}};wi.add(ul);const cl=class extends bh{constructor(){super(...arguments),this._fonts=[],this._overrides=[],this._stylesheet="",this.fontsDirty=!1}static from(t){return new cl(Object.keys(cl.defaultOptions).reduce(((e,i)=>({...e,[i]:t[i]})),{}))}cleanFonts(){this._fonts.length>0&&(this._fonts.forEach((t=>{URL.revokeObjectURL(t.src),t.refs--,0===t.refs&&(t.fontFace&&document.fonts.delete(t.fontFace),delete cl.availableFonts[t.originalUrl])})),this.fontFamily="Arial",this._fonts.length=0,this.styleID++,this.fontsDirty=!0)}loadFont(t,e={}){const{availableFonts:i}=cl;if(i[t]){const e=i[t];return this._fonts.push(e),e.refs++,this.styleID++,this.fontsDirty=!0,Promise.resolve()}return C.ADAPTER.fetch(t).then((t=>t.blob())).then((async t=>new Promise(((e,i)=>{const n=URL.createObjectURL(t),r=new FileReader;r.onload=()=>e([n,r.result]),r.onerror=i,r.readAsDataURL(t)})))).then((async([n,r])=>{const s=Object.assign({family:ve.basename(t,ve.extname(t)),weight:"normal",style:"normal",src:n,dataSrc:r,refs:1,originalUrl:t,fontFace:null},e);i[t]=s,this._fonts.push(s),this.styleID++;const o=new FontFace(s.family,`url(${s.src})`,{weight:s.weight,style:s.style});s.fontFace=o,await o.load(),document.fonts.add(o),await document.fonts.ready,this.styleID++,this.fontsDirty=!0}))}addOverride(...t){const e=t.filter((t=>!this._overrides.includes(t)));e.length>0&&(this._overrides.push(...e),this.styleID++)}removeOverride(...t){const e=t.filter((t=>this._overrides.includes(t)));e.length>0&&(this._overrides=this._overrides.filter((t=>!e.includes(t))),this.styleID++)}toCSS(t){return[`transform: scale(${t})`,"transform-origin: top left","display: inline-block",`color: ${this.normalizeColor(this.fill)}`,`font-size: ${this.fontSize}px`,`font-family: ${this.fontFamily}`,`font-weight: ${this.fontWeight}`,`font-style: ${this.fontStyle}`,`font-variant: ${this.fontVariant}`,`letter-spacing: ${this.letterSpacing}px`,`text-align: ${this.align}`,`padding: ${this.padding}px`,`white-space: ${this.whiteSpace}`,...this.lineHeight?[`line-height: ${this.lineHeight}px`]:[],...this.wordWrap?["word-wrap: "+(this.breakWords?"break-all":"break-word"),`max-width: ${this.wordWrapWidth}px`]:[],...this.strokeThickness?[`-webkit-text-stroke-width: ${this.strokeThickness}px`,`-webkit-text-stroke-color: ${this.normalizeColor(this.stroke)}`,`text-stroke-width: ${this.strokeThickness}px`,`text-stroke-color: ${this.normalizeColor(this.stroke)}`,"paint-order: stroke"]:[],...this.dropShadow?[this.dropShadowToCSS()]:[],...this._overrides].join(";")}toGlobalCSS(){return this._fonts.reduce(((t,e)=>`${t}\n            @font-face {\n                font-family: "${e.family}";\n                src: url('${e.dataSrc}');\n                font-weight: ${e.weight};\n                font-style: ${e.style}; \n            }`),this._stylesheet)}get stylesheet(){return this._stylesheet}set stylesheet(t){this._stylesheet!==t&&(this._stylesheet=t,this.styleID++)}normalizeColor(t){var e,i;return Array.isArray(t)&&(e=t,_e("7.2.0","utils.rgb2hex is deprecated, use Color#toNumber instead"),t=qe.shared.setValue(e).toNumber()),"number"==typeof t?(i=t,_e("7.2.0","utils.hex2string is deprecated, use Color#toHex instead"),qe.shared.setValue(i).toHex()):t}dropShadowToCSS(){let t=this.normalizeColor(this.dropShadowColor);const e=this.dropShadowAlpha,i=Math.round(Math.cos(this.dropShadowAngle)*this.dropShadowDistance),n=Math.round(Math.sin(this.dropShadowAngle)*this.dropShadowDistance);t.startsWith("#")&&e<1&&(t+=(255*e|0).toString(16).padStart(2,"0"));const r=`${i}px ${n}px`;return this.dropShadowBlur>0?`text-shadow: ${r} ${this.dropShadowBlur}px ${t}`:`text-shadow: ${r} ${t}`}reset(){Object.assign(this,cl.defaultOptions)}onBeforeDraw(){const{fontsDirty:t}=this;return this.fontsDirty=!1,this.isSafari&&this._fonts.length>0&&t?new Promise((t=>setTimeout(t,100))):Promise.resolve()}get isSafari(){const{userAgent:t}=C.ADAPTER.getNavigator();return/^((?!chrome|android).)*safari/i.test(t)}set fillGradientStops(t){console.warn("[HTMLTextStyle] fillGradientStops is not supported by HTMLText")}get fillGradientStops(){return super.fillGradientStops}set fillGradientType(t){console.warn("[HTMLTextStyle] fillGradientType is not supported by HTMLText")}get fillGradientType(){return super.fillGradientType}set miterLimit(t){console.warn("[HTMLTextStyle] miterLimit is not supported by HTMLText")}get miterLimit(){return super.miterLimit}set trim(t){console.warn("[HTMLTextStyle] trim is not supported by HTMLText")}get trim(){return super.trim}set textBaseline(t){console.warn("[HTMLTextStyle] textBaseline is not supported by HTMLText")}get textBaseline(){return super.textBaseline}set leading(t){console.warn("[HTMLTextStyle] leading is not supported by HTMLText")}get leading(){return super.leading}set lineJoin(t){console.warn("[HTMLTextStyle] lineJoin is not supported by HTMLText")}get lineJoin(){return super.lineJoin}};let dl=cl;dl.availableFonts={},dl.defaultOptions={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,padding:0,stroke:"black",strokeThickness:0,whiteSpace:"normal",wordWrap:!1,wordWrapWidth:100};const pl=class extends Ds{constructor(t="",e={}){super(sr.EMPTY),this._text=null,this._style=null,this._autoResolution=!0,this._loading=!1,this.localStyleID=-1,this.dirty=!1,this.ownsStyle=!1;const i=new Image,n=sr.from(i,{scaleMode:C.SCALE_MODE,resourceOptions:{autoLoad:!1}});n.orig=new Zi,n.trim=new Zi,this.texture=n;const r="http://www.w3.org/2000/svg",s="http://www.w3.org/1999/xhtml",o=document.createElementNS(r,"svg"),a=document.createElementNS(r,"foreignObject"),h=document.createElementNS(s,"div"),l=document.createElementNS(s,"style");a.setAttribute("width","10000"),a.setAttribute("height","10000"),a.style.overflow="hidden",o.appendChild(a),this.maxWidth=pl.defaultMaxWidth,this.maxHeight=pl.defaultMaxHeight,this._domElement=h,this._styleElement=l,this._svgRoot=o,this._foreignObject=a,this._foreignObject.appendChild(l),this._foreignObject.appendChild(h),this._image=i,this._loadImage=new Image,this._autoResolution=pl.defaultAutoResolution,this._resolution=pl.defaultResolution??C.RESOLUTION,this.text=t,this.style=e}measureText(t){const{text:e,style:i,resolution:n}=Object.assign({text:this._text,style:this._style,resolution:this._resolution},t);Object.assign(this._domElement,{innerHTML:e,style:i.toCSS(n)}),this._styleElement.textContent=i.toGlobalCSS(),document.body.appendChild(this._svgRoot);const r=this._domElement.getBoundingClientRect();this._svgRoot.remove();const s=Math.min(this.maxWidth,Math.ceil(r.width)),o=Math.min(this.maxHeight,Math.ceil(r.height));return this._svgRoot.setAttribute("width",s.toString()),this._svgRoot.setAttribute("height",o.toString()),e!==this._text&&(this._domElement.innerHTML=this._text),i!==this._style&&(Object.assign(this._domElement,{style:this._style?.toCSS(n)}),this._styleElement.textContent=this._style?.toGlobalCSS()),{width:s+2*i.padding,height:o+2*i.padding}}async updateText(t=!0){const{style:e,_image:i,_loadImage:n}=this;if(this.localStyleID!==e.styleID&&(this.dirty=!0,this.localStyleID=e.styleID),!this.dirty&&t)return;const{width:r,height:s}=this.measureText();i.width=n.width=Math.ceil(Math.max(1,r)),i.height=n.height=Math.ceil(Math.max(1,s)),this._loading||(this._loading=!0,await new Promise((t=>{n.onload=async()=>{await e.onBeforeDraw(),this._loading=!1,i.src=n.src,n.onload=null,n.src="",this.updateTexture(),t()};const r=(new XMLSerializer).serializeToString(this._svgRoot);n.src=`data:image/svg+xml;charset=utf8,${encodeURIComponent(r)}`})))}get source(){return this._image}updateTexture(){const{style:t,texture:e,_image:i,resolution:n}=this,{padding:r}=t,{baseTexture:s}=e;e.trim.width=e._frame.width=i.width/n,e.trim.height=e._frame.height=i.height/n,e.trim.x=-r,e.trim.y=-r,e.orig.width=e._frame.width-2*r,e.orig.height=e._frame.height-2*r,this._onTextureUpdate(),s.setRealSize(i.width,i.height,n),this.dirty=!1}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._render(t)}_renderCanvas(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._renderCanvas(t)}getLocalBounds(t){return this.updateText(!0),super.getLocalBounds(t)}_calculateBounds(){this.updateText(!0),this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_onStyleChange(){this.dirty=!0}destroy(t){"boolean"==typeof t&&(t={children:t}),t=Object.assign({},pl.defaultDestroyOptions,t),super.destroy(t);const e=null;this.ownsStyle&&this._style?.cleanFonts(),this._style=e,this._svgRoot?.remove(),this._svgRoot=e,this._domElement?.remove(),this._domElement=e,this._foreignObject?.remove(),this._foreignObject=e,this._styleElement?.remove(),this._styleElement=e,this._loadImage.src="",this._loadImage.onload=null,this._loadImage=e,this._image.src="",this._image=e}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._image.width/this.resolution}set width(t){this.updateText(!0);const e=ri(this.scale.x)||1;this.scale.x=e*t/this._image.width/this.resolution,this._width=t}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._image.height/this.resolution}set height(t){this.updateText(!0);const e=ri(this.scale.y)||1;this.scale.y=e*t/this._image.height/this.resolution,this._height=t}get style(){return this._style}set style(t){this._style!==t&&((t=t||{})instanceof dl?(this.ownsStyle=!1,this._style=t):t instanceof bh?(console.warn("[HTMLText] Cloning TextStyle, if this is not what you want, use HTMLTextStyle"),this.ownsStyle=!0,this._style=dl.from(t)):(this.ownsStyle=!0,this._style=new dl(t)),this.localStyleID=-1,this.dirty=!0)}get text(){return this._text}set text(t){t=String(""===t||null==t?" ":t),t=this.sanitiseText(t),this._text!==t&&(this._text=t,this.dirty=!0)}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}sanitiseText(t){return t.replace(/<br>/gi,"<br/>").replace(/<hr>/gi,"<hr/>").replace(/&nbsp;/gi,"&#160;")}};let fl=pl;fl.defaultDestroyOptions={texture:!0,children:!1,baseTexture:!0},fl.defaultMaxWidth=2024,fl.defaultMaxHeight=2024,fl.defaultAutoResolution=!0;var gl=Object.defineProperty,ml=(t,e,i)=>(((t,e,i)=>{e in t?gl(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i})(t,"symbol"!=typeof e?e+"":e,i),i);class vl{constructor(t){ml(this,"parent"),ml(this,"paused"),this.parent=t,this.paused=!1}destroy(){}down(t){return!1}move(t){return!1}up(t){return!1}wheel(t){return!1}update(t){}resize(){}reset(){}pause(){this.paused=!0}resume(){this.paused=!1}}var yl=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof Gt<"u"?Gt:typeof self<"u"?self:{},_l={exports:{}};!function(t,e){(function(){var e,i;i=function(e){return t.exports=e},e={linear:function(t,e,i,n){return i*t/n+e},easeInQuad:function(t,e,i,n){return i*(t/=n)*t+e},easeOutQuad:function(t,e,i,n){return-i*(t/=n)*(t-2)+e},easeInOutQuad:function(t,e,i,n){return(t/=n/2)<1?i/2*t*t+e:-i/2*(--t*(t-2)-1)+e},easeInCubic:function(t,e,i,n){return i*(t/=n)*t*t+e},easeOutCubic:function(t,e,i,n){return i*((t=t/n-1)*t*t+1)+e},easeInOutCubic:function(t,e,i,n){return(t/=n/2)<1?i/2*t*t*t+e:i/2*((t-=2)*t*t+2)+e},easeInQuart:function(t,e,i,n){return i*(t/=n)*t*t*t+e},easeOutQuart:function(t,e,i,n){return-i*((t=t/n-1)*t*t*t-1)+e},easeInOutQuart:function(t,e,i,n){return(t/=n/2)<1?i/2*t*t*t*t+e:-i/2*((t-=2)*t*t*t-2)+e},easeInQuint:function(t,e,i,n){return i*(t/=n)*t*t*t*t+e},easeOutQuint:function(t,e,i,n){return i*((t=t/n-1)*t*t*t*t+1)+e},easeInOutQuint:function(t,e,i,n){return(t/=n/2)<1?i/2*t*t*t*t*t+e:i/2*((t-=2)*t*t*t*t+2)+e},easeInSine:function(t,e,i,n){return-i*Math.cos(t/n*(Math.PI/2))+i+e},easeOutSine:function(t,e,i,n){return i*Math.sin(t/n*(Math.PI/2))+e},easeInOutSine:function(t,e,i,n){return-i/2*(Math.cos(Math.PI*t/n)-1)+e},easeInExpo:function(t,e,i,n){return 0===t?e:i*Math.pow(2,10*(t/n-1))+e},easeOutExpo:function(t,e,i,n){return t===n?e+i:i*(1-Math.pow(2,-10*t/n))+e},easeInOutExpo:function(t,e,i,n){return(t/=n/2)<1?i/2*Math.pow(2,10*(t-1))+e:i/2*(2-Math.pow(2,-10*--t))+e},easeInCirc:function(t,e,i,n){return-i*(Math.sqrt(1-(t/=n)*t)-1)+e},easeOutCirc:function(t,e,i,n){return i*Math.sqrt(1-(t=t/n-1)*t)+e},easeInOutCirc:function(t,e,i,n){return(t/=n/2)<1?-i/2*(Math.sqrt(1-t*t)-1)+e:i/2*(Math.sqrt(1-(t-=2)*t)+1)+e},easeInElastic:function(t,e,i,n){var r,s,o;return o=1.70158,0===t||(t/=n),(s=0)||(s=.3*n),(r=i)<Math.abs(i)?(r=i,o=s/4):o=s/(2*Math.PI)*Math.asin(i/r),-r*Math.pow(2,10*(t-=1))*Math.sin((t*n-o)*(2*Math.PI)/s)+e},easeOutElastic:function(t,e,i,n){var r,s,o;return o=1.70158,0===t||(t/=n),(s=0)||(s=.3*n),(r=i)<Math.abs(i)?(r=i,o=s/4):o=s/(2*Math.PI)*Math.asin(i/r),r*Math.pow(2,-10*t)*Math.sin((t*n-o)*(2*Math.PI)/s)+i+e},easeInOutElastic:function(t,e,i,n){var r,s,o;return o=1.70158,0===t||(t/=n/2),(s=0)||(s=n*(.3*1.5)),(r=i)<Math.abs(i)?(r=i,o=s/4):o=s/(2*Math.PI)*Math.asin(i/r),t<1?r*Math.pow(2,10*(t-=1))*Math.sin((t*n-o)*(2*Math.PI)/s)*-.5+e:r*Math.pow(2,-10*(t-=1))*Math.sin((t*n-o)*(2*Math.PI)/s)*.5+i+e},easeInBack:function(t,e,i,n,r){return void 0===r&&(r=1.70158),i*(t/=n)*t*((r+1)*t-r)+e},easeOutBack:function(t,e,i,n,r){return void 0===r&&(r=1.70158),i*((t=t/n-1)*t*((r+1)*t+r)+1)+e},easeInOutBack:function(t,e,i,n,r){return void 0===r&&(r=1.70158),(t/=n/2)<1?i/2*(t*t*((1+(r*=1.525))*t-r))+e:i/2*((t-=2)*t*((1+(r*=1.525))*t+r)+2)+e},easeInBounce:function(t,i,n,r){return n-e.easeOutBounce(r-t,0,n,r)+i},easeOutBounce:function(t,e,i,n){return(t/=n)<1/2.75?i*(7.5625*t*t)+e:t<2/2.75?i*(7.5625*(t-=1.5/2.75)*t+.75)+e:t<2.5/2.75?i*(7.5625*(t-=2.25/2.75)*t+.9375)+e:i*(7.5625*(t-=2.625/2.75)*t+.984375)+e},easeInOutBounce:function(t,i,n,r){return t<r/2?.5*e.easeInBounce(2*t,0,n,r)+i:.5*e.easeOutBounce(2*t-r,0,n,r)+.5*n+i}},i(e)}).call(yl)}(_l);const xl=_l.exports;function bl(t,e){return t?"function"==typeof t?t:"string"==typeof t?xl[t]:void 0:xl[e]}const wl={removeOnInterrupt:!1,ease:"linear",time:1e3};class Tl extends vl{constructor(t,e={}){super(t),ml(this,"options"),ml(this,"startX"),ml(this,"startY"),ml(this,"deltaX"),ml(this,"deltaY"),ml(this,"keepCenter"),ml(this,"startWidth",null),ml(this,"startHeight",null),ml(this,"deltaWidth",null),ml(this,"deltaHeight",null),ml(this,"width",null),ml(this,"height",null),ml(this,"time",0),this.options=Object.assign({},wl,e),this.options.ease=bl(this.options.ease),this.setupPosition(),this.setupZoom(),this.time=0}setupPosition(){typeof this.options.position<"u"?(this.startX=this.parent.center.x,this.startY=this.parent.center.y,this.deltaX=this.options.position.x-this.parent.center.x,this.deltaY=this.options.position.y-this.parent.center.y,this.keepCenter=!1):this.keepCenter=!0}setupZoom(){this.width=null,this.height=null,typeof this.options.scale<"u"?this.width=this.parent.screenWidth/this.options.scale:typeof this.options.scaleX<"u"||typeof this.options.scaleY<"u"?(typeof this.options.scaleX<"u"&&(this.width=this.parent.screenWidth/this.options.scaleX),typeof this.options.scaleY<"u"&&(this.height=this.parent.screenHeight/this.options.scaleY)):(typeof this.options.width<"u"&&(this.width=this.options.width),typeof this.options.height<"u"&&(this.height=this.options.height)),null!==this.width&&(this.startWidth=this.parent.screenWidthInWorldPixels,this.deltaWidth=this.width-this.startWidth),null!==this.height&&(this.startHeight=this.parent.screenHeightInWorldPixels,this.deltaHeight=this.height-this.startHeight)}down(){return this.options.removeOnInterrupt&&this.parent.plugins.remove("animate"),!1}complete(){this.parent.plugins.remove("animate"),null!==this.width&&this.parent.fitWidth(this.width,this.keepCenter,null===this.height),null!==this.height&&this.parent.fitHeight(this.height,this.keepCenter,null===this.width),!this.keepCenter&&this.options.position&&this.parent.moveCenter(this.options.position),this.parent.emit("animate-end",this.parent),this.options.callbackOnComplete&&this.options.callbackOnComplete(this.parent)}update(t){if(this.paused)return;this.time+=t;const e=new qi(this.parent.scale.x,this.parent.scale.y);if(this.time>=this.options.time){const t=this.parent.width,i=this.parent.height;this.complete(),(t!==this.parent.width||i!==this.parent.height)&&this.parent.emit("zoomed",{viewport:this.parent,original:e,type:"animate"})}else{const t=this.options.ease(this.time,0,1,this.options.time);if(null!==this.width){const e=this.startWidth,i=this.deltaWidth;this.parent.fitWidth(e+i*t,this.keepCenter,null===this.height)}if(null!==this.height){const e=this.startHeight,i=this.deltaHeight;this.parent.fitHeight(e+i*t,this.keepCenter,null===this.width)}if(null===this.width?this.parent.scale.x=this.parent.scale.y:null===this.height&&(this.parent.scale.y=this.parent.scale.x),!this.keepCenter){const e=this.startX,i=this.startY,n=this.deltaX,r=this.deltaY,s=new qi(this.parent.x,this.parent.y);this.parent.moveCenter(e+n*t,i+r*t),this.parent.emit("moved",{viewport:this.parent,original:s,type:"animate"})}(this.width||this.height)&&this.parent.emit("zoomed",{viewport:this.parent,original:e,type:"animate"})}}}const El={sides:"all",friction:.5,time:150,ease:"easeInOutSine",underflow:"center",bounceBox:null};class Al extends vl{constructor(t,e={}){super(t),ml(this,"options"),ml(this,"left"),ml(this,"top"),ml(this,"right"),ml(this,"bottom"),ml(this,"underflowX"),ml(this,"underflowY"),ml(this,"ease"),ml(this,"toX"),ml(this,"toY"),this.options=Object.assign({},El,e),this.ease=bl(this.options.ease,"easeInOutSine"),this.options.sides?"all"===this.options.sides?this.top=this.bottom=this.left=this.right=!0:"horizontal"===this.options.sides?(this.right=this.left=!0,this.top=this.bottom=!1):"vertical"===this.options.sides?(this.left=this.right=!1,this.top=this.bottom=!0):(this.top=-1!==this.options.sides.indexOf("top"),this.bottom=-1!==this.options.sides.indexOf("bottom"),this.left=-1!==this.options.sides.indexOf("left"),this.right=-1!==this.options.sides.indexOf("right")):this.left=this.top=this.right=this.bottom=!1;const i=this.options.underflow.toLowerCase();"center"===i?(this.underflowX=0,this.underflowY=0):(this.underflowX=-1!==i.indexOf("left")?-1:-1!==i.indexOf("right")?1:0,this.underflowY=-1!==i.indexOf("top")?-1:-1!==i.indexOf("bottom")?1:0),this.reset()}isActive(){return null!==this.toX||null!==this.toY}down(){return this.toX=this.toY=null,!1}up(){return this.bounce(),!1}update(t){if(!this.paused){if(this.bounce(),this.toX){const e=this.toX;e.time+=t,this.parent.emit("moved",{viewport:this.parent,type:"bounce-x"}),e.time>=this.options.time?(this.parent.x=e.end,this.toX=null,this.parent.emit("bounce-x-end",this.parent)):this.parent.x=this.ease(e.time,e.start,e.delta,this.options.time)}if(this.toY){const e=this.toY;e.time+=t,this.parent.emit("moved",{viewport:this.parent,type:"bounce-y"}),e.time>=this.options.time?(this.parent.y=e.end,this.toY=null,this.parent.emit("bounce-y-end",this.parent)):this.parent.y=this.ease(e.time,e.start,e.delta,this.options.time)}}}calcUnderflowX(){let t;switch(this.underflowX){case-1:t=0;break;case 1:t=this.parent.screenWidth-this.parent.screenWorldWidth;break;default:t=(this.parent.screenWidth-this.parent.screenWorldWidth)/2}return t}calcUnderflowY(){let t;switch(this.underflowY){case-1:t=0;break;case 1:t=this.parent.screenHeight-this.parent.screenWorldHeight;break;default:t=(this.parent.screenHeight-this.parent.screenWorldHeight)/2}return t}oob(){const t=this.options.bounceBox;if(t){const e=typeof t.x>"u"?0:t.x,i=typeof t.y>"u"?0:t.y,n=typeof t.width>"u"?this.parent.worldWidth:t.width,r=typeof t.height>"u"?this.parent.worldHeight:t.height;return{left:this.parent.left<e,right:this.parent.right>n,top:this.parent.top<i,bottom:this.parent.bottom>r,topLeft:new qi(e*this.parent.scale.x,i*this.parent.scale.y),bottomRight:new qi(n*this.parent.scale.x-this.parent.screenWidth,r*this.parent.scale.y-this.parent.screenHeight)}}return{left:this.parent.left<0,right:this.parent.right>this.parent.worldWidth,top:this.parent.top<0,bottom:this.parent.bottom>this.parent.worldHeight,topLeft:new qi(0,0),bottomRight:new qi(this.parent.worldWidth*this.parent.scale.x-this.parent.screenWidth,this.parent.worldHeight*this.parent.scale.y-this.parent.screenHeight)}}bounce(){var t,e;if(this.paused)return;let i,n=this.parent.plugins.get("decelerate",!0);n&&(n.x||n.y)&&(n.x&&n.percentChangeX===(null==(t=n.options)?void 0:t.friction)||n.y&&n.percentChangeY===(null==(e=n.options)?void 0:e.friction))&&(i=this.oob(),(i.left&&this.left||i.right&&this.right)&&(n.percentChangeX=this.options.friction),(i.top&&this.top||i.bottom&&this.bottom)&&(n.percentChangeY=this.options.friction));const r=this.parent.plugins.get("drag",!0)||{},s=this.parent.plugins.get("pinch",!0)||{};if(n=n||{},!(null!=r&&r.active||null!=s&&s.active||this.toX&&this.toY||n.x&&n.y)){i=i||this.oob();const t=i.topLeft,e=i.bottomRight;if(!this.toX&&!n.x){let n=null;i.left&&this.left?n=this.parent.screenWorldWidth<this.parent.screenWidth?this.calcUnderflowX():-t.x:i.right&&this.right&&(n=this.parent.screenWorldWidth<this.parent.screenWidth?this.calcUnderflowX():-e.x),null!==n&&this.parent.x!==n&&(this.toX={time:0,start:this.parent.x,delta:n-this.parent.x,end:n},this.parent.emit("bounce-x-start",this.parent))}if(!this.toY&&!n.y){let n=null;i.top&&this.top?n=this.parent.screenWorldHeight<this.parent.screenHeight?this.calcUnderflowY():-t.y:i.bottom&&this.bottom&&(n=this.parent.screenWorldHeight<this.parent.screenHeight?this.calcUnderflowY():-e.y),null!==n&&this.parent.y!==n&&(this.toY={time:0,start:this.parent.y,delta:n-this.parent.y,end:n},this.parent.emit("bounce-y-start",this.parent))}}}reset(){this.toX=this.toY=null,this.bounce()}}const Sl={left:!1,right:!1,top:!1,bottom:!1,direction:null,underflow:"center"};class Cl extends vl{constructor(t,e={}){super(t),ml(this,"options"),ml(this,"last"),ml(this,"noUnderflow"),ml(this,"underflowX"),ml(this,"underflowY"),this.options=Object.assign({},Sl,e),this.options.direction&&(this.options.left="x"===this.options.direction||"all"===this.options.direction||null,this.options.right="x"===this.options.direction||"all"===this.options.direction||null,this.options.top="y"===this.options.direction||"all"===this.options.direction||null,this.options.bottom="y"===this.options.direction||"all"===this.options.direction||null),this.parseUnderflow(),this.last={x:null,y:null,scaleX:null,scaleY:null},this.update()}parseUnderflow(){const t=this.options.underflow.toLowerCase();"none"===t?this.noUnderflow=!0:"center"===t?(this.underflowX=this.underflowY=0,this.noUnderflow=!1):(this.underflowX=-1!==t.indexOf("left")?-1:-1!==t.indexOf("right")?1:0,this.underflowY=-1!==t.indexOf("top")?-1:-1!==t.indexOf("bottom")?1:0,this.noUnderflow=!1)}move(){return this.update(),!1}update(){if(this.paused||this.parent.x===this.last.x&&this.parent.y===this.last.y&&this.parent.scale.x===this.last.scaleX&&this.parent.scale.y===this.last.scaleY)return;const t=new qi(this.parent.x,this.parent.y),e=this.parent.plugins.decelerate||{};if(null!==this.options.left||null!==this.options.right){let i=!1;if(!this.noUnderflow&&this.parent.screenWorldWidth<this.parent.screenWidth)switch(this.underflowX){case-1:0!==this.parent.x&&(this.parent.x=0,i=!0);break;case 1:this.parent.x!==this.parent.screenWidth-this.parent.screenWorldWidth&&(this.parent.x=this.parent.screenWidth-this.parent.screenWorldWidth,i=!0);break;default:this.parent.x!==(this.parent.screenWidth-this.parent.screenWorldWidth)/2&&(this.parent.x=(this.parent.screenWidth-this.parent.screenWorldWidth)/2,i=!0)}else null!==this.options.left&&this.parent.left<(!0===this.options.left?0:this.options.left)&&(this.parent.x=-(!0===this.options.left?0:this.options.left)*this.parent.scale.x,e.x=0,i=!0),null!==this.options.right&&this.parent.right>(!0===this.options.right?this.parent.worldWidth:this.options.right)&&(this.parent.x=-(!0===this.options.right?this.parent.worldWidth:this.options.right)*this.parent.scale.x+this.parent.screenWidth,e.x=0,i=!0);i&&this.parent.emit("moved",{viewport:this.parent,original:t,type:"clamp-x"})}if(null!==this.options.top||null!==this.options.bottom){let i=!1;if(!this.noUnderflow&&this.parent.screenWorldHeight<this.parent.screenHeight)switch(this.underflowY){case-1:0!==this.parent.y&&(this.parent.y=0,i=!0);break;case 1:this.parent.y!==this.parent.screenHeight-this.parent.screenWorldHeight&&(this.parent.y=this.parent.screenHeight-this.parent.screenWorldHeight,i=!0);break;default:this.parent.y!==(this.parent.screenHeight-this.parent.screenWorldHeight)/2&&(this.parent.y=(this.parent.screenHeight-this.parent.screenWorldHeight)/2,i=!0)}else null!==this.options.top&&this.parent.top<(!0===this.options.top?0:this.options.top)&&(this.parent.y=-(!0===this.options.top?0:this.options.top)*this.parent.scale.y,e.y=0,i=!0),null!==this.options.bottom&&this.parent.bottom>(!0===this.options.bottom?this.parent.worldHeight:this.options.bottom)&&(this.parent.y=-(!0===this.options.bottom?this.parent.worldHeight:this.options.bottom)*this.parent.scale.y+this.parent.screenHeight,e.y=0,i=!0);i&&this.parent.emit("moved",{viewport:this.parent,original:t,type:"clamp-y"})}this.last.x=this.parent.x,this.last.y=this.parent.y,this.last.scaleX=this.parent.scale.x,this.last.scaleY=this.parent.scale.y}reset(){this.update()}}const Il={minWidth:null,minHeight:null,maxWidth:null,maxHeight:null,minScale:null,maxScale:null};class Ml extends vl{constructor(t,e={}){super(t),ml(this,"options"),this.options=Object.assign({},Il,e),this.clamp()}resize(){this.clamp()}clamp(){if(!this.paused)if(this.options.minWidth||this.options.minHeight||this.options.maxWidth||this.options.maxHeight){let t=this.parent.worldScreenWidth,e=this.parent.worldScreenHeight;if(null!==this.options.minWidth&&t<this.options.minWidth){const i=this.parent.scale.x;this.parent.fitWidth(this.options.minWidth,!1,!1,!0),this.parent.scale.y*=this.parent.scale.x/i,t=this.parent.worldScreenWidth,e=this.parent.worldScreenHeight,this.parent.emit("zoomed",{viewport:this.parent,type:"clamp-zoom"})}if(null!==this.options.maxWidth&&t>this.options.maxWidth){const i=this.parent.scale.x;this.parent.fitWidth(this.options.maxWidth,!1,!1,!0),this.parent.scale.y*=this.parent.scale.x/i,t=this.parent.worldScreenWidth,e=this.parent.worldScreenHeight,this.parent.emit("zoomed",{viewport:this.parent,type:"clamp-zoom"})}if(null!==this.options.minHeight&&e<this.options.minHeight){const i=this.parent.scale.y;this.parent.fitHeight(this.options.minHeight,!1,!1,!0),this.parent.scale.x*=this.parent.scale.y/i,t=this.parent.worldScreenWidth,e=this.parent.worldScreenHeight,this.parent.emit("zoomed",{viewport:this.parent,type:"clamp-zoom"})}if(null!==this.options.maxHeight&&e>this.options.maxHeight){const t=this.parent.scale.y;this.parent.fitHeight(this.options.maxHeight,!1,!1,!0),this.parent.scale.x*=this.parent.scale.y/t,this.parent.emit("zoomed",{viewport:this.parent,type:"clamp-zoom"})}}else if(this.options.minScale||this.options.maxScale){const t={x:null,y:null},e={x:null,y:null};if("number"==typeof this.options.minScale)t.x=this.options.minScale,t.y=this.options.minScale;else if(null!==this.options.minScale){const e=this.options.minScale;t.x=typeof e.x>"u"?null:e.x,t.y=typeof e.y>"u"?null:e.y}if("number"==typeof this.options.maxScale)e.x=this.options.maxScale,e.y=this.options.maxScale;else if(null!==this.options.maxScale){const t=this.options.maxScale;e.x=typeof t.x>"u"?null:t.x,e.y=typeof t.y>"u"?null:t.y}let i=this.parent.scale.x,n=this.parent.scale.y;null!==t.x&&i<t.x&&(i=t.x),null!==e.x&&i>e.x&&(i=e.x),null!==t.y&&n<t.y&&(n=t.y),null!==e.y&&n>e.y&&(n=e.y),(i!==this.parent.scale.x||n!==this.parent.scale.y)&&(this.parent.scale.set(i,n),this.parent.emit("zoomed",{viewport:this.parent,type:"clamp-zoom"}))}}reset(){this.clamp()}}const Rl={friction:.98,bounce:.8,minSpeed:.01},Pl=16;class Dl extends vl{constructor(t,e={}){super(t),ml(this,"options"),ml(this,"x"),ml(this,"y"),ml(this,"percentChangeX"),ml(this,"percentChangeY"),ml(this,"saved"),ml(this,"timeSinceRelease"),this.options=Object.assign({},Rl,e),this.saved=[],this.timeSinceRelease=0,this.reset(),this.parent.on("moved",(t=>this.handleMoved(t)))}down(){return this.saved=[],this.x=this.y=null,!1}isActive(){return!(!this.x&&!this.y)}move(){if(this.paused)return!1;const t=this.parent.input.count();return(1===t||t>1&&!this.parent.plugins.get("pinch",!0))&&(this.saved.push({x:this.parent.x,y:this.parent.y,time:performance.now()}),this.saved.length>60&&this.saved.splice(0,30)),!1}handleMoved(t){if(this.saved.length){const e=this.saved[this.saved.length-1];"clamp-x"===t.type&&t.original?e.x===t.original.x&&(e.x=this.parent.x):"clamp-y"===t.type&&t.original&&e.y===t.original.y&&(e.y=this.parent.y)}}up(){if(0===this.parent.input.count()&&this.saved.length){const t=performance.now();for(const e of this.saved)if(e.time>=t-100){const i=t-e.time;this.x=(this.parent.x-e.x)/i,this.y=(this.parent.y-e.y)/i,this.percentChangeX=this.percentChangeY=this.options.friction,this.timeSinceRelease=0;break}}return!1}activate(t){typeof(t=t||{}).x<"u"&&(this.x=t.x,this.percentChangeX=this.options.friction),typeof t.y<"u"&&(this.y=t.y,this.percentChangeY=this.options.friction)}update(t){if(this.paused)return;const e=this.x||this.y,i=this.timeSinceRelease,n=this.timeSinceRelease+t;if(this.x){const e=this.percentChangeX,r=Math.log(e);this.parent.x+=this.x*Pl/r*(Math.pow(e,n/Pl)-Math.pow(e,i/Pl)),this.x*=Math.pow(this.percentChangeX,t/Pl)}if(this.y){const e=this.percentChangeY,r=Math.log(e);this.parent.y+=this.y*Pl/r*(Math.pow(e,n/Pl)-Math.pow(e,i/Pl)),this.y*=Math.pow(this.percentChangeY,t/Pl)}this.timeSinceRelease+=t,this.x&&this.y?Math.abs(this.x)<this.options.minSpeed&&Math.abs(this.y)<this.options.minSpeed&&(this.x=0,this.y=0):(Math.abs(this.x||0)<this.options.minSpeed&&(this.x=0),Math.abs(this.y||0)<this.options.minSpeed&&(this.y=0)),e&&this.parent.emit("moved",{viewport:this.parent,type:"decelerate"})}reset(){this.x=this.y=null}}const Ol={direction:"all",pressDrag:!0,wheel:!0,wheelScroll:1,reverse:!1,clampWheel:!1,underflow:"center",factor:1,mouseButtons:"all",keyToPress:null,ignoreKeyToPressOnTouch:!1,lineHeight:20,wheelSwapAxes:!1};class Ll extends vl{constructor(t,e={}){super(t),ml(this,"options"),ml(this,"moved"),ml(this,"reverse"),ml(this,"xDirection"),ml(this,"yDirection"),ml(this,"keyIsPressed"),ml(this,"mouse"),ml(this,"underflowX"),ml(this,"underflowY"),ml(this,"last"),ml(this,"current"),ml(this,"windowEventHandlers",[]),this.options=Object.assign({},Ol,e),this.moved=!1,this.reverse=this.options.reverse?1:-1,this.xDirection=!this.options.direction||"all"===this.options.direction||"x"===this.options.direction,this.yDirection=!this.options.direction||"all"===this.options.direction||"y"===this.options.direction,this.keyIsPressed=!1,this.parseUnderflow(),this.mouseButtons(this.options.mouseButtons),this.options.keyToPress&&this.handleKeyPresses(this.options.keyToPress)}handleKeyPresses(t){this.addWindowEventHandler("keyup",(e=>{t.includes(e.code)&&(this.keyIsPressed=!1)})),this.addWindowEventHandler("keydown",(e=>{t.includes(e.code)&&(this.keyIsPressed=!0)}))}addWindowEventHandler(t,e){window.addEventListener(t,e),this.windowEventHandlers.push({event:t,handler:e})}destroy(){this.windowEventHandlers.forEach((({event:t,handler:e})=>{window.removeEventListener(t,e)}))}mouseButtons(t){this.mouse=t&&"all"!==t?[-1!==t.indexOf("left"),-1!==t.indexOf("middle"),-1!==t.indexOf("right")]:[!0,!0,!0]}parseUnderflow(){const t=this.options.underflow.toLowerCase();"center"===t?(this.underflowX=0,this.underflowY=0):(t.includes("left")?this.underflowX=-1:t.includes("right")?this.underflowX=1:this.underflowX=0,t.includes("top")?this.underflowY=-1:t.includes("bottom")?this.underflowY=1:this.underflowY=0)}checkButtons(t){const e="mouse"===t.pointerType,i=this.parent.input.count();return!(!(1===i||i>1&&!this.parent.plugins.get("pinch",!0))||e&&!this.mouse[t.button])}checkKeyPress(t){return!this.options.keyToPress||this.keyIsPressed||this.options.ignoreKeyToPressOnTouch&&"touch"===t.data.pointerType}down(t){return!(this.paused||!this.options.pressDrag)&&(this.checkButtons(t)&&this.checkKeyPress(t)?(this.last={x:t.global.x,y:t.global.y},this.current=t.pointerId,!0):(this.last=null,!1))}get active(){return this.moved}move(t){if(this.paused||!this.options.pressDrag)return!1;if(this.last&&this.current===t.data.pointerId){const e=t.global.x,i=t.global.y,n=this.parent.input.count();if(1===n||n>1&&!this.parent.plugins.get("pinch",!0)){const n=e-this.last.x,r=i-this.last.y;if(this.moved||this.xDirection&&this.parent.input.checkThreshold(n)||this.yDirection&&this.parent.input.checkThreshold(r)){const n={x:e,y:i};return this.xDirection&&(this.parent.x+=(n.x-this.last.x)*this.options.factor),this.yDirection&&(this.parent.y+=(n.y-this.last.y)*this.options.factor),this.last=n,this.moved||this.parent.emit("drag-start",{event:t,screen:new qi(this.last.x,this.last.y),world:this.parent.toWorld(new qi(this.last.x,this.last.y)),viewport:this.parent}),this.moved=!0,this.parent.emit("moved",{viewport:this.parent,type:"drag"}),!0}}else this.moved=!1}return!1}up(t){if(this.paused)return!1;const e=this.parent.input.touches;if(1===e.length){const t=e[0];return t.last&&(this.last={x:t.last.x,y:t.last.y},this.current=t.id),this.moved=!1,!0}if(this.last&&this.moved){const e=new qi(this.last.x,this.last.y);return this.parent.emit("drag-end",{event:t,screen:e,world:this.parent.toWorld(e),viewport:this.parent}),this.last=null,this.moved=!1,!0}return!1}wheel(t){if(this.paused)return!1;if(this.options.wheel){const e=this.parent.plugins.get("wheel",!0);if(!e||!e.options.wheelZoom&&!t.ctrlKey){const e=t.deltaMode?this.options.lineHeight:1,i=[t.deltaX,t.deltaY],[n,r]=this.options.wheelSwapAxes?i.reverse():i;return this.xDirection&&(this.parent.x+=n*e*this.options.wheelScroll*this.reverse),this.yDirection&&(this.parent.y+=r*e*this.options.wheelScroll*this.reverse),this.options.clampWheel&&this.clamp(),this.parent.emit("wheel-scroll",this.parent),this.parent.emit("moved",{viewport:this.parent,type:"wheel"}),this.parent.options.passiveWheel||t.preventDefault(),this.parent.options.stopPropagation&&t.stopPropagation(),!0}}return!1}resume(){this.last=null,this.paused=!1}clamp(){const t=this.parent.plugins.get("decelerate",!0)||{};if("y"!==this.options.clampWheel)if(this.parent.screenWorldWidth<this.parent.screenWidth)switch(this.underflowX){case-1:this.parent.x=0;break;case 1:this.parent.x=this.parent.screenWidth-this.parent.screenWorldWidth;break;default:this.parent.x=(this.parent.screenWidth-this.parent.screenWorldWidth)/2}else this.parent.left<0?(this.parent.x=0,t.x=0):this.parent.right>this.parent.worldWidth&&(this.parent.x=-this.parent.worldWidth*this.parent.scale.x+this.parent.screenWidth,t.x=0);if("x"!==this.options.clampWheel)if(this.parent.screenWorldHeight<this.parent.screenHeight)switch(this.underflowY){case-1:this.parent.y=0;break;case 1:this.parent.y=this.parent.screenHeight-this.parent.screenWorldHeight;break;default:this.parent.y=(this.parent.screenHeight-this.parent.screenWorldHeight)/2}else this.parent.top<0&&(this.parent.y=0,t.y=0),this.parent.bottom>this.parent.worldHeight&&(this.parent.y=-this.parent.worldHeight*this.parent.scale.y+this.parent.screenHeight,t.y=0)}}const Nl={speed:0,acceleration:null,radius:null};class Bl extends vl{constructor(t,e,i={}){super(t),ml(this,"options"),ml(this,"target"),ml(this,"velocity"),this.target=e,this.options=Object.assign({},Nl,i),this.velocity={x:0,y:0}}update(t){if(this.paused)return;const e=this.parent.center;let i=this.target.x,n=this.target.y;if(this.options.radius){if(!(Math.sqrt(Math.pow(this.target.y-e.y,2)+Math.pow(this.target.x-e.x,2))>this.options.radius))return;{const t=Math.atan2(this.target.y-e.y,this.target.x-e.x);i=this.target.x-Math.cos(t)*this.options.radius,n=this.target.y-Math.sin(t)*this.options.radius}}const r=i-e.x,s=n-e.y;if(r||s)if(this.options.speed)if(this.options.acceleration){const t=Math.atan2(n-e.y,i-e.x),o=Math.sqrt(Math.pow(r,2)+Math.pow(s,2));if(o){const a=(Math.pow(this.velocity.x,2)+Math.pow(this.velocity.y,2))/(2*this.options.acceleration);this.velocity=o>a?{x:Math.min(this.velocity.x+(this.options.acceleration,this.options.speed)),y:Math.min(this.velocity.y+(this.options.acceleration,this.options.speed))}:{x:Math.max(this.velocity.x-this.options.acceleration*this.options.speed,0),y:Math.max(this.velocity.y-this.options.acceleration*this.options.speed,0)};const h=Math.cos(t)*this.velocity.x,l=Math.sin(t)*this.velocity.y,u=Math.abs(h)>Math.abs(r)?i:e.x+h,c=Math.abs(l)>Math.abs(s)?n:e.y+l;this.parent.moveCenter(u,c),this.parent.emit("moved",{viewport:this.parent,type:"follow"})}}else{const t=Math.atan2(n-e.y,i-e.x),o=Math.cos(t)*this.options.speed,a=Math.sin(t)*this.options.speed,h=Math.abs(o)>Math.abs(r)?i:e.x+o,l=Math.abs(a)>Math.abs(s)?n:e.y+a;this.parent.moveCenter(h,l),this.parent.emit("moved",{viewport:this.parent,type:"follow"})}else this.parent.moveCenter(i,n),this.parent.emit("moved",{viewport:this.parent,type:"follow"})}}const kl={radius:null,distance:null,top:null,bottom:null,left:null,right:null,speed:8,reverse:!1,noDecelerate:!1,linear:!1,allowButtons:!1};class Fl extends vl{constructor(t,e={}){super(t),ml(this,"options"),ml(this,"reverse"),ml(this,"radiusSquared"),ml(this,"left"),ml(this,"top"),ml(this,"right"),ml(this,"bottom"),ml(this,"horizontal"),ml(this,"vertical"),this.options=Object.assign({},kl,e),this.reverse=this.options.reverse?1:-1,this.radiusSquared="number"==typeof this.options.radius?Math.pow(this.options.radius,2):null,this.resize()}resize(){const t=this.options.distance;null!==t?(this.left=t,this.top=t,this.right=this.parent.screenWidth-t,this.bottom=this.parent.screenHeight-t):this.options.radius||(this.left=this.options.left,this.top=this.options.top,this.right=null===this.options.right?null:this.parent.screenWidth-this.options.right,this.bottom=null===this.options.bottom?null:this.parent.screenHeight-this.options.bottom)}down(){return this.paused||this.options.allowButtons||(this.horizontal=this.vertical=null),!1}move(t){if(this.paused||"mouse"!==t.pointerType&&1!==t.pointerId||!this.options.allowButtons&&0!==t.buttons)return!1;const e=t.global.x,i=t.global.y;if(this.radiusSquared){const t=this.parent.toScreen(this.parent.center);if(Math.pow(t.x-e,2)+Math.pow(t.y-i,2)>=this.radiusSquared){const n=Math.atan2(t.y-i,t.x-e);this.options.linear?(this.horizontal=Math.round(Math.cos(n))*this.options.speed*this.reverse*.06,this.vertical=Math.round(Math.sin(n))*this.options.speed*this.reverse*.06):(this.horizontal=Math.cos(n)*this.options.speed*this.reverse*.06,this.vertical=Math.sin(n)*this.options.speed*this.reverse*.06)}else this.horizontal&&this.decelerateHorizontal(),this.vertical&&this.decelerateVertical(),this.horizontal=this.vertical=0}else null!==this.left&&e<this.left?this.horizontal=Number(this.reverse)*this.options.speed*.06:null!==this.right&&e>this.right?this.horizontal=-1*this.reverse*this.options.speed*.06:(this.decelerateHorizontal(),this.horizontal=0),null!==this.top&&i<this.top?this.vertical=Number(this.reverse)*this.options.speed*.06:null!==this.bottom&&i>this.bottom?this.vertical=-1*this.reverse*this.options.speed*.06:(this.decelerateVertical(),this.vertical=0);return!1}decelerateHorizontal(){const t=this.parent.plugins.get("decelerate",!0);this.horizontal&&t&&!this.options.noDecelerate&&t.activate({x:this.horizontal*this.options.speed*this.reverse/(1e3/60)})}decelerateVertical(){const t=this.parent.plugins.get("decelerate",!0);this.vertical&&t&&!this.options.noDecelerate&&t.activate({y:this.vertical*this.options.speed*this.reverse/(1e3/60)})}up(){return this.paused||(this.horizontal&&this.decelerateHorizontal(),this.vertical&&this.decelerateVertical(),this.horizontal=this.vertical=null),!1}update(){if(!this.paused&&(this.horizontal||this.vertical)){const t=this.parent.center;this.horizontal&&(t.x+=this.horizontal*this.options.speed),this.vertical&&(t.y+=this.vertical*this.options.speed),this.parent.moveCenter(t),this.parent.emit("moved",{viewport:this.parent,type:"mouse-edges"})}}}const Ul={noDrag:!1,percent:1,center:null,factor:1,axis:"all"};class Gl extends vl{constructor(t,e={}){super(t),ml(this,"options"),ml(this,"active",!1),ml(this,"pinching",!1),ml(this,"moved",!1),ml(this,"lastCenter"),this.options=Object.assign({},Ul,e)}down(){return this.parent.input.count()>=2&&(this.active=!0,!0)}isAxisX(){return["all","x"].includes(this.options.axis)}isAxisY(){return["all","y"].includes(this.options.axis)}move(t){if(this.paused||!this.active)return!1;const e=t.global.x,i=t.global.y,n=this.parent.input.touches;if(n.length>=2){const r=n[0],s=n[1],o=r.last&&s.last?Math.sqrt(Math.pow(s.last.x-r.last.x,2)+Math.pow(s.last.y-r.last.y,2)):null;if(r.id===t.pointerId?r.last={x:e,y:i,data:t}:s.id===t.pointerId&&(s.last={x:e,y:i,data:t}),o){let t;const e=new qi(r.last.x+(s.last.x-r.last.x)/2,r.last.y+(s.last.y-r.last.y)/2);this.options.center||(t=this.parent.toLocal(e));let i=Math.sqrt(Math.pow(s.last.x-r.last.x,2)+Math.pow(s.last.y-r.last.y,2));i=0===i?i=1e-10:i;const n=(1-o/i)*this.options.percent*(this.isAxisX()?this.parent.scale.x:this.parent.scale.y);this.isAxisX()&&(this.parent.scale.x+=n),this.isAxisY()&&(this.parent.scale.y+=n),this.parent.emit("zoomed",{viewport:this.parent,type:"pinch",center:e});const a=this.parent.plugins.get("clamp-zoom",!0);if(a&&a.clamp(),this.options.center)this.parent.moveCenter(this.options.center);else{const i=this.parent.toGlobal(t);this.parent.x+=(e.x-i.x)*this.options.factor,this.parent.y+=(e.y-i.y)*this.options.factor,this.parent.emit("moved",{viewport:this.parent,type:"pinch"})}!this.options.noDrag&&this.lastCenter&&(this.parent.x+=(e.x-this.lastCenter.x)*this.options.factor,this.parent.y+=(e.y-this.lastCenter.y)*this.options.factor,this.parent.emit("moved",{viewport:this.parent,type:"pinch"})),this.lastCenter=e,this.moved=!0}else this.pinching||(this.parent.emit("pinch-start",this.parent),this.pinching=!0);return!0}return!1}up(){return!!(this.pinching&&this.parent.input.touches.length<=1)&&(this.active=!1,this.lastCenter=null,this.pinching=!1,this.moved=!1,this.parent.emit("pinch-end",this.parent),!0)}}const zl={topLeft:!1,friction:.8,time:1e3,ease:"easeInOutSine",interrupt:!0,removeOnComplete:!1,removeOnInterrupt:!1,forceStart:!1};class jl extends vl{constructor(t,e,i,n={}){super(t),ml(this,"options"),ml(this,"ease"),ml(this,"x"),ml(this,"y"),ml(this,"percent"),ml(this,"snapping"),ml(this,"deltaX"),ml(this,"deltaY"),ml(this,"startX"),ml(this,"startY"),this.options=Object.assign({},zl,n),this.ease=bl(n.ease,"easeInOutSine"),this.x=e,this.y=i,this.options.forceStart&&this.snapStart()}snapStart(){this.percent=0,this.snapping={time:0};const t=this.options.topLeft?this.parent.corner:this.parent.center;this.deltaX=this.x-t.x,this.deltaY=this.y-t.y,this.startX=t.x,this.startY=t.y,this.parent.emit("snap-start",this.parent)}wheel(){return this.options.removeOnInterrupt&&this.parent.plugins.remove("snap"),!1}down(){return this.options.removeOnInterrupt?this.parent.plugins.remove("snap"):this.options.interrupt&&(this.snapping=null),!1}up(){if(0===this.parent.input.count()){const t=this.parent.plugins.get("decelerate",!0);t&&(t.x||t.y)&&(t.percentChangeX=t.percentChangeY=this.options.friction)}return!1}update(t){if(!(this.paused||this.options.interrupt&&0!==this.parent.input.count()))if(this.snapping){const e=this.snapping;let i,n,r;e.time+=t;const s=this.startX,o=this.startY,a=this.deltaX,h=this.deltaY;if(e.time>this.options.time)i=!0,n=s+a,r=o+h;else{const t=this.ease(e.time,0,1,this.options.time);n=s+a*t,r=o+h*t}this.options.topLeft?this.parent.moveCorner(n,r):this.parent.moveCenter(n,r),this.parent.emit("moved",{viewport:this.parent,type:"snap"}),i&&(this.options.removeOnComplete&&this.parent.plugins.remove("snap"),this.parent.emit("snap-end",this.parent),this.snapping=null)}else{const t=this.options.topLeft?this.parent.corner:this.parent.center;(t.x!==this.x||t.y!==this.y)&&this.snapStart()}}}const Hl={width:0,height:0,time:1e3,ease:"easeInOutSine",center:null,interrupt:!0,removeOnComplete:!1,removeOnInterrupt:!1,forceStart:!1,noMove:!1};class Wl extends vl{constructor(t,e={}){super(t),ml(this,"options"),ml(this,"ease"),ml(this,"xScale"),ml(this,"yScale"),ml(this,"xIndependent"),ml(this,"yIndependent"),ml(this,"snapping"),this.options=Object.assign({},Hl,e),this.ease=bl(this.options.ease),this.xIndependent=!1,this.yIndependent=!1,this.xScale=0,this.yScale=0,this.options.width>0&&(this.xScale=t.screenWidth/this.options.width,this.xIndependent=!0),this.options.height>0&&(this.yScale=t.screenHeight/this.options.height,this.yIndependent=!0),this.xScale=this.xIndependent?this.xScale:this.yScale,this.yScale=this.yIndependent?this.yScale:this.xScale,0===this.options.time?(t.container.scale.x=this.xScale,t.container.scale.y=this.yScale,this.options.removeOnComplete&&this.parent.plugins.remove("snap-zoom")):e.forceStart&&this.createSnapping()}createSnapping(){const t=this.parent.worldScreenWidth,e=this.parent.worldScreenHeight,i=this.parent.screenWidth/this.xScale,n=this.parent.screenHeight/this.yScale;this.snapping={time:0,startX:t,startY:e,deltaX:i-t,deltaY:n-e},this.parent.emit("snap-zoom-start",this.parent)}resize(){this.snapping=null,this.options.width>0&&(this.xScale=this.parent.screenWidth/this.options.width),this.options.height>0&&(this.yScale=this.parent.screenHeight/this.options.height),this.xScale=this.xIndependent?this.xScale:this.yScale,this.yScale=this.yIndependent?this.yScale:this.xScale}wheel(){return this.options.removeOnInterrupt&&this.parent.plugins.remove("snap-zoom"),!1}down(){return this.options.removeOnInterrupt?this.parent.plugins.remove("snap-zoom"):this.options.interrupt&&(this.snapping=null),!1}update(t){if(this.paused||this.options.interrupt&&0!==this.parent.input.count())return;let e;if(!this.options.center&&!this.options.noMove&&(e=this.parent.center),this.snapping){if(this.snapping){const i=this.snapping;if(i.time+=t,i.time>=this.options.time)this.parent.scale.set(this.xScale,this.yScale),this.options.removeOnComplete&&this.parent.plugins.remove("snap-zoom"),this.parent.emit("snap-zoom-end",this.parent),this.snapping=null;else{const t=this.snapping,e=this.ease(t.time,t.startX,t.deltaX,this.options.time),i=this.ease(t.time,t.startY,t.deltaY,this.options.time);this.parent.scale.x=this.parent.screenWidth/e,this.parent.scale.y=this.parent.screenHeight/i}const n=this.parent.plugins.get("clamp-zoom",!0);n&&n.clamp(),this.options.noMove||(this.options.center?this.parent.moveCenter(this.options.center):this.parent.moveCenter(e))}}else(this.parent.scale.x!==this.xScale||this.parent.scale.y!==this.yScale)&&this.createSnapping()}resume(){this.snapping=null,super.resume()}}const Xl={percent:.1,smooth:!1,interrupt:!0,reverse:!1,center:null,lineHeight:20,axis:"all",keyToPress:null,trackpadPinch:!1,wheelZoom:!0};class Vl extends vl{constructor(t,e={}){super(t),ml(this,"options"),ml(this,"smoothing"),ml(this,"smoothingCenter"),ml(this,"smoothingCount"),ml(this,"keyIsPressed"),this.options=Object.assign({},Xl,e),this.keyIsPressed=!1,this.options.keyToPress&&this.handleKeyPresses(this.options.keyToPress)}handleKeyPresses(t){window.addEventListener("keydown",(e=>{t.includes(e.code)&&(this.keyIsPressed=!0)})),window.addEventListener("keyup",(e=>{t.includes(e.code)&&(this.keyIsPressed=!1)}))}checkKeyPress(){return!this.options.keyToPress||this.keyIsPressed}down(){return this.options.interrupt&&(this.smoothing=null),!1}isAxisX(){return["all","x"].includes(this.options.axis)}isAxisY(){return["all","y"].includes(this.options.axis)}update(){if(this.smoothing){const t=this.smoothingCenter,e=this.smoothing;let i;this.options.center||(i=this.parent.toLocal(t)),this.isAxisX()&&(this.parent.scale.x+=e.x),this.isAxisY()&&(this.parent.scale.y+=e.y),this.parent.emit("zoomed",{viewport:this.parent,type:"wheel"});const n=this.parent.plugins.get("clamp-zoom",!0);if(n&&n.clamp(),this.options.center)this.parent.moveCenter(this.options.center);else{const e=this.parent.toGlobal(i);this.parent.x+=t.x-e.x,this.parent.y+=t.y-e.y}this.parent.emit("moved",{viewport:this.parent,type:"wheel"}),this.smoothingCount++,this.smoothingCount>=this.options.smooth&&(this.smoothing=null)}}pinch(t){if(this.paused)return;const e=this.parent.input.getPointerPosition(t),i=-t.deltaY*(t.deltaMode?this.options.lineHeight:1)/200,n=Math.pow(2,(1+this.options.percent)*i);let r;this.options.center||(r=this.parent.toLocal(e)),this.isAxisX()&&(this.parent.scale.x*=n),this.isAxisY()&&(this.parent.scale.y*=n),this.parent.emit("zoomed",{viewport:this.parent,type:"wheel"});const s=this.parent.plugins.get("clamp-zoom",!0);if(s&&s.clamp(),this.options.center)this.parent.moveCenter(this.options.center);else{const t=this.parent.toGlobal(r);this.parent.x+=e.x-t.x,this.parent.y+=e.y-t.y}this.parent.emit("moved",{viewport:this.parent,type:"wheel"}),this.parent.emit("wheel-start",{event:t,viewport:this.parent})}wheel(t){if(this.paused||!this.checkKeyPress())return!1;if(t.ctrlKey&&this.options.trackpadPinch)this.pinch(t);else if(this.options.wheelZoom){const e=this.parent.input.getPointerPosition(t),i=(this.options.reverse?-1:1)*-t.deltaY*(t.deltaMode?this.options.lineHeight:1)/500,n=Math.pow(2,(1+this.options.percent)*i);if(this.options.smooth){const t={x:this.smoothing?this.smoothing.x*(this.options.smooth-this.smoothingCount):0,y:this.smoothing?this.smoothing.y*(this.options.smooth-this.smoothingCount):0};this.smoothing={x:((this.parent.scale.x+t.x)*n-this.parent.scale.x)/this.options.smooth,y:((this.parent.scale.y+t.y)*n-this.parent.scale.y)/this.options.smooth},this.smoothingCount=0,this.smoothingCenter=e}else{let t;this.options.center||(t=this.parent.toLocal(e)),this.isAxisX()&&(this.parent.scale.x*=n),this.isAxisY()&&(this.parent.scale.y*=n),this.parent.emit("zoomed",{viewport:this.parent,type:"wheel"});const i=this.parent.plugins.get("clamp-zoom",!0);if(i&&i.clamp(),this.options.center)this.parent.moveCenter(this.options.center);else{const i=this.parent.toGlobal(t);this.parent.x+=e.x-i.x,this.parent.y+=e.y-i.y}}this.parent.emit("moved",{viewport:this.parent,type:"wheel"}),this.parent.emit("wheel-start",{event:t,viewport:this.parent})}return!this.parent.options.passiveWheel}}class Yl{constructor(t){ml(this,"viewport"),ml(this,"clickedAvailable"),ml(this,"isMouseDown"),ml(this,"last"),ml(this,"wheelFunction"),ml(this,"touches"),this.viewport=t,this.touches=[],this.addListeners()}addListeners(){this.viewport.interactive=!0,this.viewport.forceHitArea||(this.viewport.hitArea=new Zi(0,0,this.viewport.worldWidth,this.viewport.worldHeight)),this.viewport.on("pointerdown",this.down,this),this.viewport.options.allowPreserveDragOutside?this.viewport.on("globalpointermove",this.move,this):this.viewport.on("pointermove",this.move,this),this.viewport.on("pointerup",this.up,this),this.viewport.on("pointerupoutside",this.up,this),this.viewport.on("pointercancel",this.up,this),this.viewport.options.allowPreserveDragOutside||this.viewport.on("pointerleave",this.up,this),this.wheelFunction=t=>this.handleWheel(t),this.viewport.options.events.domElement.addEventListener("wheel",this.wheelFunction,{passive:this.viewport.options.passiveWheel}),this.isMouseDown=!1}destroy(){this.viewport.options.events.domElement.removeEventListener("wheel",this.wheelFunction)}down(t){if(!this.viewport.pause&&this.viewport.worldVisible){if("mouse"===t.pointerType?this.isMouseDown=!0:this.get(t.pointerId)||this.touches.push({id:t.pointerId,last:null}),1===this.count()){this.last=t.global.clone();const e=this.viewport.plugins.get("decelerate",!0),i=this.viewport.plugins.get("bounce",!0);e&&e.isActive()||i&&i.isActive()?this.clickedAvailable=!1:this.clickedAvailable=!0}else this.clickedAvailable=!1;this.viewport.plugins.down(t)&&this.viewport.options.stopPropagation&&t.stopPropagation()}}clear(){this.isMouseDown=!1,this.touches=[],this.last=null}checkThreshold(t){return Math.abs(t)>=this.viewport.threshold}move(t){if(this.viewport.pause||!this.viewport.worldVisible)return;const e=this.viewport.plugins.move(t);if(this.clickedAvailable&&this.last){const e=t.global.x-this.last.x,i=t.global.y-this.last.y;(this.checkThreshold(e)||this.checkThreshold(i))&&(this.clickedAvailable=!1)}e&&this.viewport.options.stopPropagation&&t.stopPropagation()}up(t){if(this.viewport.pause||!this.viewport.worldVisible)return;"mouse"===t.pointerType&&(this.isMouseDown=!1),"mouse"!==t.pointerType&&this.remove(t.pointerId);const e=this.viewport.plugins.up(t);this.clickedAvailable&&0===this.count()&&this.last&&(this.viewport.emit("clicked",{event:t,screen:this.last,world:this.viewport.toWorld(this.last),viewport:this.viewport}),this.clickedAvailable=!1),e&&this.viewport.options.stopPropagation&&t.stopPropagation()}getPointerPosition(t){const e=new qi;return this.viewport.options.events.mapPositionToPoint(e,t.clientX,t.clientY),e}handleWheel(t){if(this.viewport.pause||!this.viewport.worldVisible)return;const e=this.viewport.toLocal(this.getPointerPosition(t));this.viewport.left<=e.x&&e.x<=this.viewport.right&&this.viewport.top<=e.y&&e.y<=this.viewport.bottom&&this.viewport.plugins.wheel(t)&&!this.viewport.options.passiveWheel&&t.preventDefault()}pause(){this.touches=[],this.isMouseDown=!1}get(t){for(const e of this.touches)if(e.id===t)return e;return null}remove(t){for(let e=0;e<this.touches.length;e++)if(this.touches[e].id===t)return void this.touches.splice(e,1)}count(){return(this.isMouseDown?1:0)+this.touches.length}}const $l=["drag","pinch","wheel","follow","mouse-edges","decelerate","animate","bounce","snap-zoom","clamp-zoom","snap","clamp"];class ql{constructor(t){ml(this,"plugins"),ml(this,"list"),ml(this,"viewport"),this.viewport=t,this.list=[],this.plugins={}}add(t,e,i=$l.length){const n=this.plugins[t];n&&n.destroy(),this.plugins[t]=e;const r=$l.indexOf(t);-1!==r&&$l.splice(r,1),$l.splice(i,0,t),this.sort()}get(t,e){var i;return e&&null!=(i=this.plugins[t])&&i.paused?null:this.plugins[t]}update(t){for(const e of this.list)e.update(t)}resize(){for(const t of this.list)t.resize()}reset(){for(const t of this.list)t.reset()}removeAll(){this.list.forEach((t=>{t.destroy()})),this.plugins={},this.sort()}remove(t){var e;this.plugins[t]&&(null==(e=this.plugins[t])||e.destroy(),delete this.plugins[t],this.viewport.emit("plugin-remove",t),this.sort())}pause(t){var e;null==(e=this.plugins[t])||e.pause()}resume(t){var e;null==(e=this.plugins[t])||e.resume()}sort(){this.list=[];for(const t of $l)this.plugins[t]&&this.list.push(this.plugins[t])}down(t){let e=!1;for(const i of this.list)i.down(t)&&(e=!0);return e}move(t){let e=!1;for(const i of this.viewport.plugins.list)i.move(t)&&(e=!0);return e}up(t){let e=!1;for(const i of this.list)i.up(t)&&(e=!0);return e}wheel(t){let e=!1;for(const i of this.list)i.wheel(t)&&(e=!0);return e}}const Kl={screenWidth:window.innerWidth,screenHeight:window.innerHeight,worldWidth:null,worldHeight:null,threshold:5,passiveWheel:!0,stopPropagation:!1,forceHitArea:null,noTicker:!1,disableOnContextMenu:!1,ticker:ss.shared,allowPreserveDragOutside:!1};class Zl extends Ms{constructor(t){super(),ml(this,"moving"),ml(this,"screenWidth"),ml(this,"screenHeight"),ml(this,"threshold"),ml(this,"input"),ml(this,"plugins"),ml(this,"zooming"),ml(this,"lastViewport"),ml(this,"options"),ml(this,"_dirty"),ml(this,"_forceHitArea"),ml(this,"_hitAreaDefault"),ml(this,"_pause"),ml(this,"tickerFunction"),ml(this,"_worldWidth"),ml(this,"_worldHeight"),ml(this,"_disableOnContextMenu",(t=>t.preventDefault())),this.options={...Kl,...t},this.screenWidth=this.options.screenWidth,this.screenHeight=this.options.screenHeight,this._worldWidth=this.options.worldWidth,this._worldHeight=this.options.worldHeight,this.forceHitArea=this.options.forceHitArea,this.threshold=this.options.threshold,this.options.disableOnContextMenu&&this.options.events.domElement.addEventListener("contextmenu",this._disableOnContextMenu),this.options.noTicker||(this.tickerFunction=()=>this.update(this.options.ticker.elapsedMS),this.options.ticker.add(this.tickerFunction)),this.input=new Yl(this),this.plugins=new ql(this)}destroy(t){!this.options.noTicker&&this.tickerFunction&&this.options.ticker.remove(this.tickerFunction),this.options.disableOnContextMenu&&this.options.events.domElement.removeEventListener("contextmenu",this._disableOnContextMenu),this.input.destroy(),super.destroy(t)}update(t){this.pause||(this.plugins.update(t),this.lastViewport&&(this.lastViewport.x!==this.x||this.lastViewport.y!==this.y?this.moving=!0:this.moving&&(this.emit("moved-end",this),this.moving=!1),this.lastViewport.scaleX!==this.scale.x||this.lastViewport.scaleY!==this.scale.y?this.zooming=!0:this.zooming&&(this.emit("zoomed-end",this),this.zooming=!1)),this.forceHitArea||(this._hitAreaDefault=new Zi(this.left,this.top,this.worldScreenWidth,this.worldScreenHeight),this.hitArea=this._hitAreaDefault),this._dirty=this._dirty||!this.lastViewport||this.lastViewport.x!==this.x||this.lastViewport.y!==this.y||this.lastViewport.scaleX!==this.scale.x||this.lastViewport.scaleY!==this.scale.y,this.lastViewport={x:this.x,y:this.y,scaleX:this.scale.x,scaleY:this.scale.y},this.emit("frame-end",this))}resize(t=window.innerWidth,e=window.innerHeight,i,n){this.screenWidth=t,this.screenHeight=e,typeof i<"u"&&(this._worldWidth=i),typeof n<"u"&&(this._worldHeight=n),this.plugins.resize(),this.dirty=!0}get worldWidth(){return this._worldWidth?this._worldWidth:this.width/this.scale.x}set worldWidth(t){this._worldWidth=t,this.plugins.resize()}get worldHeight(){return this._worldHeight?this._worldHeight:this.height/this.scale.y}set worldHeight(t){this._worldHeight=t,this.plugins.resize()}getVisibleBounds(){return new Zi(this.left,this.top,this.worldScreenWidth,this.worldScreenHeight)}toWorld(t,e){return 2===arguments.length?this.toLocal(new qi(t,e)):this.toLocal(t)}toScreen(t,e){return 2===arguments.length?this.toGlobal(new qi(t,e)):this.toGlobal(t)}get worldScreenWidth(){return this.screenWidth/this.scale.x}get worldScreenHeight(){return this.screenHeight/this.scale.y}get screenWorldWidth(){return this.worldWidth*this.scale.x}get screenWorldHeight(){return this.worldHeight*this.scale.y}get center(){return new qi(this.worldScreenWidth/2-this.x/this.scale.x,this.worldScreenHeight/2-this.y/this.scale.y)}set center(t){this.moveCenter(t)}moveCenter(...t){let e,i;"number"==typeof t[0]?(e=t[0],i=t[1]):(e=t[0].x,i=t[0].y);const n=(this.worldScreenWidth/2-e)*this.scale.x,r=(this.worldScreenHeight/2-i)*this.scale.y;return(this.x!==n||this.y!==r)&&(this.position.set(n,r),this.plugins.reset(),this.dirty=!0),this}get corner(){return new qi(-this.x/this.scale.x,-this.y/this.scale.y)}set corner(t){this.moveCorner(t)}moveCorner(...t){let e,i;return 1===t.length?(e=-t[0].x*this.scale.x,i=-t[0].y*this.scale.y):(e=-t[0]*this.scale.x,i=-t[1]*this.scale.y),(e!==this.x||i!==this.y)&&(this.position.set(e,i),this.plugins.reset(),this.dirty=!0),this}get screenWidthInWorldPixels(){return this.screenWidth/this.scale.x}get screenHeightInWorldPixels(){return this.screenHeight/this.scale.y}findFitWidth(t){return this.screenWidth/t}findFitHeight(t){return this.screenHeight/t}findFit(t,e){const i=this.screenWidth/t,n=this.screenHeight/e;return Math.min(i,n)}findCover(t,e){const i=this.screenWidth/t,n=this.screenHeight/e;return Math.max(i,n)}fitWidth(t=this.worldWidth,e,i=!0,n){let r;e&&(r=this.center),this.scale.x=this.screenWidth/t,i&&(this.scale.y=this.scale.x);const s=this.plugins.get("clamp-zoom",!0);return!n&&s&&s.clamp(),e&&r&&this.moveCenter(r),this}fitHeight(t=this.worldHeight,e,i=!0,n){let r;e&&(r=this.center),this.scale.y=this.screenHeight/t,i&&(this.scale.x=this.scale.y);const s=this.plugins.get("clamp-zoom",!0);return!n&&s&&s.clamp(),e&&r&&this.moveCenter(r),this}fitWorld(t){let e;t&&(e=this.center),this.scale.x=this.screenWidth/this.worldWidth,this.scale.y=this.screenHeight/this.worldHeight,this.scale.x<this.scale.y?this.scale.y=this.scale.x:this.scale.x=this.scale.y;const i=this.plugins.get("clamp-zoom",!0);return i&&i.clamp(),t&&e&&this.moveCenter(e),this}fit(t,e=this.worldWidth,i=this.worldHeight){let n;t&&(n=this.center),this.scale.x=this.screenWidth/e,this.scale.y=this.screenHeight/i,this.scale.x<this.scale.y?this.scale.y=this.scale.x:this.scale.x=this.scale.y;const r=this.plugins.get("clamp-zoom",!0);return r&&r.clamp(),t&&n&&this.moveCenter(n),this}setZoom(t,e){let i;e&&(i=this.center),this.scale.set(t);const n=this.plugins.get("clamp-zoom",!0);return n&&n.clamp(),e&&i&&this.moveCenter(i),this}zoomPercent(t,e){return this.setZoom(this.scale.x+this.scale.x*t,e)}zoom(t,e){return this.fitWidth(t+this.worldScreenWidth,e),this}get scaled(){return this.scale.x}set scaled(t){this.setZoom(t,!0)}snapZoom(t){return this.plugins.add("snap-zoom",new Wl(this,t)),this}OOB(){return{left:this.left<0,right:this.right>this.worldWidth,top:this.top<0,bottom:this.bottom>this.worldHeight,cornerPoint:new qi(this.worldWidth*this.scale.x-this.screenWidth,this.worldHeight*this.scale.y-this.screenHeight)}}get right(){return-this.x/this.scale.x+this.worldScreenWidth}set right(t){this.x=-t*this.scale.x+this.screenWidth,this.plugins.reset()}get left(){return-this.x/this.scale.x}set left(t){this.x=-t*this.scale.x,this.plugins.reset()}get top(){return-this.y/this.scale.y}set top(t){this.y=-t*this.scale.y,this.plugins.reset()}get bottom(){return-this.y/this.scale.y+this.worldScreenHeight}set bottom(t){this.y=-t*this.scale.y+this.screenHeight,this.plugins.reset()}get dirty(){return!!this._dirty}set dirty(t){this._dirty=t}get forceHitArea(){return this._forceHitArea}set forceHitArea(t){t?(this._forceHitArea=t,this.hitArea=t):(this._forceHitArea=null,this.hitArea=new Zi(0,0,this.worldWidth,this.worldHeight))}drag(t){return this.plugins.add("drag",new Ll(this,t)),this}clamp(t){return this.plugins.add("clamp",new Cl(this,t)),this}decelerate(t){return this.plugins.add("decelerate",new Dl(this,t)),this}bounce(t){return this.plugins.add("bounce",new Al(this,t)),this}pinch(t){return this.plugins.add("pinch",new Gl(this,t)),this}snap(t,e,i){return this.plugins.add("snap",new jl(this,t,e,i)),this}follow(t,e){return this.plugins.add("follow",new Bl(this,t,e)),this}wheel(t){return this.plugins.add("wheel",new Vl(this,t)),this}animate(t){return this.plugins.add("animate",new Tl(this,t)),this}clampZoom(t){return this.plugins.add("clamp-zoom",new Ml(this,t)),this}mouseEdges(t){return this.plugins.add("mouse-edges",new Fl(this,t)),this}get pause(){return!!this._pause}set pause(t){this._pause=t,this.lastViewport=null,this.moving=!1,this.zooming=!1,t&&this.input.pause()}ensureVisible(t,e,i,n,r){r&&(i>this.worldScreenWidth||n>this.worldScreenHeight)&&(this.fit(!0,i,n),this.emit("zoomed",{viewport:this,type:"ensureVisible"}));let s=!1;t<this.left?(this.left=t,s=!0):t+i>this.right&&(this.right=t+i,s=!0),e<this.top?(this.top=e,s=!0):e+n>this.bottom&&(this.bottom=e+n,s=!0),s&&this.emit("moved",{viewport:this,type:"ensureVisible"})}}var Jl,Ql;!function(t){t.allNodesGroup="allNodesGroup",t.nodeContainer="nodeContainer",t.nodeCircle="nodeCircle",t.allLinksGroup="allLinksGroup",t.linkContainer="linkContainer",t.linkLine="linkLine",t.linkQuadratic="linkQuadratic",t.linkLoop="linkLoop",t.linkText="linkText",t.linkArrow="linkArrow",t.addLink="addLink",t.addLinkLine="addLinkLine"}(Jl||(Jl={})),function(t){t.AfterLayout="afterlayout",t.AfterSimulation="aftersimulation",t.INodeClick="node:click",t.INodeDoubleClick="node:doubleclick",t.INodeContextmenu="node:contextmenu",t.ILinkClick="link:click",t.ILinkDoubleClick="link:doubleclick",t.ILinkContextmenu="link:contextmenu",t.ICanvasClick="canvas:click",t.ICanvasDoubleClick="canvas:dblclick",t.IDrawLinkEnd="createEdge:end"}(Ql||(Ql={}));var tu="object"==typeof Gt&&Gt&&Gt.Object===Object&&Gt,eu="object"==typeof self&&self&&self.Object===Object&&self,iu=tu||eu||Function("return this")(),nu=iu.Symbol,ru=Object.prototype,su=ru.hasOwnProperty,ou=ru.toString,au=nu?nu.toStringTag:void 0;var hu=Object.prototype.toString;var lu="[object Null]",uu="[object Undefined]",cu=nu?nu.toStringTag:void 0;function du(t){return null==t?void 0===t?uu:lu:cu&&cu in Object(t)?function(t){var e=su.call(t,au),i=t[au];try{t[au]=void 0;var n=!0}catch(t){}var r=ou.call(t);return n&&(e?t[au]=i:delete t[au]),r}(t):function(t){return hu.call(t)}(t)}function pu(t){return null!=t&&"object"==typeof t}var fu="[object Symbol]";function gu(t){return"symbol"==typeof t||pu(t)&&du(t)==fu}var mu=NaN;function vu(t){return"number"==typeof t?t:gu(t)?mu:+t}function yu(t,e){for(var i=-1,n=null==t?0:t.length,r=Array(n);++i<n;)r[i]=e(t[i],i,t);return r}var _u=Array.isArray,xu=1/0,bu=nu?nu.prototype:void 0,wu=bu?bu.toString:void 0;function Tu(t){if("string"==typeof t)return t;if(_u(t))return yu(t,Tu)+"";if(gu(t))return wu?wu.call(t):"";var e=t+"";return"0"==e&&1/t==-xu?"-0":e}function Eu(t,e){return function(i,n){var r;if(void 0===i&&void 0===n)return e;if(void 0!==i&&(r=i),void 0!==n){if(void 0===r)return n;"string"==typeof i||"string"==typeof n?(i=Tu(i),n=Tu(n)):(i=vu(i),n=vu(n)),r=t(i,n)}return r}}var Au=Eu((function(t,e){return t+e}),0),Su=/\s/;function Cu(t){for(var e=t.length;e--&&Su.test(t.charAt(e)););return e}var Iu=/^\s+/;function Mu(t){return t?t.slice(0,Cu(t)+1).replace(Iu,""):t}function Ru(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}var Pu=NaN,Du=/^[-+]0x[0-9a-f]+$/i,Ou=/^0b[01]+$/i,Lu=/^0o[0-7]+$/i,Nu=parseInt;function Bu(t){if("number"==typeof t)return t;if(gu(t))return Pu;if(Ru(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=Ru(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=Mu(t);var i=Ou.test(t);return i||Lu.test(t)?Nu(t.slice(2),i?2:8):Du.test(t)?Pu:+t}var ku=1/0,Fu=17976931348623157e292;function Uu(t){return t?(t=Bu(t))===ku||t===-ku?(t<0?-1:1)*Fu:t==t?t:0:0===t?t:0}function Gu(t){var e=Uu(t),i=e%1;return e==e?i?e-i:e:0}function zu(t){return t}var ju="[object AsyncFunction]",Hu="[object Function]",Wu="[object GeneratorFunction]",Xu="[object Proxy]";function Vu(t){if(!Ru(t))return!1;var e=du(t);return e==Hu||e==Wu||e==ju||e==Xu}var Yu=iu["__core-js_shared__"],$u=function(){var t=/[^.]+$/.exec(Yu&&Yu.keys&&Yu.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();var qu=Function.prototype.toString;function Ku(t){if(null!=t){try{return qu.call(t)}catch(t){}try{return t+""}catch(t){}}return""}var Zu=/^\[object .+?Constructor\]$/,Ju=Function.prototype,Qu=Object.prototype,tc=Ju.toString,ec=Qu.hasOwnProperty,ic=RegExp("^"+tc.call(ec).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function nc(t){return!(!Ru(t)||function(t){return!!$u&&$u in t}(t))&&(Vu(t)?ic:Zu).test(Ku(t))}function rc(t,e){var i=function(t,e){return null==t?void 0:t[e]}(t,e);return nc(i)?i:void 0}var sc=rc(iu,"WeakMap"),oc=sc&&new sc,ac=oc?function(t,e){return oc.set(t,e),t}:zu,hc=Object.create,lc=function(){function t(){}return function(e){if(!Ru(e))return{};if(hc)return hc(e);t.prototype=e;var i=new t;return t.prototype=void 0,i}}();function uc(t){return function(){var e=arguments;switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3]);case 5:return new t(e[0],e[1],e[2],e[3],e[4]);case 6:return new t(e[0],e[1],e[2],e[3],e[4],e[5]);case 7:return new t(e[0],e[1],e[2],e[3],e[4],e[5],e[6])}var i=lc(t.prototype),n=t.apply(i,e);return Ru(n)?n:i}}var cc=1;function dc(t,e,i){switch(i.length){case 0:return t.call(e);case 1:return t.call(e,i[0]);case 2:return t.call(e,i[0],i[1]);case 3:return t.call(e,i[0],i[1],i[2])}return t.apply(e,i)}var pc=Math.max;function fc(t,e,i,n){for(var r=-1,s=t.length,o=i.length,a=-1,h=e.length,l=pc(s-o,0),u=Array(h+l),c=!n;++a<h;)u[a]=e[a];for(;++r<o;)(c||r<s)&&(u[i[r]]=t[r]);for(;l--;)u[a++]=t[r++];return u}var gc=Math.max;function mc(t,e,i,n){for(var r=-1,s=t.length,o=-1,a=i.length,h=-1,l=e.length,u=gc(s-a,0),c=Array(u+l),d=!n;++r<u;)c[r]=t[r];for(var p=r;++h<l;)c[p+h]=e[h];for(;++o<a;)(d||r<s)&&(c[p+i[o]]=t[r++]);return c}function vc(){}var yc=4294967295;function _c(t){this.__wrapped__=t,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=yc,this.__views__=[]}function xc(){}_c.prototype=lc(vc.prototype),_c.prototype.constructor=_c;var bc=oc?function(t){return oc.get(t)}:xc,wc={},Tc=Object.prototype.hasOwnProperty;function Ec(t){for(var e=t.name+"",i=wc[e],n=Tc.call(wc,e)?i.length:0;n--;){var r=i[n],s=r.func;if(null==s||s==t)return r.name}return e}function Ac(t,e){this.__wrapped__=t,this.__actions__=[],this.__chain__=!!e,this.__index__=0,this.__values__=void 0}function Sc(t,e){var i=-1,n=t.length;for(e||(e=Array(n));++i<n;)e[i]=t[i];return e}function Cc(t){if(t instanceof _c)return t.clone();var e=new Ac(t.__wrapped__,t.__chain__);return e.__actions__=Sc(t.__actions__),e.__index__=t.__index__,e.__values__=t.__values__,e}Ac.prototype=lc(vc.prototype),Ac.prototype.constructor=Ac;var Ic=Object.prototype.hasOwnProperty;function Mc(t){if(pu(t)&&!_u(t)&&!(t instanceof _c)){if(t instanceof Ac)return t;if(Ic.call(t,"__wrapped__"))return Cc(t)}return new Ac(t)}function Rc(t){var e=Ec(t),i=Mc[e];if("function"!=typeof i||!(e in _c.prototype))return!1;if(t===i)return!0;var n=bc(i);return!!n&&t===n[0]}Mc.prototype=vc.prototype,Mc.prototype.constructor=Mc;var Pc=Date.now;function Dc(t){var e=0,i=0;return function(){var n=Pc(),r=16-(n-i);if(i=n,r>0){if(++e>=800)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}var Oc=Dc(ac),Lc=/\{\n\/\* \[wrapped with (.+)\] \*/,Nc=/,? & /;var Bc=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/;function kc(t){return function(){return t}}var Fc=function(){try{var t=rc(Object,"defineProperty");return t({},"",{}),t}catch(t){}}(),Uc=Fc?function(t,e){return Fc(t,"toString",{configurable:!0,enumerable:!1,value:kc(e),writable:!0})}:zu,Gc=Dc(Uc);function zc(t,e){for(var i=-1,n=null==t?0:t.length;++i<n&&!1!==e(t[i],i,t););return t}function jc(t,e,i,n){for(var r=t.length,s=i+(n?1:-1);n?s--:++s<r;)if(e(t[s],s,t))return s;return-1}function Hc(t){return t!=t}function Wc(t,e,i){return e==e?function(t,e,i){for(var n=i-1,r=t.length;++n<r;)if(t[n]===e)return n;return-1}(t,e,i):jc(t,Hc,i)}function Xc(t,e){return!!(null==t?0:t.length)&&Wc(t,e,0)>-1}var Vc=[["ary",128],["bind",1],["bindKey",2],["curry",8],["curryRight",16],["flip",512],["partial",32],["partialRight",64],["rearg",256]];function Yc(t,e,i){var n=e+"";return Gc(t,function(t,e){var i=e.length;if(!i)return t;var n=i-1;return e[n]=(i>1?"& ":"")+e[n],e=e.join(i>2?", ":" "),t.replace(Bc,"{\n/* [wrapped with "+e+"] */\n")}(n,function(t,e){return zc(Vc,(function(i){var n="_."+i[0];e&i[1]&&!Xc(t,n)&&t.push(n)})),t.sort()}(function(t){var e=t.match(Lc);return e?e[1].split(Nc):[]}(n),i)))}var $c=1,qc=2,Kc=4,Zc=8,Jc=32,Qc=64;function td(t,e,i,n,r,s,o,a,h,l){var u=e&Zc;e|=u?Jc:Qc,(e&=~(u?Qc:Jc))&Kc||(e&=~($c|qc));var c=[t,e,r,u?s:void 0,u?o:void 0,u?void 0:s,u?void 0:o,a,h,l],d=i.apply(void 0,c);return Rc(t)&&Oc(d,c),d.placeholder=n,Yc(d,t,e)}function ed(t){return t.placeholder}var id=9007199254740991,nd=/^(?:0|[1-9]\d*)$/;function rd(t,e){var i=typeof t;return!!(e=null==e?id:e)&&("number"==i||"symbol"!=i&&nd.test(t))&&t>-1&&t%1==0&&t<e}var sd=Math.min;var od="__lodash_placeholder__";function ad(t,e){for(var i=-1,n=t.length,r=0,s=[];++i<n;){var o=t[i];o!==e&&o!==od||(t[i]=od,s[r++]=i)}return s}var hd=1,ld=2,ud=8,cd=16,dd=128,pd=512;function fd(t,e,i,n,r,s,o,a,h,l){var u=e&dd,c=e&hd,d=e&ld,p=e&(ud|cd),f=e&pd,g=d?void 0:uc(t);return function m(){for(var v=arguments.length,y=Array(v),_=v;_--;)y[_]=arguments[_];if(p)var x=ed(m),b=function(t,e){for(var i=t.length,n=0;i--;)t[i]===e&&++n;return n}(y,x);if(n&&(y=fc(y,n,r,p)),s&&(y=mc(y,s,o,p)),v-=b,p&&v<l){var w=ad(y,x);return td(t,e,fd,m.placeholder,i,y,w,a,h,l-v)}var T=c?i:this,E=d?T[t]:t;return v=y.length,a?y=function(t,e){for(var i=t.length,n=sd(e.length,i),r=Sc(t);n--;){var s=e[n];t[n]=rd(s,i)?r[s]:void 0}return t}(y,a):f&&v>1&&y.reverse(),u&&h<v&&(y.length=h),this&&this!==iu&&this instanceof m&&(E=g||uc(E)),E.apply(T,y)}}var gd=1;var md="__lodash_placeholder__",vd=1,yd=2,_d=4,xd=8,bd=128,wd=256,Td=Math.min;var Ed="Expected a function",Ad=1,Sd=2,Cd=8,Id=16,Md=32,Rd=64,Pd=Math.max;function Dd(t,e,i,n,r,s,o,a){var h=e&Sd;if(!h&&"function"!=typeof t)throw new TypeError(Ed);var l=n?n.length:0;if(l||(e&=~(Md|Rd),n=r=void 0),o=void 0===o?o:Pd(Gu(o),0),a=void 0===a?a:Gu(a),l-=r?r.length:0,e&Rd){var u=n,c=r;n=r=void 0}var d=h?void 0:bc(t),p=[t,e,i,n,r,u,c,s,o,a];if(d&&function(t,e){var i=t[1],n=e[1],r=i|n,s=r<(vd|yd|bd),o=n==bd&&i==xd||n==bd&&i==wd&&t[7].length<=e[8]||n==(bd|wd)&&e[7].length<=e[8]&&i==xd;if(!s&&!o)return t;n&vd&&(t[2]=e[2],r|=i&vd?0:_d);var a=e[3];if(a){var h=t[3];t[3]=h?fc(h,a,e[4]):a,t[4]=h?ad(t[3],md):e[4]}(a=e[5])&&(h=t[5],t[5]=h?mc(h,a,e[6]):a,t[6]=h?ad(t[5],md):e[6]),(a=e[7])&&(t[7]=a),n&bd&&(t[8]=null==t[8]?e[8]:Td(t[8],e[8])),null==t[9]&&(t[9]=e[9]),t[0]=e[0],t[1]=r}(p,d),t=p[0],e=p[1],i=p[2],n=p[3],r=p[4],!(a=p[9]=void 0===p[9]?h?0:t.length:Pd(p[9]-l,0))&&e&(Cd|Id)&&(e&=~(Cd|Id)),e&&e!=Ad)f=e==Cd||e==Id?function(t,e,i){var n=uc(t);return function r(){for(var s=arguments.length,o=Array(s),a=s,h=ed(r);a--;)o[a]=arguments[a];var l=s<3&&o[0]!==h&&o[s-1]!==h?[]:ad(o,h);return(s-=l.length)<i?td(t,e,fd,r.placeholder,void 0,o,l,void 0,void 0,i-s):dc(this&&this!==iu&&this instanceof r?n:t,this,o)}}(t,e,a):e!=Md&&e!=(Ad|Md)||r.length?fd.apply(void 0,p):function(t,e,i,n){var r=e&gd,s=uc(t);return function e(){for(var o=-1,a=arguments.length,h=-1,l=n.length,u=Array(l+a),c=this&&this!==iu&&this instanceof e?s:t;++h<l;)u[h]=n[h];for(;a--;)u[h++]=arguments[++o];return dc(c,r?i:this,u)}}(t,e,i,n);else var f=function(t,e,i){var n=e&cc,r=uc(t);return function e(){return(this&&this!==iu&&this instanceof e?r:t).apply(n?i:this,arguments)}}(t,e,i);return Yc((d?ac:Oc)(f,p),t,e)}var Od=128;function Ld(t,e,i){return e=i?void 0:e,e=t&&null==e?t.length:e,Dd(t,Od,void 0,void 0,void 0,void 0,e)}function Nd(t,e,i){"__proto__"==e&&Fc?Fc(t,e,{configurable:!0,enumerable:!0,value:i,writable:!0}):t[e]=i}function Bd(t,e){return t===e||t!=t&&e!=e}var kd=Object.prototype.hasOwnProperty;function Fd(t,e,i){var n=t[e];kd.call(t,e)&&Bd(n,i)&&(void 0!==i||e in t)||Nd(t,e,i)}function Ud(t,e,i,n){var r=!i;i||(i={});for(var s=-1,o=e.length;++s<o;){var a=e[s],h=n?n(i[a],t[a],a,i,t):void 0;void 0===h&&(h=t[a]),r?Nd(i,a,h):Fd(i,a,h)}return i}var Gd=Math.max;function zd(t,e,i){return e=Gd(void 0===e?t.length-1:e,0),function(){for(var n=arguments,r=-1,s=Gd(n.length-e,0),o=Array(s);++r<s;)o[r]=n[e+r];r=-1;for(var a=Array(e+1);++r<e;)a[r]=n[r];return a[e]=i(o),dc(t,this,a)}}function jd(t,e){return Gc(zd(t,e,zu),t+"")}var Hd=9007199254740991;function Wd(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=Hd}function Xd(t){return null!=t&&Wd(t.length)&&!Vu(t)}function Vd(t,e,i){if(!Ru(i))return!1;var n=typeof e;return!!("number"==n?Xd(i)&&rd(e,i.length):"string"==n&&e in i)&&Bd(i[e],t)}function Yd(t){return jd((function(e,i){var n=-1,r=i.length,s=r>1?i[r-1]:void 0,o=r>2?i[2]:void 0;for(s=t.length>3&&"function"==typeof s?(r--,s):void 0,o&&Vd(i[0],i[1],o)&&(s=r<3?void 0:s,r=1),e=Object(e);++n<r;){var a=i[n];a&&t(e,a,n,s)}return e}))}var $d=Object.prototype;function qd(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||$d)}function Kd(t,e){for(var i=-1,n=Array(t);++i<t;)n[i]=e(i);return n}function Zd(t){return pu(t)&&"[object Arguments]"==du(t)}var Jd=Object.prototype,Qd=Jd.hasOwnProperty,tp=Jd.propertyIsEnumerable,ep=Zd(function(){return arguments}())?Zd:function(t){return pu(t)&&Qd.call(t,"callee")&&!tp.call(t,"callee")};function ip(){return!1}var np="object"==typeof exports&&exports&&!exports.nodeType&&exports,rp=np&&"object"==typeof module&&module&&!module.nodeType&&module,sp=rp&&rp.exports===np?iu.Buffer:void 0,op=(sp?sp.isBuffer:void 0)||ip,ap={};function hp(t){return function(e){return t(e)}}ap["[object Float32Array]"]=ap["[object Float64Array]"]=ap["[object Int8Array]"]=ap["[object Int16Array]"]=ap["[object Int32Array]"]=ap["[object Uint8Array]"]=ap["[object Uint8ClampedArray]"]=ap["[object Uint16Array]"]=ap["[object Uint32Array]"]=!0,ap["[object Arguments]"]=ap["[object Array]"]=ap["[object ArrayBuffer]"]=ap["[object Boolean]"]=ap["[object DataView]"]=ap["[object Date]"]=ap["[object Error]"]=ap["[object Function]"]=ap["[object Map]"]=ap["[object Number]"]=ap["[object Object]"]=ap["[object RegExp]"]=ap["[object Set]"]=ap["[object String]"]=ap["[object WeakMap]"]=!1;var lp="object"==typeof exports&&exports&&!exports.nodeType&&exports,up=lp&&"object"==typeof module&&module&&!module.nodeType&&module,cp=up&&up.exports===lp&&tu.process,dp=function(){try{var t=up&&up.require&&up.require("util").types;return t||cp&&cp.binding&&cp.binding("util")}catch(t){}}(),pp=dp&&dp.isTypedArray,fp=pp?hp(pp):function(t){return pu(t)&&Wd(t.length)&&!!ap[du(t)]},gp=Object.prototype.hasOwnProperty;function mp(t,e){var i=_u(t),n=!i&&ep(t),r=!i&&!n&&op(t),s=!i&&!n&&!r&&fp(t),o=i||n||r||s,a=o?Kd(t.length,String):[],h=a.length;for(var l in t)!e&&!gp.call(t,l)||o&&("length"==l||r&&("offset"==l||"parent"==l)||s&&("buffer"==l||"byteLength"==l||"byteOffset"==l)||rd(l,h))||a.push(l);return a}function vp(t,e){return function(i){return t(e(i))}}var yp=vp(Object.keys,Object),_p=Object.prototype.hasOwnProperty;function xp(t){if(!qd(t))return yp(t);var e=[];for(var i in Object(t))_p.call(t,i)&&"constructor"!=i&&e.push(i);return e}function bp(t){return Xd(t)?mp(t):xp(t)}var wp=Object.prototype.hasOwnProperty,Tp=Yd((function(t,e){if(qd(e)||Xd(e))Ud(e,bp(e),t);else for(var i in e)wp.call(e,i)&&Fd(t,i,e[i])}));var Ep=Object.prototype.hasOwnProperty;function Ap(t){if(!Ru(t))return function(t){var e=[];if(null!=t)for(var i in Object(t))e.push(i);return e}(t);var e=qd(t),i=[];for(var n in t)("constructor"!=n||!e&&Ep.call(t,n))&&i.push(n);return i}function Sp(t){return Xd(t)?mp(t,!0):Ap(t)}var Cp=Yd((function(t,e){Ud(e,Sp(e),t)})),Ip=Yd((function(t,e,i,n){Ud(e,Sp(e),t,n)})),Mp=Yd((function(t,e,i,n){Ud(e,bp(e),t,n)})),Rp=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Pp=/^\w*$/;function Dp(t,e){if(_u(t))return!1;var i=typeof t;return!("number"!=i&&"symbol"!=i&&"boolean"!=i&&null!=t&&!gu(t))||(Pp.test(t)||!Rp.test(t)||null!=e&&t in Object(e))}var Op=rc(Object,"create");var Lp=Object.prototype.hasOwnProperty;var Np=Object.prototype.hasOwnProperty;function Bp(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var n=t[e];this.set(n[0],n[1])}}function kp(t,e){for(var i=t.length;i--;)if(Bd(t[i][0],e))return i;return-1}Bp.prototype.clear=function(){this.__data__=Op?Op(null):{},this.size=0},Bp.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},Bp.prototype.get=function(t){var e=this.__data__;if(Op){var i=e[t];return"__lodash_hash_undefined__"===i?void 0:i}return Lp.call(e,t)?e[t]:void 0},Bp.prototype.has=function(t){var e=this.__data__;return Op?void 0!==e[t]:Np.call(e,t)},Bp.prototype.set=function(t,e){var i=this.__data__;return this.size+=this.has(t)?0:1,i[t]=Op&&void 0===e?"__lodash_hash_undefined__":e,this};var Fp=Array.prototype.splice;function Up(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var n=t[e];this.set(n[0],n[1])}}Up.prototype.clear=function(){this.__data__=[],this.size=0},Up.prototype.delete=function(t){var e=this.__data__,i=kp(e,t);return!(i<0)&&(i==e.length-1?e.pop():Fp.call(e,i,1),--this.size,!0)},Up.prototype.get=function(t){var e=this.__data__,i=kp(e,t);return i<0?void 0:e[i][1]},Up.prototype.has=function(t){return kp(this.__data__,t)>-1},Up.prototype.set=function(t,e){var i=this.__data__,n=kp(i,t);return n<0?(++this.size,i.push([t,e])):i[n][1]=e,this};var Gp=rc(iu,"Map");function zp(t,e){var i,n,r=t.__data__;return("string"==(n=typeof(i=e))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==i:null===i)?r["string"==typeof e?"string":"hash"]:r.map}function jp(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var n=t[e];this.set(n[0],n[1])}}jp.prototype.clear=function(){this.size=0,this.__data__={hash:new Bp,map:new(Gp||Up),string:new Bp}},jp.prototype.delete=function(t){var e=zp(this,t).delete(t);return this.size-=e?1:0,e},jp.prototype.get=function(t){return zp(this,t).get(t)},jp.prototype.has=function(t){return zp(this,t).has(t)},jp.prototype.set=function(t,e){var i=zp(this,t),n=i.size;return i.set(t,e),this.size+=i.size==n?0:1,this};var Hp="Expected a function";function Wp(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError(Hp);var i=function(){var n=arguments,r=e?e.apply(this,n):n[0],s=i.cache;if(s.has(r))return s.get(r);var o=t.apply(this,n);return i.cache=s.set(r,o)||s,o};return i.cache=new(Wp.Cache||jp),i}Wp.Cache=jp;var Xp=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Vp=/\\(\\)?/g,Yp=function(t){var e=Wp(t,(function(t){return 500===i.size&&i.clear(),t})),i=e.cache;return e}((function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(Xp,(function(t,i,n,r){e.push(n?r.replace(Vp,"$1"):i||t)})),e}));function $p(t){return null==t?"":Tu(t)}function qp(t,e){return _u(t)?t:Dp(t,e)?[t]:Yp($p(t))}var Kp=1/0;function Zp(t){if("string"==typeof t||gu(t))return t;var e=t+"";return"0"==e&&1/t==-Kp?"-0":e}function Jp(t,e){for(var i=0,n=(e=qp(e,t)).length;null!=t&&i<n;)t=t[Zp(e[i++])];return i&&i==n?t:void 0}function Qp(t,e,i){var n=null==t?void 0:Jp(t,e);return void 0===n?i:n}function tf(t,e){for(var i=-1,n=e.length,r=Array(n),s=null==t;++i<n;)r[i]=s?void 0:Qp(t,e[i]);return r}function ef(t,e){for(var i=-1,n=e.length,r=t.length;++i<n;)t[r+i]=e[i];return t}var nf=nu?nu.isConcatSpreadable:void 0;function rf(t){return _u(t)||ep(t)||!!(nf&&t&&t[nf])}function sf(t,e,i,n,r){var s=-1,o=t.length;for(i||(i=rf),r||(r=[]);++s<o;){var a=t[s];e>0&&i(a)?e>1?sf(a,e-1,i,n,r):ef(r,a):n||(r[r.length]=a)}return r}function of(t){return(null==t?0:t.length)?sf(t,1):[]}function af(t){return Gc(zd(t,void 0,of),t+"")}var hf=af(tf),lf=vp(Object.getPrototypeOf,Object),uf="[object Object]",cf=Function.prototype,df=Object.prototype,pf=cf.toString,ff=df.hasOwnProperty,gf=pf.call(Object);function mf(t){if(!pu(t)||du(t)!=uf)return!1;var e=lf(t);if(null===e)return!0;var i=ff.call(e,"constructor")&&e.constructor;return"function"==typeof i&&i instanceof i&&pf.call(i)==gf}var vf="[object DOMException]",yf="[object Error]";function _f(t){if(!pu(t))return!1;var e=du(t);return e==yf||e==vf||"string"==typeof t.message&&"string"==typeof t.name&&!mf(t)}var xf=jd((function(t,e){try{return dc(t,void 0,e)}catch(t){return _f(t)?t:new Error(t)}})),bf="Expected a function";function wf(t,e){var i;if("function"!=typeof e)throw new TypeError(bf);return t=Gu(t),function(){return--t>0&&(i=e.apply(this,arguments)),t<=1&&(e=void 0),i}}var Tf=jd((function(t,e,i){var n=1;if(i.length){var r=ad(i,ed(Tf));n|=32}return Dd(t,n,e,i,r)}));Tf.placeholder={};var Ef=af((function(t,e){return zc(e,(function(e){e=Zp(e),Nd(t,e,Tf(t[e],t))})),t})),Af=jd((function(t,e,i){var n=3;if(i.length){var r=ad(i,ed(Af));n|=32}return Dd(e,n,t,i,r)}));function Sf(t,e,i){var n=-1,r=t.length;e<0&&(e=-e>r?0:r+e),(i=i>r?r:i)<0&&(i+=r),r=e>i?0:i-e>>>0,e>>>=0;for(var s=Array(r);++n<r;)s[n]=t[n+e];return s}function Cf(t,e,i){var n=t.length;return i=void 0===i?n:i,!e&&i>=n?t:Sf(t,e,i)}Af.placeholder={};var If=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]");function Mf(t){return If.test(t)}var Rf="\\ud800-\\udfff",Pf="["+Rf+"]",Df="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",Of="\\ud83c[\\udffb-\\udfff]",Lf="[^"+Rf+"]",Nf="(?:\\ud83c[\\udde6-\\uddff]){2}",Bf="[\\ud800-\\udbff][\\udc00-\\udfff]",kf="(?:"+Df+"|"+Of+")"+"?",Ff="[\\ufe0e\\ufe0f]?",Uf=Ff+kf+("(?:\\u200d(?:"+[Lf,Nf,Bf].join("|")+")"+Ff+kf+")*"),Gf="(?:"+[Lf+Df+"?",Df,Nf,Bf,Pf].join("|")+")",zf=RegExp(Of+"(?="+Of+")|"+Gf+Uf,"g");function jf(t){return Mf(t)?function(t){return t.match(zf)||[]}(t):function(t){return t.split("")}(t)}function Hf(t){return function(e){var i=Mf(e=$p(e))?jf(e):void 0,n=i?i[0]:e.charAt(0),r=i?Cf(i,1).join(""):e.slice(1);return n[t]()+r}}var Wf=Hf("toUpperCase");function Xf(t){return Wf($p(t).toLowerCase())}function Vf(t,e,i,n){var r=-1,s=null==t?0:t.length;for(n&&s&&(i=t[++r]);++r<s;)i=e(i,t[r],r,t);return i}function Yf(t){return function(e){return null==t?void 0:t[e]}}var $f=Yf({"":"A","":"A","":"A","":"A","":"A","":"A","":"a","":"a","":"a","":"a","":"a","":"a","":"C","":"c","":"D","":"d","":"E","":"E","":"E","":"E","":"e","":"e","":"e","":"e","":"I","":"I","":"I","":"I","":"i","":"i","":"i","":"i","":"N","":"n","":"O","":"O","":"O","":"O","":"O","":"O","":"o","":"o","":"o","":"o","":"o","":"o","":"U","":"U","":"U","":"U","":"u","":"u","":"u","":"u","":"Y","":"y","":"y","":"Ae","":"ae","":"Th","":"th","":"ss","":"A","":"A","":"A","":"a","":"a","":"a","":"C","":"C","":"C","":"C","":"c","":"c","":"c","":"c","":"D","":"D","":"d","":"d","":"E","":"E","":"E","":"E","":"E","":"e","":"e","":"e","":"e","":"e","":"G","":"G","":"G","":"G","":"g","":"g","":"g","":"g","":"H","":"H","":"h","":"h","":"I","":"I","":"I","":"I","":"I","":"i","":"i","":"i","":"i","":"i","":"J","":"j","":"K","":"k","":"k","":"L","":"L","":"L","":"L","":"L","":"l","":"l","":"l","":"l","":"l","":"N","":"N","":"N","":"N","":"n","":"n","":"n","":"n","":"O","":"O","":"O","":"o","":"o","":"o","":"R","":"R","":"R","":"r","":"r","":"r","":"S","":"S","":"S","":"S","":"s","":"s","":"s","":"s","":"T","":"T","":"T","":"t","":"t","":"t","":"U","":"U","":"U","":"U","":"U","":"U","":"u","":"u","":"u","":"u","":"u","":"u","":"W","":"w","":"Y","":"y","":"Y","":"Z","":"Z","":"Z","":"z","":"z","":"z","":"IJ","":"ij","":"Oe","":"oe","":"'n","":"s"}),qf=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Kf=RegExp("[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]","g");function Zf(t){return(t=$p(t))&&t.replace(qf,$f).replace(Kf,"")}var Jf=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;var Qf=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;var tg="\\ud800-\\udfff",eg="\\u2700-\\u27bf",ig="a-z\\xdf-\\xf6\\xf8-\\xff",ng="A-Z\\xc0-\\xd6\\xd8-\\xde",rg="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",sg="["+rg+"]",og="\\d+",ag="["+eg+"]",hg="["+ig+"]",lg="[^"+tg+rg+og+eg+ig+ng+"]",ug="(?:\\ud83c[\\udde6-\\uddff]){2}",cg="[\\ud800-\\udbff][\\udc00-\\udfff]",dg="["+ng+"]",pg="(?:"+hg+"|"+lg+")",fg="(?:"+dg+"|"+lg+")",gg="(?:['](?:d|ll|m|re|s|t|ve))?",mg="(?:['](?:D|LL|M|RE|S|T|VE))?",vg="(?:[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]|\\ud83c[\\udffb-\\udfff])?",yg="[\\ufe0e\\ufe0f]?",_g=yg+vg+("(?:\\u200d(?:"+["[^"+tg+"]",ug,cg].join("|")+")"+yg+vg+")*"),xg="(?:"+[ag,ug,cg].join("|")+")"+_g,bg=RegExp([dg+"?"+hg+"+"+gg+"(?="+[sg,dg,"$"].join("|")+")",fg+"+"+mg+"(?="+[sg,dg+pg,"$"].join("|")+")",dg+"?"+pg+"+"+gg,dg+"+"+mg,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",og,xg].join("|"),"g");function wg(t,e,i){return t=$p(t),void 0===(e=i?void 0:e)?function(t){return Qf.test(t)}(t)?function(t){return t.match(bg)||[]}(t):function(t){return t.match(Jf)||[]}(t):t.match(e)||[]}var Tg=RegExp("[']","g");function Eg(t){return function(e){return Vf(wg(Zf(e).replace(Tg,"")),t,"")}}var Ag=Eg((function(t,e,i){return e=e.toLowerCase(),t+(i?Xf(e):e)}));var Sg=iu.isFinite,Cg=Math.min;function Ig(t){var e=Math[t];return function(t,i){if(t=Bu(t),(i=null==i?0:Cg(Gu(i),292))&&Sg(t)){var n=($p(t)+"e").split("e");return+((n=($p(e(n[0]+"e"+(+n[1]+i)))+"e").split("e"))[0]+"e"+(+n[1]-i))}return e(t)}}var Mg=Ig("ceil");function Rg(t){var e=Mc(t);return e.__chain__=!0,e}var Pg=Math.ceil,Dg=Math.max;function Og(t,e,i){return t==t&&(void 0!==i&&(t=t<=i?t:i),void 0!==e&&(t=t>=e?t:e)),t}function Lg(t){var e=this.__data__=new Up(t);this.size=e.size}function Ng(t,e){return t&&Ud(e,bp(e),t)}Lg.prototype.clear=function(){this.__data__=new Up,this.size=0},Lg.prototype.delete=function(t){var e=this.__data__,i=e.delete(t);return this.size=e.size,i},Lg.prototype.get=function(t){return this.__data__.get(t)},Lg.prototype.has=function(t){return this.__data__.has(t)},Lg.prototype.set=function(t,e){var i=this.__data__;if(i instanceof Up){var n=i.__data__;if(!Gp||n.length<199)return n.push([t,e]),this.size=++i.size,this;i=this.__data__=new jp(n)}return i.set(t,e),this.size=i.size,this};var Bg="object"==typeof exports&&exports&&!exports.nodeType&&exports,kg=Bg&&"object"==typeof module&&module&&!module.nodeType&&module,Fg=kg&&kg.exports===Bg?iu.Buffer:void 0,Ug=Fg?Fg.allocUnsafe:void 0;function Gg(t,e){if(e)return t.slice();var i=t.length,n=Ug?Ug(i):new t.constructor(i);return t.copy(n),n}function zg(t,e){for(var i=-1,n=null==t?0:t.length,r=0,s=[];++i<n;){var o=t[i];e(o,i,t)&&(s[r++]=o)}return s}function jg(){return[]}var Hg=Object.prototype.propertyIsEnumerable,Wg=Object.getOwnPropertySymbols,Xg=Wg?function(t){return null==t?[]:(t=Object(t),zg(Wg(t),(function(e){return Hg.call(t,e)})))}:jg;var Vg=Object.getOwnPropertySymbols?function(t){for(var e=[];t;)ef(e,Xg(t)),t=lf(t);return e}:jg;function Yg(t,e,i){var n=e(t);return _u(t)?n:ef(n,i(t))}function $g(t){return Yg(t,bp,Xg)}function qg(t){return Yg(t,Sp,Vg)}var Kg=rc(iu,"DataView"),Zg=rc(iu,"Promise"),Jg=rc(iu,"Set"),Qg="[object Map]",tm="[object Promise]",em="[object Set]",im="[object WeakMap]",nm="[object DataView]",rm=Ku(Kg),sm=Ku(Gp),om=Ku(Zg),am=Ku(Jg),hm=Ku(sc),lm=du;(Kg&&lm(new Kg(new ArrayBuffer(1)))!=nm||Gp&&lm(new Gp)!=Qg||Zg&&lm(Zg.resolve())!=tm||Jg&&lm(new Jg)!=em||sc&&lm(new sc)!=im)&&(lm=function(t){var e=du(t),i="[object Object]"==e?t.constructor:void 0,n=i?Ku(i):"";if(n)switch(n){case rm:return nm;case sm:return Qg;case om:return tm;case am:return em;case hm:return im}return e});var um=lm,cm=Object.prototype.hasOwnProperty;var dm=iu.Uint8Array;function pm(t){var e=new t.constructor(t.byteLength);return new dm(e).set(new dm(t)),e}var fm=/\w*$/;var gm=nu?nu.prototype:void 0,mm=gm?gm.valueOf:void 0;function vm(t,e){var i=e?pm(t.buffer):t.buffer;return new t.constructor(i,t.byteOffset,t.length)}var ym="[object Boolean]",_m="[object Date]",xm="[object Map]",bm="[object Number]",wm="[object RegExp]",Tm="[object Set]",Em="[object String]",Am="[object Symbol]",Sm="[object ArrayBuffer]",Cm="[object DataView]",Im="[object Float32Array]",Mm="[object Float64Array]",Rm="[object Int8Array]",Pm="[object Int16Array]",Dm="[object Int32Array]",Om="[object Uint8Array]",Lm="[object Uint8ClampedArray]",Nm="[object Uint16Array]",Bm="[object Uint32Array]";function km(t,e,i){var n,r=t.constructor;switch(e){case Sm:return pm(t);case ym:case _m:return new r(+t);case Cm:return function(t,e){var i=e?pm(t.buffer):t.buffer;return new t.constructor(i,t.byteOffset,t.byteLength)}(t,i);case Im:case Mm:case Rm:case Pm:case Dm:case Om:case Lm:case Nm:case Bm:return vm(t,i);case xm:return new r;case bm:case Em:return new r(t);case wm:return function(t){var e=new t.constructor(t.source,fm.exec(t));return e.lastIndex=t.lastIndex,e}(t);case Tm:return new r;case Am:return n=t,mm?Object(mm.call(n)):{}}}function Fm(t){return"function"!=typeof t.constructor||qd(t)?{}:lc(lf(t))}var Um=dp&&dp.isMap,Gm=Um?hp(Um):function(t){return pu(t)&&"[object Map]"==um(t)};var zm=dp&&dp.isSet,jm=zm?hp(zm):function(t){return pu(t)&&"[object Set]"==um(t)},Hm=1,Wm=2,Xm=4,Vm="[object Arguments]",Ym="[object Function]",$m="[object GeneratorFunction]",qm="[object Object]",Km={};function Zm(t,e,i,n,r,s){var o,a=e&Hm,h=e&Wm,l=e&Xm;if(i&&(o=r?i(t,n,r,s):i(t)),void 0!==o)return o;if(!Ru(t))return t;var u=_u(t);if(u){if(o=function(t){var e=t.length,i=new t.constructor(e);return e&&"string"==typeof t[0]&&cm.call(t,"index")&&(i.index=t.index,i.input=t.input),i}(t),!a)return Sc(t,o)}else{var c=um(t),d=c==Ym||c==$m;if(op(t))return Gg(t,a);if(c==qm||c==Vm||d&&!r){if(o=h||d?{}:Fm(t),!a)return h?function(t,e){return Ud(t,Vg(t),e)}(t,function(t,e){return t&&Ud(e,Sp(e),t)}(o,t)):function(t,e){return Ud(t,Xg(t),e)}(t,Ng(o,t))}else{if(!Km[c])return r?t:{};o=km(t,c,a)}}s||(s=new Lg);var p=s.get(t);if(p)return p;s.set(t,o),jm(t)?t.forEach((function(n){o.add(Zm(n,e,i,n,t,s))})):Gm(t)&&t.forEach((function(n,r){o.set(r,Zm(n,e,i,r,t,s))}));var f=u?void 0:(l?h?qg:$g:h?Sp:bp)(t);return zc(f||t,(function(n,r){f&&(n=t[r=n]),Fd(o,r,Zm(n,e,i,r,t,s))})),o}Km[Vm]=Km["[object Array]"]=Km["[object ArrayBuffer]"]=Km["[object DataView]"]=Km["[object Boolean]"]=Km["[object Date]"]=Km["[object Float32Array]"]=Km["[object Float64Array]"]=Km["[object Int8Array]"]=Km["[object Int16Array]"]=Km["[object Int32Array]"]=Km["[object Map]"]=Km["[object Number]"]=Km[qm]=Km["[object RegExp]"]=Km["[object Set]"]=Km["[object String]"]=Km["[object Symbol]"]=Km["[object Uint8Array]"]=Km["[object Uint8ClampedArray]"]=Km["[object Uint16Array]"]=Km["[object Uint32Array]"]=!0,Km["[object Error]"]=Km[Ym]=Km["[object WeakMap]"]=!1;function Jm(t){return Zm(t,5)}function Qm(t){var e=-1,i=null==t?0:t.length;for(this.__data__=new jp;++e<i;)this.add(t[e])}function tv(t,e){for(var i=-1,n=null==t?0:t.length;++i<n;)if(e(t[i],i,t))return!0;return!1}function ev(t,e){return t.has(e)}Qm.prototype.add=Qm.prototype.push=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this},Qm.prototype.has=function(t){return this.__data__.has(t)};var iv=1,nv=2;function rv(t,e,i,n,r,s){var o=i&iv,a=t.length,h=e.length;if(a!=h&&!(o&&h>a))return!1;var l=s.get(t),u=s.get(e);if(l&&u)return l==e&&u==t;var c=-1,d=!0,p=i&nv?new Qm:void 0;for(s.set(t,e),s.set(e,t);++c<a;){var f=t[c],g=e[c];if(n)var m=o?n(g,f,c,e,t,s):n(f,g,c,t,e,s);if(void 0!==m){if(m)continue;d=!1;break}if(p){if(!tv(e,(function(t,e){if(!ev(p,e)&&(f===t||r(f,t,i,n,s)))return p.push(e)}))){d=!1;break}}else if(f!==g&&!r(f,g,i,n,s)){d=!1;break}}return s.delete(t),s.delete(e),d}function sv(t){var e=-1,i=Array(t.size);return t.forEach((function(t,n){i[++e]=[n,t]})),i}function ov(t){var e=-1,i=Array(t.size);return t.forEach((function(t){i[++e]=t})),i}var av=1,hv=2,lv="[object Boolean]",uv="[object Date]",cv="[object Error]",dv="[object Map]",pv="[object Number]",fv="[object RegExp]",gv="[object Set]",mv="[object String]",vv="[object Symbol]",yv="[object ArrayBuffer]",_v="[object DataView]",xv=nu?nu.prototype:void 0,bv=xv?xv.valueOf:void 0;var wv=1,Tv=Object.prototype.hasOwnProperty;var Ev=1,Av="[object Arguments]",Sv="[object Array]",Cv="[object Object]",Iv=Object.prototype.hasOwnProperty;function Mv(t,e,i,n,r,s){var o=_u(t),a=_u(e),h=o?Sv:um(t),l=a?Sv:um(e),u=(h=h==Av?Cv:h)==Cv,c=(l=l==Av?Cv:l)==Cv,d=h==l;if(d&&op(t)){if(!op(e))return!1;o=!0,u=!1}if(d&&!u)return s||(s=new Lg),o||fp(t)?rv(t,e,i,n,r,s):function(t,e,i,n,r,s,o){switch(i){case _v:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case yv:return!(t.byteLength!=e.byteLength||!s(new dm(t),new dm(e)));case lv:case uv:case pv:return Bd(+t,+e);case cv:return t.name==e.name&&t.message==e.message;case fv:case mv:return t==e+"";case dv:var a=sv;case gv:var h=n&av;if(a||(a=ov),t.size!=e.size&&!h)return!1;var l=o.get(t);if(l)return l==e;n|=hv,o.set(t,e);var u=rv(a(t),a(e),n,r,s,o);return o.delete(t),u;case vv:if(bv)return bv.call(t)==bv.call(e)}return!1}(t,e,h,i,n,r,s);if(!(i&Ev)){var p=u&&Iv.call(t,"__wrapped__"),f=c&&Iv.call(e,"__wrapped__");if(p||f){var g=p?t.value():t,m=f?e.value():e;return s||(s=new Lg),r(g,m,i,n,s)}}return!!d&&(s||(s=new Lg),function(t,e,i,n,r,s){var o=i&wv,a=$g(t),h=a.length;if(h!=$g(e).length&&!o)return!1;for(var l=h;l--;){var u=a[l];if(!(o?u in e:Tv.call(e,u)))return!1}var c=s.get(t),d=s.get(e);if(c&&d)return c==e&&d==t;var p=!0;s.set(t,e),s.set(e,t);for(var f=o;++l<h;){var g=t[u=a[l]],m=e[u];if(n)var v=o?n(m,g,u,e,t,s):n(g,m,u,t,e,s);if(!(void 0===v?g===m||r(g,m,i,n,s):v)){p=!1;break}f||(f="constructor"==u)}if(p&&!f){var y=t.constructor,_=e.constructor;y==_||!("constructor"in t)||!("constructor"in e)||"function"==typeof y&&y instanceof y&&"function"==typeof _&&_ instanceof _||(p=!1)}return s.delete(t),s.delete(e),p}(t,e,i,n,r,s))}function Rv(t,e,i,n,r){return t===e||(null==t||null==e||!pu(t)&&!pu(e)?t!=t&&e!=e:Mv(t,e,i,n,Rv,r))}var Pv=1,Dv=2;function Ov(t,e,i,n){var r=i.length,s=r,o=!n;if(null==t)return!s;for(t=Object(t);r--;){var a=i[r];if(o&&a[2]?a[1]!==t[a[0]]:!(a[0]in t))return!1}for(;++r<s;){var h=(a=i[r])[0],l=t[h],u=a[1];if(o&&a[2]){if(void 0===l&&!(h in t))return!1}else{var c=new Lg;if(n)var d=n(l,u,h,t,e,c);if(!(void 0===d?Rv(u,l,Pv|Dv,n,c):d))return!1}}return!0}function Lv(t){return t==t&&!Ru(t)}function Nv(t){for(var e=bp(t),i=e.length;i--;){var n=e[i],r=t[n];e[i]=[n,r,Lv(r)]}return e}function Bv(t,e){return function(i){return null!=i&&(i[t]===e&&(void 0!==e||t in Object(i)))}}function kv(t){var e=Nv(t);return 1==e.length&&e[0][2]?Bv(e[0][0],e[0][1]):function(i){return i===t||Ov(i,t,e)}}function Fv(t,e){return null!=t&&e in Object(t)}function Uv(t,e,i){for(var n=-1,r=(e=qp(e,t)).length,s=!1;++n<r;){var o=Zp(e[n]);if(!(s=null!=t&&i(t,o)))break;t=t[o]}return s||++n!=r?s:!!(r=null==t?0:t.length)&&Wd(r)&&rd(o,r)&&(_u(t)||ep(t))}function Gv(t,e){return null!=t&&Uv(t,e,Fv)}var zv=1,jv=2;function Hv(t,e){return Dp(t)&&Lv(e)?Bv(Zp(t),e):function(i){var n=Qp(i,t);return void 0===n&&n===e?Gv(i,t):Rv(e,n,zv|jv)}}function Wv(t){return function(e){return null==e?void 0:e[t]}}function Xv(t){return Dp(t)?Wv(Zp(t)):function(t){return function(e){return Jp(e,t)}}(t)}function Vv(t){return"function"==typeof t?t:null==t?zu:"object"==typeof t?_u(t)?Hv(t[0],t[1]):kv(t):Xv(t)}function Yv(t,e,i){var n=i.length;if(null==t)return!n;for(t=Object(t);n--;){var r=i[n],s=e[r],o=t[r];if(void 0===o&&!(r in t)||!s(o))return!1}return!0}function $v(t,e,i,n){for(var r=-1,s=null==t?0:t.length;++r<s;){var o=t[r];e(n,o,i(o),t)}return n}function qv(t){return function(e,i,n){for(var r=-1,s=Object(e),o=n(e),a=o.length;a--;){var h=o[t?a:++r];if(!1===i(s[h],h,s))break}return e}}var Kv=qv();function Zv(t,e){return t&&Kv(t,e,bp)}function Jv(t,e){return function(i,n){if(null==i)return i;if(!Xd(i))return t(i,n);for(var r=i.length,s=e?r:-1,o=Object(i);(e?s--:++s<r)&&!1!==n(o[s],s,o););return i}}var Qv=Jv(Zv);function ty(t,e,i,n){return Qv(t,(function(t,r,s){e(n,t,i(t),s)})),n}function ey(t,e){return function(i,n){var r=_u(i)?$v:ty,s=e?e():{};return r(i,t,Vv(n),s)}}var iy=Object.prototype.hasOwnProperty,ny=ey((function(t,e,i){iy.call(t,i)?++t[i]:Nd(t,i,1)}));function ry(t,e,i){var n=Dd(t,8,void 0,void 0,void 0,void 0,void 0,e=i?void 0:e);return n.placeholder=ry.placeholder,n}ry.placeholder={};function sy(t,e,i){var n=Dd(t,16,void 0,void 0,void 0,void 0,void 0,e=i?void 0:e);return n.placeholder=sy.placeholder,n}sy.placeholder={};var oy=function(){return iu.Date.now()},ay="Expected a function",hy=Math.max,ly=Math.min;function uy(t,e,i){var n,r,s,o,a,h,l=0,u=!1,c=!1,d=!0;if("function"!=typeof t)throw new TypeError(ay);function p(e){var i=n,s=r;return n=r=void 0,l=e,o=t.apply(s,i)}function f(t){var i=t-h;return void 0===h||i>=e||i<0||c&&t-l>=s}function g(){var t=oy();if(f(t))return m(t);a=setTimeout(g,function(t){var i=e-(t-h);return c?ly(i,s-(t-l)):i}(t))}function m(t){return a=void 0,d&&n?p(t):(n=r=void 0,o)}function v(){var t=oy(),i=f(t);if(n=arguments,r=this,h=t,i){if(void 0===a)return function(t){return l=t,a=setTimeout(g,e),u?p(t):o}(h);if(c)return clearTimeout(a),a=setTimeout(g,e),p(h)}return void 0===a&&(a=setTimeout(g,e)),o}return e=Bu(e)||0,Ru(i)&&(u=!!i.leading,s=(c="maxWait"in i)?hy(Bu(i.maxWait)||0,e):s,d="trailing"in i?!!i.trailing:d),v.cancel=function(){void 0!==a&&clearTimeout(a),l=0,n=h=r=a=void 0},v.flush=function(){return void 0===a?o:m(oy())},v}var cy=Object.prototype,dy=cy.hasOwnProperty,py=jd((function(t,e){t=Object(t);var i=-1,n=e.length,r=n>2?e[2]:void 0;for(r&&Vd(e[0],e[1],r)&&(n=1);++i<n;)for(var s=e[i],o=Sp(s),a=-1,h=o.length;++a<h;){var l=o[a],u=t[l];(void 0===u||Bd(u,cy[l])&&!dy.call(t,l))&&(t[l]=s[l])}return t}));function fy(t,e,i){(void 0!==i&&!Bd(t[e],i)||void 0===i&&!(e in t))&&Nd(t,e,i)}function gy(t){return pu(t)&&Xd(t)}function my(t,e){if(("constructor"!==e||"function"!=typeof t[e])&&"__proto__"!=e)return t[e]}function vy(t){return Ud(t,Sp(t))}function yy(t,e,i,n,r){t!==e&&Kv(e,(function(s,o){if(r||(r=new Lg),Ru(s))!function(t,e,i,n,r,s,o){var a=my(t,i),h=my(e,i),l=o.get(h);if(l)fy(t,i,l);else{var u=s?s(a,h,i+"",t,e,o):void 0,c=void 0===u;if(c){var d=_u(h),p=!d&&op(h),f=!d&&!p&&fp(h);u=h,d||p||f?_u(a)?u=a:gy(a)?u=Sc(a):p?(c=!1,u=Gg(h,!0)):f?(c=!1,u=vm(h,!0)):u=[]:mf(h)||ep(h)?(u=a,ep(a)?u=vy(a):Ru(a)&&!Vu(a)||(u=Fm(h))):c=!1}c&&(o.set(h,u),r(u,h,n,s,o),o.delete(h)),fy(t,i,u)}}(t,e,o,i,yy,n,r);else{var a=n?n(my(t,o),s,o+"",t,e,r):void 0;void 0===a&&(a=s),fy(t,o,a)}}),Sp)}function _y(t,e,i,n,r,s){return Ru(t)&&Ru(e)&&(s.set(e,t),yy(t,e,void 0,_y,s),s.delete(e)),t}var xy=Yd((function(t,e,i,n){yy(t,e,i,n)})),by=jd((function(t){return t.push(void 0,_y),dc(xy,void 0,t)}));function wy(t,e,i){if("function"!=typeof t)throw new TypeError("Expected a function");return setTimeout((function(){t.apply(void 0,i)}),e)}var Ty=jd((function(t,e){return wy(t,1,e)})),Ey=jd((function(t,e,i){return wy(t,Bu(e)||0,i)}));function Ay(t,e,i){for(var n=-1,r=null==t?0:t.length;++n<r;)if(i(e,t[n]))return!0;return!1}var Sy=200;function Cy(t,e,i,n){var r=-1,s=Xc,o=!0,a=t.length,h=[],l=e.length;if(!a)return h;i&&(e=yu(e,hp(i))),n?(s=Ay,o=!1):e.length>=Sy&&(s=ev,o=!1,e=new Qm(e));t:for(;++r<a;){var u=t[r],c=null==i?u:i(u);if(u=n||0!==u?u:0,o&&c==c){for(var d=l;d--;)if(e[d]===c)continue t;h.push(u)}else s(e,c,n)||h.push(u)}return h}var Iy=jd((function(t,e){return gy(t)?Cy(t,sf(e,1,gy,!0)):[]}));function My(t){var e=null==t?0:t.length;return e?t[e-1]:void 0}var Ry=jd((function(t,e){var i=My(e);return gy(i)&&(i=void 0),gy(t)?Cy(t,sf(e,1,gy,!0),Vv(i)):[]})),Py=jd((function(t,e){var i=My(e);return gy(i)&&(i=void 0),gy(t)?Cy(t,sf(e,1,gy,!0),void 0,i):[]})),Dy=Eu((function(t,e){return t/e}),1);function Oy(t,e,i,n){for(var r=t.length,s=n?r:-1;(n?s--:++s<r)&&e(t[s],s,t););return i?Sf(t,n?0:s,n?s+1:r):Sf(t,n?s+1:0,n?r:s)}function Ly(t){return"function"==typeof t?t:zu}function Ny(t,e){return(_u(t)?zc:Qv)(t,Ly(e))}function By(t,e){for(var i=null==t?0:t.length;i--&&!1!==e(t[i],i,t););return t}var ky=qv(!0);function Fy(t,e){return t&&ky(t,e,bp)}var Uy=Jv(Fy,!0);function Gy(t,e){return(_u(t)?By:Uy)(t,Ly(e))}function zy(t){return function(e){var i=um(e);return"[object Map]"==i?sv(e):"[object Set]"==i?function(t){var e=-1,i=Array(t.size);return t.forEach((function(t){i[++e]=[t,t]})),i}(e):function(t,e){return yu(e,(function(e){return[e,t[e]]}))}(e,t(e))}}var jy=zy(bp),Hy=zy(Sp),Wy=Yf({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}),Xy=/[&<>"']/g,Vy=RegExp(Xy.source);function Yy(t){return(t=$p(t))&&Vy.test(t)?t.replace(Xy,Wy):t}var $y=/[\\^$.*+?()[\]{}|]/g,qy=RegExp($y.source);function Ky(t,e){for(var i=-1,n=null==t?0:t.length;++i<n;)if(!e(t[i],i,t))return!1;return!0}function Zy(t,e){var i=!0;return Qv(t,(function(t,n,r){return i=!!e(t,n,r)})),i}var Jy=4294967295;function Qy(t){return t?Og(Gu(t),0,Jy):0}function t_(t,e){var i=[];return Qv(t,(function(t,n,r){e(t,n,r)&&i.push(t)})),i}function e_(t){return function(e,i,n){var r=Object(e);if(!Xd(e)){var s=Vv(i);e=bp(e),i=function(t){return s(r[t],t,r)}}var o=t(e,i,n);return o>-1?r[s?e[o]:o]:void 0}}var i_=Math.max;function n_(t,e,i){var n=null==t?0:t.length;if(!n)return-1;var r=null==i?0:Gu(i);return r<0&&(r=i_(n+r,0)),jc(t,Vv(e),r)}var r_=e_(n_);function s_(t,e,i){var n;return i(t,(function(t,i,r){if(e(t,i,r))return n=i,!1})),n}var o_=Math.max,a_=Math.min;function h_(t,e,i){var n=null==t?0:t.length;if(!n)return-1;var r=n-1;return void 0!==i&&(r=Gu(i),r=i<0?o_(n+r,0):a_(r,n-1)),jc(t,Vv(e),r,!0)}var l_=e_(h_);function u_(t){return t&&t.length?t[0]:void 0}function c_(t,e){var i=-1,n=Xd(t)?Array(t.length):[];return Qv(t,(function(t,r,s){n[++i]=e(t,r,s)})),n}function d_(t,e){return(_u(t)?yu:c_)(t,Vv(e))}var p_=Ig("floor");function f_(t){return af((function(e){var i=e.length,n=i,r=Ac.prototype.thru;for(t&&e.reverse();n--;){var s=e[n];if("function"!=typeof s)throw new TypeError("Expected a function");if(r&&!o&&"wrapper"==Ec(s))var o=new Ac([],!0)}for(n=o?n:i;++n<i;){var a=Ec(s=e[n]),h="wrapper"==a?bc(s):void 0;o=h&&Rc(h[0])&&424==h[1]&&!h[4].length&&1==h[9]?o[Ec(h[0])].apply(o,h[3]):1==s.length&&Rc(s)?o[a]():o.thru(s)}return function(){var t=arguments,n=t[0];if(o&&1==t.length&&_u(n))return o.plant(n).value();for(var r=0,s=i?e[r].apply(this,t):n;++r<i;)s=e[r].call(this,s);return s}}))}var g_=f_(),m_=f_(!0);function v_(t,e){return zg(e,(function(e){return Vu(t[e])}))}var y_=Object.prototype.hasOwnProperty,__=ey((function(t,e,i){y_.call(t,i)?t[i].push(e):Nd(t,i,[e])}));function x_(t,e){return t>e}function b_(t){return function(e,i){return"string"==typeof e&&"string"==typeof i||(e=Bu(e),i=Bu(i)),t(e,i)}}var w_=b_(x_),T_=b_((function(t,e){return t>=e})),E_=Object.prototype.hasOwnProperty;function A_(t,e){return null!=t&&E_.call(t,e)}var S_=Math.max,C_=Math.min;var I_="[object String]";function M_(t){return"string"==typeof t||!_u(t)&&pu(t)&&du(t)==I_}function R_(t,e){return yu(e,(function(e){return t[e]}))}function P_(t){return null==t?[]:R_(t,bp(t))}var D_=Math.max;var O_=Math.max;var L_=Math.min;function N_(t,e,i){for(var n=i?Ay:Xc,r=t[0].length,s=t.length,o=s,a=Array(s),h=1/0,l=[];o--;){var u=t[o];o&&e&&(u=yu(u,hp(e))),h=L_(u.length,h),a[o]=!i&&(e||r>=120&&u.length>=120)?new Qm(o&&u):void 0}u=t[0];var c=-1,d=a[0];t:for(;++c<r&&l.length<h;){var p=u[c],f=e?e(p):p;if(p=i||0!==p?p:0,!(d?ev(d,f):n(l,f,i))){for(o=s;--o;){var g=a[o];if(!(g?ev(g,f):n(t[o],f,i)))continue t}d&&d.push(f),l.push(p)}}return l}function B_(t){return gy(t)?t:[]}var k_=jd((function(t){var e=yu(t,B_);return e.length&&e[0]===t[0]?N_(e):[]})),F_=jd((function(t){var e=My(t),i=yu(t,B_);return e===My(i)?e=void 0:i.pop(),i.length&&i[0]===t[0]?N_(i,Vv(e)):[]})),U_=jd((function(t){var e=My(t),i=yu(t,B_);return(e="function"==typeof e?e:void 0)&&i.pop(),i.length&&i[0]===t[0]?N_(i,void 0,e):[]}));function G_(t,e){return function(i,n){return function(t,e,i,n){return Zv(t,(function(t,r,s){e(n,i(t),r,s)})),n}(i,t,e(n),{})}}var z_=Object.prototype.toString,j_=G_((function(t,e,i){null!=e&&"function"!=typeof e.toString&&(e=z_.call(e)),t[e]=i}),kc(zu)),H_=Object.prototype,W_=H_.hasOwnProperty,X_=H_.toString,V_=G_((function(t,e,i){null!=e&&"function"!=typeof e.toString&&(e=X_.call(e)),W_.call(t,e)?t[e].push(i):t[e]=[i]}),Vv);function Y_(t,e){return e.length<2?t:Jp(t,Sf(e,0,-1))}function $_(t,e,i){var n=null==(t=Y_(t,e=qp(e,t)))?t:t[Zp(My(e))];return null==n?void 0:dc(n,t,i)}var q_=jd($_),K_=jd((function(t,e,i){var n=-1,r="function"==typeof e,s=Xd(t)?Array(t.length):[];return Qv(t,(function(t){s[++n]=r?dc(e,t,i):$_(t,e,i)})),s}));var Z_=dp&&dp.isArrayBuffer,J_=Z_?hp(Z_):function(t){return pu(t)&&"[object ArrayBuffer]"==du(t)};var Q_=dp&&dp.isDate,tx=Q_?hp(Q_):function(t){return pu(t)&&"[object Date]"==du(t)};var ex=Object.prototype.hasOwnProperty;function ix(t,e){return Rv(t,e)}var nx=iu.isFinite;function rx(t){return"number"==typeof t&&t==Gu(t)}var sx="[object Number]";function ox(t){return"number"==typeof t||pu(t)&&du(t)==sx}var ax=Yu?Vu:ip;var hx=dp&&dp.isRegExp,lx=hx?hp(hx):function(t){return pu(t)&&"[object RegExp]"==du(t)},ux=9007199254740991;var cx=Array.prototype.join;var dx=Eg((function(t,e,i){return t+(i?"-":"")+e.toLowerCase()})),px=ey((function(t,e,i){Nd(t,i,e)}));var fx=Math.max,gx=Math.min;var mx=Eg((function(t,e,i){return t+(i?" ":"")+e.toLowerCase()})),vx=Hf("toLowerCase");function yx(t,e){return t<e}var _x=b_(yx),xx=b_((function(t,e){return t<=e}));function bx(t,e,i){for(var n=-1,r=t.length;++n<r;){var s=t[n],o=e(s);if(null!=o&&(void 0===a?o==o&&!gu(o):i(o,a)))var a=o,h=s}return h}function wx(t,e){for(var i,n=-1,r=t.length;++n<r;){var s=e(t[n]);void 0!==s&&(i=void 0===i?s:i+s)}return i}var Tx=NaN;function Ex(t,e){var i=null==t?0:t.length;return i?wx(t,e)/i:Tx}var Ax=Yd((function(t,e,i){yy(t,e,i)})),Sx=jd((function(t,e){return function(i){return $_(i,t,e)}})),Cx=jd((function(t,e){return function(i){return $_(t,i,e)}}));function Ix(t,e,i){var n=bp(e),r=v_(e,n),s=!(Ru(i)&&"chain"in i&&!i.chain),o=Vu(t);return zc(r,(function(i){var n=e[i];t[i]=n,o&&(t.prototype[i]=function(){var e=this.__chain__;if(s||e){var i=t(this.__wrapped__);return(i.__actions__=Sc(this.__actions__)).push({func:n,args:arguments,thisArg:t}),i.__chain__=e,i}return n.apply(t,ef([this.value()],arguments))})})),t}var Mx=Eu((function(t,e){return t*e}),1),Rx="Expected a function";function Px(t){if("function"!=typeof t)throw new TypeError(Rx);return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}var Dx="[object Map]",Ox="[object Set]",Lx=nu?nu.iterator:void 0;function Nx(t){if(!t)return[];if(Xd(t))return M_(t)?jf(t):Sc(t);if(Lx&&t[Lx])return function(t){for(var e,i=[];!(e=t.next()).done;)i.push(e.value);return i}(t[Lx]());var e=um(t);return(e==Dx?sv:e==Ox?ov:P_)(t)}function Bx(t,e){var i=t.length;if(i)return rd(e+=e<0?i:0,i)?t[e]:void 0}function kx(t,e){return null==(t=Y_(t,e=qp(e,t)))||delete t[Zp(My(e))]}function Fx(t){return mf(t)?void 0:t}var Ux=af((function(t,e){var i={};if(null==t)return i;var n=!1;e=yu(e,(function(e){return e=qp(e,t),n||(n=e.length>1),e})),Ud(t,qg(t),i),n&&(i=Zm(i,7,Fx));for(var r=e.length;r--;)kx(i,e[r]);return i}));function Gx(t,e,i,n){if(!Ru(t))return t;for(var r=-1,s=(e=qp(e,t)).length,o=s-1,a=t;null!=a&&++r<s;){var h=Zp(e[r]),l=i;if("__proto__"===h||"constructor"===h||"prototype"===h)return t;if(r!=o){var u=a[h];void 0===(l=n?n(u,h,a):void 0)&&(l=Ru(u)?u:rd(e[r+1])?[]:{})}Fd(a,h,l),a=a[h]}return t}function zx(t,e,i){for(var n=-1,r=e.length,s={};++n<r;){var o=e[n],a=Jp(t,o);i(a,o)&&Gx(s,qp(o,t),a)}return s}function jx(t,e){if(null==t)return{};var i=yu(qg(t),(function(t){return[t]}));return e=Vv(e),zx(t,i,(function(t,i){return e(t,i[0])}))}function Hx(t,e){if(t!==e){var i=void 0!==t,n=null===t,r=t==t,s=gu(t),o=void 0!==e,a=null===e,h=e==e,l=gu(e);if(!a&&!l&&!s&&t>e||s&&o&&h&&!a&&!l||n&&o&&h||!i&&h||!r)return 1;if(!n&&!s&&!l&&t<e||l&&i&&r&&!n&&!s||a&&i&&r||!o&&r||!h)return-1}return 0}function Wx(t,e,i){e=e.length?yu(e,(function(t){return _u(t)?function(e){return Jp(e,1===t.length?t[0]:t)}:t})):[zu];var n=-1;e=yu(e,hp(Vv));var r=c_(t,(function(t,i,r){var s=yu(e,(function(e){return e(t)}));return{criteria:s,index:++n,value:t}}));return function(t,e){var i=t.length;for(t.sort(e);i--;)t[i]=t[i].value;return t}(r,(function(t,e){return function(t,e,i){for(var n=-1,r=t.criteria,s=e.criteria,o=r.length,a=i.length;++n<o;){var h=Hx(r[n],s[n]);if(h)return n>=a?h:h*("desc"==i[n]?-1:1)}return t.index-e.index}(t,e,i)}))}function Xx(t){return af((function(e){return e=yu(e,hp(Vv)),jd((function(i){var n=this;return t(e,(function(t){return dc(t,n,i)}))}))}))}var Vx=Xx(yu),Yx=jd,$x=Math.min,qx=Yx((function(t,e){var i=(e=1==e.length&&_u(e[0])?yu(e[0],hp(Vv)):yu(sf(e,1),hp(Vv))).length;return jd((function(n){for(var r=-1,s=$x(n.length,i);++r<s;)n[r]=e[r].call(this,n[r]);return dc(t,this,n)}))})),Kx=Xx(Ky),Zx=Xx(tv),Jx=9007199254740991,Qx=Math.floor;function tb(t,e){var i="";if(!t||e<1||e>Jx)return i;do{e%2&&(i+=t),(e=Qx(e/2))&&(t+=t)}while(e);return i}var eb=Wv("length"),ib="\\ud800-\\udfff",nb="["+ib+"]",rb="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",sb="\\ud83c[\\udffb-\\udfff]",ob="[^"+ib+"]",ab="(?:\\ud83c[\\udde6-\\uddff]){2}",hb="[\\ud800-\\udbff][\\udc00-\\udfff]",lb="(?:"+rb+"|"+sb+")"+"?",ub="[\\ufe0e\\ufe0f]?",cb=ub+lb+("(?:\\u200d(?:"+[ob,ab,hb].join("|")+")"+ub+lb+")*"),db="(?:"+[ob+rb+"?",rb,ab,hb,nb].join("|")+")",pb=RegExp(sb+"(?="+sb+")|"+db+cb,"g");function fb(t){return Mf(t)?function(t){for(var e=pb.lastIndex=0;pb.test(t);)++e;return e}(t):eb(t)}var gb=Math.ceil;function mb(t,e){var i=(e=void 0===e?" ":Tu(e)).length;if(i<2)return i?tb(e,t):e;var n=tb(e,gb(t/fb(e)));return Mf(e)?Cf(jf(n),0,t).join(""):n.slice(0,t)}var vb=Math.ceil,yb=Math.floor;var _b=/^\s+/,xb=iu.parseInt;var bb=jd((function(t,e){return Dd(t,32,void 0,e,ad(e,ed(bb)))}));bb.placeholder={};var wb=jd((function(t,e){return Dd(t,64,void 0,e,ad(e,ed(wb)))}));wb.placeholder={};var Tb=ey((function(t,e,i){t[i?0:1].push(e)}),(function(){return[[],[]]}));var Eb=af((function(t,e){return null==t?{}:function(t,e){return zx(t,e,(function(e,i){return Gv(t,i)}))}(t,e)}));function Ab(t,e,i,n){for(var r=i-1,s=t.length;++r<s;)if(n(t[r],e))return r;return-1}var Sb=Array.prototype.splice;function Cb(t,e,i,n){var r=n?Ab:Wc,s=-1,o=e.length,a=t;for(t===e&&(e=Sc(e)),i&&(a=yu(t,hp(i)));++s<o;)for(var h=0,l=e[s],u=i?i(l):l;(h=r(a,u,h,n))>-1;)a!==t&&Sb.call(a,h,1),Sb.call(t,h,1);return t}function Ib(t,e){return t&&t.length&&e&&e.length?Cb(t,e):t}var Mb=jd(Ib);var Rb=Array.prototype.splice;function Pb(t,e){for(var i=t?e.length:0,n=i-1;i--;){var r=e[i];if(i==n||r!==s){var s=r;rd(r)?Rb.call(t,r,1):kx(t,r)}}return t}var Db=af((function(t,e){var i=null==t?0:t.length,n=tf(t,e);return Pb(t,yu(e,(function(t){return rd(t,i)?+t:t})).sort(Hx)),n})),Ob=Math.floor,Lb=Math.random;function Nb(t,e){return t+Ob(Lb()*(e-t+1))}var Bb=parseFloat,kb=Math.min,Fb=Math.random;var Ub=Math.ceil,Gb=Math.max;function zb(t){return function(e,i,n){return n&&"number"!=typeof n&&Vd(e,i,n)&&(i=n=void 0),e=Uu(e),void 0===i?(i=e,e=0):i=Uu(i),function(t,e,i,n){for(var r=-1,s=Gb(Ub((e-t)/(i||1)),0),o=Array(s);s--;)o[n?s:++r]=t,t+=i;return o}(e,i,n=void 0===n?e<i?1:-1:Uu(n),t)}}var jb=zb(),Hb=zb(!0),Wb=af((function(t,e){return Dd(t,256,void 0,void 0,void 0,e)}));function Xb(t,e,i,n,r){return r(t,(function(t,r,s){i=n?(n=!1,t):e(i,t,r,s)})),i}function Vb(t,e,i,n){var r=null==t?0:t.length;for(n&&r&&(i=t[--r]);r--;)i=e(i,t[r],r,t);return i}var Yb=Array.prototype.reverse;function $b(t){return null==t?t:Yb.call(t)}var qb=Ig("round");function Kb(t){var e=t.length;return e?t[Nb(0,e-1)]:void 0}function Zb(t){return Kb(P_(t))}function Jb(t,e){var i=-1,n=t.length,r=n-1;for(e=void 0===e?n:e;++i<e;){var s=Nb(i,r),o=t[s];t[s]=t[i],t[i]=o}return t.length=e,t}function Qb(t,e){return Jb(Sc(t),Og(e,0,t.length))}function tw(t,e){var i=P_(t);return Jb(i,Og(e,0,i.length))}function ew(t){return Jb(Sc(t))}function iw(t){return Jb(P_(t))}var nw=Eg((function(t,e,i){return t+(i?"_":"")+e.toLowerCase()}));function rw(t,e){var i;return Qv(t,(function(t,n,r){return!(i=e(t,n,r))})),!!i}var sw=jd((function(t,e){if(null==t)return[];var i=e.length;return i>1&&Vd(t,e[0],e[1])?e=[]:i>2&&Vd(e[0],e[1],e[2])&&(e=[e[0]]),Wx(t,sf(e,1),[])})),ow=4294967294,aw=Math.floor,hw=Math.min;function lw(t,e,i,n){var r=0,s=null==t?0:t.length;if(0===s)return 0;for(var o=(e=i(e))!=e,a=null===e,h=gu(e),l=void 0===e;r<s;){var u=aw((r+s)/2),c=i(t[u]),d=void 0!==c,p=null===c,f=c==c,g=gu(c);if(o)var m=n||f;else m=l?f&&(n||d):a?f&&d&&(n||!p):h?f&&d&&!p&&(n||!g):!p&&!g&&(n?c<=e:c<e);m?r=u+1:s=u}return hw(s,ow)}var uw=2147483647;function cw(t,e,i){var n=0,r=null==t?n:t.length;if("number"==typeof e&&e==e&&r<=uw){for(;n<r;){var s=n+r>>>1,o=t[s];null!==o&&!gu(o)&&(i?o<=e:o<e)?n=s+1:r=s}return r}return lw(t,e,zu,i)}function dw(t,e){for(var i=-1,n=t.length,r=0,s=[];++i<n;){var o=t[i],a=e?e(o):o;if(!i||!Bd(a,h)){var h=a;s[r++]=0===o?0:o}}return s}var pw=Math.max;var fw=Eg((function(t,e,i){return t+(i?" ":"")+Wf(e)}));var gw=Eu((function(t,e){return t-e}),0);var mw=Object.prototype,vw=mw.hasOwnProperty;function yw(t,e,i,n){return void 0===t||Bd(t,mw[i])&&!vw.call(n,i)?e:t}var _w={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"};function xw(t){return"\\"+_w[t]}var bw=/<%=([\s\S]+?)%>/g,ww={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:bw,variable:"",imports:{_:{escape:Yy}}},Tw=/\b__p \+= '';/g,Ew=/\b(__p \+=) '' \+/g,Aw=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Sw=/[()=,{}\[\]\/\s]/,Cw=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Iw=/($^)/,Mw=/['\n\r\u2028\u2029\\]/g,Rw=Object.prototype.hasOwnProperty;function Pw(t,e){return e(t)}var Dw=4294967295,Ow=Math.min;function Lw(t,e){var i=t;return i instanceof _c&&(i=i.value()),Vf(e,(function(t,e){return e.func.apply(e.thisArg,ef([t],e.args))}),i)}function Nw(){return Lw(this.__wrapped__,this.__actions__)}var Bw=9007199254740991;function kw(t,e){for(var i=t.length;i--&&Wc(e,t[i],0)>-1;);return i}function Fw(t,e){for(var i=-1,n=t.length;++i<n&&Wc(e,t[i],0)>-1;);return i}var Uw=/^\s+/;var Gw=/\w*$/;var zw=Yf({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"}),jw=/&(?:amp|lt|gt|quot|#39);/g,Hw=RegExp(jw.source);var Ww=Jg&&1/ov(new Jg([,-0]))[1]==1/0?function(t){return new Jg(t)}:xc,Xw=200;function Vw(t,e,i){var n=-1,r=Xc,s=t.length,o=!0,a=[],h=a;if(i)o=!1,r=Ay;else if(s>=Xw){var l=e?null:Ww(t);if(l)return ov(l);o=!1,r=ev,h=new Qm}else h=e?[]:a;t:for(;++n<s;){var u=t[n],c=e?e(u):u;if(u=i||0!==u?u:0,o&&c==c){for(var d=h.length;d--;)if(h[d]===c)continue t;e&&h.push(c),a.push(u)}else r(h,c,i)||(h!==a&&h.push(c),a.push(u))}return a}var Yw=jd((function(t){return Vw(sf(t,1,gy,!0))})),$w=jd((function(t){var e=My(t);return gy(e)&&(e=void 0),Vw(sf(t,1,gy,!0),Vv(e))})),qw=jd((function(t){var e=My(t);return e="function"==typeof e?e:void 0,Vw(sf(t,1,gy,!0),void 0,e)}));var Kw=0;var Zw=Math.max;function Jw(t){if(!t||!t.length)return[];var e=0;return t=zg(t,(function(t){if(gy(t))return e=Zw(t.length,e),!0})),Kd(e,(function(e){return yu(t,Wv(e))}))}function Qw(t,e){if(!t||!t.length)return[];var i=Jw(t);return null==e?i:yu(i,(function(t){return dc(e,void 0,t)}))}function tT(t,e,i,n){return Gx(t,e,i(Jp(t,e)),n)}var eT=Eg((function(t,e,i){return t+(i?" ":"")+e.toUpperCase()}));var iT=jd((function(t,e){return gy(t)?Cy(t,e):[]}));var nT=af((function(t){var e=t.length,i=e?t[0]:0,n=this.__wrapped__,r=function(e){return tf(e,t)};return!(e>1||this.__actions__.length)&&n instanceof _c&&rd(i)?((n=n.slice(i,+i+(e?1:0))).__actions__.push({func:Pw,args:[r],thisArg:void 0}),new Ac(n,this.__chain__).thru((function(t){return e&&!t.length&&t.push(void 0),t}))):this.thru(r)}));function rT(t,e,i){var n=t.length;if(n<2)return n?Vw(t[0]):[];for(var r=-1,s=Array(n);++r<n;)for(var o=t[r],a=-1;++a<n;)a!=r&&(s[r]=Cy(s[r]||o,t[a],e,i));return Vw(sf(s,1),e,i)}var sT=jd((function(t){return rT(zg(t,gy))})),oT=jd((function(t){var e=My(t);return gy(e)&&(e=void 0),rT(zg(t,gy),Vv(e))})),aT=jd((function(t){var e=My(t);return e="function"==typeof e?e:void 0,rT(zg(t,gy),void 0,e)})),hT=jd(Jw);function lT(t,e,i){for(var n=-1,r=t.length,s=e.length,o={};++n<r;){var a=n<s?e[n]:void 0;i(o,t[n],a)}return o}var uT=jd((function(t){var e=t.length,i=e>1?t[e-1]:void 0;return i="function"==typeof i?(t.pop(),i):void 0,Qw(t,i)})),cT={chunk:function(t,e,i){e=(i?Vd(t,e,i):void 0===e)?1:Dg(Gu(e),0);var n=null==t?0:t.length;if(!n||e<1)return[];for(var r=0,s=0,o=Array(Pg(n/e));r<n;)o[s++]=Sf(t,r,r+=e);return o},compact:function(t){for(var e=-1,i=null==t?0:t.length,n=0,r=[];++e<i;){var s=t[e];s&&(r[n++]=s)}return r},concat:function(){var t=arguments.length;if(!t)return[];for(var e=Array(t-1),i=arguments[0],n=t;n--;)e[n-1]=arguments[n];return ef(_u(i)?Sc(i):[i],sf(e,1))},difference:Iy,differenceBy:Ry,differenceWith:Py,drop:function(t,e,i){var n=null==t?0:t.length;return n?Sf(t,(e=i||void 0===e?1:Gu(e))<0?0:e,n):[]},dropRight:function(t,e,i){var n=null==t?0:t.length;return n?Sf(t,0,(e=n-(e=i||void 0===e?1:Gu(e)))<0?0:e):[]},dropRightWhile:function(t,e){return t&&t.length?Oy(t,Vv(e),!0,!0):[]},dropWhile:function(t,e){return t&&t.length?Oy(t,Vv(e),!0):[]},fill:function(t,e,i,n){var r=null==t?0:t.length;return r?(i&&"number"!=typeof i&&Vd(t,e,i)&&(i=0,n=r),function(t,e,i,n){var r=t.length;for((i=Gu(i))<0&&(i=-i>r?0:r+i),(n=void 0===n||n>r?r:Gu(n))<0&&(n+=r),n=i>n?0:Qy(n);i<n;)t[i++]=e;return t}(t,e,i,n)):[]},findIndex:n_,findLastIndex:h_,first:u_,flatten:of,flattenDeep:function(t){return(null==t?0:t.length)?sf(t,Infinity):[]},flattenDepth:function(t,e){return(null==t?0:t.length)?sf(t,e=void 0===e?1:Gu(e)):[]},fromPairs:function(t){for(var e=-1,i=null==t?0:t.length,n={};++e<i;){var r=t[e];n[r[0]]=r[1]}return n},head:u_,indexOf:function(t,e,i){var n=null==t?0:t.length;if(!n)return-1;var r=null==i?0:Gu(i);return r<0&&(r=O_(n+r,0)),Wc(t,e,r)},initial:function(t){return(null==t?0:t.length)?Sf(t,0,-1):[]},intersection:k_,intersectionBy:F_,intersectionWith:U_,join:function(t,e){return null==t?"":cx.call(t,e)},last:My,lastIndexOf:function(t,e,i){var n=null==t?0:t.length;if(!n)return-1;var r=n;return void 0!==i&&(r=(r=Gu(i))<0?fx(n+r,0):gx(r,n-1)),e==e?function(t,e,i){for(var n=i+1;n--;)if(t[n]===e)return n;return n}(t,e,r):jc(t,Hc,r,!0)},nth:function(t,e){return t&&t.length?Bx(t,Gu(e)):void 0},pull:Mb,pullAll:Ib,pullAllBy:function(t,e,i){return t&&t.length&&e&&e.length?Cb(t,e,Vv(i)):t},pullAllWith:function(t,e,i){return t&&t.length&&e&&e.length?Cb(t,e,void 0,i):t},pullAt:Db,remove:function(t,e){var i=[];if(!t||!t.length)return i;var n=-1,r=[],s=t.length;for(e=Vv(e);++n<s;){var o=t[n];e(o,n,t)&&(i.push(o),r.push(n))}return Pb(t,r),i},reverse:$b,slice:function(t,e,i){var n=null==t?0:t.length;return n?(i&&"number"!=typeof i&&Vd(t,e,i)?(e=0,i=n):(e=null==e?0:Gu(e),i=void 0===i?n:Gu(i)),Sf(t,e,i)):[]},sortedIndex:function(t,e){return cw(t,e)},sortedIndexBy:function(t,e,i){return lw(t,e,Vv(i))},sortedIndexOf:function(t,e){var i=null==t?0:t.length;if(i){var n=cw(t,e);if(n<i&&Bd(t[n],e))return n}return-1},sortedLastIndex:function(t,e){return cw(t,e,!0)},sortedLastIndexBy:function(t,e,i){return lw(t,e,Vv(i),!0)},sortedLastIndexOf:function(t,e){if(null==t?0:t.length){var i=cw(t,e,!0)-1;if(Bd(t[i],e))return i}return-1},sortedUniq:function(t){return t&&t.length?dw(t):[]},sortedUniqBy:function(t,e){return t&&t.length?dw(t,Vv(e)):[]},tail:function(t){var e=null==t?0:t.length;return e?Sf(t,1,e):[]},take:function(t,e,i){return t&&t.length?Sf(t,0,(e=i||void 0===e?1:Gu(e))<0?0:e):[]},takeRight:function(t,e,i){var n=null==t?0:t.length;return n?Sf(t,(e=n-(e=i||void 0===e?1:Gu(e)))<0?0:e,n):[]},takeRightWhile:function(t,e){return t&&t.length?Oy(t,Vv(e),!1,!0):[]},takeWhile:function(t,e){return t&&t.length?Oy(t,Vv(e)):[]},union:Yw,unionBy:$w,unionWith:qw,uniq:function(t){return t&&t.length?Vw(t):[]},uniqBy:function(t,e){return t&&t.length?Vw(t,Vv(e)):[]},uniqWith:function(t,e){return e="function"==typeof e?e:void 0,t&&t.length?Vw(t,void 0,e):[]},unzip:Jw,unzipWith:Qw,without:iT,xor:sT,xorBy:oT,xorWith:aT,zip:hT,zipObject:function(t,e){return lT(t||[],e||[],Fd)},zipObjectDeep:function(t,e){return lT(t||[],e||[],Gx)},zipWith:uT},dT={countBy:ny,each:Ny,eachRight:Gy,every:function(t,e,i){var n=_u(t)?Ky:Zy;return i&&Vd(t,e,i)&&(e=void 0),n(t,Vv(e))},filter:function(t,e){return(_u(t)?zg:t_)(t,Vv(e))},find:r_,findLast:l_,flatMap:function(t,e){return sf(d_(t,e),1)},flatMapDeep:function(t,e){return sf(d_(t,e),Infinity)},flatMapDepth:function(t,e,i){return i=void 0===i?1:Gu(i),sf(d_(t,e),i)},forEach:Ny,forEachRight:Gy,groupBy:__,includes:function(t,e,i,n){t=Xd(t)?t:P_(t),i=i&&!n?Gu(i):0;var r=t.length;return i<0&&(i=D_(r+i,0)),M_(t)?i<=r&&t.indexOf(e,i)>-1:!!r&&Wc(t,e,i)>-1},invokeMap:K_,keyBy:px,map:d_,orderBy:function(t,e,i,n){return null==t?[]:(_u(e)||(e=null==e?[]:[e]),_u(i=n?void 0:i)||(i=null==i?[]:[i]),Wx(t,e,i))},partition:Tb,reduce:function(t,e,i){var n=_u(t)?Vf:Xb,r=arguments.length<3;return n(t,Vv(e),i,r,Qv)},reduceRight:function(t,e,i){var n=_u(t)?Vb:Xb,r=arguments.length<3;return n(t,Vv(e),i,r,Uy)},reject:function(t,e){return(_u(t)?zg:t_)(t,Px(Vv(e)))},sample:function(t){return(_u(t)?Kb:Zb)(t)},sampleSize:function(t,e,i){return e=(i?Vd(t,e,i):void 0===e)?1:Gu(e),(_u(t)?Qb:tw)(t,e)},shuffle:function(t){return(_u(t)?ew:iw)(t)},size:function(t){if(null==t)return 0;if(Xd(t))return M_(t)?fb(t):t.length;var e=um(t);return"[object Map]"==e||"[object Set]"==e?t.size:xp(t).length},some:function(t,e,i){var n=_u(t)?tv:rw;return i&&Vd(t,e,i)&&(e=void 0),n(t,Vv(e))},sortBy:sw},pT=oy,fT={after:function(t,e){if("function"!=typeof e)throw new TypeError("Expected a function");return t=Gu(t),function(){if(--t<1)return e.apply(this,arguments)}},ary:Ld,before:wf,bind:Tf,bindKey:Af,curry:ry,curryRight:sy,debounce:uy,defer:Ty,delay:Ey,flip:function(t){return Dd(t,512)},memoize:Wp,negate:Px,once:function(t){return wf(2,t)},overArgs:qx,partial:bb,partialRight:wb,rearg:Wb,rest:function(t,e){if("function"!=typeof t)throw new TypeError("Expected a function");return jd(t,e=void 0===e?e:Gu(e))},spread:function(t,e){if("function"!=typeof t)throw new TypeError("Expected a function");return e=null==e?0:pw(Gu(e),0),jd((function(i){var n=i[e],r=Cf(i,0,e);return n&&ef(r,n),dc(t,this,r)}))},throttle:function(t,e,i){var n=!0,r=!0;if("function"!=typeof t)throw new TypeError("Expected a function");return Ru(i)&&(n="leading"in i?!!i.leading:n,r="trailing"in i?!!i.trailing:r),uy(t,e,{leading:n,maxWait:e,trailing:r})},unary:function(t){return Ld(t,1)},wrap:function(t,e){return bb(Ly(e),t)}},gT={castArray:function(){if(!arguments.length)return[];var t=arguments[0];return _u(t)?t:[t]},clone:function(t){return Zm(t,4)},cloneDeep:Jm,cloneDeepWith:function(t,e){return Zm(t,5,e="function"==typeof e?e:void 0)},cloneWith:function(t,e){return Zm(t,4,e="function"==typeof e?e:void 0)},conformsTo:function(t,e){return null==e||Yv(t,e,bp(e))},eq:Bd,gt:w_,gte:T_,isArguments:ep,isArray:_u,isArrayBuffer:J_,isArrayLike:Xd,isArrayLikeObject:gy,isBoolean:function(t){return!0===t||!1===t||pu(t)&&"[object Boolean]"==du(t)},isBuffer:op,isDate:tx,isElement:function(t){return pu(t)&&1===t.nodeType&&!mf(t)},isEmpty:function(t){if(null==t)return!0;if(Xd(t)&&(_u(t)||"string"==typeof t||"function"==typeof t.splice||op(t)||fp(t)||ep(t)))return!t.length;var e=um(t);if("[object Map]"==e||"[object Set]"==e)return!t.size;if(qd(t))return!xp(t).length;for(var i in t)if(ex.call(t,i))return!1;return!0},isEqual:ix,isEqualWith:function(t,e,i){var n=(i="function"==typeof i?i:void 0)?i(t,e):void 0;return void 0===n?Rv(t,e,void 0,i):!!n},isError:_f,isFinite:function(t){return"number"==typeof t&&nx(t)},isFunction:Vu,isInteger:rx,isLength:Wd,isMap:Gm,isMatch:function(t,e){return t===e||Ov(t,e,Nv(e))},isMatchWith:function(t,e,i){return i="function"==typeof i?i:void 0,Ov(t,e,Nv(e),i)},isNaN:function(t){return ox(t)&&t!=+t},isNative:function(t){if(ax(t))throw new Error("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return nc(t)},isNil:function(t){return null==t},isNull:function(t){return null===t},isNumber:ox,isObject:Ru,isObjectLike:pu,isPlainObject:mf,isRegExp:lx,isSafeInteger:function(t){return rx(t)&&t>=-9007199254740991&&t<=ux},isSet:jm,isString:M_,isSymbol:gu,isTypedArray:fp,isUndefined:function(t){return void 0===t},isWeakMap:function(t){return pu(t)&&"[object WeakMap]"==um(t)},isWeakSet:function(t){return pu(t)&&"[object WeakSet]"==du(t)},lt:_x,lte:xx,toArray:Nx,toFinite:Uu,toInteger:Gu,toLength:Qy,toNumber:Bu,toPlainObject:vy,toSafeInteger:function(t){return t?Og(Gu(t),-9007199254740991,Bw):0===t?t:0},toString:$p},mT={add:Au,ceil:Mg,divide:Dy,floor:p_,max:function(t){return t&&t.length?bx(t,zu,x_):void 0},maxBy:function(t,e){return t&&t.length?bx(t,Vv(e),x_):void 0},mean:function(t){return Ex(t,zu)},meanBy:function(t,e){return Ex(t,Vv(e))},min:function(t){return t&&t.length?bx(t,zu,yx):void 0},minBy:function(t,e){return t&&t.length?bx(t,Vv(e),yx):void 0},multiply:Mx,round:qb,subtract:gw,sum:function(t){return t&&t.length?wx(t,zu):0},sumBy:function(t,e){return t&&t.length?wx(t,Vv(e)):0}},vT=function(t,e,i){return void 0===i&&(i=e,e=void 0),void 0!==i&&(i=(i=Bu(i))==i?i:0),void 0!==e&&(e=(e=Bu(e))==e?e:0),Og(Bu(t),e,i)},yT=function(t,e,i){return e=Uu(e),void 0===i?(i=e,e=0):i=Uu(i),function(t,e,i){return t>=C_(e,i)&&t<S_(e,i)}(t=Bu(t),e,i)},_T=function(t,e,i){if(i&&"boolean"!=typeof i&&Vd(t,e,i)&&(e=i=void 0),void 0===i&&("boolean"==typeof e?(i=e,e=void 0):"boolean"==typeof t&&(i=t,t=void 0)),void 0===t&&void 0===e?(t=0,e=1):(t=Uu(t),void 0===e?(e=t,t=0):e=Uu(e)),t>e){var n=t;t=e,e=n}if(i||t%1||e%1){var r=Fb();return kb(t+r*(e-t+Bb("1e-"+((r+"").length-1))),e)}return Nb(t,e)},xT={assign:Tp,assignIn:Cp,assignInWith:Ip,assignWith:Mp,at:hf,create:function(t,e){var i=lc(t);return null==e?i:Ng(i,e)},defaults:py,defaultsDeep:by,entries:jy,entriesIn:Hy,extend:Cp,extendWith:Ip,findKey:function(t,e){return s_(t,Vv(e),Zv)},findLastKey:function(t,e){return s_(t,Vv(e),Fy)},forIn:function(t,e){return null==t?t:Kv(t,Ly(e),Sp)},forInRight:function(t,e){return null==t?t:ky(t,Ly(e),Sp)},forOwn:function(t,e){return t&&Zv(t,Ly(e))},forOwnRight:function(t,e){return t&&Fy(t,Ly(e))},functions:function(t){return null==t?[]:v_(t,bp(t))},functionsIn:function(t){return null==t?[]:v_(t,Sp(t))},get:Qp,has:function(t,e){return null!=t&&Uv(t,e,A_)},hasIn:Gv,invert:j_,invertBy:V_,invoke:q_,keys:bp,keysIn:Sp,mapKeys:function(t,e){var i={};return e=Vv(e),Zv(t,(function(t,n,r){Nd(i,e(t,n,r),t)})),i},mapValues:function(t,e){var i={};return e=Vv(e),Zv(t,(function(t,n,r){Nd(i,n,e(t,n,r))})),i},merge:Ax,mergeWith:xy,omit:Ux,omitBy:function(t,e){return jx(t,Px(Vv(e)))},pick:Eb,pickBy:jx,result:function(t,e,i){var n=-1,r=(e=qp(e,t)).length;for(r||(r=1,t=void 0);++n<r;){var s=null==t?void 0:t[Zp(e[n])];void 0===s&&(n=r,s=i),t=Vu(s)?s.call(t):s}return t},set:function(t,e,i){return null==t?t:Gx(t,e,i)},setWith:function(t,e,i,n){return n="function"==typeof n?n:void 0,null==t?t:Gx(t,e,i,n)},toPairs:jy,toPairsIn:Hy,transform:function(t,e,i){var n=_u(t),r=n||op(t)||fp(t);if(e=Vv(e),null==i){var s=t&&t.constructor;i=r?n?new s:[]:Ru(t)&&Vu(s)?lc(lf(t)):{}}return(r?zc:Zv)(t,(function(t,n,r){return e(i,t,n,r)})),i},unset:function(t,e){return null==t||kx(t,e)},update:function(t,e,i){return null==t?t:tT(t,e,Ly(i))},updateWith:function(t,e,i,n){return n="function"==typeof n?n:void 0,null==t?t:tT(t,e,Ly(i),n)},values:P_,valuesIn:function(t){return null==t?[]:R_(t,Sp(t))}},bT={at:nT,chain:Rg,commit:function(){return new Ac(this.value(),this.__chain__)},lodash:Mc,next:function(){void 0===this.__values__&&(this.__values__=Nx(this.value()));var t=this.__index__>=this.__values__.length;return{done:t,value:t?void 0:this.__values__[this.__index__++]}},plant:function(t){for(var e,i=this;i instanceof vc;){var n=Cc(i);n.__index__=0,n.__values__=void 0,e?r.__wrapped__=n:e=n;var r=n;i=i.__wrapped__}return r.__wrapped__=t,e},reverse:function(){var t=this.__wrapped__;if(t instanceof _c){var e=t;return this.__actions__.length&&(e=new _c(this)),(e=e.reverse()).__actions__.push({func:Pw,args:[$b],thisArg:void 0}),new Ac(e,this.__chain__)}return this.thru($b)},tap:function(t,e){return e(t),t},thru:Pw,toIterator:function(){return this},toJSON:Nw,value:Nw,valueOf:Nw,wrapperChain:function(){return Rg(this)}},wT={camelCase:Ag,capitalize:Xf,deburr:Zf,endsWith:function(t,e,i){t=$p(t),e=Tu(e);var n=t.length,r=i=void 0===i?n:Og(Gu(i),0,n);return(i-=e.length)>=0&&t.slice(i,r)==e},escape:Yy,escapeRegExp:function(t){return(t=$p(t))&&qy.test(t)?t.replace($y,"\\$&"):t},kebabCase:dx,lowerCase:mx,lowerFirst:vx,pad:function(t,e,i){t=$p(t);var n=(e=Gu(e))?fb(t):0;if(!e||n>=e)return t;var r=(e-n)/2;return mb(yb(r),i)+t+mb(vb(r),i)},padEnd:function(t,e,i){t=$p(t);var n=(e=Gu(e))?fb(t):0;return e&&n<e?t+mb(e-n,i):t},padStart:function(t,e,i){t=$p(t);var n=(e=Gu(e))?fb(t):0;return e&&n<e?mb(e-n,i)+t:t},parseInt:function(t,e,i){return i||null==e?e=0:e&&(e=+e),xb($p(t).replace(_b,""),e||0)},repeat:function(t,e,i){return e=(i?Vd(t,e,i):void 0===e)?1:Gu(e),tb($p(t),e)},replace:function(){var t=arguments,e=$p(t[0]);return t.length<3?e:e.replace(t[1],t[2])},snakeCase:nw,split:function(t,e,i){return i&&"number"!=typeof i&&Vd(t,e,i)&&(e=i=void 0),(i=void 0===i?4294967295:i>>>0)?(t=$p(t))&&("string"==typeof e||null!=e&&!lx(e))&&!(e=Tu(e))&&Mf(t)?Cf(jf(t),0,i):t.split(e,i):[]},startCase:fw,startsWith:function(t,e,i){return t=$p(t),i=null==i?0:Og(Gu(i),0,t.length),e=Tu(e),t.slice(i,i+e.length)==e},template:function(t,e,i){var n=ww.imports._.templateSettings||ww;i&&Vd(t,e,i)&&(e=void 0),t=$p(t),e=Ip({},e,n,yw);var r,s,o=Ip({},e.imports,n.imports,yw),a=bp(o),h=R_(o,a),l=0,u=e.interpolate||Iw,c="__p += '",d=RegExp((e.escape||Iw).source+"|"+u.source+"|"+(u===bw?Cw:Iw).source+"|"+(e.evaluate||Iw).source+"|$","g"),p=Rw.call(e,"sourceURL")?"//# sourceURL="+(e.sourceURL+"").replace(/\s/g," ")+"\n":"";t.replace(d,(function(e,i,n,o,a,h){return n||(n=o),c+=t.slice(l,h).replace(Mw,xw),i&&(r=!0,c+="' +\n__e("+i+") +\n'"),a&&(s=!0,c+="';\n"+a+";\n__p += '"),n&&(c+="' +\n((__t = ("+n+")) == null ? '' : __t) +\n'"),l=h+e.length,e})),c+="';\n";var f=Rw.call(e,"variable")&&e.variable;if(f){if(Sw.test(f))throw new Error("Invalid `variable` option passed into `_.template`")}else c="with (obj) {\n"+c+"\n}\n";c=(s?c.replace(Tw,""):c).replace(Ew,"$1").replace(Aw,"$1;"),c="function("+(f||"obj")+") {\n"+(f?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(r?", __e = _.escape":"")+(s?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+c+"return __p\n}";var g=xf((function(){return Function(a,p+"return "+c).apply(void 0,h)}));if(g.source=c,_f(g))throw g;return g},templateSettings:ww,toLower:function(t){return $p(t).toLowerCase()},toUpper:function(t){return $p(t).toUpperCase()},trim:function(t,e,i){if((t=$p(t))&&(i||void 0===e))return Mu(t);if(!t||!(e=Tu(e)))return t;var n=jf(t),r=jf(e);return Cf(n,Fw(n,r),kw(n,r)+1).join("")},trimEnd:function(t,e,i){if((t=$p(t))&&(i||void 0===e))return t.slice(0,Cu(t)+1);if(!t||!(e=Tu(e)))return t;var n=jf(t);return Cf(n,0,kw(n,jf(e))+1).join("")},trimStart:function(t,e,i){if((t=$p(t))&&(i||void 0===e))return t.replace(Uw,"");if(!t||!(e=Tu(e)))return t;var n=jf(t);return Cf(n,Fw(n,jf(e))).join("")},truncate:function(t,e){var i=30,n="...";if(Ru(e)){var r="separator"in e?e.separator:r;i="length"in e?Gu(e.length):i,n="omission"in e?Tu(e.omission):n}var s=(t=$p(t)).length;if(Mf(t)){var o=jf(t);s=o.length}if(i>=s)return t;var a=i-fb(n);if(a<1)return n;var h=o?Cf(o,0,a).join(""):t.slice(0,a);if(void 0===r)return h+n;if(o&&(a+=h.length-a),lx(r)){if(t.slice(a).search(r)){var l,u=h;for(r.global||(r=RegExp(r.source,$p(Gw.exec(r))+"g")),r.lastIndex=0;l=r.exec(u);)var c=l.index;h=h.slice(0,void 0===c?a:c)}}else if(t.indexOf(Tu(r),a)!=a){var d=h.lastIndexOf(r);d>-1&&(h=h.slice(0,d))}return h+n},unescape:function(t){return(t=$p(t))&&Hw.test(t)?t.replace(jw,zw):t},upperCase:eT,upperFirst:Wf,words:wg},TT={attempt:xf,bindAll:Ef,cond:function(t){var e=null==t?0:t.length,i=Vv;return t=e?yu(t,(function(t){if("function"!=typeof t[1])throw new TypeError("Expected a function");return[i(t[0]),t[1]]})):[],jd((function(i){for(var n=-1;++n<e;){var r=t[n];if(dc(r[0],this,i))return dc(r[1],this,i)}}))},conforms:function(t){return function(t){var e=bp(t);return function(i){return Yv(i,t,e)}}(Zm(t,1))},constant:kc,defaultTo:function(t,e){return null==t||t!=t?e:t},flow:g_,flowRight:m_,identity:zu,iteratee:function(t){return Vv("function"==typeof t?t:Zm(t,1))},matches:function(t){return kv(Zm(t,1))},matchesProperty:function(t,e){return Hv(t,Zm(e,1))},method:Sx,methodOf:Cx,mixin:Ix,noop:xc,nthArg:function(t){return t=Gu(t),jd((function(e){return Bx(e,t)}))},over:Vx,overEvery:Kx,overSome:Zx,property:Xv,propertyOf:function(t){return function(e){return null==t?void 0:Jp(t,e)}},range:jb,rangeRight:Hb,stubArray:jg,stubFalse:ip,stubObject:function(){return{}},stubString:function(){return""},stubTrue:function(){return!0},times:function(t,e){if((t=Gu(t))<1||t>9007199254740991)return[];var i=Dw,n=Ow(t,Dw);e=Ly(e),t-=Dw;for(var r=Kd(n,e);++i<t;)e(i);return r},toPath:function(t){return _u(t)?yu(t,Zp):gu(t)?[t]:Sc(Yp($p(t)))},uniqueId:function(t){var e=++Kw;return $p(t)+e}};var ET=Math.max,AT=Math.min;var ST=Math.min;
/**
 * @license
 * Lodash (Custom Build) <https://lodash.com/>
 * Build: `lodash modularize exports="es" -o ./`
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */
var CT,IT=4294967295,MT=Array.prototype,RT=Object.prototype.hasOwnProperty,PT=nu?nu.iterator:void 0,DT=Math.max,OT=Math.min,LT=function(t){return function(e,i,n){if(null==n){var r=Ru(i),s=r&&bp(i),o=s&&s.length&&v_(i,s);(o?o.length:r)||(n=i,i=e,e=this)}return t(e,i,n)}}(Ix);Mc.after=fT.after,Mc.ary=fT.ary,Mc.assign=xT.assign,Mc.assignIn=xT.assignIn,Mc.assignInWith=xT.assignInWith,Mc.assignWith=xT.assignWith,Mc.at=xT.at,Mc.before=fT.before,Mc.bind=fT.bind,Mc.bindAll=TT.bindAll,Mc.bindKey=fT.bindKey,Mc.castArray=gT.castArray,Mc.chain=bT.chain,Mc.chunk=cT.chunk,Mc.compact=cT.compact,Mc.concat=cT.concat,Mc.cond=TT.cond,Mc.conforms=TT.conforms,Mc.constant=TT.constant,Mc.countBy=dT.countBy,Mc.create=xT.create,Mc.curry=fT.curry,Mc.curryRight=fT.curryRight,Mc.debounce=fT.debounce,Mc.defaults=xT.defaults,Mc.defaultsDeep=xT.defaultsDeep,Mc.defer=fT.defer,Mc.delay=fT.delay,Mc.difference=cT.difference,Mc.differenceBy=cT.differenceBy,Mc.differenceWith=cT.differenceWith,Mc.drop=cT.drop,Mc.dropRight=cT.dropRight,Mc.dropRightWhile=cT.dropRightWhile,Mc.dropWhile=cT.dropWhile,Mc.fill=cT.fill,Mc.filter=dT.filter,Mc.flatMap=dT.flatMap,Mc.flatMapDeep=dT.flatMapDeep,Mc.flatMapDepth=dT.flatMapDepth,Mc.flatten=cT.flatten,Mc.flattenDeep=cT.flattenDeep,Mc.flattenDepth=cT.flattenDepth,Mc.flip=fT.flip,Mc.flow=TT.flow,Mc.flowRight=TT.flowRight,Mc.fromPairs=cT.fromPairs,Mc.functions=xT.functions,Mc.functionsIn=xT.functionsIn,Mc.groupBy=dT.groupBy,Mc.initial=cT.initial,Mc.intersection=cT.intersection,Mc.intersectionBy=cT.intersectionBy,Mc.intersectionWith=cT.intersectionWith,Mc.invert=xT.invert,Mc.invertBy=xT.invertBy,Mc.invokeMap=dT.invokeMap,Mc.iteratee=TT.iteratee,Mc.keyBy=dT.keyBy,Mc.keys=bp,Mc.keysIn=xT.keysIn,Mc.map=dT.map,Mc.mapKeys=xT.mapKeys,Mc.mapValues=xT.mapValues,Mc.matches=TT.matches,Mc.matchesProperty=TT.matchesProperty,Mc.memoize=fT.memoize,Mc.merge=xT.merge,Mc.mergeWith=xT.mergeWith,Mc.method=TT.method,Mc.methodOf=TT.methodOf,Mc.mixin=LT,Mc.negate=Px,Mc.nthArg=TT.nthArg,Mc.omit=xT.omit,Mc.omitBy=xT.omitBy,Mc.once=fT.once,Mc.orderBy=dT.orderBy,Mc.over=TT.over,Mc.overArgs=fT.overArgs,Mc.overEvery=TT.overEvery,Mc.overSome=TT.overSome,Mc.partial=fT.partial,Mc.partialRight=fT.partialRight,Mc.partition=dT.partition,Mc.pick=xT.pick,Mc.pickBy=xT.pickBy,Mc.property=TT.property,Mc.propertyOf=TT.propertyOf,Mc.pull=cT.pull,Mc.pullAll=cT.pullAll,Mc.pullAllBy=cT.pullAllBy,Mc.pullAllWith=cT.pullAllWith,Mc.pullAt=cT.pullAt,Mc.range=TT.range,Mc.rangeRight=TT.rangeRight,Mc.rearg=fT.rearg,Mc.reject=dT.reject,Mc.remove=cT.remove,Mc.rest=fT.rest,Mc.reverse=cT.reverse,Mc.sampleSize=dT.sampleSize,Mc.set=xT.set,Mc.setWith=xT.setWith,Mc.shuffle=dT.shuffle,Mc.slice=cT.slice,Mc.sortBy=dT.sortBy,Mc.sortedUniq=cT.sortedUniq,Mc.sortedUniqBy=cT.sortedUniqBy,Mc.split=wT.split,Mc.spread=fT.spread,Mc.tail=cT.tail,Mc.take=cT.take,Mc.takeRight=cT.takeRight,Mc.takeRightWhile=cT.takeRightWhile,Mc.takeWhile=cT.takeWhile,Mc.tap=bT.tap,Mc.throttle=fT.throttle,Mc.thru=Pw,Mc.toArray=gT.toArray,Mc.toPairs=xT.toPairs,Mc.toPairsIn=xT.toPairsIn,Mc.toPath=TT.toPath,Mc.toPlainObject=gT.toPlainObject,Mc.transform=xT.transform,Mc.unary=fT.unary,Mc.union=cT.union,Mc.unionBy=cT.unionBy,Mc.unionWith=cT.unionWith,Mc.uniq=cT.uniq,Mc.uniqBy=cT.uniqBy,Mc.uniqWith=cT.uniqWith,Mc.unset=xT.unset,Mc.unzip=cT.unzip,Mc.unzipWith=cT.unzipWith,Mc.update=xT.update,Mc.updateWith=xT.updateWith,Mc.values=xT.values,Mc.valuesIn=xT.valuesIn,Mc.without=cT.without,Mc.words=wT.words,Mc.wrap=fT.wrap,Mc.xor=cT.xor,Mc.xorBy=cT.xorBy,Mc.xorWith=cT.xorWith,Mc.zip=cT.zip,Mc.zipObject=cT.zipObject,Mc.zipObjectDeep=cT.zipObjectDeep,Mc.zipWith=cT.zipWith,Mc.entries=xT.toPairs,Mc.entriesIn=xT.toPairsIn,Mc.extend=xT.assignIn,Mc.extendWith=xT.assignInWith,LT(Mc,Mc),Mc.add=mT.add,Mc.attempt=TT.attempt,Mc.camelCase=wT.camelCase,Mc.capitalize=wT.capitalize,Mc.ceil=mT.ceil,Mc.clamp=vT,Mc.clone=gT.clone,Mc.cloneDeep=gT.cloneDeep,Mc.cloneDeepWith=gT.cloneDeepWith,Mc.cloneWith=gT.cloneWith,Mc.conformsTo=gT.conformsTo,Mc.deburr=wT.deburr,Mc.defaultTo=TT.defaultTo,Mc.divide=mT.divide,Mc.endsWith=wT.endsWith,Mc.eq=gT.eq,Mc.escape=wT.escape,Mc.escapeRegExp=wT.escapeRegExp,Mc.every=dT.every,Mc.find=dT.find,Mc.findIndex=cT.findIndex,Mc.findKey=xT.findKey,Mc.findLast=dT.findLast,Mc.findLastIndex=cT.findLastIndex,Mc.findLastKey=xT.findLastKey,Mc.floor=mT.floor,Mc.forEach=dT.forEach,Mc.forEachRight=dT.forEachRight,Mc.forIn=xT.forIn,Mc.forInRight=xT.forInRight,Mc.forOwn=xT.forOwn,Mc.forOwnRight=xT.forOwnRight,Mc.get=xT.get,Mc.gt=gT.gt,Mc.gte=gT.gte,Mc.has=xT.has,Mc.hasIn=xT.hasIn,Mc.head=cT.head,Mc.identity=zu,Mc.includes=dT.includes,Mc.indexOf=cT.indexOf,Mc.inRange=yT,Mc.invoke=xT.invoke,Mc.isArguments=gT.isArguments,Mc.isArray=_u,Mc.isArrayBuffer=gT.isArrayBuffer,Mc.isArrayLike=gT.isArrayLike,Mc.isArrayLikeObject=gT.isArrayLikeObject,Mc.isBoolean=gT.isBoolean,Mc.isBuffer=gT.isBuffer,Mc.isDate=gT.isDate,Mc.isElement=gT.isElement,Mc.isEmpty=gT.isEmpty,Mc.isEqual=gT.isEqual,Mc.isEqualWith=gT.isEqualWith,Mc.isError=gT.isError,Mc.isFinite=gT.isFinite,Mc.isFunction=gT.isFunction,Mc.isInteger=gT.isInteger,Mc.isLength=gT.isLength,Mc.isMap=gT.isMap,Mc.isMatch=gT.isMatch,Mc.isMatchWith=gT.isMatchWith,Mc.isNaN=gT.isNaN,Mc.isNative=gT.isNative,Mc.isNil=gT.isNil,Mc.isNull=gT.isNull,Mc.isNumber=gT.isNumber,Mc.isObject=Ru,Mc.isObjectLike=gT.isObjectLike,Mc.isPlainObject=gT.isPlainObject,Mc.isRegExp=gT.isRegExp,Mc.isSafeInteger=gT.isSafeInteger,Mc.isSet=gT.isSet,Mc.isString=gT.isString,Mc.isSymbol=gT.isSymbol,Mc.isTypedArray=gT.isTypedArray,Mc.isUndefined=gT.isUndefined,Mc.isWeakMap=gT.isWeakMap,Mc.isWeakSet=gT.isWeakSet,Mc.join=cT.join,Mc.kebabCase=wT.kebabCase,Mc.last=My,Mc.lastIndexOf=cT.lastIndexOf,Mc.lowerCase=wT.lowerCase,Mc.lowerFirst=wT.lowerFirst,Mc.lt=gT.lt,Mc.lte=gT.lte,Mc.max=mT.max,Mc.maxBy=mT.maxBy,Mc.mean=mT.mean,Mc.meanBy=mT.meanBy,Mc.min=mT.min,Mc.minBy=mT.minBy,Mc.stubArray=TT.stubArray,Mc.stubFalse=TT.stubFalse,Mc.stubObject=TT.stubObject,Mc.stubString=TT.stubString,Mc.stubTrue=TT.stubTrue,Mc.multiply=mT.multiply,Mc.nth=cT.nth,Mc.noop=TT.noop,Mc.now=pT,Mc.pad=wT.pad,Mc.padEnd=wT.padEnd,Mc.padStart=wT.padStart,Mc.parseInt=wT.parseInt,Mc.random=_T,Mc.reduce=dT.reduce,Mc.reduceRight=dT.reduceRight,Mc.repeat=wT.repeat,Mc.replace=wT.replace,Mc.result=xT.result,Mc.round=mT.round,Mc.sample=dT.sample,Mc.size=dT.size,Mc.snakeCase=wT.snakeCase,Mc.some=dT.some,Mc.sortedIndex=cT.sortedIndex,Mc.sortedIndexBy=cT.sortedIndexBy,Mc.sortedIndexOf=cT.sortedIndexOf,Mc.sortedLastIndex=cT.sortedLastIndex,Mc.sortedLastIndexBy=cT.sortedLastIndexBy,Mc.sortedLastIndexOf=cT.sortedLastIndexOf,Mc.startCase=wT.startCase,Mc.startsWith=wT.startsWith,Mc.subtract=mT.subtract,Mc.sum=mT.sum,Mc.sumBy=mT.sumBy,Mc.template=wT.template,Mc.times=TT.times,Mc.toFinite=gT.toFinite,Mc.toInteger=Gu,Mc.toLength=gT.toLength,Mc.toLower=wT.toLower,Mc.toNumber=gT.toNumber,Mc.toSafeInteger=gT.toSafeInteger,Mc.toString=gT.toString,Mc.toUpper=wT.toUpper,Mc.trim=wT.trim,Mc.trimEnd=wT.trimEnd,Mc.trimStart=wT.trimStart,Mc.truncate=wT.truncate,Mc.unescape=wT.unescape,Mc.uniqueId=TT.uniqueId,Mc.upperCase=wT.upperCase,Mc.upperFirst=wT.upperFirst,Mc.each=dT.forEach,Mc.eachRight=dT.forEachRight,Mc.first=cT.head,LT(Mc,(CT={},Zv(Mc,(function(t,e){RT.call(Mc.prototype,e)||(CT[e]=t)})),CT),{chain:!1}),Mc.VERSION="4.17.21",(Mc.templateSettings=wT.templateSettings).imports._=Mc,zc(["bind","bindKey","curry","curryRight","partial","partialRight"],(function(t){Mc[t].placeholder=Mc})),zc(["drop","take"],(function(t,e){_c.prototype[t]=function(i){i=void 0===i?1:DT(Gu(i),0);var n=this.__filtered__&&!e?new _c(this):this.clone();return n.__filtered__?n.__takeCount__=OT(i,n.__takeCount__):n.__views__.push({size:OT(i,IT),type:t+(n.__dir__<0?"Right":"")}),n},_c.prototype[t+"Right"]=function(e){return this.reverse()[t](e).reverse()}})),zc(["filter","map","takeWhile"],(function(t,e){var i=e+1,n=1==i||3==i;_c.prototype[t]=function(t){var e=this.clone();return e.__iteratees__.push({iteratee:Vv(t),type:i}),e.__filtered__=e.__filtered__||n,e}})),zc(["head","last"],(function(t,e){var i="take"+(e?"Right":"");_c.prototype[t]=function(){return this[i](1).value()[0]}})),zc(["initial","tail"],(function(t,e){var i="drop"+(e?"":"Right");_c.prototype[t]=function(){return this.__filtered__?new _c(this):this[i](1)}})),_c.prototype.compact=function(){return this.filter(zu)},_c.prototype.find=function(t){return this.filter(t).head()},_c.prototype.findLast=function(t){return this.reverse().find(t)},_c.prototype.invokeMap=jd((function(t,e){return"function"==typeof t?new _c(this):this.map((function(i){return $_(i,t,e)}))})),_c.prototype.reject=function(t){return this.filter(Px(Vv(t)))},_c.prototype.slice=function(t,e){t=Gu(t);var i=this;return i.__filtered__&&(t>0||e<0)?new _c(i):(t<0?i=i.takeRight(-t):t&&(i=i.drop(t)),void 0!==e&&(i=(e=Gu(e))<0?i.dropRight(-e):i.take(e-t)),i)},_c.prototype.takeRightWhile=function(t){return this.reverse().takeWhile(t).reverse()},_c.prototype.toArray=function(){return this.take(IT)},Zv(_c.prototype,(function(t,e){var i=/^(?:filter|find|map|reject)|While$/.test(e),n=/^(?:head|last)$/.test(e),r=Mc[n?"take"+("last"==e?"Right":""):e],s=n||/^find/.test(e);r&&(Mc.prototype[e]=function(){var e=this.__wrapped__,o=n?[1]:arguments,a=e instanceof _c,h=o[0],l=a||_u(e),u=function(t){var e=r.apply(Mc,ef([t],o));return n&&c?e[0]:e};l&&i&&"function"==typeof h&&1!=h.length&&(a=l=!1);var c=this.__chain__,d=!!this.__actions__.length,p=s&&!c,f=a&&!d;if(!s&&l){e=f?e:new _c(this);var g=t.apply(e,o);return g.__actions__.push({func:Pw,args:[u],thisArg:void 0}),new Ac(g,c)}return p&&f?t.apply(this,o):(g=this.thru(u),p?n?g.value()[0]:g.value():g)})})),zc(["pop","push","shift","sort","splice","unshift"],(function(t){var e=MT[t],i=/^(?:push|sort|unshift)$/.test(t)?"tap":"thru",n=/^(?:pop|shift)$/.test(t);Mc.prototype[t]=function(){var t=arguments;if(n&&!this.__chain__){var r=this.value();return e.apply(_u(r)?r:[],t)}return this[i]((function(i){return e.apply(_u(i)?i:[],t)}))}})),Zv(_c.prototype,(function(t,e){var i=Mc[e];if(i){var n=i.name+"";RT.call(wc,n)||(wc[n]=[]),wc[n].push({name:e,func:i})}})),wc[fd(void 0,2).name]=[{name:"wrapper",func:void 0}],_c.prototype.clone=function(){var t=new _c(this.__wrapped__);return t.__actions__=Sc(this.__actions__),t.__dir__=this.__dir__,t.__filtered__=this.__filtered__,t.__iteratees__=Sc(this.__iteratees__),t.__takeCount__=this.__takeCount__,t.__views__=Sc(this.__views__),t},_c.prototype.reverse=function(){if(this.__filtered__){var t=new _c(this);t.__dir__=-1,t.__filtered__=!0}else(t=this.clone()).__dir__*=-1;return t},_c.prototype.value=function(){var t=this.__wrapped__.value(),e=this.__dir__,i=_u(t),n=e<0,r=i?t.length:0,s=function(t,e,i){for(var n=-1,r=i.length;++n<r;){var s=i[n],o=s.size;switch(s.type){case"drop":t+=o;break;case"dropRight":e-=o;break;case"take":e=AT(e,t+o);break;case"takeRight":t=ET(t,e-o)}}return{start:t,end:e}}(0,r,this.__views__),o=s.start,a=s.end,h=a-o,l=n?a:o-1,u=this.__iteratees__,c=u.length,d=0,p=ST(h,this.__takeCount__);if(!i||!n&&r==h&&p==h)return Lw(t,this.__actions__);var f=[];t:for(;h--&&d<p;){for(var g=-1,m=t[l+=e];++g<c;){var v=u[g],y=v.iteratee,_=v.type,x=y(m);if(2==_)m=x;else if(!x){if(1==_)continue t;break t}}f[d++]=m}return f},Mc.prototype.at=bT.at,Mc.prototype.chain=bT.wrapperChain,Mc.prototype.commit=bT.commit,Mc.prototype.next=bT.next,Mc.prototype.plant=bT.plant,Mc.prototype.reverse=bT.reverse,Mc.prototype.toJSON=Mc.prototype.valueOf=Mc.prototype.value=bT.value,Mc.prototype.first=Mc.prototype.head,PT&&(Mc.prototype[PT]=bT.toIterator);var NT,BT=function(){function t(t){this.canvas=t,this.drawLinkState={isDrawing:!1,startNode:null,endNode:null},this.isNodeClick=!1,this.graph=t.graph,this.initEvents()}return t.prototype.initEvents=function(){var t=this;this.preventContainerWheel(),this.canvas.app.stage.on("mousemove",(function(e){return t.graph.emit("canvas:mousemove",e)})),this.canvas.app.stage.on("mouseup",(function(e){return t.graph.emit("canvas:mouseup",e)})),this.canvasClick(),this.canvas.viewport.getChildByName(Jl.allNodesGroup).children.forEach((function(e){var i=t.getNodeDataByContainer(e);t.bindNodeEvent(e,i)})),this.canvas.viewport.getChildByName(Jl.allLinksGroup,!0).children.forEach((function(e){t.bindLinkEvent(e)}))},t.prototype.preventContainerWheel=function(){document.getElementById(this.graph.cfg.container).addEventListener("wheel",(function(t){t.preventDefault()}))},t.prototype.canvasClick=function(){var t=this;var e=0,i=null;this.canvas.app.stage.eventMode="static",this.canvas.app.stage.on("mousedown",(function(n){1===++e?i=setTimeout((function(){!function(e){var i=t.canvas.viewport.toWorld(e.data.global);t.graph.emit(Ql.ICanvasClick,Object.assign(e,{point:i}))}(n),e=0}),300):(clearTimeout(i),function(e){var i=t.canvas.viewport.toWorld(e.data.global);t.graph.emit(Ql.ICanvasDoubleClick,Object.assign(e,{point:i}))}(n),e=0)}))},t.prototype.bindNodeEvent=function(t,e){var i=this;t.cursor="pointer",t.eventMode="static",t.on("click",(function(e){e.stopPropagation(),i.isNodeClick&&i.emitDataOfNode(t,Ql.INodeClick,e)})),t.on("mouseenter",(function(e){return i.emitDataOfNode(t,"node:mouseenter",e)})),t.on("mousemove",(function(e){return i.emitDataOfNode(t,"node:mousemove",e)})),t.on("mouseout",(function(e){return i.emitDataOfNode(t,"node:mouseout",e)})),t.on("mouseup",(function(e){return i.emitDataOfNode(t,"node:mouseup",e)})),this.dragNodeEvent(t)},t.prototype.dragNodeEvent=function(t){var e,i=this,n=this,r=null;function s(e){r&&(n.getNodeDataByContainer(t)&&n.emitDataOfNode(t,"node:drag",e))}function o(e){r=null,n.canvas.app.stage.off("mousemove",s),n.emitDataOfNode(t,"node:dragend",e)}t.on("mousedown",(function(i){i.stopPropagation(),e=Object.assign({},i.data.global),function(e){r=t,n.canvas.app.stage.on("mousemove",s),n.emitDataOfNode(t,"node:dragstart",e)}(i)})),t.on("mouseup",(function(t){var n=Object.assign({},t.data.global);i.isNodeClick=ix(n,e),o(t)})),t.on("mouseupoutside",(function(t){o(t)}))},t.prototype.bindLinkEvent=function(t){var e=this;t.eventMode="static",t.cursor="pointer";var i=t.getChildByName(Jl.linkText);i&&(i.eventMode="static",i.cursor="pointer"),t.on("click",(function(i){i.stopImmediatePropagation(),e.graph.emit(Ql.ILinkClick,Object.assign(i,{_data_:e.getLinkDataByContainer(t)}))})),t.on("mouseenter",(function(i){return e.emitDataOfLink(t,"link:mouseenter",i)})),t.on("mousemove",(function(i){return e.emitDataOfLink(t,"link:mousemove",i)})),t.on("mouseout",(function(i){return e.emitDataOfLink(t,"link:mouseout",i)})),t.on("mouseup",(function(i){return e.emitDataOfLink(t,"link:mouseup",i)}))},t.prototype.getNodeDataByContainer=function(t){return this.canvas.c2nodeWeekMap.get(t)},t.prototype.getLinkDataByContainer=function(t){return this.canvas.c2linkWeekMap.get(t)},t.prototype.emitDataOfNode=function(t,e,i){var n=this.canvas.viewport.toWorld(i.data.global);this.graph.emit(e,Object.assign(i,{_data_:this.getNodeDataByContainer(t),point:n,shape:t}))},t.prototype.emitDataOfLink=function(t,e,i){var n=this.canvas.viewport.toWorld(i.data.global);this.graph.emit(e,Object.assign(i,{_data_:this.getLinkDataByContainer(t),point:n,shape:t}))},t}();!function(t){t.DragCanvas="drag-canvas",t.ZoomCanvas="zoom-canvas",t.DragNode="drag-node",t.CreateEdge="create-edge"}(NT||(NT={}));var kT=function(t){function i(e){return t.call(this,e)||this}return e(i,t),i.prototype.draw=function(t){return this.nodeData=t,this.nodeContainer=new Ms,this.nodeContainer.name=Jl.nodeContainer,this.nodeContainer.addChild(this.drawNode()),this.nodeContainer.addChild(this.drawLabel()),this.nodeContainer.position.set(t.x,t.y),this.nodeContainer},i.prototype.drawNode=function(){var t,e,i,n,r=new rh;return r.name=Jl.nodeCircle,(null===(t=this.nodeData.style)||void 0===t?void 0:t.lineWidth)&&r.lineStyle({width:null===(e=this.nodeData.style)||void 0===e?void 0:e.lineWidth,color:null===(i=this.nodeData.style)||void 0===i?void 0:i.stroke}),r.beginFill((null===(n=this.nodeData.style)||void 0===n?void 0:n.fill)||this.cfg.defaultNode.style.fill),r.drawCircle(0,0,this.nodeData.size||this.cfg.defaultNode.size),r.endFill(),r},i.prototype.drawLabel=function(){var t,e,i=this.nodeData.labelCfg,n=new bh({fontSize:(null===(t=null==i?void 0:i.style)||void 0===t?void 0:t.fontSize)||this.cfg.defaultNode.labelCfg.style.fontSize,fill:(null===(e=null==i?void 0:i.style)||void 0===e?void 0:e.fill)||this.cfg.defaultNode.labelCfg.style.fill,align:(null==i?void 0:i.align)||this.cfg.defaultNode.labelCfg.align||"center"}),r=new Sh(this.nodeData.showName||this.nodeData.name||"",n);return r.anchor.set(.5),r},i.prototype.update=function(t){this.nodeContainer.position.set(t.x,t.y)},i}(s),FT="undefined"!=typeof Float32Array?Float32Array:Array;function UT(){var t=new FT(3);return FT!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function GT(t,e,i){var n=new FT(3);return n[0]=t,n[1]=e,n[2]=i,n}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});function zT(){var t=new FT(4);return FT!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}UT(),function(){var t,e=(t=new FT(4),FT!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t)}();var jT;UT(),GT(1,0,0),GT(0,1,0),zT(),zT(),jT=new FT(9),FT!=Float32Array&&(jT[1]=0,jT[2]=0,jT[3]=0,jT[5]=0,jT[6]=0,jT[7]=0),jT[0]=1,jT[4]=1,jT[8]=1,function(){var t=function(){var t=new FT(2);return FT!=Float32Array&&(t[0]=0,t[1]=0),t}()}();var HT=function(t,e){return Math.atan2(e.y-t.y,e.x-t.x)*(180/Math.PI)},WT=function(t,e){return{x:(t.x+e.x)/2,y:(t.y+e.y)/2}};function XT(t,e){return void 0===e&&(e="id"),"string"==typeof t?t:t[e]}var VT=function(t,e,i){void 0===i&&(i=30);var n=Math.atan2(e.y-t.y,e.x-t.x);return{x:e.x-Math.cos(n)*(i+0),y:e.y-Math.sin(n)*(i+0)}},YT=function(t,e,i,n){void 0===i&&(i=0),void 0===n&&(n=0);var r={x:(1-i)*t.x+i*e.x,y:(1-i)*t.y+i*e.y},s=[0,0];!function(t,e){var i=e[0],n=e[1],r=i*i+n*n;r>0&&(r=1/Math.sqrt(r)),t[0]=e[0]*r,t[1]=e[1]*r}(s,[e.x-t.x,e.y-t.y]),s&&(s[0]||s[1])||(s=[0,0]);var o=[-s[1]*n,s[0]*n];return r.x+=o[0],r.y+=o[1],r};function $T(t,e){for(var i=[],n=0;n<t.length;n+=2){var r={x:t[n],y:t[n+1]};i.push(r)}i.reverse();var s=i[0];return i.find((function(t){return i=t,n=s,Math.sqrt(Math.pow(i.x-n.x,2)+Math.pow(i.y-n.y,2))>e;var i,n}))}function qT(t,e,i=.001){return this===e||Math.abs(t.a-e.a)<i&&Math.abs(t.b-e.b)<i&&Math.abs(t.c-e.c)<i&&Math.abs(t.d-e.d)<i&&Math.abs(t.tx-e.tx)<i&&Math.abs(t.ty-e.ty)<i}class KT{constructor(){this.textureIds=[],this.matrices=[],this.lines=[],this.count=0}clear(){for(let t=0;t<this.count;t++)this.textureIds[t]=null,this.matrices[t]=null;this.count=0}add(t,e,i,n,r,s){const{textureIds:o,matrices:a,lines:h,count:l}=this;t=4*t+r;for(let r=0;r<l;r++)if(h[2*r]===i&&h[2*r+1]===n&&o[r]===t&&qT(a[r],e))return r;return l>=s.maxStyles?-1:(o[l]=t,a[l]=e,h[2*l]=i,h[2*l+1]=n,this.count++,l)}}class ZT{constructor(){this.texArray=new zn,this.styleArray=new KT,this.shader=null,this.blend=u.NORMAL,this.start=0,this.size=0,this.TICK=0,this.settings=null,this.data=null}clear(){this.texArray.clear(),this.styleArray.clear(),this.settings=null,this.data=null,this.shader=null}begin(t,e){this.TICK=++Li._globalBatch,this.settings=t,this.shader=e,this.start=0,this.size=0,this.data=null,e&&e.settings&&(this.settings=e.settings)}check(t){return 0===this.size?(this.shader=t,!0):this.shader===t}add(t,e,i,n,r){const{texArray:s,TICK:o,styleArray:a,settings:h}=this,{baseTexture:l}=t;if(l._batchEnabled!==o&&s.count===h.maxTextures)return-1;const u=l._batchEnabled!==o?s.count:l._batchLocation,c=a.add(u,e||nn.IDENTITY,i,n,r,h);return c>=0&&l._batchEnabled!==o&&(l._batchEnabled=o,l._batchLocation=s.count,s.elements[s.count++]=l),c}}class JT{constructor(){this.reset()}begin(t,e,i){this.reset(),this.style=t,this.start=e,this.attribStart=i,this.jointEnd=0}end(t,e){this.attribSize=e-this.attribStart,this.size=t-this.start}reset(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0,this.styleId=-1,this.rgba=0,this.jointEnd=0}}class QT{constructor(){this.reset()}toJSON(){return this.copyTo({})}clone(){return this.copyTo(new QT)}copyTo(t){return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.shader=this.shader,t.visible=this.visible,t.smooth=this.smooth,t.matrixTex=null,t}packLineScale(){return 0}reset(){this.color=16777215,this.alpha=1,this.texture=sr.WHITE,this.matrix=null,this.shader=null,this.visible=!1,this.smooth=!1,this.matrixTex=null}destroy(){this.texture=null,this.matrix=null,this.matrixTex=null}getTextureMatrix(){const t=this.texture;return this.matrix?t.frame.width===t.baseTexture.width&&t.frame.height===t.baseTexture.height?this.matrix:(this.matrixTex?this.matrixTex.copyFrom(this.matrix):this.matrixTex=this.matrix.clone(),this.matrixTex.translate(Number(t.frame.x),Number(t.frame.y)),this.matrixTex):null}}var tE=(t=>(t.NONE="none",t.NORMAL="normal",t.HORIZONTAL="horizontal",t.VERTICAL="vertical",t))(tE||{});class eE extends QT{clone(){return this.copyTo(new eE)}copyTo(t){return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.shader=this.shader,t.visible=this.visible,t.width=this.width,t.alignment=this.alignment,t.cap=this.cap,t.join=this.join,t.miterLimit=this.miterLimit,t.scaleMode=this.scaleMode,t}packLineScale(){switch(this.scaleMode){case"normal":return 1;case"horizontal":return 2;case"vertical":return 3;default:return 0}}reset(){super.reset(),this.smooth=!0,this.color=0,this.width=0,this.alignment=.5,this.cap=Fa.BUTT,this.join=ka.MITER,this.miterLimit=10,this.scaleMode="normal"}}class iE{constructor(){this.verts=[],this.joints=[],this.vertexSize=0,this.indexSize=0,this.closePointEps=1e-4}clear(){this.verts.length=0,this.joints.length=0,this.vertexSize=0,this.indexSize=0}destroy(){this.verts.length=0,this.joints.length=0}}var nE=(t=>(t[t.NONE=0]="NONE",t[t.FILL=1]="FILL",t[t.JOINT_BEVEL=4]="JOINT_BEVEL",t[t.JOINT_MITER=8]="JOINT_MITER",t[t.JOINT_ROUND=12]="JOINT_ROUND",t[t.JOINT_CAP_BUTT=16]="JOINT_CAP_BUTT",t[t.JOINT_CAP_SQUARE=18]="JOINT_CAP_SQUARE",t[t.JOINT_CAP_ROUND=20]="JOINT_CAP_ROUND",t[t.FILL_EXPAND=24]="FILL_EXPAND",t[t.CAP_BUTT=32]="CAP_BUTT",t[t.CAP_SQUARE=64]="CAP_SQUARE",t[t.CAP_ROUND=96]="CAP_ROUND",t[t.CAP_BUTT2=128]="CAP_BUTT2",t))(nE||{});const rE=class{constructor(){this.strideFloats=12,this.bufferPos=0,this.indexPos=0}updateBufferSize(t,e,i,n){const{joints:r}=n;let s=!1,o=0,a=0;for(let i=t;i<t+e;i++){const t=-32&r[i],e=31&r[i];if(e===nE.FILL){s=!0,o++;continue}if(e>=nE.FILL_EXPAND){o+=3,a+=3;continue}const n=rE.vertsByJoint[e]+rE.vertsByJoint[t];n>=4&&(o+=n,a+=6+3*Math.max(n-6,0))}s&&(a+=i),n.vertexSize+=o,n.indexSize+=a}beginPack(t,e,i,n,r=0,s=0){this.buildData=t,this.bufFloat=e,this.bufUint=i,this.indices=n,this.bufferPos=r,this.indexPos=s}endPack(){this.buildData=null,this.bufFloat=null,this.bufUint=null,this.indices=null}packInterleavedGeometry(t,e,i,n,r){const{bufFloat:s,bufUint:o,indices:a,buildData:h,strideFloats:l}=this,{joints:u,verts:c}=h;let d,p,f,g,m,v,y,_,x=this.bufferPos,b=this.indexPos,w=this.bufferPos/this.strideFloats,T=!1,E=0;for(let i=t;i<t+e;i++){const t=u[i],e=-32&u[i],h=31&u[i];if(h===nE.FILL){T=!0,d=c[2*i],p=c[2*i+1],s[x]=d,s[x+1]=p,s[x+2]=d,s[x+3]=p,s[x+4]=d,s[x+5]=p,s[x+6]=d,s[x+7]=p,s[x+8]=E,s[x+9]=16*h,s[x+10]=n,o[x+11]=r,x+=l;continue}if(h>=nE.FILL_EXPAND){m=c[2*i],v=c[2*i+1],d=c[2*i+2],p=c[2*i+3],f=c[2*i+4],g=c[2*i+5];const e=i+3;for(let i=0;i<3;i++)s[x]=m,s[x+1]=v,s[x+2]=d,s[x+3]=p,s[x+4]=f,s[x+5]=g,s[x+6]=c[2*(e+i)],s[x+7]=c[2*(e+i)+1],s[x+8]=E,s[x+9]=16*t+i,s[x+10]=n,o[x+11]=r,x+=l;a[b]=w,a[b+1]=w+1,a[b+2]=w+2,b+=3,w+=3;continue}const A=rE.vertsByJoint[h]+rE.vertsByJoint[e];if(0===A)continue;d=c[2*i],p=c[2*i+1],f=c[2*i+2],g=c[2*i+3],m=c[2*i-2],v=c[2*i-1];const S=Math.sqrt((f-d)*(f-d)+(g-p)*(g-p));0===rE.vertsByJoint[h]&&(E-=S),(-3&h)!==nE.JOINT_CAP_BUTT?(y=c[2*i+4],_=c[2*i+5]):(y=d,_=p);for(let e=0;e<A;e++)s[x]=m,s[x+1]=v,s[x+2]=d,s[x+3]=p,s[x+4]=f,s[x+5]=g,s[x+6]=y,s[x+7]=_,s[x+8]=E,s[x+9]=16*t+e,s[x+10]=n,o[x+11]=r,x+=l;E+=S,a[b]=w,a[b+1]=w+1,a[b+2]=w+2,a[b+3]=w,a[b+4]=w+2,a[b+5]=w+3,b+=6;for(let t=5;t+1<A;t++)a[b]=w+4,a[b+1]=w+t,a[b+2]=w+t+1,b+=3;w+=A}if(T){for(let t=0;t<i.length;t++)a[b+t]=i[t]+w;b+=i.length}this.bufferPos=x,this.indexPos=b}};let sE=rE;sE.vertsByJoint=[];const oE=sE.vertsByJoint;for(let t=0;t<256;t++)oE.push(0);oE[nE.FILL]=1;for(let t=0;t<8;t++)oE[nE.FILL_EXPAND+t]=3;oE[nE.JOINT_BEVEL]=9,oE[nE.JOINT_BEVEL+1]=9,oE[nE.JOINT_BEVEL+2]=9,oE[nE.JOINT_BEVEL+3]=9,oE[nE.JOINT_ROUND]=9,oE[nE.JOINT_ROUND+1]=9,oE[nE.JOINT_ROUND+2]=9,oE[nE.JOINT_ROUND+3]=9,oE[nE.JOINT_MITER]=9,oE[nE.JOINT_MITER+1]=9,oE[nE.JOINT_MITER+2]=4,oE[nE.JOINT_MITER+3]=4,oE[nE.JOINT_CAP_BUTT]=4,oE[nE.JOINT_CAP_BUTT+1]=4,oE[nE.JOINT_CAP_SQUARE]=4,oE[nE.JOINT_CAP_SQUARE+1]=4,oE[nE.JOINT_CAP_ROUND]=9,oE[nE.JOINT_CAP_ROUND+1]=9,oE[nE.CAP_ROUND]=4;class aE{constructor(t,e=null,i=null,n=null){this.shape=t,this.lineStyle=i,this.fillStyle=e,this.matrix=n,this.type=t.type,this.points=[],this.holes=[],this.triangles=[],this.closeStroke=!1,this.clearBuild()}clearPath(){this.points.length=0,this.closeStroke=!0}clearBuild(){this.triangles.length=0,this.fillStart=0,this.fillLen=0,this.strokeStart=0,this.strokeLen=0,this.fillAA=!1}clone(){return new aE(this.shape,this.fillStyle,this.lineStyle,this.matrix)}capType(){let t;switch(this.lineStyle.cap){case Fa.SQUARE:t=nE.CAP_SQUARE;break;case Fa.ROUND:t=nE.CAP_ROUND;break;default:t=nE.CAP_BUTT}return t}goodJointType(){let t;switch(this.lineStyle.join){case ka.BEVEL:t=nE.JOINT_BEVEL;break;case ka.ROUND:t=nE.JOINT_ROUND;break;default:t=nE.JOINT_MITER+3}return t}jointType(){let t;switch(this.lineStyle.join){case ka.BEVEL:t=nE.JOINT_BEVEL;break;case ka.ROUND:t=nE.JOINT_ROUND;break;default:t=nE.JOINT_MITER}return t}destroy(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null,this.triangles=null}}class hE{path(t,e){const i=t.points;let n,r,s,o,a,h;if(t.type===$i.CIRC){const e=t.shape;n=e.x,r=e.y,a=h=e.radius,s=o=0}else if(t.type===$i.ELIP){const e=t.shape;n=e.x,r=e.y,a=e.width,h=e.height,s=o=0}else{const e=t.shape,i=e.width/2,l=e.height/2;n=e.x+i,r=e.y+l,a=h=Math.max(0,Math.min(e.radius,Math.min(i,l))),s=i-a,o=l-h}if(!(a>=0&&h>=0&&s>=0&&o>=0))return void(i.length=0);const l=Math.ceil(2.3*Math.sqrt(a+h)),u=8*l+(s?4:0)+(o?4:0);if(i.length=u,0===u)return;if(0===l)return i.length=8,i[0]=i[6]=n+s,i[1]=i[3]=r+o,i[2]=i[4]=n-s,void(i[5]=i[7]=r-o);let c=0,d=4*l+(s?2:0)+2,p=d,f=u;{const t=s+a,e=o,h=n+t,l=n-t,u=r+e;if(i[c++]=h,i[c++]=u,i[--d]=u,i[--d]=l,o){const t=r-e;i[p++]=l,i[p++]=t,i[--f]=t,i[--f]=h}}for(let t=1;t<l;t++){const e=Math.PI/2*(t/l),u=s+Math.cos(e)*a,g=o+Math.sin(e)*h,m=n+u,v=n-u,y=r+g,_=r-g;i[c++]=m,i[c++]=y,i[--d]=y,i[--d]=v,i[p++]=v,i[p++]=_,i[--f]=_,i[--f]=m}{const t=o+h,e=n+s,a=n-s,l=r+t,u=r-t;i[c++]=e,i[c++]=l,i[--f]=u,i[--f]=e,s&&(i[c++]=a,i[c++]=l,i[--f]=u,i[--f]=a)}}fill(t,e){const{verts:i,joints:n}=e,{points:r,triangles:s}=t;if(0===r.length)return;let o,a;if(t.type!==$i.RREC){const e=t.shape;o=e.x,a=e.y}else{const e=t.shape;o=e.x+e.width/2,a=e.y+e.height/2}const h=t.matrix,l=h?h.a*o+h.c*a+h.tx:o,u=h?h.b*o+h.d*a+h.ty:a;let c=1;if(!t.fillAA){i.push(l,u),n.push(nE.FILL),i.push(r[0],r[1]),n.push(nE.FILL);for(let t=2;t<r.length;t+=2)i.push(r[t],r[t+1]),n.push(nE.FILL),s.push(c++,0,c);return void s.push(1,0,c)}const d=r.length;let p=r[d-2],f=r[d-1],g=f-r[d-3],m=r[d-4]-p;const v=Math.sqrt(g*g+m*m);let y,_;g/=v,m/=v;for(let t=0;t<d;t+=2){const e=r[t],s=r[t+1];let o=s-f,a=p-e;const h=Math.sqrt(o*o+a*a);o/=h,a/=h;let c=g+o,d=m+a;const v=o*c+a*d;c/=v,d/=v,t>0?(i.push(c),i.push(d)):(y=c,_=d),i.push(l),i.push(u),i.push(p),i.push(f),i.push(e),i.push(s),i.push(0),i.push(0),i.push(c),i.push(d),n.push(nE.FILL_EXPAND+2),n.push(nE.NONE),n.push(nE.NONE),n.push(nE.NONE),n.push(nE.NONE),n.push(nE.NONE),p=e,f=s,g=o,m=a}i.push(y),i.push(_)}line(t,e){const{verts:i,joints:n}=e,{points:r}=t,s=8===r.length?t.goodJointType():nE.JOINT_MITER+3,o=r.length;if(0!==o){i.push(r[o-2],r[o-1]),n.push(nE.NONE);for(let t=0;t<o;t+=2)i.push(r[t],r[t+1]),n.push(s);i.push(r[0],r[1]),n.push(nE.NONE),i.push(r[2],r[3]),n.push(nE.NONE)}}}const lE=[];function uE(t,e=!1){const i=t.length;if(i<6)return;let n=0;for(let e=0,r=t[i-2],s=t[i-1];e<i;e+=2){const i=t[e],o=t[e+1];n+=(i-r)*(o+s),r=i,s=o}if(!e&&n>0||e&&n<=0){const e=i/2;for(let n=e+e%2;n<i;n+=2){const e=i-n-2,r=i-n-1,s=n,o=n+1;[t[e],t[s]]=[t[s],t[e]],[t[r],t[o]]=[t[o],t[r]]}}}class cE{path(t,e){const i=t.shape,n=t.points=i.points.slice(),r=e.closePointEps,s=r*r;if(0===n.length)return;const o=new qi(n[0],n[1]),a=new qi(n[n.length-2],n[n.length-1]),h=t.closeStroke=i.closeStroke;let l=n.length,u=2;for(let t=2;t<l;t+=2){const e=n[t-2],i=n[t-1],s=n[t],o=n[t+1];let a=!0;Math.abs(e-s)<r&&Math.abs(i-o)<r&&(a=!1),a&&(n[u]=n[t],n[u+1]=n[t+1],u+=2)}n.length=l=u,u=2;for(let t=2;t+2<l;t+=2){let e=n[t-2],i=n[t-1];const r=n[t],o=n[t+1];let a=n[t+2],h=n[t+3];e-=r,i-=o,a-=r,h-=o;let l=!0;Math.abs(a*i-h*e)<s&&e*a+i*h<-s&&(l=!1),l&&(n[u]=n[t],n[u+1]=n[t+1],u+=2)}if(n[u]=n[l-2],n[u+1]=n[l-1],u+=2,n.length=l=u,!(l<=2)&&h){Math.abs(o.x-a.x)<r&&Math.abs(o.y-a.y)<r&&(n.pop(),n.pop())}}line(t,e){const{closeStroke:i,points:n}=t,r=n.length;if(r<=2)return;const{verts:s,joints:o}=e,a=t.jointType(),h=t.capType();let l,u,c=0;i?(l=n[r-2],u=n[r-1],o.push(nE.NONE)):(l=n[2],u=n[3],h===nE.CAP_ROUND?(s.push(n[0],n[1]),o.push(nE.NONE),o.push(nE.CAP_ROUND),c=0):(c=h,o.push(nE.NONE))),s.push(l,u);for(let t=0;t<r;t+=2){const e=n[t],d=n[t+1];let p=a;t+2>=r?i||(p=nE.NONE):t+4>=r&&(i||(h===nE.CAP_ROUND&&(p=nE.JOINT_CAP_ROUND),h===nE.CAP_BUTT&&(p=nE.JOINT_CAP_BUTT),h===nE.CAP_SQUARE&&(p=nE.JOINT_CAP_SQUARE))),p+=c,c=0,s.push(e,d),o.push(p),l=e,u=d}i?(s.push(n[0],n[1]),o.push(nE.NONE),s.push(n[2],n[3]),o.push(nE.NONE)):(s.push(n[r-4],n[r-3]),o.push(nE.NONE))}fill(t,e){let i=t.points;const n=t.holes,r=e.closePointEps,{verts:s,joints:o}=e;if(i.length<6)return;const a=[];let h=i.length;uE(i,!1);for(let t=0;t<n.length;t++){const e=n[t];uE(e.points,!0),a.push(i.length/2),i=i.concat(e.points)}const l=lE;l.length<i.length&&(l.length=i.length);let u=0;for(let t=0;t<=a.length;t++){let e=h/2;t>0&&(e=t<a.length?a[t]:i.length>>1),l[2*u]=e-1,l[2*(e-1)+1]=u;for(let t=u;t+1<e;t++)l[2*t+1]=t+1,l[2*t+2]=t;u=e}if(t.triangles=$.exports(i,a,2),!t.triangles)return;if(!t.fillAA){for(let t=0;t<i.length;t+=2)s.push(i[t],i[t+1]),o.push(nE.FILL);return}const{triangles:c}=t;h=i.length;for(let t=0;t<c.length;t+=3){let e=0;for(let i=0;i<3;i++){const n=c[t+i],r=c[t+(i+1)%3];l[2*n]!==r&&l[2*n+1]!==r||(e|=1<<i)}o.push(nE.FILL_EXPAND+e),o.push(nE.NONE),o.push(nE.NONE),o.push(nE.NONE),o.push(nE.NONE),o.push(nE.NONE)}for(let t=0;t<h/2;t++){const e=l[2*t],n=l[2*t+1];let s=i[2*n+1]-i[2*t+1],o=-(i[2*n]-i[2*t]),a=i[2*t+1]-i[2*e+1],h=-(i[2*t]-i[2*e]);const u=Math.sqrt(s*s+o*o);s/=u,o/=u;const c=Math.sqrt(a*a+h*h);a/=c,h/=c;let d=s+a,p=o+h;const f=d*s+p*o;Math.abs(f)<r?(d=s,p=o):(d/=f,p/=f),l[2*t]=d,l[2*t+1]=p}for(let t=0;t<c.length;t+=3){const e=c[t],n=c[t+1],r=c[t+2],o=i[2*r+1]-i[2*n+1],a=-(i[2*r]-i[2*n]),h=i[2*n+1]-i[2*e+1];let u=1;o*-(i[2*n]-i[2*e])-h*a>0&&(u=2);for(let e=0;e<3;e++){const n=c[t+e*u%3];s.push(i[2*n],i[2*n+1])}for(let e=0;e<3;e++){const i=c[t+e*u%3];s.push(l[2*i],l[2*i+1])}}}}const dE={[$i.POLY]:new cE,[$i.CIRC]:new hE,[$i.ELIP]:new hE,[$i.RECT]:new class{constructor(){this._polyBuilder=new cE}path(t,e){const i=t.shape,n=i.x,r=i.y,s=i.width,o=i.height,a=t.points;a.length=0,a.push(n,r,n+s,r,n+s,r+o,n,r+o)}line(t,e){const{verts:i,joints:n}=e,{points:r}=t,s=t.goodJointType(),o=r.length;i.push(r[o-2],r[o-1]),n.push(nE.NONE);for(let t=0;t<o;t+=2)i.push(r[t],r[t+1]),n.push(s);i.push(r[0],r[1]),n.push(nE.NONE),i.push(r[2],r[3]),n.push(nE.NONE)}fill(t,e){const{verts:i,joints:n}=e,{points:r,triangles:s}=t;if(s.length=0,!t.fillAA)return i.push(r[0],r[1],r[2],r[3],r[4],r[5],r[6],r[7]),n.push(nE.FILL,nE.FILL,nE.FILL,nE.FILL),void s.push(0,1,2,0,2,3);this._polyBuilder.fill(t,e)}},[$i.RREC]:new class{constructor(){this._circleBuilder=new hE}path(t,e){this._circleBuilder.path(t,e)}line(t,e){this._circleBuilder.line(t,e)}fill(t,e){this._circleBuilder.fill(t,e)}}},pE=[],fE=[],gE=new qi,mE=new Ts;class vE extends Hi{constructor(){super(),this.indicesUint16=null,this.initAttributes(!1),this.buildData=new iE,this.graphicsData=[],this.dirty=0,this.batchDirty=-1,this.cacheDirty=-1,this.clearDirty=0,this.drawCalls=[],this.batches=[],this.shapeBuildIndex=0,this.shapeBatchIndex=0,this._bounds=new Ts,this.boundsDirty=-1,this.boundsPadding=0,this.batchable=!1,this.indicesUint16=null,this.packer=null,this.packSize=0,this.pack32index=null}get points(){return this.buildData.verts}get closePointEps(){return this.buildData.closePointEps}initAttributes(t){this._buffer=new ki(null,t,!1),this._bufferFloats=new Float32Array,this._bufferUint=new Uint32Array,this._indexBuffer=new ki(null,t,!0),this.addAttribute("aPrev",this._buffer,2,!1,f.FLOAT).addAttribute("aPoint1",this._buffer,2,!1,f.FLOAT).addAttribute("aPoint2",this._buffer,2,!1,f.FLOAT).addAttribute("aNext",this._buffer,2,!1,f.FLOAT).addAttribute("aTravel",this._buffer,1,!1,f.FLOAT).addAttribute("aVertexJoint",this._buffer,1,!1,f.FLOAT).addAttribute("aStyleId",this._buffer,1,!1,f.FLOAT).addAttribute("aColor",this._buffer,4,!0,f.UNSIGNED_BYTE).addIndex(this._indexBuffer),this.strideFloats=12}checkInstancing(t,e){this.packer||(this.packer=new sE,this.pack32index=e)}get bounds(){return this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds}invalidate(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeBuildIndex=0,this.shapeBatchIndex=0,this.packSize=0,this.buildData.clear();for(let t=0;t<this.drawCalls.length;t++)this.drawCalls[t].clear(),fE.push(this.drawCalls[t]);this.drawCalls.length=0;for(let t=0;t<this.batches.length;t++){const e=this.batches[t];e.reset(),pE.push(e)}this.batches.length=0}clear(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this}drawShape(t,e=null,i=null,n=null){const r=new aE(t,e,i,n);return this.graphicsData.push(r),this.dirty++,this}drawHole(t,e=null){if(!this.graphicsData.length)return null;const i=new aE(t,null,null,e),n=this.graphicsData[this.graphicsData.length-1];return i.lineStyle=n.lineStyle,n.holes.push(i),this.dirty++,this}destroy(){super.destroy();for(let t=0;t<this.graphicsData.length;++t)this.graphicsData[t].destroy();this.buildData.destroy(),this.buildData=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null}containsPoint(t){const e=this.graphicsData;for(let i=0;i<e.length;++i){const n=e[i];if(n.fillStyle.visible&&(n.shape&&(n.matrix?n.matrix.applyInverse(t,gE):gE.copyFrom(t),n.shape.contains(gE.x,gE.y)))){let t=!1;if(n.holes)for(let e=0;e<n.holes.length;e++){if(n.holes[e].shape.contains(gE.x,gE.y)){t=!0;break}}if(!t)return!0}}return!1}updatePoints(){}updateBufferSize(){this._buffer.update(new Float32Array)}updateBuild(){const{graphicsData:t,buildData:e}=this,i=t.length;for(let n=this.shapeBuildIndex;n<i;n++){const i=t[n];i.strokeStart=0,i.strokeLen=0,i.fillStart=0,i.fillLen=0;const{fillStyle:r,lineStyle:s,holes:o}=i;if(!r.visible&&!s.visible)continue;const a=dE[i.type];if(i.clearPath(),a.path(i,e),i.matrix&&this.transformPoints(i.points,i.matrix),i.clearBuild(),!(i.points.length<=2)&&((r.visible||s.visible)&&this.processHoles(o),r.visible&&(i.fillAA=i.fillStyle.smooth&&i.fillStyle.texture===sr.WHITE&&0===o.length&&!(i.closeStroke&&i.lineStyle.visible&&!i.lineStyle.shader&&i.lineStyle.alpha>=.99&&i.lineStyle.width*Math.min(i.lineStyle.alignment,1-i.lineStyle.alignment)>=.495),i.fillStart=e.joints.length,o.length?dE[$i.POLY].fill(i,e):a.fill(i,e),i.fillLen=e.joints.length-i.fillStart),s.visible)){i.strokeStart=e.joints.length,a.line(i,e);for(let t=0;t<o.length;t++){const i=o[t];dE[i.type].line(i,e)}i.strokeLen=e.joints.length-i.strokeStart}}this.shapeBuildIndex=i}updateBatches(t){if(!this.graphicsData.length)return void(this.batchable=!0);if(this.updateBuild(),!this.validateBatching())return;const{buildData:e,graphicsData:i}=this,n=i.length;this.cacheDirty=this.dirty;let r=null,s=null;this.batches.length>0&&(r=this.batches[this.batches.length-1],s=r.style);for(let t=this.shapeBatchIndex;t<n;t++){const n=i[t],o=n.fillStyle,a=n.lineStyle;if(n.matrix&&this.transformPoints(n.points,n.matrix),o.visible||a.visible)for(let t=0;t<2;t++){const i=0===t?o:a;if(!i.visible)continue;const h=i.texture.baseTexture,l=e.vertexSize,u=e.indexSize;h.wrapMode=v.REPEAT,0===t?this.packer.updateBufferSize(n.fillStart,n.fillLen,n.triangles.length,e):this.packer.updateBufferSize(n.strokeStart,n.strokeLen,n.triangles.length,e);e.vertexSize!==l&&(r&&!this._compareStyles(s,i)&&(r.end(u,l),r=null),r||(r=pE.pop()||new JT,r.begin(i,u,l),this.batches.push(r),s=i),r.jointEnd=0===t?n.fillStart+n.fillLen:n.strokeStart+n.strokeLen)}}this.shapeBatchIndex=n,r&&r.end(e.indexSize,e.vertexSize),0!==this.batches.length?(this.batchable=this.isBatchable(),this.batchable?this.packBatches():(this.buildDrawCalls(t),this.updatePack())):this.batchable=!0}updatePack(){const{vertexSize:t,indexSize:e}=this.buildData;if(this.packSize===t)return;const{strideFloats:i,packer:n,buildData:r,batches:s}=this,o=this._buffer,a=this._indexBuffer,h=t*i;if(o.data.length!==h){const t=new ArrayBuffer(4*h);this._bufferFloats=new Float32Array(t),this._bufferUint=new Uint32Array(t),o.data=this._bufferFloats}a.data.length!==e&&(t>65535&&this.pack32index?a.data=new Uint32Array(e):a.data=new Uint16Array(e)),n.beginPack(r,this._bufferFloats,this._bufferUint,a.data);let l=0;for(let t=0;t<this.graphicsData.length;t++){const e=this.graphicsData[t];if(e.fillLen){for(;s[l].jointEnd<=e.fillStart;)l++;n.packInterleavedGeometry(e.fillStart,e.fillLen,e.triangles,s[l].styleId,s[l].rgba)}if(e.strokeLen){for(;s[l].jointEnd<=e.strokeStart;)l++;n.packInterleavedGeometry(e.strokeStart,e.strokeLen,e.triangles,s[l].styleId,s[l].rgba)}}o.update(),a.update(),this.packSize=t}_compareStyles(t,e){if(!t||!e)return!1;if(t.texture.baseTexture!==e.texture.baseTexture)return!1;if(t.color+t.alpha!==e.color+e.alpha)return!1;if(t.shader!==e.shader)return!1;if(t.width!==e.width)return!1;if(t.scaleMode!==e.scaleMode)return!1;if(t.alignment!==e.alignment)return!1;return qT(t.matrix||nn.IDENTITY,e.matrix||nn.IDENTITY)}validateBatching(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(let t=0,e=this.graphicsData.length;t<e;t++){const e=this.graphicsData[t],i=e.fillStyle,n=e.lineStyle;if(i&&!i.texture.baseTexture.valid)return!1;if(n&&!n.texture.baseTexture.valid)return!1}return!0}packBatches(){this.batchDirty++;const t=this.batches;for(let e=0,i=t.length;e<i;e++){const i=t[e];for(let t=0;t<i.size;t++){const e=i.start+t;this.indicesUint16[e]=this.indicesUint16[e]-i.attribStart}}}isBatchable(){return!1}buildDrawCalls(t){for(let t=0;t<this.drawCalls.length;t++)this.drawCalls[t].clear(),fE.push(this.drawCalls[t]);this.drawCalls.length=0;let e=fE.pop()||new ZT;e.begin(t,null);let i=0;this.drawCalls.push(e);for(let n=0;n<this.batches.length;n++){const r=this.batches[n],s=r.style;if(0===r.attribSize)continue;let o=-1;const a=s.getTextureMatrix();e.check(s.shader)&&(o=e.add(s.texture,a,s.width,s.alignment||0,s.packLineScale())),o<0&&(e=fE.pop()||new ZT,this.drawCalls.push(e),e.begin(t,s.shader),e.start=i,o=e.add(s.texture,a,s.width,s.alignment||0,s.packLineScale())),e.size+=r.size,i+=r.size;const{color:h,alpha:l}=s,u=qe.shared.setValue(h).toLittleEndianNumber();r.rgba=qe.shared.setValue(u).toPremultiplied(l),r.styleId=o}}processHoles(t){for(let e=0;e<t.length;e++){const i=t[e],n=dE[i.type];i.clearPath(),n.path(i,this.buildData),i.matrix&&this.transformPoints(i.points,i.matrix)}}calculateBounds(){const t=this._bounds,e=mE;let i=nn.IDENTITY;this._bounds.clear(),e.clear();for(let n=0;n<this.graphicsData.length;n++){const r=this.graphicsData[n],s=r.shape,o=r.type,a=r.lineStyle,h=r.matrix||nn.IDENTITY;let l=0;if(a&&a.visible&&(l=a.width,o!==$i.POLY||r.fillStyle.visible?l*=Math.max(0,a.alignment):l*=Math.max(a.alignment,1-a.alignment)),i!==h&&(e.isEmpty()||(t.addBoundsMatrix(e,i),e.clear()),i=h),o===$i.RECT||o===$i.RREC){const t=s;e.addFramePad(t.x,t.y,t.x+t.width,t.y+t.height,l,l)}else if(o===$i.CIRC){const t=s;e.addFramePad(t.x,t.y,t.x,t.y,t.radius+l,t.radius+l)}else if(o===$i.ELIP){const t=s;e.addFramePad(t.x,t.y,t.x,t.y,t.width+l,t.height+l)}else{const e=s;t.addVerticesMatrix(i,e.points,0,e.points.length,l,l)}}e.isEmpty()||t.addBoundsMatrix(e,i),t.pad(this.boundsPadding,this.boundsPadding)}transformPoints(t,e){for(let i=0;i<t.length/2;i++){const n=t[2*i],r=t[2*i+1];t[2*i]=e.a*n+e.c*r+e.tx,t[2*i+1]=e.b*n+e.d*r+e.ty}}}vE.BATCHABLE_SIZE=100;const yE="#version 100\nprecision highp float;\nconst float FILL = 1.0;\nconst float BEVEL = 4.0;\nconst float MITER = 8.0;\nconst float ROUND = 12.0;\nconst float JOINT_CAP_BUTT = 16.0;\nconst float JOINT_CAP_SQUARE = 18.0;\nconst float JOINT_CAP_ROUND = 20.0;\n\nconst float FILL_EXPAND = 24.0;\n\nconst float CAP_BUTT = 1.0;\nconst float CAP_SQUARE = 2.0;\nconst float CAP_ROUND = 3.0;\nconst float CAP_BUTT2 = 4.0;\n\nconst float MITER_LIMIT = 10.0;\n\n// === geom ===\nattribute vec2 aPrev;\nattribute vec2 aPoint1;\nattribute vec2 aPoint2;\nattribute vec2 aNext;\nattribute float aVertexJoint;\nattribute float aTravel;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform vec4 tint;\n\nvarying vec4 vLine1;\nvarying vec4 vLine2;\nvarying vec4 vArc;\nvarying float vType;\n\nuniform float resolution;\nuniform float expand;\n\n// === style ===\nattribute float aStyleId;\nattribute vec4 aColor;\n\nvarying float vTextureId;\nvarying vec4 vColor;\nvarying vec2 vTextureCoord;\nvarying vec2 vTravel;\n\nuniform vec2 styleLine[%MAX_STYLES%];\nuniform vec3 styleMatrix[2 * %MAX_STYLES%];\nuniform float styleTextureId[%MAX_STYLES%];\nuniform vec2 samplerSize[%MAX_TEXTURES%];\n\nvec2 doBisect(vec2 norm, float len, vec2 norm2, float len2,\n    float dy, float inner) {\n    vec2 bisect = (norm + norm2) / 2.0;\n    bisect /= dot(norm, bisect);\n    vec2 shift = dy * bisect;\n    if (inner > 0.5) {\n        if (len < len2) {\n            if (abs(dy * (bisect.x * norm.y - bisect.y * norm.x)) > len) {\n                return dy * norm;\n            }\n        } else {\n            if (abs(dy * (bisect.x * norm2.y - bisect.y * norm2.x)) > len2) {\n                return dy * norm;\n            }\n        }\n    }\n    return dy * bisect;\n}\n\nvoid main(void){\n    vec2 pointA = (translationMatrix * vec3(aPoint1, 1.0)).xy;\n    vec2 pointB = (translationMatrix * vec3(aPoint2, 1.0)).xy;\n\n    vec2 xBasis = pointB - pointA;\n    float len = length(xBasis);\n    vec2 forward = xBasis / len;\n    vec2 norm = vec2(forward.y, -forward.x);\n\n    float type = floor(aVertexJoint / 16.0);\n    float vertexNum = aVertexJoint - type * 16.0;\n    float dx = 0.0, dy = 1.0;\n\n    float capType = floor(type / 32.0);\n    type -= capType * 32.0;\n\n    int styleId = int(aStyleId + 0.5);\n    float lineWidth = styleLine[styleId].x;\n    vTextureId = floor(styleTextureId[styleId] / 4.0);\n    float scaleMode = styleTextureId[styleId] - vTextureId * 4.0;\n    float avgScale = 1.0;\n    if (scaleMode > 2.5) {\n        avgScale = length(translationMatrix * vec3(1.0, 0.0, 0.0));\n    } else if (scaleMode > 1.5) {\n        avgScale = length(translationMatrix * vec3(0.0, 1.0, 0.0));\n    } else if (scaleMode > 0.5) {\n        vec2 avgDiag = (translationMatrix * vec3(1.0, 1.0, 0.0)).xy;\n        avgScale = sqrt(dot(avgDiag, avgDiag) * 0.5);\n    }\n    lineWidth *= 0.5 * avgScale;\n    float lineAlignment = 2.0 * styleLine[styleId].y - 1.0;\n    vTextureCoord = vec2(0.0);\n\n    vec2 pos;\n\n    if (capType == CAP_ROUND) {\n        vertexNum += 4.0;\n        type = JOINT_CAP_ROUND;\n        capType = 0.0;\n        lineAlignment = -lineAlignment;\n    }\n\n    vLine1 = vec4(0.0, 10.0, 1.0, 0.0);\n    vLine2 = vec4(0.0, 10.0, 1.0, 0.0);\n    vArc = vec4(0.0);\n    if (type == FILL) {\n        pos = pointA;\n        vType = 0.0;\n        vLine2 = vec4(-2.0, -2.0, -2.0, 0.0);\n        vec2 vTexturePixel;\n        vTexturePixel.x = dot(vec3(aPoint1, 1.0), styleMatrix[styleId * 2]);\n        vTexturePixel.y = dot(vec3(aPoint1, 1.0), styleMatrix[styleId * 2 + 1]);\n        vTextureCoord = vTexturePixel / samplerSize[int(vTextureId)];\n    } else if (type >= FILL_EXPAND && type < FILL_EXPAND + 7.5) {\n        // expand vertices\n        float flags = type - FILL_EXPAND;\n        float flag3 = floor(flags / 4.0);\n        float flag2 = floor((flags - flag3 * 4.0) / 2.0);\n        float flag1 = flags - flag3 * 4.0 - flag2 * 2.0;\n\n        vec2 prev = (translationMatrix * vec3(aPrev, 1.0)).xy;\n\n        if (vertexNum < 0.5) {\n            pos = prev;\n        } else if (vertexNum < 1.5) {\n            pos = pointA;\n        } else {\n            pos = pointB;\n        }\n        float len2 = length(aNext);\n        vec2 bisect = (translationMatrix * vec3(aNext, 0.0)).xy;\n        if (len2 > 0.01) {\n            bisect = normalize(bisect) * len2;\n        }\n\n        vec2 n1 = normalize(vec2(pointA.y - prev.y, -(pointA.x - prev.x)));\n        vec2 n2 = normalize(vec2(pointB.y - pointA.y, -(pointB.x - pointA.x)));\n        vec2 n3 = normalize(vec2(prev.y - pointB.y, -(prev.x - pointB.x)));\n\n        if (n1.x * n2.y - n1.y * n2.x < 0.0) {\n            n1 = -n1;\n            n2 = -n2;\n            n3 = -n3;\n        }\n        pos += bisect * expand;\n\n        vLine1 = vec4(16.0, 16.0, 16.0, -1.0);\n        if (flag1 > 0.5) {\n            vLine1.x = -dot(pos - prev, n1);\n        }\n        if (flag2 > 0.5) {\n            vLine1.y = -dot(pos - pointA, n2);\n        }\n        if (flag3 > 0.5) {\n            vLine1.z = -dot(pos - pointB, n3);\n        }\n        vLine1.xyz *= resolution;\n        vType = 2.0;\n    } else if (type >= BEVEL) {\n        float dy = lineWidth + expand;\n        float shift = lineWidth * lineAlignment;\n        float inner = 0.0;\n        if (vertexNum >= 1.5) {\n            dy = -dy;\n            inner = 1.0;\n        }\n\n        vec2 base, next, xBasis2, bisect;\n        float flag = 0.0;\n        float side2 = 1.0;\n        if (vertexNum < 0.5 || vertexNum > 2.5 && vertexNum < 3.5) {\n            next = (translationMatrix * vec3(aPrev, 1.0)).xy;\n            base = pointA;\n            flag = type - floor(type / 2.0) * 2.0;\n            side2 = -1.0;\n        } else {\n            next = (translationMatrix * vec3(aNext, 1.0)).xy;\n            base = pointB;\n            if (type >= MITER && type < MITER + 3.5) {\n                flag = step(MITER + 1.5, type);\n                // check miter limit here?\n            }\n        }\n        xBasis2 = next - base;\n        float len2 = length(xBasis2);\n        vec2 norm2 = vec2(xBasis2.y, -xBasis2.x) / len2;\n        float D = norm.x * norm2.y - norm.y * norm2.x;\n        if (D < 0.0) {\n            inner = 1.0 - inner;\n        }\n\n        norm2 *= side2;\n\n        float collinear = step(0.0, dot(norm, norm2));\n\n        vType = 0.0;\n        float dy2 = -1000.0;\n\n        if (abs(D) < 0.01 && collinear < 0.5) {\n            if (type >= ROUND && type < ROUND + 1.5) {\n                type = JOINT_CAP_ROUND;\n            }\n            //TODO: BUTT here too\n        }\n\n        vLine1 = vec4(0.0, lineWidth, max(abs(norm.x), abs(norm.y)), min(abs(norm.x), abs(norm.y)));\n        vLine2 = vec4(0.0, lineWidth, max(abs(norm2.x), abs(norm2.y)), min(abs(norm2.x), abs(norm2.y)));\n\n        if (vertexNum < 3.5) {\n            if (abs(D) < 0.01 && collinear < 0.5) {\n                pos = (shift + dy) * norm;\n            } else {\n                if (flag < 0.5 && inner < 0.5) {\n                    pos = (shift + dy) * norm;\n                } else {\n                    pos = doBisect(norm, len, norm2, len2, shift + dy, inner);\n                }\n            }\n            vLine2.y = -1000.0;\n            if (capType >= CAP_BUTT && capType < CAP_ROUND) {\n                float extra = step(CAP_SQUARE, capType) * lineWidth;\n                vec2 back = -forward;\n                if (vertexNum < 0.5 || vertexNum > 2.5) {\n                    pos += back * (expand + extra);\n                    dy2 = expand;\n                } else {\n                    dy2 = dot(pos + base - pointA, back) - extra;\n                }\n            }\n            if (type >= JOINT_CAP_BUTT && type < JOINT_CAP_SQUARE + 0.5) {\n                float extra = step(JOINT_CAP_SQUARE, type) * lineWidth;\n                if (vertexNum < 0.5 || vertexNum > 2.5) {\n                    vLine2.y = dot(pos + base - pointB, forward) - extra;\n                } else {\n                    pos += forward * (expand + extra);\n                    vLine2.y = expand;\n                    if (capType >= CAP_BUTT) {\n                        dy2 -= expand + extra;\n                    }\n                }\n            }\n        } else if (type >= JOINT_CAP_ROUND && type < JOINT_CAP_ROUND + 1.5) {\n            base += shift * norm;\n            if (inner > 0.5) {\n                dy = -dy;\n                inner = 0.0;\n            }\n            vec2 d2 = abs(dy) * forward;\n            if (vertexNum < 4.5) {\n                dy = -dy;\n                pos = dy * norm;\n            } else if (vertexNum < 5.5) {\n                pos = dy * norm;\n            } else if (vertexNum < 6.5) {\n                pos = dy * norm + d2;\n                vArc.x = abs(dy);\n            } else {\n                dy = -dy;\n                pos = dy * norm + d2;\n                vArc.x = abs(dy);\n            }\n            vLine2 = vec4(0.0, lineWidth * 2.0 + 10.0, 1.0  , 0.0); // forget about line2 with type=3\n            vArc.y = dy;\n            vArc.z = 0.0;\n            vArc.w = lineWidth;\n            vType = 3.0;\n        } else if (abs(D) < 0.01 && collinear < 0.5) {\n            pos = dy * norm;\n        } else {\n            if (inner > 0.5) {\n                dy = -dy;\n                inner = 0.0;\n            }\n            float side = sign(dy);\n            vec2 norm3 = normalize(norm + norm2);\n\n            if (type >= MITER && type < MITER + 3.5) {\n                vec2 farVertex = doBisect(norm, len, norm2, len2, shift + dy, 0.0);\n                if (length(farVertex) > abs(shift + dy) * MITER_LIMIT) {\n                    type = BEVEL;\n                }\n            }\n\n            if (vertexNum < 4.5) {\n                pos = doBisect(norm, len, norm2, len2, shift - dy, 1.0);\n            } else if (vertexNum < 5.5) {\n                pos = (shift + dy) * norm;\n            } else if (vertexNum > 7.5) {\n                pos = (shift + dy) * norm2;\n            } else {\n                if (type >= ROUND && type < ROUND + 1.5) {\n                    pos = doBisect(norm, len, norm2, len2, shift + dy, 0.0);\n                    float d2 = abs(shift + dy);\n                    if (length(pos) > abs(shift + dy) * 1.5) {\n                        if (vertexNum < 6.5) {\n                            pos.x = (shift + dy) * norm.x - d2 * norm.y;\n                            pos.y = (shift + dy) * norm.y + d2 * norm.x;\n                        } else {\n                            pos.x = (shift + dy) * norm2.x + d2 * norm2.y;\n                            pos.y = (shift + dy) * norm2.y - d2 * norm2.x;\n                        }\n                    }\n                } else if (type >= MITER && type < MITER + 3.5) {\n                    pos = doBisect(norm, len, norm2, len2, shift + dy, 0.0); //farVertex\n                } else if (type >= BEVEL && type < BEVEL + 1.5) {\n                    float d2 = side / resolution;\n                    if (vertexNum < 6.5) {\n                        pos = (shift + dy) * norm + d2 * norm3;\n                    } else {\n                        pos = (shift + dy) * norm2 + d2 * norm3;\n                    }\n                }\n            }\n\n            if (type >= ROUND && type < ROUND + 1.5) {\n                vArc.x = side * dot(pos, norm3);\n                vArc.y = pos.x * norm3.y - pos.y * norm3.x;\n                vArc.z = dot(norm, norm3) * (lineWidth + side * shift);\n                vArc.w = lineWidth + side * shift;\n                vType = 3.0;\n            } else if (type >= MITER && type < MITER + 3.5) {\n                vType = 1.0;\n            } else if (type >= BEVEL && type < BEVEL + 1.5) {\n                vType = 4.0;\n                vArc.z = dot(norm, norm3) * (lineWidth + side * shift) - side * dot(pos, norm3);\n            }\n\n            dy = side * (dot(pos, norm) - shift);\n            dy2 = side * (dot(pos, norm2) - shift);\n        }\n\n        pos += base;\n        vLine1.xy = vec2(dy, vLine1.y) * resolution;\n        vLine2.xy = vec2(dy2, vLine2.y) * resolution;\n        vArc = vArc * resolution;\n        vTravel = vec2(aTravel * avgScale + dot(pos - pointA, vec2(-norm.y, norm.x)), avgScale);\n    }\n\n    gl_Position = vec4((projectionMatrix * vec3(pos, 1.0)).xy, 0.0, 1.0);\n\n    vColor = aColor * tint;\n}",_E="%PRECISION%\nvarying vec4 vColor;\nvarying vec4 vLine1;\nvarying vec4 vLine2;\nvarying vec4 vArc;\nvarying float vType;\nvarying float vTextureId;\nvarying vec2 vTextureCoord;\nvarying vec2 vTravel;\nuniform sampler2D uSamplers[%MAX_TEXTURES%];\n\n%PIXEL_LINE%\n\nvoid main(void){\n    %PIXEL_COVERAGE%\n\n    vec4 texColor;\n    float textureId = floor(vTextureId+0.5);\n    %FOR_LOOP%\n\n    gl_FragColor = vColor * texColor * alpha;\n}\n",xE=["\nfloat pixelLine(float x, float A, float B) {\n    return clamp(x + 0.5, 0.0, 1.0);\n}\n","\nfloat pixelLine(float x, float A, float B) {\n    float y = abs(x), s = sign(x);\n    if (y * 2.0 < A - B) {\n        return 0.5 + s * y / A;\n    }\n    y -= (A - B) * 0.5;\n    y = max(1.0 - y / B, 0.0);\n    return (1.0 + s * (1.0 - y * y)) * 0.5;\n    //return clamp(x + 0.5, 0.0, 1.0);\n}\n"];class bE extends Un{constructor(t,e=yE,i=_E,n={}){e=bE.generateVertexSrc(t,e),i=bE.generateFragmentSrc(t,i);const{maxStyles:r,maxTextures:s}=t,o=new Int32Array(s);for(let t=0;t<s;t++)o[t]=t;super(Bn.from(e,i),Object.assign(n,{styleMatrix:new Float32Array(6*r),styleTextureId:new Float32Array(r),styleLine:new Float32Array(2*r),samplerSize:new Float32Array(2*s),uSamplers:o,tint:new Float32Array([1,1,1,1]),resolution:1,expand:1})),this.settings=t}static generateVertexSrc(t,e=yE){const{maxStyles:i,maxTextures:n}=t;return e=e.replace(/%MAX_TEXTURES%/gi,`${n}`).replace(/%MAX_STYLES%/gi,`${i}`)}static generateFragmentSrc(t,e=_E){const{maxTextures:i,pixelLine:n}=t;return e=e.replace(/%PRECISION%/gi,"#version 100\n#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n#else\n  precision mediump float;\n#endif\n").replace(/%PIXEL_LINE%/gi,xE[n]).replace(/%PIXEL_COVERAGE%/gi,"float alpha = 1.0;\nif (vType < 0.5) {\n    float left = pixelLine(-vLine1.y - vLine1.x, vLine1.z, vLine1.w);\n    float right = pixelLine(vLine1.y - vLine1.x, vLine1.z, vLine1.w);\n    float near = vLine2.x - 0.5;\n    float far = min(vLine2.x + 0.5, 0.0);\n    float top = vLine2.y - 0.5;\n    float bottom = min(vLine2.y + 0.5, 0.0);\n    alpha = (right - left) * max(bottom - top, 0.0) * max(far - near, 0.0);\n} else if (vType < 1.5) {\n    float a1 = pixelLine(- vLine1.y - vLine1.x, vLine1.z, vLine1.w);\n    float a2 = pixelLine(vLine1.y - vLine1.x, vLine1.z, vLine1.w);\n    float b1 = pixelLine(- vLine2.y - vLine2.x, vLine2.z, vLine2.w);\n    float b2 = pixelLine(vLine2.y - vLine2.x, vLine2.z, vLine2.w);\n    alpha = a2 * b2 - a1 * b1;\n} else if (vType < 2.5) {\n    alpha *= max(min(vLine1.x + 0.5, 1.0), 0.0);\n    alpha *= max(min(vLine1.y + 0.5, 1.0), 0.0);\n    alpha *= max(min(vLine1.z + 0.5, 1.0), 0.0);\n} else if (vType < 3.5) {\n    float a1 = pixelLine(- vLine1.y - vLine1.x, vLine1.z, vLine1.w);\n    float a2 = pixelLine(vLine1.y - vLine1.x, vLine1.z, vLine1.w);\n    float b1 = pixelLine(- vLine2.y - vLine2.x, vLine2.z, vLine2.w);\n    float b2 = pixelLine(vLine2.y - vLine2.x, vLine2.z, vLine2.w);\n    float alpha_miter = a2 * b2 - a1 * b1;\n    float alpha_plane = clamp(vArc.z - vArc.x + 0.5, 0.0, 1.0);\n    float d = length(vArc.xy);\n    float circle_hor = max(min(vArc.w, d + 0.5) - max(-vArc.w, d - 0.5), 0.0);\n    float circle_vert = min(vArc.w * 2.0, 1.0);\n    float alpha_circle = circle_hor * circle_vert;\n    alpha = min(alpha_miter, max(alpha_circle, alpha_plane));\n} else {\n    float a1 = pixelLine(- vLine1.y - vLine1.x, vLine1.z, vLine1.w);\n    float a2 = pixelLine(vLine1.y - vLine1.x, vLine1.z, vLine1.w);\n    float b1 = pixelLine(- vLine2.y - vLine2.x, vLine2.z, vLine2.w);\n    float b2 = pixelLine(vLine2.y - vLine2.x, vLine2.z, vLine2.w);\n    alpha = a2 * b2 - a1 * b1;\n    alpha *= clamp(vArc.z + 0.5, 0.0, 1.0);\n}\n").replace(/%MAX_TEXTURES%/gi,`${i}`).replace(/%FOR_LOOP%/gi,this.generateSampleSrc(i))}static generateSampleSrc(t){let e="";e+="\n",e+="\n";for(let i=0;i<t;i++)i>0&&(e+="\nelse "),i<t-1&&(e+=`if(textureId < ${i}.5)`),e+="\n{",e+=`\n\ttexColor = texture2D(uSamplers[${i}], vTextureCoord);`,e+="\n}";return e+="\n",e+="\n",e}}const wE={LINE_SCALE_MODE:tE.NORMAL,SHADER_MAX_STYLES:24,SHADER_MAX_TEXTURES:4,PIXEL_LINE:0},TE=rh,{BezierUtils:EE,QuadraticUtils:AE,ArcUtils:SE}=sh,CE={},IE=class extends Ms{constructor(t=null){super(),this._geometry=t||new vE,this._geometry.refCount++,this.shader=null,this.shaderSettings={maxStyles:wE.SHADER_MAX_STYLES,maxTextures:wE.SHADER_MAX_TEXTURES,pixelLine:wE.PIXEL_LINE},this.state=Si.for2d(),this._fillStyle=new QT,this._lineStyle=new eE,this._matrix=null,this._holeMode=!1,this.currentPath=null,this.batches=[],this.batchTint=-1,this.batchDirty=-1,this.vertexData=null,this.pluginName="smooth",this._transformID=-1,this._tintColor=new qe(16777215),this.blendMode=u.NORMAL}get geometry(){return this._geometry}clone(){return this.finishPoly(),new IE(this._geometry)}set blendMode(t){this.state.blendMode=t}get blendMode(){return this.state.blendMode}get tint(){return this._tintColor.value}set tint(t){this._tintColor.setValue(t)}get fill(){return this._fillStyle}get line(){return this._lineStyle}lineStyle(t=null,e=0,i=1,n=.5,r=wE.LINE_SCALE_MODE){if("number"==typeof t)"boolean"==typeof r&&(r=r?tE.NONE:tE.NORMAL),t={width:t,color:e,alpha:i,alignment:n,scaleMode:r};else{const e=t.native;void 0!==e&&(t.scaleMode=e?tE.NONE:tE.NORMAL)}return this.lineTextureStyle(t)}lineTextureStyle(t){t=Object.assign({width:0,texture:sr.WHITE,color:t&&t.texture?16777215:0,alpha:1,matrix:null,alignment:.5,native:!1,cap:Fa.BUTT,join:ka.MITER,miterLimit:10,shader:null,scaleMode:wE.LINE_SCALE_MODE},t),this.normalizeColor(t),this.currentPath&&this.startPoly();const e=t.width>0&&t.alpha>0;return e?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._lineStyle,{visible:e},t)):this._lineStyle.reset(),this}startPoly(){if(this.currentPath){const t=this.currentPath.points,e=this.currentPath.points.length;e>2&&(this.drawShape(this.currentPath),this.currentPath=new tn,this.currentPath.closeStroke=!1,this.currentPath.points.push(t[e-2],t[e-1]))}else this.currentPath=new tn,this.currentPath.closeStroke=!1}finishPoly(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)}moveTo(t,e){return this.startPoly(),this.currentPath.points[0]=t,this.currentPath.points[1]=e,this}lineTo(t,e){this.currentPath||this.moveTo(0,0);const i=this.currentPath.points,n=i[i.length-2],r=i[i.length-1];return n===t&&r===e||i.push(t,e),this}_initCurve(t=0,e=0){this.currentPath?0===this.currentPath.points.length&&(this.currentPath.points=[t,e]):this.moveTo(t,e)}quadraticCurveTo(t,e,i,n){this._initCurve();const r=this.currentPath.points;return 0===r.length&&this.moveTo(0,0),AE.curveTo(t,e,i,n,r),this}bezierCurveTo(t,e,i,n,r,s){return this._initCurve(),EE.curveTo(t,e,i,n,r,s,this.currentPath.points),this}arcTo(t,e,i,n,r){this._initCurve(t,e);const s=this.currentPath.points,o=SE.curveTo(t,e,i,n,r,s);if(o){const{cx:t,cy:e,radius:i,startAngle:n,endAngle:r,anticlockwise:s}=o;this.arc(t,e,i,n,r,s)}return this}arc(t,e,i,n,r,s=!1){if(n===r)return this;!s&&r<=n?r+=Xi:s&&n<=r&&(n+=Xi);if(0===r-n)return this;const o=t+Math.cos(n)*i,a=e+Math.sin(n)*i,h=this._geometry.closePointEps;let l=this.currentPath?this.currentPath.points:null;if(l){const t=Math.abs(l[l.length-2]-o),e=Math.abs(l[l.length-1]-a);t<h&&e<h||l.push(o,a)}else this.moveTo(o,a),l=this.currentPath.points;return SE.arc(o,a,t,e,i,n,r,s,l),this}beginFill(t=0,e=1,i=!1){return this.beginTextureFill({texture:sr.WHITE,color:t,alpha:e,smooth:i})}normalizeColor(t){const e=qe.shared.setValue(t.color??0);t.color=e.toNumber(),t.alpha??(t.alpha=e.alpha)}beginTextureFill(t){t=Object.assign({texture:sr.WHITE,color:16777215,alpha:1,matrix:null,smooth:!1},t),this.normalizeColor(t),this.currentPath&&this.startPoly();const e=t.alpha>0;return e?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._fillStyle,{visible:e},t)):this._fillStyle.reset(),this}endFill(){return this.finishPoly(),this._fillStyle.reset(),this}drawRect(t,e,i,n){return this.drawShape(new Zi(t,e,i,n))}drawRoundedRect(t,e,i,n,r){return this.drawShape(new en(t,e,i,n,r))}drawCircle(t,e,i){return this.drawShape(new Ji(t,e,i))}drawEllipse(t,e,i,n){return this.drawShape(new Qi(t,e,i,n))}drawPolygon(...t){let e,i=!0;const n=t[0];n.points?(i=n.closeStroke,e=n.points):e=Array.isArray(t[0])?t[0]:t;const r=new tn(e);return r.closeStroke=i,this.drawShape(r),this}drawShape(t){return this._holeMode?this._geometry.drawHole(t,this._matrix):this._geometry.drawShape(t,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this}clear(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this}isFastRect(){const t=this._geometry.graphicsData;return!(1!==t.length||t[0].shape.type!==$i.RECT||t[0].matrix||t[0].holes.length||t[0].lineStyle.visible&&t[0].lineStyle.width)}_renderCanvas(t){TE.prototype._renderCanvas.call(this,t)}_render(t){this.finishPoly();const e=this._geometry,i=t.context.supports.uint32Indices;e.checkInstancing(t.geometry.hasInstance,i),e.updateBatches(this.shaderSettings),e.batchable?(this.batchDirty!==e.batchDirty&&this._populateBatches(),this._renderBatched(t)):(t.batch.flush(),this._renderDirect(t))}_populateBatches(){const t=this._geometry,e=this.blendMode,i=t.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=t.batchDirty,this.batches.length=i,this.vertexData=new Float32Array(t.points);for(let n=0;n<i;n++){const i=t.batches[n],r=i.style.color,s={vertexData:new Float32Array(this.vertexData.buffer,4*i.attribStart*2,2*i.attribSize),blendMode:e,_batchRGB:Ke(r),_tintRGB:r,_texture:i.style.texture,alpha:i.style.alpha,worldAlpha:1};this.batches[n]=s}}_renderBatched(t){if(this.batches.length){t.batch.setObjectRenderer(t.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(let e=0,i=this.batches.length;e<i;e++){const i=this.batches[e];i.worldAlpha=this.worldAlpha*i.alpha,t.plugins[this.pluginName].render(i)}}}_renderDirect(t){const e=this._resolveDirectShader(t);let i=e;const n=this._geometry,r=this.worldAlpha,s=i.uniforms,o=n.drawCalls;s.translationMatrix=this.transform.worldTransform,qe.shared.setValue(this._tintColor).premultiply(r).toArray(s.tint),s.resolution=t.renderTexture.current?t.renderTexture.current.resolution:t.resolution;const a=t.projection.transform;if(a){const t=Math.sqrt(a.a*a.a+a.b*a.b);s.resolution*=t}const h=t.renderTexture.current?t.renderTexture.current.multisample:t.multisample;s.expand=(h!==E.NONE?2:1)/s.resolution,t.shader.bind(i),t.geometry.bind(n,i),t.state.set(this.state),i=null;for(let r=0,a=o.length;r<a;r++){const o=n.drawCalls[r],a=i!==o.shader;a&&(i=o.shader,i&&(i.uniforms.translationMatrix=this.transform.worldTransform,i.uniforms.tint&&(i.uniforms.tint[0]=s.tint[0],i.uniforms.tint[1]=s.tint[1],i.uniforms.tint[2]=s.tint[2],i.uniforms.tint[3]=s.tint[3])));const{texArray:h,styleArray:l,size:u,start:d}=o,p=h.count,f=i||e,g=f.uniforms.styleTextureId,m=f.uniforms.styleMatrix,v=f.uniforms.styleLine;for(let t=0;t<l.count;t++){g[t]=l.textureIds[t],v[2*t]=l.lines[2*t],v[2*t+1]=l.lines[2*t+1];const e=l.matrices[t];m[6*t]=e.a,m[6*t+1]=e.c,m[6*t+2]=e.tx,m[6*t+3]=e.b,m[6*t+4]=e.d,m[6*t+5]=e.ty}const y=f.uniforms.samplerSize;for(let t=0;t<p;t++)y[2*t]=h.elements[t].width,y[2*t+1]=h.elements[t].height;t.shader.bind(f),a&&t.geometry.bind(n);for(let e=0;e<p;e++)t.texture.bind(h.elements[e],e);t.geometry.draw(c.TRIANGLES,u,d)}}_resolveDirectShader(t){let e=this.shader;const i=this.pluginName;return e||(CE[i]||(CE[i]=new bE(this.shaderSettings)),e=CE[i]),e}_calculateBounds(){this.finishPoly();const t=this._geometry;if(!t.graphicsData.length)return;const{minX:e,minY:i,maxX:n,maxY:r}=t.bounds;this._bounds.addFrame(this.transform,e,i,n,r)}containsPoint(t){return this.worldTransform.applyInverse(t,IE._TEMP_POINT),this._geometry.containsPoint(IE._TEMP_POINT)}calculateTints(){if(this.batchTint!==this.tint){this.batchTint=this._tintColor.toNumber();for(let t=0;t<this.batches.length;t++){const e=this.batches[t];e._tintRGB=qe.shared.setValue(this._tintColor).multiply(e._batchRGB).toLittleEndianNumber()}}}calculateVertices(){const t=this.transform._worldID;if(this._transformID===t)return;this._transformID=t;const e=this.transform.worldTransform,i=e.a,n=e.b,r=e.c,s=e.d,o=e.tx,a=e.ty,h=this._geometry.points,l=this.vertexData;let u=0;for(let t=0;t<h.length;t+=2){const e=h[t],c=h[t+1];l[u++]=i*e+r*c+o,l[u++]=s*c+n*e+a}}closePath(){const t=this.currentPath;return t&&(t.closeStroke=!0),this}setMatrix(t){return this._matrix=t,this}beginHole(){return this.finishPoly(),this._holeMode=!0,this}endHole(){return this.finishPoly(),this._holeMode=!1,this}destroy(t){this._geometry.refCount--,0===this._geometry.refCount&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,super.destroy(t)}};let ME=IE;ME.curves=Ua,ME._TEMP_POINT=new qi;class RE extends bE{constructor(t){super({maxStyles:16,maxTextures:1,pixelLine:1},void 0,"%PRECISION%\nvarying vec4 vColor;\nvarying vec4 vLine1;\nvarying vec4 vLine2;\nvarying vec4 vArc;\nvarying float vType;\nvarying float vTextureId;\nvarying vec2 vTextureCoord;\nvarying vec2 vTravel;\nuniform sampler2D uSamplers[%MAX_TEXTURES%];\nuniform float dash;\nuniform float gap;\n\n%PIXEL_LINE%\n\nvoid main(void){\n    %PIXEL_COVERAGE%\n\n    float d = dash * vTravel.y;\n    if (d > 0.0) {\n        float g = gap * vTravel.y;\n        if (g > 0.0) {\n            float t = mod(vTravel.x, d + g);\n            alpha *= mix(\n                min(0.5 * d + 0.5 - abs(t - 0.5 * d), 1.0),\n                max(abs(t - 0.5 * g - d) - 0.5 * g + 0.5, 0.0),\n                step(d, t)\n            );\n        }\n    } else {\n        alpha = 0.0;\n    }\n\n    vec4 texColor;\n    float textureId = floor(vTextureId+0.5);\n    %FOR_LOOP%\n\n    gl_FragColor = vColor * texColor * alpha;\n}\n",t||{dash:8,gap:5})}}var PE=function(t){function i(e){return t.call(this,e)||this}return e(i,t),i.prototype.draw=function(t){return this.linkData=t,this.linkContainer=new Ms,this.linkContainer.name=Jl.linkContainer,this.linkContainer.addChild(this.drawLine()),this.linkContainer.addChild(this.drawArrow()),this.linkContainer.addChild(this.drawLabel()),this.linkContainer},i.prototype.drawLine=function(){var t,e,i=(null===(e=null===(t=this.linkData)||void 0===t?void 0:t.style)||void 0===e?void 0:e.lineDash)?new ME:new rh;return i.name=Jl.linkLine,this.calcLine(i),i},i.prototype.calcLine=function(t){var e,i,n=this.linkData.style,r={width:(null==n?void 0:n.lineWidth)||this.cfg.defaultLink.style.lineWidth,color:new qe((null==n?void 0:n.stroke)||this.cfg.defaultLink.style.stroke).toNumber()};(null===(i=null===(e=this.linkData)||void 0===e?void 0:e.style)||void 0===i?void 0:i.lineDash)&&(r.shader=new RE({dash:this.linkData.style.lineDash,gap:8})),t.lineStyle(r),this.point=VT(this.linkData.source,this.linkData.target,this.linkData.target.size||this.cfg.defaultNode.size),t.moveTo(this.linkData.source.x,this.linkData.source.y),t.lineTo(this.point.x,this.point.y)},i.prototype.drawArrow=function(){var t,e,i=new rh;return i.name=Jl.linkArrow,i.beginFill((null===(e=null===(t=this.linkData)||void 0===t?void 0:t.style)||void 0===e?void 0:e.stroke)||this.cfg.defaultLink.style.stroke),i.drawPolygon([0,0,10,-5,6.666666666666667,0,10,5,0,0]),i.rotation=Math.atan2(this.linkData.source.y-this.point.y,this.linkData.source.x-this.point.x),i.position.set(this.point.x,this.point.y),i},i.prototype.drawLabel=function(){var t,e,i,n=null===(t=this.linkData)||void 0===t?void 0:t.labelCfg,r=new Ms;r.name=Jl.linkText;var s=this.cfg.defaultLink,o=new bh({fontSize:(null===(e=null==n?void 0:n.style)||void 0===e?void 0:e.fontSize)||s.labelCfg.style.fontSize,fill:(null===(i=null==n?void 0:n.style)||void 0===i?void 0:i.fill)||s.labelCfg.style.fill,align:(null==n?void 0:n.align)||s.labelCfg.align}),a=new Sh(this.linkData.showName||this.linkData.name||"",o);a.anchor.set(.5);var h=WT(this.linkData.source,this.linkData.target);return a.position.y=this.cfg.defaultLink.labelCfg.offset.y||-8,r.angle=HT(this.linkData.source,this.linkData.target),r.position.set(h.x,h.y),r.addChild(a),r},i.prototype.update=function(t){this.linkData=t;var e=this.linkContainer.getChildByName(Jl.linkLine);e.clear(),this.calcLine(e);var i=this.linkContainer.getChildByName(Jl.linkArrow);i.rotation=Math.atan2(t.source.y-this.point.y,t.source.x-this.point.x),i.position.set(this.point.x,this.point.y);var n=this.linkContainer.getChildByName(Jl.linkText),r=WT(t.source,t.target);n.position.set(r.x,r.y);var s=HT(t.source,t.target);n.angle=s,n.angle=s>90||s<-90?s+180:s},i}(s),DE=function(t){function i(e){return t.call(this,e)||this}return e(i,t),i.prototype.draw=function(t){this.linkData=t,this.linkContainer=new Ms,this.linkContainer.name=Jl.linkContainer;var e=this.drawLine();return this.linkContainer.addChild(e),this.linkContainer.addChild(this.drawLabel(e)),this.linkContainer.addChild(this.drawArrow(e)),this.linkContainer},i.prototype.drawLine=function(){var t=new rh;return t.name=Jl.linkQuadratic,this.calcLine(t),t},i.prototype.calcLine=function(t){var e=this.linkData.style,i=this.linkData.source,n=this.linkData.target,r=YT(i,n,.5,this.linkData._curveOffset);t.lineStyle((null==e?void 0:e.lineWidth)||this.cfg.defaultLink.style.lineWidth,new qe((null==e?void 0:e.stroke)||this.cfg.defaultLink.style.stroke).toNumber(),1),t.moveTo(i.x,i.y),t.quadraticCurveTo(r.x,r.y,n.x,n.y)},i.prototype.drawLabel=function(t){var e,i,n=this.linkData.labelCfg,r=new Ms;r.name=Jl.linkText;var s=this.cfg.defaultLink.labelCfg,o=new bh({fontSize:(null===(e=null==n?void 0:n.style)||void 0===e?void 0:e.fontSize)||s.style.fontSize,fill:(null===(i=null==n?void 0:n.style)||void 0===i?void 0:i.fill)||s.style.fill,align:(null==n?void 0:n.align)||s.align}),a=new Sh(this.linkData.showName||this.linkData.name||"",o);return a.anchor.set(.5),a.position.y=this.cfg.defaultLink.labelCfg.offset.y||-8,this.calcLabel(t,r),r.addChild(a),r},i.prototype.calcLabel=function(t,e){if(!isNaN(this.linkData.source.x)&&!isNaN(this.linkData.source.y)){var i=function(t){for(var e=[],i=0;i<t.length;i+=2){var n={x:t[i],y:t[i+1]};e.push(n)}return e.length%2==0?WT(e[e.length/2-1],e[e.length/2]):e[Math.floor(e.length/2)]}(t.currentPath.points);e.position.set(i.x,i.y);var n=HT(this.linkData.source,this.linkData.target);e.angle=n,e.angle=n>90||n<-90?n+180:n}},i.prototype.drawArrow=function(t){var e,i,n=new rh;return n.name=Jl.linkArrow,n.beginFill((null===(i=null===(e=this.linkData)||void 0===e?void 0:e.style)||void 0===i?void 0:i.stroke)||this.cfg.defaultLink.style.stroke),n.drawPolygon([0,0,10,-5,6.666666666666667,0,10,5,0,0]),this.calcArrow(n,t),n},i.prototype.calcArrow=function(t,e){if(this.linkData.target.x&&this.linkData.source.x){var i=$T(e.currentPath.points,this.linkData.target.size||this.cfg.defaultNode.size),n=VT(i,this.linkData.target,this.linkData.target.size||this.cfg.defaultNode.size);t.position.set(n.x,n.y),t.rotation=Math.atan2(i.y-this.linkData.target.y,i.x-this.linkData.target.x)}},i.prototype.update=function(t){this.linkData=t;var e=this.linkContainer.getChildByName(Jl.linkQuadratic);e.clear(),this.calcLine(e);var i=this.linkContainer.getChildByName(Jl.linkText);this.calcLabel(e,i);var n=this.linkContainer.getChildByName(Jl.linkArrow);this.calcArrow(n,e)},i}(s),OE=function(t){function i(e){return t.call(this,e)||this}return e(i,t),i.prototype.draw=function(t){return this.linkData=t,this.linkContainer=new Ms,this.linkContainer.name=Jl.linkContainer,this.linkContainer.position.set(t.source.x,t.source.y),this.linkContainer.angle=45*t.loopCfg.num,this.linkContainer.addChild(this.drawLine()),this.linkContainer.addChild(this.drawLabel()),this.linkContainer.addChild(this.drawArrow()),this.linkContainer},i.prototype.drawLine=function(){var t=this.linkData.style,e=new rh;return e.name=Jl.linkLoop,e.lineStyle((null==t?void 0:t.lineWidth)||this.cfg.defaultLink.style.lineWidth,new qe((null==t?void 0:t.stroke)||this.cfg.defaultLink.style.stroke).toNumber(),1),e.moveTo(0,0),e.bezierCurveTo(-35,-80,35,-80,0,0),e},i.prototype.drawLabel=function(){var t,e,i=this.linkData.labelCfg,n=this.cfg.defaultLink.labelCfg,r=new bh({fontSize:((null===(t=null==i?void 0:i.style)||void 0===t?void 0:t.fontSize)||n.style.fontSize)-1,fill:(null===(e=null==i?void 0:i.style)||void 0===e?void 0:e.fill)||n.style.fill,align:(null==i?void 0:i.align)||n.align}),s=new Sh(this.linkData.showName||this.linkData.name||"",r);return s.name=Jl.linkText,s.anchor.set(.5),s.position.set(0,-70),s},i.prototype.drawArrow=function(){var t,e=new rh;return e.name=Jl.linkArrow,e.beginFill((null===(t=this.linkData.style)||void 0===t?void 0:t.stroke)||this.cfg.defaultLink.style.stroke),e.drawPolygon([0,0,10,-5,6.666666666666667,0,10,5,0,0]),e.angle=-82,e.position.set(8,-(this.linkData.target.size||this.cfg.defaultNode.size)),e},i.prototype.update=function(t){this.linkContainer.position.set(t.source.x,t.source.y)},i}(s),LE=function(t){function i(e){var i=t.call(this,e)||this;return i.init(),i.initViewport(),i.showFps(),i}return e(i,t),i.prototype.init=function(){var t=document.getElementById(this.cfg.container);this.width=t.getBoundingClientRect().width,this.height=t.getBoundingClientRect().height,this.app=new eo({height:this.height,width:this.width,resolution:2,backgroundAlpha:0,antialias:!0,autoDensity:!0}),this.app.stage.eventMode="static",t.appendChild(this.app.view)},i.prototype.initViewport=function(){this.viewport=new Zl({screenWidth:this.width,screenHeight:this.height,worldWidth:this.width,worldHeight:this.height,events:this.app.renderer.events}),this.app.stage.addChild(this.viewport),this.viewport.drag().pinch().wheel().decelerate({friction:0}).clampZoom({minScale:this.cfg.zoom.minZoom,maxScale:this.cfg.zoom.maxZoom}),this.viewport.moveCenter(0,0),this.graph.viewport=this.viewport},i.prototype.showFps=function(){if(this.cfg.fps){var t=new bh({fontSize:20,fill:"red"}),e=new Sh("",t);e.position.set(10,10),this.app.stage.addChild(e);var i=ss.shared;i.add((function(){e.text="FPS: ".concat(Math.round(i.FPS))}))}},i.prototype.render=function(t){this.data=t,this.viewport.removeChildren(),this.renderLinks(t.links),this.renderNodes(t.nodes),this.canvasEvents=new BT(this)},i.prototype.renderNodes=function(t){var e=this,i=new Ms;i.name=Jl.allNodesGroup;var n=t.map((function(t){var n=new kT(e.cfg),r=n.draw(t);return t.shape=n,i.addChild(r),[t,r]}));this.c2nodeWeekMap=new WeakMap(n.map((function(t){var e=t[0];return[t[1],e]}))),this.graph.c2nodeWeekMap=this.c2nodeWeekMap,this.viewport.addChild(i)},i.prototype.renderLinks=function(t){var e=this,i=new Ms;i.name=Jl.allLinksGroup;var n=t.map((function(t){var n,r=(n="quadratic"===t._linkType?new DE(e.cfg):"loop"===t._linkType?new OE(e.cfg):new PE(e.cfg)).draw(t);return t.shape=n,i.addChild(r),[t,r]}));this.c2linkWeekMap=new WeakMap(n.map((function(t){var e=t[0];return[t[1],e]}))),this.graph.c2linkWeekMap=this.c2linkWeekMap,this.viewport.addChild(i)},i.prototype.update=function(){this.data.nodes.forEach((function(t){t.shape.update(t)})),this.data.links.forEach((function(t){t.shape.update(t)}))},i.prototype.getPointByClient=function(t,e){var i=new qi;return this.app.renderer.plugins.interaction.mapPositionToPoint(i,t,e),this.viewport.toWorld(i)},i.prototype.fitView=function(t){var e=this.graph.data.nodes.map((function(t){return t.x})),i=this.graph.data.nodes.map((function(t){return t.y})),n=Math.min.apply(Math,e),r=Math.max.apply(Math,e),s=Math.min.apply(Math,i),o=Math.max.apply(Math,i),a=Math.abs(r-n),h=Math.abs(o-s),l=new qi(n+a/2,s+h/2),u=a+2*t.padding,c=h+2*t.padding;this.viewport.resize(this.width,this.height,u,c),this.viewport.center=l,this.viewport.fit(!0)},Object.defineProperty(i.prototype,"zoomStep",{get:function(){return Math.min(this.viewport.worldWidth,this.viewport.worldHeight)/10},enumerable:!1,configurable:!0}),i.prototype.zoomIn=function(){this.viewport.zoom(-this.zoomStep,!0)},i.prototype.zoomOut=function(){this.viewport.zoom(this.zoomStep,!0)},i.prototype.clear=function(){},i.prototype.destroy=function(){},i}(n);function NE(t,e,i,n){if(isNaN(e)||isNaN(i))return t;var r,s,o,a,h,l,u,c,d,p=t._root,f={data:n},g=t._x0,m=t._y0,v=t._x1,y=t._y1;if(!p)return t._root=f,t;for(;p.length;)if((l=e>=(s=(g+v)/2))?g=s:v=s,(u=i>=(o=(m+y)/2))?m=o:y=o,r=p,!(p=p[c=u<<1|l]))return r[c]=f,t;if(a=+t._x.call(null,p.data),h=+t._y.call(null,p.data),e===a&&i===h)return f.next=p,r?r[c]=f:t._root=f,t;do{r=r?r[c]=new Array(4):t._root=new Array(4),(l=e>=(s=(g+v)/2))?g=s:v=s,(u=i>=(o=(m+y)/2))?m=o:y=o}while((c=u<<1|l)==(d=(h>=o)<<1|a>=s));return r[d]=p,r[c]=f,t}function BE(t,e,i,n,r){this.node=t,this.x0=e,this.y0=i,this.x1=n,this.y1=r}function kE(t){return t[0]}function FE(t){return t[1]}function UE(t,e,i){var n=new GE(null==e?kE:e,null==i?FE:i,NaN,NaN,NaN,NaN);return null==t?n:n.addAll(t)}function GE(t,e,i,n,r,s){this._x=t,this._y=e,this._x0=i,this._y0=n,this._x1=r,this._y1=s,this._root=void 0}function zE(t){for(var e={data:t.data},i=e;t=t.next;)i=i.next={data:t.data};return e}var jE=UE.prototype=GE.prototype;function HE(t){return function(){return t}}function WE(t){return 1e-6*(t()-.5)}function XE(t){return t.x+t.vx}function VE(t){return t.y+t.vy}function YE(t){return t.index}function $E(t,e){var i=t.get(e);if(!i)throw new Error("node not found: "+e);return i}jE.copy=function(){var t,e,i=new GE(this._x,this._y,this._x0,this._y0,this._x1,this._y1),n=this._root;if(!n)return i;if(!n.length)return i._root=zE(n),i;for(t=[{source:n,target:i._root=new Array(4)}];n=t.pop();)for(var r=0;r<4;++r)(e=n.source[r])&&(e.length?t.push({source:e,target:n.target[r]=new Array(4)}):n.target[r]=zE(e));return i},jE.add=function(t){const e=+this._x.call(null,t),i=+this._y.call(null,t);return NE(this.cover(e,i),e,i,t)},jE.addAll=function(t){var e,i,n,r,s=t.length,o=new Array(s),a=new Array(s),h=1/0,l=1/0,u=-1/0,c=-1/0;for(i=0;i<s;++i)isNaN(n=+this._x.call(null,e=t[i]))||isNaN(r=+this._y.call(null,e))||(o[i]=n,a[i]=r,n<h&&(h=n),n>u&&(u=n),r<l&&(l=r),r>c&&(c=r));if(h>u||l>c)return this;for(this.cover(h,l).cover(u,c),i=0;i<s;++i)NE(this,o[i],a[i],t[i]);return this},jE.cover=function(t,e){if(isNaN(t=+t)||isNaN(e=+e))return this;var i=this._x0,n=this._y0,r=this._x1,s=this._y1;if(isNaN(i))r=(i=Math.floor(t))+1,s=(n=Math.floor(e))+1;else{for(var o,a,h=r-i||1,l=this._root;i>t||t>=r||n>e||e>=s;)switch(a=(e<n)<<1|t<i,(o=new Array(4))[a]=l,l=o,h*=2,a){case 0:r=i+h,s=n+h;break;case 1:i=r-h,s=n+h;break;case 2:r=i+h,n=s-h;break;case 3:i=r-h,n=s-h}this._root&&this._root.length&&(this._root=l)}return this._x0=i,this._y0=n,this._x1=r,this._y1=s,this},jE.data=function(){var t=[];return this.visit((function(e){if(!e.length)do{t.push(e.data)}while(e=e.next)})),t},jE.extent=function(t){return arguments.length?this.cover(+t[0][0],+t[0][1]).cover(+t[1][0],+t[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]},jE.find=function(t,e,i){var n,r,s,o,a,h,l,u=this._x0,c=this._y0,d=this._x1,p=this._y1,f=[],g=this._root;for(g&&f.push(new BE(g,u,c,d,p)),null==i?i=1/0:(u=t-i,c=e-i,d=t+i,p=e+i,i*=i);h=f.pop();)if(!(!(g=h.node)||(r=h.x0)>d||(s=h.y0)>p||(o=h.x1)<u||(a=h.y1)<c))if(g.length){var m=(r+o)/2,v=(s+a)/2;f.push(new BE(g[3],m,v,o,a),new BE(g[2],r,v,m,a),new BE(g[1],m,s,o,v),new BE(g[0],r,s,m,v)),(l=(e>=v)<<1|t>=m)&&(h=f[f.length-1],f[f.length-1]=f[f.length-1-l],f[f.length-1-l]=h)}else{var y=t-+this._x.call(null,g.data),_=e-+this._y.call(null,g.data),x=y*y+_*_;if(x<i){var b=Math.sqrt(i=x);u=t-b,c=e-b,d=t+b,p=e+b,n=g.data}}return n},jE.remove=function(t){if(isNaN(s=+this._x.call(null,t))||isNaN(o=+this._y.call(null,t)))return this;var e,i,n,r,s,o,a,h,l,u,c,d,p=this._root,f=this._x0,g=this._y0,m=this._x1,v=this._y1;if(!p)return this;if(p.length)for(;;){if((l=s>=(a=(f+m)/2))?f=a:m=a,(u=o>=(h=(g+v)/2))?g=h:v=h,e=p,!(p=p[c=u<<1|l]))return this;if(!p.length)break;(e[c+1&3]||e[c+2&3]||e[c+3&3])&&(i=e,d=c)}for(;p.data!==t;)if(n=p,!(p=p.next))return this;return(r=p.next)&&delete p.next,n?(r?n.next=r:delete n.next,this):e?(r?e[c]=r:delete e[c],(p=e[0]||e[1]||e[2]||e[3])&&p===(e[3]||e[2]||e[1]||e[0])&&!p.length&&(i?i[d]=p:this._root=p),this):(this._root=r,this)},jE.removeAll=function(t){for(var e=0,i=t.length;e<i;++e)this.remove(t[e]);return this},jE.root=function(){return this._root},jE.size=function(){var t=0;return this.visit((function(e){if(!e.length)do{++t}while(e=e.next)})),t},jE.visit=function(t){var e,i,n,r,s,o,a=[],h=this._root;for(h&&a.push(new BE(h,this._x0,this._y0,this._x1,this._y1));e=a.pop();)if(!t(h=e.node,n=e.x0,r=e.y0,s=e.x1,o=e.y1)&&h.length){var l=(n+s)/2,u=(r+o)/2;(i=h[3])&&a.push(new BE(i,l,u,s,o)),(i=h[2])&&a.push(new BE(i,n,u,l,o)),(i=h[1])&&a.push(new BE(i,l,r,s,u)),(i=h[0])&&a.push(new BE(i,n,r,l,u))}return this},jE.visitAfter=function(t){var e,i=[],n=[];for(this._root&&i.push(new BE(this._root,this._x0,this._y0,this._x1,this._y1));e=i.pop();){var r=e.node;if(r.length){var s,o=e.x0,a=e.y0,h=e.x1,l=e.y1,u=(o+h)/2,c=(a+l)/2;(s=r[0])&&i.push(new BE(s,o,a,u,c)),(s=r[1])&&i.push(new BE(s,u,a,h,c)),(s=r[2])&&i.push(new BE(s,o,c,u,l)),(s=r[3])&&i.push(new BE(s,u,c,h,l))}n.push(e)}for(;e=n.pop();)t(e.node,e.x0,e.y0,e.x1,e.y1);return this},jE.x=function(t){return arguments.length?(this._x=t,this):this._x},jE.y=function(t){return arguments.length?(this._y=t,this):this._y};var qE={value:()=>{}};function KE(){for(var t,e=0,i=arguments.length,n={};e<i;++e){if(!(t=arguments[e]+"")||t in n||/[\s.]/.test(t))throw new Error("illegal type: "+t);n[t]=[]}return new ZE(n)}function ZE(t){this._=t}function JE(t,e){for(var i,n=0,r=t.length;n<r;++n)if((i=t[n]).name===e)return i.value}function QE(t,e,i){for(var n=0,r=t.length;n<r;++n)if(t[n].name===e){t[n]=qE,t=t.slice(0,n).concat(t.slice(n+1));break}return null!=i&&t.push({name:e,value:i}),t}ZE.prototype=KE.prototype={constructor:ZE,on:function(t,e){var i,n,r=this._,s=(n=r,(t+"").trim().split(/^|\s+/).map((function(t){var e="",i=t.indexOf(".");if(i>=0&&(e=t.slice(i+1),t=t.slice(0,i)),t&&!n.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:e}}))),o=-1,a=s.length;if(!(arguments.length<2)){if(null!=e&&"function"!=typeof e)throw new Error("invalid callback: "+e);for(;++o<a;)if(i=(t=s[o]).type)r[i]=QE(r[i],t.name,e);else if(null==e)for(i in r)r[i]=QE(r[i],t.name,null);return this}for(;++o<a;)if((i=(t=s[o]).type)&&(i=JE(r[i],t.name)))return i},copy:function(){var t={},e=this._;for(var i in e)t[i]=e[i].slice();return new ZE(t)},call:function(t,e){if((i=arguments.length-2)>0)for(var i,n,r=new Array(i),s=0;s<i;++s)r[s]=arguments[s+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(s=0,i=(n=this._[t]).length;s<i;++s)n[s].value.apply(e,r)},apply:function(t,e,i){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var n=this._[t],r=0,s=n.length;r<s;++r)n[r].value.apply(e,i)}};var tA,eA,iA=0,nA=0,rA=0,sA=1e3,oA=0,aA=0,hA=0,lA="object"==typeof performance&&performance.now?performance:Date,uA="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function cA(){return aA||(uA(dA),aA=lA.now()+hA)}function dA(){aA=0}function pA(){this._call=this._time=this._next=null}function fA(t,e,i){var n=new pA;return n.restart(t,e,i),n}function gA(){aA=(oA=lA.now())+hA,iA=nA=0;try{!function(){cA(),++iA;for(var t,e=tA;e;)(t=aA-e._time)>=0&&e._call.call(void 0,t),e=e._next;--iA}()}finally{iA=0,function(){var t,e,i=tA,n=1/0;for(;i;)i._call?(n>i._time&&(n=i._time),t=i,i=i._next):(e=i._next,i._next=null,i=t?t._next=e:tA=e);eA=t,vA(n)}(),aA=0}}function mA(){var t=lA.now(),e=t-oA;e>sA&&(hA-=e,oA=t)}function vA(t){iA||(nA&&(nA=clearTimeout(nA)),t-aA>24?(t<1/0&&(nA=setTimeout(gA,t-lA.now()-hA)),rA&&(rA=clearInterval(rA))):(rA||(oA=lA.now(),rA=setInterval(mA,sA)),iA=1,uA(gA)))}pA.prototype=fA.prototype={constructor:pA,restart:function(t,e,i){if("function"!=typeof t)throw new TypeError("callback is not a function");i=(null==i?cA():+i)+(null==e?0:+e),this._next||eA===this||(eA?eA._next=this:tA=this,eA=this),this._call=t,this._time=i,vA()},stop:function(){this._call&&(this._call=null,this._time=1/0,vA())}};const yA=1664525,_A=1013904223,xA=4294967296;function bA(t){return t.x}function wA(t){return t.y}var TA=Math.PI*(3-Math.sqrt(5));function EA(t){var e,i=1,n=.001,r=1-Math.pow(n,1/300),s=0,o=.6,a=new Map,h=fA(c),l=KE("tick","end"),u=function(){let t=1;return()=>(t=(yA*t+_A)%xA)/xA}();function c(){d(),l.call("tick",e),i<n&&(h.stop(),l.call("end",e))}function d(n){var h,l,u=t.length;void 0===n&&(n=1);for(var c=0;c<n;++c)for(i+=(s-i)*r,a.forEach((function(t){t(i)})),h=0;h<u;++h)null==(l=t[h]).fx?l.x+=l.vx*=o:(l.x=l.fx,l.vx=0),null==l.fy?l.y+=l.vy*=o:(l.y=l.fy,l.vy=0);return e}function p(){for(var e,i=0,n=t.length;i<n;++i){if((e=t[i]).index=i,null!=e.fx&&(e.x=e.fx),null!=e.fy&&(e.y=e.fy),isNaN(e.x)||isNaN(e.y)){var r=10*Math.sqrt(.5+i),s=i*TA;e.x=r*Math.cos(s),e.y=r*Math.sin(s)}(isNaN(e.vx)||isNaN(e.vy))&&(e.vx=e.vy=0)}}function f(e){return e.initialize&&e.initialize(t,u),e}return null==t&&(t=[]),p(),e={tick:d,restart:function(){return h.restart(c),e},stop:function(){return h.stop(),e},nodes:function(i){return arguments.length?(t=i,p(),a.forEach(f),e):t},alpha:function(t){return arguments.length?(i=+t,e):i},alphaMin:function(t){return arguments.length?(n=+t,e):n},alphaDecay:function(t){return arguments.length?(r=+t,e):+r},alphaTarget:function(t){return arguments.length?(s=+t,e):s},velocityDecay:function(t){return arguments.length?(o=1-t,e):1-o},randomSource:function(t){return arguments.length?(u=t,a.forEach(f),e):u},force:function(t,i){return arguments.length>1?(null==i?a.delete(t):a.set(t,f(i)),e):a.get(t)},find:function(e,i,n){var r,s,o,a,h,l=0,u=t.length;for(null==n?n=1/0:n*=n,l=0;l<u;++l)(o=(r=e-(a=t[l]).x)*r+(s=i-a.y)*s)<n&&(h=a,n=o);return h},on:function(t,i){return arguments.length>1?(l.on(t,i),e):l.on(t)}}}var AA=function(t){function i(e){void 0===e&&(e={});var i=t.call(this)||this;return i.onTick=function(){},i.onLayoutEnd=function(){},i.layoutCfg=Ax(i.getDefaultCfg(),e),i}return e(i,t),i.prototype.getDefaultCfg=function(){return{charge:{enabled:!0,autoCalcStrength:!0,strength:-20,theta:.9,strengthFn:null},collide:{enabled:!0,strength:1,radius:30,iterations:1,strengthFn:null},link:{enabled:!0,autoCalcLength:!0,strength:.8,length:100,minLength:100,strengthFn:null},alpha:.5,minVelocityDecay:.1,customVelocityDecay:null,xForce:{enabled:!0,x:0,xFn:null,strength:.1,strengthFn:null},yForce:{enabled:!0,y:0,yFn:null,strength:.1,strengthFn:null},radialForce:{x:0,y:0,diffRadius:200,enabled:!1,border:!1,rFn:function(){return 300},strengthFn:function(){return 3}},center:{x:0,y:0,enabled:!1,strength:.5},onTick:function(){},onLayoutEnd:function(){}}},i.prototype.init=function(t){this.nodes=t.nodes,this.links=t.links,function(t){var e=new Map;t.nodes.map((function(i){var n=t.links.filter((function(t){return XT(t.source)===i.id||XT(t.target)===i.id})).length;i._weight=n,e.set(i.id,n)})),t.links.map((function(t){var i=e.get(XT(t.target)),n=e.get(XT(t.source));t._weight=Math.max(i,n)}))}(t),this.calcLinkMinLength(this.nodes)},i.prototype.execute=function(){var t,e=this,i=this.layoutCfg;if(this.simulation)this.simulation.stop(),this.simulation.nodes(this.nodes),null===(t=this.simulation.force("link"))||void 0===t||t.links(this.links),this.simulation.alpha(this.layoutCfg.alpha).restart();else{var n=EA(this.nodes);this.simulation=n,i.center.enabled&&n.force("center",function(t,e){var i,n=1;function r(){var r,s,o=i.length,a=0,h=0;for(r=0;r<o;++r)a+=(s=i[r]).x,h+=s.y;for(a=(a/o-t)*n,h=(h/o-e)*n,r=0;r<o;++r)(s=i[r]).x-=a,s.y-=h}return null==t&&(t=0),null==e&&(e=0),r.initialize=function(t){i=t},r.x=function(e){return arguments.length?(t=+e,r):t},r.y=function(t){return arguments.length?(e=+t,r):e},r.strength=function(t){return arguments.length?(n=+t,r):n},r}(i.center.x,i.center.y).strength(i.center.strength));var r=i.xForce;r&&(null==r?void 0:r.enabled)&&n.force("x",function(t){var e,i,n,r=HE(.1);function s(t){for(var r,s=0,o=e.length;s<o;++s)(r=e[s]).vx+=(n[s]-r.x)*i[s]*t}function o(){if(e){var s,o=e.length;for(i=new Array(o),n=new Array(o),s=0;s<o;++s)i[s]=isNaN(n[s]=+t(e[s],s,e))?0:+r(e[s],s,e)}}return"function"!=typeof t&&(t=HE(null==t?0:+t)),s.initialize=function(t){e=t,o()},s.strength=function(t){return arguments.length?(r="function"==typeof t?t:HE(+t),o(),s):r},s.x=function(e){return arguments.length?(t="function"==typeof e?e:HE(+e),o(),s):t},s}(r.xFn||(null==r?void 0:r.x)).strength(r.strengthFn||(null==r?void 0:r.strength)));var s=i.yForce;s&&(null==s?void 0:s.enabled)&&n.force("y",function(t){var e,i,n,r=HE(.1);function s(t){for(var r,s=0,o=e.length;s<o;++s)(r=e[s]).vy+=(n[s]-r.y)*i[s]*t}function o(){if(e){var s,o=e.length;for(i=new Array(o),n=new Array(o),s=0;s<o;++s)i[s]=isNaN(n[s]=+t(e[s],s,e))?0:+r(e[s],s,e)}}return"function"!=typeof t&&(t=HE(null==t?0:+t)),s.initialize=function(t){e=t,o()},s.strength=function(t){return arguments.length?(r="function"==typeof t?t:HE(+t),o(),s):r},s.y=function(e){return arguments.length?(t="function"==typeof e?e:HE(+e),o(),s):t},s}(s.yFn||(null==s?void 0:s.y)).strength(s.strengthFn||(null==s?void 0:s.strength)));var o=i.radialForce;o&&o.enabled&&n.force("r",function(t,e,i){var n,r,s,o=HE(.1);function a(t){for(var o=0,a=n.length;o<a;++o){var h=n[o],l=h.x-e||1e-6,u=h.y-i||1e-6,c=Math.sqrt(l*l+u*u),d=(s[o]-c)*r[o]*t/c;h.vx+=l*d,h.vy+=u*d}}function h(){if(n){var e,i=n.length;for(r=new Array(i),s=new Array(i),e=0;e<i;++e)s[e]=+t(n[e],e,n),r[e]=isNaN(s[e])?0:+o(n[e],e,n)}}return"function"!=typeof t&&(t=HE(+t)),null==e&&(e=0),null==i&&(i=0),a.initialize=function(t){n=t,h()},a.strength=function(t){return arguments.length?(o="function"==typeof t?t:HE(+t),h(),a):o},a.radius=function(e){return arguments.length?(t="function"==typeof e?e:HE(+e),h(),a):t},a.x=function(t){return arguments.length?(e=+t,a):e},a.y=function(t){return arguments.length?(i=+t,a):i},a}(o.rFn,(null==o?void 0:o.x)||(null==r?void 0:r.x),(null==o?void 0:o.y)||(null==s?void 0:s.y)).strength(o.strengthFn));var a=i.charge;a&&a.enabled&&n.force("charge",function(){var t,e,i,n,r,s=HE(-30),o=1,a=1/0,h=.81;function l(i){var r,s=t.length,o=UE(t,bA,wA).visitAfter(c);for(n=i,r=0;r<s;++r)e=t[r],o.visit(d)}function u(){if(t){var e,i,n=t.length;for(r=new Array(n),e=0;e<n;++e)i=t[e],r[i.index]=+s(i,e,t)}}function c(t){var e,i,n,s,o,a=0,h=0;if(t.length){for(n=s=o=0;o<4;++o)(e=t[o])&&(i=Math.abs(e.value))&&(a+=e.value,h+=i,n+=i*e.x,s+=i*e.y);t.x=n/h,t.y=s/h}else{(e=t).x=e.data.x,e.y=e.data.y;do{a+=r[e.data.index]}while(e=e.next)}t.value=a}function d(t,s,l,u){if(!t.value)return!0;var c=t.x-e.x,d=t.y-e.y,p=u-s,f=c*c+d*d;if(p*p/h<f)return f<a&&(0===c&&(f+=(c=WE(i))*c),0===d&&(f+=(d=WE(i))*d),f<o&&(f=Math.sqrt(o*f)),e.vx+=c*t.value*n/f,e.vy+=d*t.value*n/f),!0;if(!(t.length||f>=a)){(t.data!==e||t.next)&&(0===c&&(f+=(c=WE(i))*c),0===d&&(f+=(d=WE(i))*d),f<o&&(f=Math.sqrt(o*f)));do{t.data!==e&&(p=r[t.data.index]*n/f,e.vx+=c*p,e.vy+=d*p)}while(t=t.next)}}return l.initialize=function(e,n){t=e,i=n,u()},l.strength=function(t){return arguments.length?(s="function"==typeof t?t:HE(+t),u(),l):s},l.distanceMin=function(t){return arguments.length?(o=t*t,l):Math.sqrt(o)},l.distanceMax=function(t){return arguments.length?(a=t*t,l):Math.sqrt(a)},l.theta=function(t){return arguments.length?(h=t*t,l):Math.sqrt(h)},l}().strength(a.strengthFn?a.strengthFn:function(t){if(a.autoCalcStrength){var e=(null==t?void 0:t._weight)||0;if(e>1){var i=Math.min(-500*e,-800);return i<-3e4&&(i=-3e4),i}return-200}return a.strength}).theta(a.theta));var h=i.collide;h&&h.enabled&&n.force("collide",function(t){var e,i,n,r=1,s=1;function o(){for(var t,o,h,l,u,c,d,p=e.length,f=0;f<s;++f)for(o=UE(e,XE,VE).visitAfter(a),t=0;t<p;++t)h=e[t],c=i[h.index],d=c*c,l=h.x+h.vx,u=h.y+h.vy,o.visit(g);function g(t,e,i,s,o){var a=t.data,p=t.r,f=c+p;if(!a)return e>l+f||s<l-f||i>u+f||o<u-f;if(a.index>h.index){var g=l-a.x-a.vx,m=u-a.y-a.vy,v=g*g+m*m;v<f*f&&(0===g&&(v+=(g=WE(n))*g),0===m&&(v+=(m=WE(n))*m),v=(f-(v=Math.sqrt(v)))/v*r,h.vx+=(g*=v)*(f=(p*=p)/(d+p)),h.vy+=(m*=v)*f,a.vx-=g*(f=1-f),a.vy-=m*f)}}}function a(t){if(t.data)return t.r=i[t.data.index];for(var e=t.r=0;e<4;++e)t[e]&&t[e].r>t.r&&(t.r=t[e].r)}function h(){if(e){var n,r,s=e.length;for(i=new Array(s),n=0;n<s;++n)r=e[n],i[r.index]=+t(r,n,e)}}return"function"!=typeof t&&(t=HE(null==t?1:+t)),o.initialize=function(t,i){e=t,n=i,h()},o.iterations=function(t){return arguments.length?(s=+t,o):s},o.strength=function(t){return arguments.length?(r=+t,o):r},o.radius=function(e){return arguments.length?(t="function"==typeof e?e:HE(+e),h(),o):t},o}().radius(h.radius).strength(h.strengthFn||h.strength).iterations(h.iterations)),null==n||n.nodes(this.nodes);var l=i.link;l&&l.enabled&&n.force("link",function(t){var e,i,n,r,s,o,a=YE,h=function(t){return 1/Math.min(r[t.source.index],r[t.target.index])},l=HE(30),u=1;function c(n){for(var r=0,a=t.length;r<u;++r)for(var h,l,c,d,p,f,g,m=0;m<a;++m)l=(h=t[m]).source,d=(c=h.target).x+c.vx-l.x-l.vx||WE(o),p=c.y+c.vy-l.y-l.vy||WE(o),d*=f=((f=Math.sqrt(d*d+p*p))-i[m])/f*n*e[m],p*=f,c.vx-=d*(g=s[m]),c.vy-=p*g,l.vx+=d*(g=1-g),l.vy+=p*g}function d(){if(n){var o,h,l=n.length,u=t.length,c=new Map(n.map(((t,e)=>[a(t,e,n),t])));for(o=0,r=new Array(l);o<u;++o)(h=t[o]).index=o,"object"!=typeof h.source&&(h.source=$E(c,h.source)),"object"!=typeof h.target&&(h.target=$E(c,h.target)),r[h.source.index]=(r[h.source.index]||0)+1,r[h.target.index]=(r[h.target.index]||0)+1;for(o=0,s=new Array(u);o<u;++o)h=t[o],s[o]=r[h.source.index]/(r[h.source.index]+r[h.target.index]);e=new Array(u),p(),i=new Array(u),f()}}function p(){if(n)for(var i=0,r=t.length;i<r;++i)e[i]=+h(t[i],i,t)}function f(){if(n)for(var e=0,r=t.length;e<r;++e)i[e]=+l(t[e],e,t)}return null==t&&(t=[]),c.initialize=function(t,e){n=t,o=e,d()},c.links=function(e){return arguments.length?(t=e,d(),c):t},c.id=function(t){return arguments.length?(a=t,c):a},c.iterations=function(t){return arguments.length?(u=+t,c):u},c.strength=function(t){return arguments.length?(h="function"==typeof t?t:HE(+t),p(),c):h},c.distance=function(t){return arguments.length?(l="function"==typeof t?t:HE(+t),f(),c):l},c}(this.links).id((function(t){return t.id})).distance((function(t){var e,n=Math.max(i.link.length,i.link.minLength);return e=i.link.autoCalcLength?Math.max(n-10*((null==t?void 0:t._weight)||0),i.link.minLength):n,"quadratic"===t._linkType&&(e*=1.2+.1*t._sameCount),e})).strength(l.strengthFn||l.strength));var u=this.nodes.length+this.links.length;if(i.customVelocityDecay)n.velocityDecay(i.customVelocityDecay);else{var c=i.minVelocityDecay+.001*u;c>.4&&(c=.4),n.velocityDecay(c)}n.on("tick",(function(){return e.onTick()})),n.on("end",(function(){return e.onLayoutEnd()})),n.alpha(this.layoutCfg.alpha),n.restart()}},i.prototype.updateCfg=function(t){void 0===t&&(t={}),this.simulation.stop(),this.simulation=null,this.layoutCfg=Ax(this.getDefaultCfg(),t)},i.prototype.getType=function(){return"force"},i.prototype.getCfg=function(){return this.layoutCfg},i.prototype.calcLinkMinLength=function(t){t.length<=15&&(this.layoutCfg.link.minLength=150)},i}(r),SA=function(){function t(t){var e=this;this.graph=t,this.holdNodesPosition=function(t){var i=e.graph.data.nodes,n=e.graph.data.links,r=new Map(i.map((function(t){return[t.id,t]}))),s=new Map(n.map((function(t){return[t.id,t]})));return t.nodes=t.nodes.map((function(t){return Object.assign(r.get(t.id)||{},t)})),t.links=t.links.map((function(t,e){var i,n,r;return r="[object Object]"===Object.prototype.toString.call(t.source)?"".concat(null===(i=t.source)||void 0===i?void 0:i.id,"-").concat(null===(n=t.target)||void 0===n?void 0:n.id,"-").concat(e):"".concat(t.source,"-").concat(t.target,"-").concat(e),Object.assign(s.get(t.id)||{},{id:r},t)})),t.links.forEach((function(e){"[object Object]"!==Object.prototype.toString.call(e.source)&&(e.source=t.nodes.find((function(t){return t.id===e.source}))),"[object Object]"!==Object.prototype.toString.call(e.target)&&(e.target=t.nodes.find((function(t){return t.id===e.target})))})),t},this.cfg=this.graph.cfg,this.initLayout()}return t.prototype.initLayout=function(){var t,e,i=this;if(this.cfg.layout&&this.cfg.layout.type||(this.cfg.layout={type:"force"}),this.canvasRender=new LE(this.graph),"force"===(null===(e=null===(t=this.cfg)||void 0===t?void 0:t.layout)||void 0===e?void 0:e.type)){this.layoutClass=new AA(this.cfg.layout);var n=this.cfg.layout.onTick;this.layoutClass.onTick=function(){i.canvasRender.update(),n&&n()}}this.forceLayoutOnDrag()},t.prototype.clearView=function(){this.canvasRender.clear()},t.prototype.forceLayoutOnDrag=function(){var t,e,i=this;"force"===(null===(e=null===(t=this.cfg)||void 0===t?void 0:t.layout)||void 0===e?void 0:e.type)&&(this.graph.on("node:dragstart",(function(){i.layoutClass.simulation.alphaTarget(.3).restart()})),this.graph.on("node:dragend",(function(){i.layoutClass.simulation.alphaTarget(0)})))},t.prototype.execLayoutMethod=function(t){this.layoutClass.layout(t)},t.prototype.changeData=function(t){var e=this.holdNodesPosition(t);this.graph.data=e,function(t,e){void 0===e&&(e=30);for(var i="line",n=t.length,r=2*e,s={},o=[],a={},h=0;h<n;h++){var l=t[h],u=XT(l.source),c=XT(l.target),d="".concat(u,"-").concat(c);if(!o[h]){s[d]||(s[d]=[]),o[h]=!0,s[d].push(l);for(var p=0;p<n;p++)if(h!==p){var f=t[p],g=XT(f.source),m=XT(f.target);o[p]||(u===m&&c===g?(s[d].push(f),o[p]=!0,a["".concat(g,"|").concat(m,"|").concat(s[d].length-1)]=!0):u===g&&c===m&&(s[d].push(f),o[p]=!0))}for(var v in s)for(var y=s[v],_=y.length,x=0;x<_;x++){var b=y[x];if(b._uid="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString()})),XT(b.source)!==XT(b.target))if(1!==_||XT(b.source)===XT(b.target)){b._linkType="quadratic",b._sameCount=_;var w=(x%2==0?1:-1)*(a["".concat(XT(b.source),"|").concat(XT(b.target),"|").concat(x)]?-1:1);b._curveOffset=_%2==1?w*Math.ceil(x/2)*r:w*(Math.floor(x/2)*r+e)}else b._linkType=i;else b._linkType="loop",b.loopCfg={num:x,dist:20*Math.floor(x/8)+50}}}}}(this.graph.data.links),this.canvasRender.render(this.graph.data),this.execLayoutMethod(this.graph.data)},t.prototype.updateLayout=function(t){void 0===t&&(t={}),"force"===this.cfg.layout.type&&(this.layoutClass.updateCfg(t),this.canvasRender.render(this.graph.data),this.layoutClass.execute())},t.prototype.reRender=function(){this.canvasRender.render(this.graph.data),this.execLayoutMethod(this.graph.data)},t.prototype.getPointByClient=function(t,e){return this.canvasRender.getPointByClient(t,e)},t.prototype.getLayoutCfg=function(){return this.layoutClass.getCfg()},t.prototype.getCanvasRender=function(){return this.canvasRender},t}(),CA=function(t){function i(e){var i=t.call(this,e)||this;return i.graph=e,i}return e(i,t),i.prototype.bind=function(){t.prototype.bind.call(this),this.graph.viewport.plugins.resume("wheel")},i.prototype.unbind=function(){t.prototype.unbind.call(this),this.graph.viewport.plugins.pause("wheel")},i}(o),IA=function(t){function i(e){return t.call(this,e)||this}return e(i,t),i.prototype.bind=function(){t.prototype.bind.call(this),this.graph.viewport.plugins.resume("drag")},i.prototype.unbind=function(){t.prototype.unbind.call(this),this.graph.viewport.plugins.pause("drag")},i}(o),MA=function(t){function i(e){return t.call(this,e)||this}return e(i,t),i.prototype.getEvents=function(){return{"node:dragstart":"onDragstart","node:drag":"onNodeDrag","node:dragend":"onDragend"}},i.prototype.onDragstart=function(){this.graph.viewport.pause=!0},i.prototype.onNodeDrag=function(t){t._data_.fx=t.point.x,t._data_.fy=t.point.y},i.prototype.onDragend=function(){this.graph.viewport.pause=!1},i}(o),RA=function(t){function i(e){var i=t.call(this,e)||this;return i.drawLinkState={isDrawing:!1,startNode:null,endNode:null},i}return e(i,t),i.prototype.getEvents=function(){return{"node:mouseenter":"mouseenter","node:mousemove":"mousemove","node:mouseout":"mouseout","node:mouseup":"mouseup"}},i.prototype.mouseenter=function(t){var e=t.shape;e.getChildByName(Jl.addLink)||e.addChild(this.createAddLinkGraphics())},i.prototype.mousemove=function(t){var e=t.shape,i=t._data_,n=e.getChildByName(Jl.addLink),r=i.size,s=e.toLocal(t.data.global),o=function(t,e,i,n,r){var s=Math.sqrt(Math.pow(t-i,2)+Math.pow(e-n,2));return{x:r/s*(t-i)+i,y:r/s*(e-n)+n,dist:s}}(s.x,s.y,0,0,r||this.graph.cfg.defaultNode.size);n.position.set(o.x,o.y),n.visible=!this.drawLinkState.isDrawing,this.renderNodeBorder(e,i,!0)},i.prototype.mouseout=function(t){var e=t.shape,i=t._data_;e.getChildByName(Jl.addLink).visible=!1,this.renderNodeBorder(e,i)},i.prototype.mouseup=function(t){if(this.drawLinkState.isDrawing){var e=t.shape,i=t._data_;this.renderNodeBorder(e,i)}},i.prototype.createAddLinkGraphics=function(){var t=this,e=null,i=new rh;return i.name=Jl.addLink,i.beginFill("#fff"),i.lineStyle({width:2,color:"rgb(0, 199, 117)"}),i.drawCircle(0,0,8),i.cursor="cell",i.eventMode="static",i.visible=!1,this.graph.viewport.addChild(i),i.on("mouseenter",(function(){i.visible=!0})),i.on("mouseout",(function(t){i.visible=!1})),i.on("mousedown",(function(i){i.stopPropagation();var s=i.target.parent;e=s.position,t.drawLinkState.isDrawing=!0,t.drawLinkState.startNode=t.getNodeDataByContainer(s);var o=new ME;o.name=Jl.addLinkLine,t.graph.viewport.addChild(o),t.graph.on("canvas:mousemove",n),t.graph.on("canvas:mouseup",r),t.graph.viewport.pause=!0})),i;function n(i){if(e){var n=t.graph.viewport.toWorld(i.data.global),r=t.graph.viewport.getChildByName(Jl.addLinkLine),s=new RE({dash:5,gap:8});r.clear(),r.lineStyle({color:"orange",width:2,shader:s});var o=VT(n,e,t.graph.cfg.defaultNode.size);r.moveTo(o.x,o.y),r.lineTo(n.x,n.y)}}function r(i){e=null,t.drawLinkState.isDrawing=!1,t.graph.viewport.getChildByName(Jl.addLinkLine).destroy(),t.graph.off("canvas:mousemove",n),t.graph.off("canvas:mouseup",r),t.graph.viewport.pause=!1;var s=i.target;"nodeContainer"==(null==s?void 0:s.name)&&(t.drawLinkState.endNode=t.getNodeDataByContainer(s),t.graph.emit(Ql.IDrawLinkEnd,{startNode:t.drawLinkState.startNode,endNode:t.drawLinkState.endNode}),t.drawLinkState.isDrawing=!1,t.drawLinkState.startNode=null,t.drawLinkState.endNode=null)}},i.prototype.renderNodeBorder=function(t,e,i){var n;if(void 0===i&&(i=!1),this.drawLinkState.isDrawing){var r=t.getChildByName(Jl.nodeCircle);r.clear(),i&&r.lineStyle({color:"orange",width:1}),r.beginFill((null===(n=e.style)||void 0===n?void 0:n.fill)||this.graph.cfg.defaultNode.style.fill),r.drawCircle(0,0,e.size||this.graph.cfg.defaultNode.size),r.endFill()}},i.prototype.getNodeDataByContainer=function(t){return this.graph.c2nodeWeekMap.get(t)},i}(o),PA=function(){function t(t){this.graph=t,this.modes={default:[]},this.currentBehaviors=[],this.initBehavior(),this.setMode(this.graph.cfg.currentMode)}return t.prototype.initBehavior=function(){this.behaviors={"zoom-canvas":new CA(this.graph),"drag-canvas":new IA(this.graph),"drag-node":new MA(this.graph),"create-edge":new RA(this.graph)}},t.prototype.bindBehavior=function(){var t=this,e=this.graph.cfg.modes[this.graph.currentMode],i=Object.keys(this.behaviors);null==e||e.forEach((function(e){i.includes(e)&&(t.behaviors[e].bind(),t.currentBehaviors.push(t.behaviors[e]))}))},t.prototype.unbindBehavior=function(){this.currentBehaviors.forEach((function(t){t.unbind()}))},t.prototype.setMode=function(t){this.currentMode=t,this.unbindBehavior(),this.bindBehavior()},t.prototype.getMode=function(){return this.currentMode},t}(),DA={container:"",debug:!1,fps:!1,defaultNode:{size:25,style:{fill:"#bdd2fd"},labelCfg:{align:"center",style:{fontSize:12,fill:"#fff"}}},defaultLink:{style:{stroke:"#333333",lineWidth:1},labelCfg:{align:"center",style:{fontSize:12,fill:"#000"},offset:{y:-8}}},zoom:{minZoom:.4,maxZoom:2},modes:{default:[]},currentMode:"default",plugins:[]},OA=function(t){function i(e){var i=t.call(this)||this;return i.data={nodes:[],links:[]},i.cfg=Ax(i.getDefaultCfg(),e),i.init(),e.debug&&console.warn("[ pixi-graph-genji ] version:0.0.8"),i}return e(i,t),i.prototype.getDefaultCfg=function(){return Jm(DA)},i.prototype.init=function(){this.layoutController=new SA(this),this.modeController=new PA(this)},i.prototype.changeData=function(t){void 0===t?this.layoutController.reRender():this.layoutController.changeData(t)},i.prototype.clearState=function(){this.data={nodes:[],links:[]},this.layoutController.clearView()},i.prototype.updateLayout=function(t){this.cfg.layout=Ax(this.cfg.layout,t),this.layoutController.updateLayout(t)},i.prototype.fitView=function(t){void 0===t&&(t={padding:50}),this.layoutController.getCanvasRender().fitView(t)},i.prototype.zoomIn=function(){this.layoutController.getCanvasRender().zoomIn()},i.prototype.zoomOut=function(){this.layoutController.getCanvasRender().zoomOut()},i.prototype.setMode=function(t){var e=Object.keys(this.cfg.modes);e.includes(t)?(this.cfg.currentMode=t,this.modeController.setMode(t)):console.warn("".concat(t,", ").concat(e.join(",")))},i.prototype.getPointByClient=function(t,e){return this.layoutController.getPointByClient(t,e)},Object.defineProperty(i.prototype,"currentMode",{get:function(){return this.cfg.currentMode},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"layoutCfg",{get:function(){return this.layoutController.getLayoutCfg()},enumerable:!1,configurable:!0}),i.prototype.destroy=function(){this.clearEvents(),this.clearState(),this.layoutController=null,this.modeController=null},i}(i),LA={Graph:OA};export{o as BaseBehavior,r as BaseLayout,s as BaseShape,Jl as ContainerName,n as ElementRender,OA as Graph,NT as ModeType,LA as default};
